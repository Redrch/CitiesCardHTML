# æŠ€èƒ½æ›´æ–°æŠ¥å‘Š - é¢œè‰²æŠ€èƒ½ç§»é™¤åçš„ä¿®æ”¹

**ä¿®å¤æ—¥æœŸ**: 2026-01-07
**ä¿®å¤å†…å®¹**: ç„•ç„¶ä¸€æ–°å’Œæ¨ªæ‰«ä¸€ç©ºæŠ€èƒ½è°ƒæ•´ + å¼€å‘æœåŠ¡å™¨å¯åŠ¨

---

## âœ… é—®é¢˜1: Vueå¼€å‘æœåŠ¡å™¨æ— æ³•è®¿é—®

### é—®é¢˜
- è®¿é—® `http://localhost:5173/` æ—¶æ˜¾ç¤º"è¿æ¥è¢«æ‹’ç»"

### è§£å†³æ–¹æ¡ˆ
å·²æˆåŠŸå¯åŠ¨Viteå¼€å‘æœåŠ¡å™¨ï¼š
```bash
npm run dev
```

**æœåŠ¡å™¨çŠ¶æ€**: âœ… è¿è¡Œä¸­
**è®¿é—®åœ°å€**: http://localhost:5173/
**å¯åŠ¨æ—¶é—´**: 288ms

---

## âœ… é—®é¢˜2: Vueç‰ˆæœ¬æŠ€èƒ½ä¿®æ”¹ï¼ˆé¢œè‰²æŠ€èƒ½å·²åˆ é™¤ï¼‰

### 2.1 ç„•ç„¶ä¸€æ–° (2é‡‘å¸)

**æ—§åŠŸèƒ½** (å·²åºŸå¼ƒ):
- æ¸…é™¤åŸå¸‚é¢œè‰²æŠ€èƒ½ç­‰çº§ (red, green, blue, yellow)

**æ–°åŠŸèƒ½**:
- é‡ç½®åŸå¸‚ä¸“å±æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°åˆ°0
- æ¸…é™¤åŸå¸‚ç‰¹æ®ŠçŠ¶æ€ï¼ˆå¯é€‰ï¼‰

**ä¿®æ”¹æ–‡ä»¶**:
1. âœ… `src/composables/skills/nonBattleSkills.js` (line 1021-1061)
   ```javascript
   // é‡ç½®åŸå¸‚ä¸“å±æŠ€èƒ½çš„ä½¿ç”¨æ¬¡æ•°
   if (selfCity.skillUsageCount) {
     selfCity.skillUsageCount = 0
   }

   // æ¸…é™¤ç‰¹æ®ŠçŠ¶æ€
   if (selfCity.specialState) {
     delete selfCity.specialState
   }
   ```

2. âœ… `src/components/Skills/SkillSelector.vue` (line 279)
   - **æ—§æè¿°**: 'æ¸…é™¤åŸå¸‚é¢œè‰²æŠ€èƒ½æ•ˆæœ'
   - **æ–°æè¿°**: 'é‡ç½®åŸå¸‚ä¸“å±æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°'
   - **requiresTarget**: false â†’ true (éœ€è¦é€‰æ‹©å·±æ–¹åŸå¸‚)
   - **category**: 'control' (ä¿æŒä¸å˜)

3. âœ… `src/components/Skills/SkillSelector.vue` (line 643)
   - **æ—§è°ƒç”¨**: `executeHuanRanYiXin(props.currentPlayer)`
   - **æ–°è°ƒç”¨**: `executeHuanRanYiXin(props.currentPlayer, getSelfCityObject())`

---

### 2.2 æ¨ªæ‰«ä¸€ç©º

**æ—§åŠŸèƒ½** (å·²åºŸå¼ƒ):
- æ¸…é™¤å¯¹æ‰‹æ‰€æœ‰åŸå¸‚çš„é¢œè‰²æŠ€èƒ½ (red, green, blue, yellow)

**æ–°åŠŸèƒ½**:
- æ¸…ç©ºå¯¹æ‰‹**æˆ˜æ–—é¢„å¤‡åŸå¸‚**çš„åŸå¸‚ä¸“å±æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°
- åªå½±å“åœ¨rosterä¸­çš„åŸå¸‚

**ä¿®æ”¹æ–‡ä»¶**:
1. âœ… `src/composables/skills/nonBattleSkills.js` (line 2082-2138)
   ```javascript
   // è·å–å¯¹æ‰‹çš„æˆ˜æ–—é¢„å¤‡åŸå¸‚ç´¢å¼•åˆ—è¡¨
   const rosterIndices = gameStore.roster[target.name] || []

   // åªæ¸…ç©ºæˆ˜æ–—é¢„å¤‡åŸå¸‚çš„åŸå¸‚ä¸“å±æŠ€èƒ½ä½¿ç”¨æ¬¡æ•°
   rosterIndices.forEach(cityIdx => {
     const city = target.cities[cityIdx]
     if (city && city.skillUsageCount !== undefined) {
       city.skillUsageCount = 0
       count++
     }
   })
   ```

2. âœ… `src/components/Skills/SkillSelector.vue` (line 324)
   - **æ—§æè¿°**: 'æ‘§æ¯å¯¹æ‰‹æ‰€æœ‰HP<10000åŸå¸‚'
   - **æ–°æè¿°**: 'æ¸…ç©ºå¯¹æ‰‹æˆ˜æ–—é¢„å¤‡åŸå¸‚çš„åŸå¸‚ä¸“å±æŠ€èƒ½'
   - **category**: 'damage' â†’ 'control'
   - **requiresTarget**: true (ä¿æŒä¸å˜)

---

## âœ… é—®é¢˜3: HTMLç‰ˆæœ¬æ¨ªæ‰«ä¸€ç©ºé‡‘å¸æˆæœ¬è°ƒæ•´

### è°ƒæ•´å†…å®¹
- **Vueç‰ˆæœ¬**: ä¿æŒ 7 é‡‘å¸
- **HTMLç‰ˆæœ¬**: 7 â†’ 5 é‡‘å¸

### ä¿®æ”¹ä½ç½®

#### citycard_web.html

1. âœ… **SKILL_COST_MAP** (line 842)
   ```javascript
   // ä¿®æ”¹å‰
   'æ¨ªæ‰«ä¸€ç©º': 7,

   // ä¿®æ”¹å
   'æ¨ªæ‰«ä¸€ç©º': 5,
   ```

2. âœ… **æŠ€èƒ½ä½¿ç”¨Modal** (line 29644)
   ```javascript
   // ä¿®æ”¹å‰
   useSkillWithModal('æ¨ªæ‰«ä¸€ç©º', 8, {

   // ä¿®æ”¹å
   useSkillWithModal('æ¨ªæ‰«ä¸€ç©º', 5, {
   ```

3. âœ… **æ‰§è¡Œå‡½æ•°è°ƒç”¨** (line 29647)
   ```javascript
   // ä¿®æ”¹å‰
   await executeSweepAll(selections, 8);

   // ä¿®æ”¹å
   await executeSweepAll(selections, 5);
   ```

4. âœ… **éªŒè¯**: åœ¨å¦ä¸€ä¸ªSKILL_COST_MAPå‰¯æœ¬ä¸­ä¹Ÿå·²æ›´æ–° (line 32647)

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

### Vueç‰ˆæœ¬
| æ–‡ä»¶ | ä¿®æ”¹é¡¹ | çŠ¶æ€ |
|------|--------|------|
| nonBattleSkills.js | ç„•ç„¶ä¸€æ–°å‡½æ•° | âœ… |
| nonBattleSkills.js | æ¨ªæ‰«ä¸€ç©ºå‡½æ•° | âœ… |
| SkillSelector.vue | ç„•ç„¶ä¸€æ–°æè¿° | âœ… |
| SkillSelector.vue | ç„•ç„¶ä¸€æ–°è°ƒç”¨ | âœ… |
| SkillSelector.vue | æ¨ªæ‰«ä¸€ç©ºæè¿° | âœ… |

### HTMLç‰ˆæœ¬
| ä½ç½® | ä¿®æ”¹é¡¹ | çŠ¶æ€ |
|------|--------|------|
| line 842 | SKILL_COST_MAP | âœ… 7â†’5 |
| line 29644 | useSkillWithModal | âœ… 8â†’5 |
| line 29647 | executeSweepAllè°ƒç”¨ | âœ… 8â†’5 |
| line 32647 | SKILL_COST_MAPå‰¯æœ¬ | âœ… 7â†’5 |

---

## ğŸ¯ æŠ€èƒ½å¯¹æ¯”è¡¨

| æŠ€èƒ½ | Vueç‰ˆæœ¬ | HTMLç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|----------|------|
| ç„•ç„¶ä¸€æ–° | 2é‡‘å¸ | 2é‡‘å¸ | é‡ç½®åŸå¸‚ä¸“å±æŠ€èƒ½ä½¿ç”¨æ¬¡æ•° |
| æ¨ªæ‰«ä¸€ç©º | 7é‡‘å¸ | 5é‡‘å¸ | æ¸…ç©ºå¯¹æ‰‹æˆ˜æ–—é¢„å¤‡åŸå¸‚ä¸“å±æŠ€èƒ½ |

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. Vueç‰ˆæœ¬æµ‹è¯•

#### ç„•ç„¶ä¸€æ–°
1. é€‰æ‹©å·±æ–¹ä¸€åº§ä½¿ç”¨è¿‡åŸå¸‚ä¸“å±æŠ€èƒ½çš„åŸå¸‚
2. ä½¿ç”¨"ç„•ç„¶ä¸€æ–°"æŠ€èƒ½
3. éªŒè¯ï¼š`city.skillUsageCount` åº”é‡ç½®ä¸º 0
4. éªŒè¯ï¼šæ¶ˆè€— 2 é‡‘å¸

#### æ¨ªæ‰«ä¸€ç©º
1. é€‰æ‹©å¯¹æ‰‹ç©å®¶
2. ä½¿ç”¨"æ¨ªæ‰«ä¸€ç©º"æŠ€èƒ½
3. éªŒè¯ï¼šåªæœ‰å¯¹æ‰‹æˆ˜æ–—é¢„å¤‡åŸå¸‚çš„ `skillUsageCount` è¢«é‡ç½®
4. éªŒè¯ï¼šæ¶ˆè€— 7 é‡‘å¸

### 2. HTMLç‰ˆæœ¬æµ‹è¯•

#### æ¨ªæ‰«ä¸€ç©º
1. åœ¨ä¸»æŒäººæ¨¡å¼æˆ–ç©å®¶æ¨¡å¼ä¸­é€‰æ‹©"æ¨ªæ‰«ä¸€ç©º"
2. éªŒè¯ï¼šæ˜¾ç¤ºæˆæœ¬ä¸º 5 é‡‘å¸
3. ä½¿ç”¨æŠ€èƒ½åéªŒè¯ï¼šæ‰£é™¤ 5 é‡‘å¸
4. éªŒè¯ï¼šåŠŸèƒ½æ­£å¸¸æ‰§è¡Œ

---

## ğŸ“ æŠ€èƒ½æè¿°æ›´æ–°å»ºè®®

### Vueç‰ˆæœ¬ - æŠ€èƒ½ä»‹ç»

**ç„•ç„¶ä¸€æ–°** (src/data/skills.js æˆ–æŠ€èƒ½è¯´æ˜æ–‡æ¡£):
```
èŠ±è´¹2é‡‘å¸ã€‚é€‰å®šå·±æ–¹ä¸€åº§åŸå¸‚ï¼Œé‡ç½®åŸå¸‚ä¸“å±æŠ€èƒ½åˆ°åˆå§‹çŠ¶æ€ï¼ˆå·²ä½¿ç”¨æ¬¡æ•°æ¢å¤åˆ°0ï¼‰ã€‚æ¯å±€é™2æ¬¡ã€‚
```

**æ¨ªæ‰«ä¸€ç©º** (src/data/skills.js æˆ–æŠ€èƒ½è¯´æ˜æ–‡æ¡£):
```
èŠ±è´¹7é‡‘å¸ã€‚é€‰å®šä¸€ä¸ªå¯¹æ‰‹ç©å®¶ï¼Œæ¸…ç©ºå…¶å½“å‰æ‰€æœ‰æˆ˜æ–—é¢„å¤‡åŸå¸‚çš„åŸå¸‚ä¸“å±æŠ€èƒ½ã€‚æ¯å±€é™1æ¬¡ã€‚
```

### HTMLç‰ˆæœ¬ - æŠ€èƒ½ä»‹ç»

**æ¨ªæ‰«ä¸€ç©º** (æŠ€èƒ½è¯´æ˜æˆ–å¸®åŠ©æ–‡æ¡£):
```
èŠ±è´¹5é‡‘å¸ã€‚é€‰å®šä¸€ä¸ªå¯¹æ‰‹ç©å®¶ï¼Œæ¸…ç©ºå…¶å½“å‰æ‰€æœ‰æˆ˜æ–—é¢„å¤‡åŸå¸‚çš„åŸå¸‚ä¸“å±æŠ€èƒ½ã€‚æ¯å±€é™1æ¬¡ã€‚
```

---

## âœ… å®Œæˆæ¸…å•

- âœ… Vueå¼€å‘æœåŠ¡å™¨å¯åŠ¨
- âœ… ç„•ç„¶ä¸€æ–°åŠŸèƒ½é‡å†™
- âœ… ç„•ç„¶ä¸€æ–°æè¿°æ›´æ–°
- âœ… ç„•ç„¶ä¸€æ–°è°ƒç”¨ä¿®æ­£
- âœ… æ¨ªæ‰«ä¸€ç©ºåŠŸèƒ½é‡å†™
- âœ… æ¨ªæ‰«ä¸€ç©ºæè¿°æ›´æ–°
- âœ… HTMLç‰ˆæœ¬æ¨ªæ‰«ä¸€ç©ºæˆæœ¬æ›´æ–°ï¼ˆ4å¤„ï¼‰
- âœ… æ¸…ç†å¤‡ä»½æ–‡ä»¶

---

## ğŸ”§ å¼€å‘æœåŠ¡å™¨ä¿¡æ¯

**å¯åŠ¨å‘½ä»¤**: `npm run dev`
**è®¿é—®åœ°å€**: http://localhost:5173/
**çŠ¶æ€**: âœ… è¿è¡Œä¸­
**Viteç‰ˆæœ¬**: v7.3.0
**å¯åŠ¨æ—¶é—´**: 288ms

---

## ğŸ“Œ é‡è¦æç¤º

1. **ç„•ç„¶ä¸€æ–°** ç°åœ¨éœ€è¦é€‰æ‹©å·±æ–¹åŸå¸‚ï¼ˆ`requiresSelfCity: true`ï¼‰
2. **æ¨ªæ‰«ä¸€ç©º** åªå½±å“å¯¹æ‰‹çš„æˆ˜æ–—é¢„å¤‡åŸå¸‚ï¼Œä¸æ˜¯æ‰€æœ‰åŸå¸‚
3. **æ¨ªæ‰«ä¸€ç©º** åœ¨Vueç‰ˆæœ¬æ˜¯7é‡‘å¸ï¼ŒHTMLç‰ˆæœ¬æ˜¯5é‡‘å¸
4. é¢œè‰²æŠ€èƒ½ç›¸å…³ä»£ç å·²å®Œå…¨ç§»é™¤

---

## âœ… ä¿®å¤å®Œæˆ

æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼ŒVueå¼€å‘æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œå¯ä»¥è®¿é—® http://localhost:5173/ è¿›è¡Œæµ‹è¯•ã€‚

**ä¸‹ä¸€æ­¥**:
1. åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•ç„•ç„¶ä¸€æ–°å’Œæ¨ªæ‰«ä¸€ç©ºæŠ€èƒ½
2. éªŒè¯HTMLç‰ˆæœ¬çš„æ¨ªæ‰«ä¸€ç©ºæˆæœ¬ä¸º5é‡‘å¸
3. æ›´æ–°æŠ€èƒ½è¯´æ˜æ–‡æ¡£
