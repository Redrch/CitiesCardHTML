(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function rl(e){const n=Object.create(null);for(const t of e.split(","))n[t]=1;return t=>t in n}const mn={},ji=[],Ht=()=>{},ed=()=>!1,fr=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),al=e=>e.startsWith("onUpdate:"),On=Object.assign,ll=(e,n)=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)},jh=Object.prototype.hasOwnProperty,cn=(e,n)=>jh.call(e,n),Le=Array.isArray,Fi=e=>oo(e)==="[object Map]",rs=e=>oo(e)==="[object Set]",uc=e=>oo(e)==="[object Date]",Je=e=>typeof e=="function",Bn=e=>typeof e=="string",yt=e=>typeof e=="symbol",hn=e=>e!==null&&typeof e=="object",nd=e=>(hn(e)||Je(e))&&Je(e.then)&&Je(e.catch),td=Object.prototype.toString,oo=e=>td.call(e),Fh=e=>oo(e).slice(8,-1),id=e=>oo(e)==="[object Object]",mr=e=>Bn(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,As=rl(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),hr=e=>{const n=Object.create(null);return(t=>n[t]||(n[t]=e(t)))},Vh=/-\w/g,ui=hr(e=>e.replace(Vh,n=>n.slice(1).toUpperCase())),Wh=/\B([A-Z])/g,hi=hr(e=>e.replace(Wh,"-$1").toLowerCase()),sd=hr(e=>e.charAt(0).toUpperCase()+e.slice(1)),Xr=hr(e=>e?`on${sd(e)}`:""),oi=(e,n)=>!Object.is(e,n),ko=(e,...n)=>{for(let t=0;t<e.length;t++)e[t](...n)},od=(e,n,t,i=!1)=>{Object.defineProperty(e,n,{configurable:!0,enumerable:!1,writable:i,value:t})},pr=e=>{const n=parseFloat(e);return isNaN(n)?e:n},zh=e=>{const n=Bn(e)?Number(e):NaN;return isNaN(n)?e:n};let dc;const gr=()=>dc||(dc=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ki(e){if(Le(e)){const n={};for(let t=0;t<e.length;t++){const i=e[t],s=Bn(i)?Kh(i):Ki(i);if(s)for(const o in s)n[o]=s[o]}return n}else if(Bn(e)||hn(e))return e}const Gh=/;(?![^(]*\))/g,Jh=/:([^]+)/,Yh=/\/\*[^]*?\*\//g;function Kh(e){const n={};return e.replace(Yh,"").split(Gh).forEach(t=>{if(t){const i=t.split(Jh);i.length>1&&(n[i[0].trim()]=i[1].trim())}}),n}function ze(e){let n="";if(Bn(e))n=e;else if(Le(e))for(let t=0;t<e.length;t++){const i=ze(e[t]);i&&(n+=i+" ")}else if(hn(e))for(const t in e)e[t]&&(n+=t+" ");return n.trim()}const Zh="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Qh=rl(Zh);function rd(e){return!!e||e===""}function Xh(e,n){if(e.length!==n.length)return!1;let t=!0;for(let i=0;t&&i<e.length;i++)t=ro(e[i],n[i]);return t}function ro(e,n){if(e===n)return!0;let t=uc(e),i=uc(n);if(t||i)return t&&i?e.getTime()===n.getTime():!1;if(t=yt(e),i=yt(n),t||i)return e===n;if(t=Le(e),i=Le(n),t||i)return t&&i?Xh(e,n):!1;if(t=hn(e),i=hn(n),t||i){if(!t||!i)return!1;const s=Object.keys(e).length,o=Object.keys(n).length;if(s!==o)return!1;for(const r in e){const a=e.hasOwnProperty(r),l=n.hasOwnProperty(r);if(a&&!l||!a&&l||!ro(e[r],n[r]))return!1}}return String(e)===String(n)}function cl(e,n){return e.findIndex(t=>ro(t,n))}const ad=e=>!!(e&&e.__v_isRef===!0),U=e=>Bn(e)?e:e==null?"":Le(e)||hn(e)&&(e.toString===td||!Je(e.toString))?ad(e)?U(e.value):JSON.stringify(e,ld,2):String(e),ld=(e,n)=>ad(n)?ld(e,n.value):Fi(n)?{[`Map(${n.size})`]:[...n.entries()].reduce((t,[i,s],o)=>(t[ea(i,o)+" =>"]=s,t),{})}:rs(n)?{[`Set(${n.size})`]:[...n.values()].map(t=>ea(t))}:yt(n)?ea(n):hn(n)&&!Le(n)&&!id(n)?String(n):n,ea=(e,n="")=>{var t;return yt(e)?`Symbol(${(t=e.description)!=null?t:n})`:e};let Fn;class cd{constructor(n=!1){this.detached=n,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Fn,!n&&Fn&&(this.index=(Fn.scopes||(Fn.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let n,t;if(this.scopes)for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].pause();for(n=0,t=this.effects.length;n<t;n++)this.effects[n].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let n,t;if(this.scopes)for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].resume();for(n=0,t=this.effects.length;n<t;n++)this.effects[n].resume()}}run(n){if(this._active){const t=Fn;try{return Fn=this,n()}finally{Fn=t}}}on(){++this._on===1&&(this.prevScope=Fn,Fn=this)}off(){this._on>0&&--this._on===0&&(Fn=this.prevScope,this.prevScope=void 0)}stop(n){if(this._active){this._active=!1;let t,i;for(t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(this.effects.length=0,t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!n){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function ud(e){return new cd(e)}function dd(){return Fn}function ep(e,n=!1){Fn&&Fn.cleanups.push(e)}let yn;const na=new WeakSet;class fd{constructor(n){this.fn=n,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Fn&&Fn.active&&Fn.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,na.has(this)&&(na.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||hd(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,fc(this),pd(this);const n=yn,t=pt;yn=this,pt=!0;try{return this.fn()}finally{gd(this),yn=n,pt=t,this.flags&=-3}}stop(){if(this.flags&1){for(let n=this.deps;n;n=n.nextDep)fl(n);this.deps=this.depsTail=void 0,fc(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?na.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ba(this)&&this.run()}get dirty(){return ba(this)}}let md=0,Ps,Hs;function hd(e,n=!1){if(e.flags|=8,n){e.next=Hs,Hs=e;return}e.next=Ps,Ps=e}function ul(){md++}function dl(){if(--md>0)return;if(Hs){let n=Hs;for(Hs=void 0;n;){const t=n.next;n.next=void 0,n.flags&=-9,n=t}}let e;for(;Ps;){let n=Ps;for(Ps=void 0;n;){const t=n.next;if(n.next=void 0,n.flags&=-9,n.flags&1)try{n.trigger()}catch(i){e||(e=i)}n=t}}if(e)throw e}function pd(e){for(let n=e.deps;n;n=n.nextDep)n.version=-1,n.prevActiveLink=n.dep.activeLink,n.dep.activeLink=n}function gd(e){let n,t=e.depsTail,i=t;for(;i;){const s=i.prevDep;i.version===-1?(i===t&&(t=s),fl(i),np(i)):n=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=s}e.deps=n,e.depsTail=t}function ba(e){for(let n=e.deps;n;n=n.nextDep)if(n.dep.version!==n.version||n.dep.computed&&(yd(n.dep.computed)||n.dep.version!==n.version))return!0;return!!e._dirty}function yd(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Os)||(e.globalVersion=Os,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!ba(e))))return;e.flags|=2;const n=e.dep,t=yn,i=pt;yn=e,pt=!0;try{pd(e);const s=e.fn(e._value);(n.version===0||oi(s,e._value))&&(e.flags|=128,e._value=s,n.version++)}catch(s){throw n.version++,s}finally{yn=t,pt=i,gd(e),e.flags&=-3}}function fl(e,n=!1){const{dep:t,prevSub:i,nextSub:s}=e;if(i&&(i.nextSub=s,e.prevSub=void 0),s&&(s.prevSub=i,e.nextSub=void 0),t.subs===e&&(t.subs=i,!i&&t.computed)){t.computed.flags&=-5;for(let o=t.computed.deps;o;o=o.nextDep)fl(o,!0)}!n&&!--t.sc&&t.map&&t.map.delete(t.key)}function np(e){const{prevDep:n,nextDep:t}=e;n&&(n.nextDep=t,e.prevDep=void 0),t&&(t.prevDep=n,e.nextDep=void 0)}let pt=!0;const Cd=[];function jt(){Cd.push(pt),pt=!1}function Ft(){const e=Cd.pop();pt=e===void 0?!0:e}function fc(e){const{cleanup:n}=e;if(e.cleanup=void 0,n){const t=yn;yn=void 0;try{n()}finally{yn=t}}}let Os=0;class tp{constructor(n,t){this.sub=n,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class ml{constructor(n){this.computed=n,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(n){if(!yn||!pt||yn===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==yn)t=this.activeLink=new tp(yn,this),yn.deps?(t.prevDep=yn.depsTail,yn.depsTail.nextDep=t,yn.depsTail=t):yn.deps=yn.depsTail=t,vd(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const i=t.nextDep;i.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=i),t.prevDep=yn.depsTail,t.nextDep=void 0,yn.depsTail.nextDep=t,yn.depsTail=t,yn.deps===t&&(yn.deps=i)}return t}trigger(n){this.version++,Os++,this.notify(n)}notify(n){ul();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{dl()}}}function vd(e){if(e.dep.sc++,e.sub.flags&4){const n=e.dep.computed;if(n&&!e.dep.subs){n.flags|=20;for(let i=n.deps;i;i=i.nextDep)vd(i)}const t=e.dep.subs;t!==e&&(e.prevSub=t,t&&(t.nextSub=e)),e.dep.subs=e}}const qo=new WeakMap,xi=Symbol(""),Aa=Symbol(""),Us=Symbol("");function Vn(e,n,t){if(pt&&yn){let i=qo.get(e);i||qo.set(e,i=new Map);let s=i.get(t);s||(i.set(t,s=new ml),s.map=i,s.key=t),s.track()}}function Mt(e,n,t,i,s,o){const r=qo.get(e);if(!r){Os++;return}const a=l=>{l&&l.trigger()};if(ul(),n==="clear")r.forEach(a);else{const l=Le(e),u=l&&mr(t);if(l&&t==="length"){const f=Number(i);r.forEach((m,h)=>{(h==="length"||h===Us||!yt(h)&&h>=f)&&a(m)})}else switch((t!==void 0||r.has(void 0))&&a(r.get(t)),u&&a(r.get(Us)),n){case"add":l?u&&a(r.get("length")):(a(r.get(xi)),Fi(e)&&a(r.get(Aa)));break;case"delete":l||(a(r.get(xi)),Fi(e)&&a(r.get(Aa)));break;case"set":Fi(e)&&a(r.get(xi));break}}dl()}function ip(e,n){const t=qo.get(e);return t&&t.get(n)}function Ni(e){const n=an(e);return n===e?n:(Vn(n,"iterate",Us),rt(e)?n:n.map(Ct))}function yr(e){return Vn(e=an(e),"iterate",Us),e}function ei(e,n){return Vt(e)?Lt(e)?Zi(Ct(n)):Zi(n):Ct(n)}const sp={__proto__:null,[Symbol.iterator](){return ta(this,Symbol.iterator,e=>ei(this,e))},concat(...e){return Ni(this).concat(...e.map(n=>Le(n)?Ni(n):n))},entries(){return ta(this,"entries",e=>(e[1]=ei(this,e[1]),e))},every(e,n){return Tt(this,"every",e,n,void 0,arguments)},filter(e,n){return Tt(this,"filter",e,n,t=>t.map(i=>ei(this,i)),arguments)},find(e,n){return Tt(this,"find",e,n,t=>ei(this,t),arguments)},findIndex(e,n){return Tt(this,"findIndex",e,n,void 0,arguments)},findLast(e,n){return Tt(this,"findLast",e,n,t=>ei(this,t),arguments)},findLastIndex(e,n){return Tt(this,"findLastIndex",e,n,void 0,arguments)},forEach(e,n){return Tt(this,"forEach",e,n,void 0,arguments)},includes(...e){return ia(this,"includes",e)},indexOf(...e){return ia(this,"indexOf",e)},join(e){return Ni(this).join(e)},lastIndexOf(...e){return ia(this,"lastIndexOf",e)},map(e,n){return Tt(this,"map",e,n,void 0,arguments)},pop(){return hs(this,"pop")},push(...e){return hs(this,"push",e)},reduce(e,...n){return mc(this,"reduce",e,n)},reduceRight(e,...n){return mc(this,"reduceRight",e,n)},shift(){return hs(this,"shift")},some(e,n){return Tt(this,"some",e,n,void 0,arguments)},splice(...e){return hs(this,"splice",e)},toReversed(){return Ni(this).toReversed()},toSorted(e){return Ni(this).toSorted(e)},toSpliced(...e){return Ni(this).toSpliced(...e)},unshift(...e){return hs(this,"unshift",e)},values(){return ta(this,"values",e=>ei(this,e))}};function ta(e,n,t){const i=yr(e),s=i[n]();return i!==e&&!rt(e)&&(s._next=s.next,s.next=()=>{const o=s._next();return o.done||(o.value=t(o.value)),o}),s}const op=Array.prototype;function Tt(e,n,t,i,s,o){const r=yr(e),a=r!==e&&!rt(e),l=r[n];if(l!==op[n]){const m=l.apply(e,o);return a?Ct(m):m}let u=t;r!==e&&(a?u=function(m,h){return t.call(this,ei(e,m),h,e)}:t.length>2&&(u=function(m,h){return t.call(this,m,h,e)}));const f=l.call(r,u,i);return a&&s?s(f):f}function mc(e,n,t,i){const s=yr(e);let o=t;return s!==e&&(rt(e)?t.length>3&&(o=function(r,a,l){return t.call(this,r,a,l,e)}):o=function(r,a,l){return t.call(this,r,ei(e,a),l,e)}),s[n](o,...i)}function ia(e,n,t){const i=an(e);Vn(i,"iterate",Us);const s=i[n](...t);return(s===-1||s===!1)&&Cr(t[0])?(t[0]=an(t[0]),i[n](...t)):s}function hs(e,n,t=[]){jt(),ul();const i=an(e)[n].apply(e,t);return dl(),Ft(),i}const rp=rl("__proto__,__v_isRef,__isVue"),_d=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(yt));function ap(e){yt(e)||(e=String(e));const n=an(this);return Vn(n,"has",e),n.hasOwnProperty(e)}class $d{constructor(n=!1,t=!1){this._isReadonly=n,this._isShallow=t}get(n,t,i){if(t==="__v_skip")return n.__v_skip;const s=this._isReadonly,o=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return o;if(t==="__v_raw")return i===(s?o?yp:Pd:o?Ad:bd).get(n)||Object.getPrototypeOf(n)===Object.getPrototypeOf(i)?n:void 0;const r=Le(n);if(!s){let l;if(r&&(l=sp[t]))return l;if(t==="hasOwnProperty")return ap}const a=Reflect.get(n,t,xn(n)?n:i);if((yt(t)?_d.has(t):rp(t))||(s||Vn(n,"get",t),o))return a;if(xn(a)){const l=r&&mr(t)?a:a.value;return s&&hn(l)?Ha(l):l}return hn(a)?s?Ha(a):Ne(a):a}}class wd extends $d{constructor(n=!1){super(!1,n)}set(n,t,i,s){let o=n[t];const r=Le(n)&&mr(t);if(!this._isShallow){const u=Vt(o);if(!rt(i)&&!Vt(i)&&(o=an(o),i=an(i)),!r&&xn(o)&&!xn(i))return u||(o.value=i),!0}const a=r?Number(t)<n.length:cn(n,t),l=Reflect.set(n,t,i,xn(n)?n:s);return n===an(s)&&(a?oi(i,o)&&Mt(n,"set",t,i):Mt(n,"add",t,i)),l}deleteProperty(n,t){const i=cn(n,t);n[t];const s=Reflect.deleteProperty(n,t);return s&&i&&Mt(n,"delete",t,void 0),s}has(n,t){const i=Reflect.has(n,t);return(!yt(t)||!_d.has(t))&&Vn(n,"has",t),i}ownKeys(n){return Vn(n,"iterate",Le(n)?"length":xi),Reflect.ownKeys(n)}}class lp extends $d{constructor(n=!1){super(!0,n)}set(n,t){return!0}deleteProperty(n,t){return!0}}const cp=new wd,up=new lp,dp=new wd(!0);const Pa=e=>e,bo=e=>Reflect.getPrototypeOf(e);function fp(e,n,t){return function(...i){const s=this.__v_raw,o=an(s),r=Fi(o),a=e==="entries"||e===Symbol.iterator&&r,l=e==="keys"&&r,u=s[e](...i),f=t?Pa:n?Zi:Ct;return!n&&Vn(o,"iterate",l?Aa:xi),{next(){const{value:m,done:h}=u.next();return h?{value:m,done:h}:{value:a?[f(m[0]),f(m[1])]:f(m),done:h}},[Symbol.iterator](){return this}}}}function Ao(e){return function(...n){return e==="delete"?!1:e==="clear"?void 0:this}}function mp(e,n){const t={get(s){const o=this.__v_raw,r=an(o),a=an(s);e||(oi(s,a)&&Vn(r,"get",s),Vn(r,"get",a));const{has:l}=bo(r),u=n?Pa:e?Zi:Ct;if(l.call(r,s))return u(o.get(s));if(l.call(r,a))return u(o.get(a));o!==r&&o.get(s)},get size(){const s=this.__v_raw;return!e&&Vn(an(s),"iterate",xi),s.size},has(s){const o=this.__v_raw,r=an(o),a=an(s);return e||(oi(s,a)&&Vn(r,"has",s),Vn(r,"has",a)),s===a?o.has(s):o.has(s)||o.has(a)},forEach(s,o){const r=this,a=r.__v_raw,l=an(a),u=n?Pa:e?Zi:Ct;return!e&&Vn(l,"iterate",xi),a.forEach((f,m)=>s.call(o,u(f),u(m),r))}};return On(t,e?{add:Ao("add"),set:Ao("set"),delete:Ao("delete"),clear:Ao("clear")}:{add(s){!n&&!rt(s)&&!Vt(s)&&(s=an(s));const o=an(this);return bo(o).has.call(o,s)||(o.add(s),Mt(o,"add",s,s)),this},set(s,o){!n&&!rt(o)&&!Vt(o)&&(o=an(o));const r=an(this),{has:a,get:l}=bo(r);let u=a.call(r,s);u||(s=an(s),u=a.call(r,s));const f=l.call(r,s);return r.set(s,o),u?oi(o,f)&&Mt(r,"set",s,o):Mt(r,"add",s,o),this},delete(s){const o=an(this),{has:r,get:a}=bo(o);let l=r.call(o,s);l||(s=an(s),l=r.call(o,s)),a&&a.call(o,s);const u=o.delete(s);return l&&Mt(o,"delete",s,void 0),u},clear(){const s=an(this),o=s.size!==0,r=s.clear();return o&&Mt(s,"clear",void 0,void 0),r}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=fp(s,e,n)}),t}function hl(e,n){const t=mp(e,n);return(i,s,o)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?i:Reflect.get(cn(t,s)&&s in i?t:i,s,o)}const hp={get:hl(!1,!1)},pp={get:hl(!1,!0)},gp={get:hl(!0,!1)};const bd=new WeakMap,Ad=new WeakMap,Pd=new WeakMap,yp=new WeakMap;function Cp(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function vp(e){return e.__v_skip||!Object.isExtensible(e)?0:Cp(Fh(e))}function Ne(e){return Vt(e)?e:pl(e,!1,cp,hp,bd)}function _p(e){return pl(e,!1,dp,pp,Ad)}function Ha(e){return pl(e,!0,up,gp,Pd)}function pl(e,n,t,i,s){if(!hn(e)||e.__v_raw&&!(n&&e.__v_isReactive))return e;const o=vp(e);if(o===0)return e;const r=s.get(e);if(r)return r;const a=new Proxy(e,o===2?i:t);return s.set(e,a),a}function Lt(e){return Vt(e)?Lt(e.__v_raw):!!(e&&e.__v_isReactive)}function Vt(e){return!!(e&&e.__v_isReadonly)}function rt(e){return!!(e&&e.__v_isShallow)}function Cr(e){return e?!!e.__v_raw:!1}function an(e){const n=e&&e.__v_raw;return n?an(n):e}function gl(e){return!cn(e,"__v_skip")&&Object.isExtensible(e)&&od(e,"__v_skip",!0),e}const Ct=e=>hn(e)?Ne(e):e,Zi=e=>hn(e)?Ha(e):e;function xn(e){return e?e.__v_isRef===!0:!1}function Ce(e){return $p(e,!1)}function $p(e,n){return xn(e)?e:new wp(e,n)}class wp{constructor(n,t){this.dep=new ml,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?n:an(n),this._value=t?n:Ct(n),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(n){const t=this._rawValue,i=this.__v_isShallow||rt(n)||Vt(n);n=i?n:an(n),oi(n,t)&&(this._rawValue=n,this._value=i?n:Ct(n),this.dep.trigger())}}function Fe(e){return xn(e)?e.value:e}const bp={get:(e,n,t)=>n==="__v_raw"?e:Fe(Reflect.get(e,n,t)),set:(e,n,t,i)=>{const s=e[n];return xn(s)&&!xn(t)?(s.value=t,!0):Reflect.set(e,n,t,i)}};function Hd(e){return Lt(e)?e:new Proxy(e,bp)}function Ap(e){const n=Le(e)?new Array(e.length):{};for(const t in e)n[t]=Hp(e,t);return n}class Pp{constructor(n,t,i){this._object=n,this._key=t,this._defaultValue=i,this.__v_isRef=!0,this._value=void 0,this._raw=an(n);let s=!0,o=n;if(!Le(n)||!mr(String(t)))do s=!Cr(o)||rt(o);while(s&&(o=o.__v_raw));this._shallow=s}get value(){let n=this._object[this._key];return this._shallow&&(n=Fe(n)),this._value=n===void 0?this._defaultValue:n}set value(n){if(this._shallow&&xn(this._raw[this._key])){const t=this._object[this._key];if(xn(t)){t.value=n;return}}this._object[this._key]=n}get dep(){return ip(this._raw,this._key)}}function Hp(e,n,t){return new Pp(e,n,t)}class xp{constructor(n,t,i){this.fn=n,this.setter=t,this._value=void 0,this.dep=new ml(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Os-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&yn!==this)return hd(this,!0),!0}get value(){const n=this.dep.track();return yd(this),n&&(n.version=this.dep.version),this._value}set value(n){this.setter&&this.setter(n)}}function Bp(e,n,t=!1){let i,s;return Je(e)?i=e:(i=e.get,s=e.set),new xp(i,s,t)}const Po={},Lo=new WeakMap;let _i;function Sp(e,n=!1,t=_i){if(t){let i=Lo.get(t);i||Lo.set(t,i=[]),i.push(e)}}function Ip(e,n,t=mn){const{immediate:i,deep:s,once:o,scheduler:r,augmentJob:a,call:l}=t,u=Y=>s?Y:rt(Y)||s===!1||s===0?Dt(Y,1):Dt(Y);let f,m,h,v,S=!1,X=!1;if(xn(e)?(m=()=>e.value,S=rt(e)):Lt(e)?(m=()=>u(e),S=!0):Le(e)?(X=!0,S=e.some(Y=>Lt(Y)||rt(Y)),m=()=>e.map(Y=>{if(xn(Y))return Y.value;if(Lt(Y))return u(Y);if(Je(Y))return l?l(Y,2):Y()})):Je(e)?n?m=l?()=>l(e,2):e:m=()=>{if(h){jt();try{h()}finally{Ft()}}const Y=_i;_i=f;try{return l?l(e,3,[v]):e(v)}finally{_i=Y}}:m=Ht,n&&s){const Y=m,V=s===!0?1/0:s;m=()=>Dt(Y(),V)}const ae=dd(),fe=()=>{f.stop(),ae&&ae.active&&ll(ae.effects,f)};if(o&&n){const Y=n;n=(...V)=>{Y(...V),fe()}}let ge=X?new Array(e.length).fill(Po):Po;const R=Y=>{if(!(!(f.flags&1)||!f.dirty&&!Y))if(n){const V=f.run();if(s||S||(X?V.some((ee,ue)=>oi(ee,ge[ue])):oi(V,ge))){h&&h();const ee=_i;_i=f;try{const ue=[V,ge===Po?void 0:X&&ge[0]===Po?[]:ge,v];ge=V,l?l(n,3,ue):n(...ue)}finally{_i=ee}}}else f.run()};return a&&a(R),f=new fd(m),f.scheduler=r?()=>r(R,!1):R,v=Y=>Sp(Y,!1,f),h=f.onStop=()=>{const Y=Lo.get(f);if(Y){if(l)l(Y,4);else for(const V of Y)V();Lo.delete(f)}},n?i?R(!0):ge=f.run():r?r(R.bind(null,!0),!0):f.run(),fe.pause=f.pause.bind(f),fe.resume=f.resume.bind(f),fe.stop=fe,fe}function Dt(e,n=1/0,t){if(n<=0||!hn(e)||e.__v_skip||(t=t||new Map,(t.get(e)||0)>=n))return e;if(t.set(e,n),n--,xn(e))Dt(e.value,n,t);else if(Le(e))for(let i=0;i<e.length;i++)Dt(e[i],n,t);else if(rs(e)||Fi(e))e.forEach(i=>{Dt(i,n,t)});else if(id(e)){for(const i in e)Dt(e[i],n,t);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&Dt(e[i],n,t)}return e}function ao(e,n,t,i){try{return i?e(...i):e()}catch(s){vr(s,n,t)}}function vt(e,n,t,i){if(Je(e)){const s=ao(e,n,t,i);return s&&nd(s)&&s.catch(o=>{vr(o,n,t)}),s}if(Le(e)){const s=[];for(let o=0;o<e.length;o++)s.push(vt(e[o],n,t,i));return s}}function vr(e,n,t,i=!0){const s=n?n.vnode:null,{errorHandler:o,throwUnhandledErrorInProduction:r}=n&&n.appContext.config||mn;if(n){let a=n.parent;const l=n.proxy,u=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const f=a.ec;if(f){for(let m=0;m<f.length;m++)if(f[m](e,l,u)===!1)return}a=a.parent}if(o){jt(),ao(o,null,10,[e,l,u]),Ft();return}}kp(e,t,s,i,r)}function kp(e,n,t,i=!0,s=!1){if(s)throw e;console.error(e)}const Kn=[];let At=-1;const Vi=[];let ni=null,qi=0;const xd=Promise.resolve();let Oo=null;function Qi(e){const n=Oo||xd;return e?n.then(this?e.bind(this):e):n}function Ep(e){let n=At+1,t=Kn.length;for(;n<t;){const i=n+t>>>1,s=Kn[i],o=js(s);o<e||o===e&&s.flags&2?n=i+1:t=i}return n}function yl(e){if(!(e.flags&1)){const n=js(e),t=Kn[Kn.length-1];!t||!(e.flags&2)&&n>=js(t)?Kn.push(e):Kn.splice(Ep(n),0,e),e.flags|=1,Bd()}}function Bd(){Oo||(Oo=xd.then(Id))}function Tp(e){Le(e)?Vi.push(...e):ni&&e.id===-1?ni.splice(qi+1,0,e):e.flags&1||(Vi.push(e),e.flags|=1),Bd()}function hc(e,n,t=At+1){for(;t<Kn.length;t++){const i=Kn[t];if(i&&i.flags&2){if(e&&i.id!==e.uid)continue;Kn.splice(t,1),t--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function Sd(e){if(Vi.length){const n=[...new Set(Vi)].sort((t,i)=>js(t)-js(i));if(Vi.length=0,ni){ni.push(...n);return}for(ni=n,qi=0;qi<ni.length;qi++){const t=ni[qi];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}ni=null,qi=0}}const js=e=>e.id==null?e.flags&2?-1:1/0:e.id;function Id(e){try{for(At=0;At<Kn.length;At++){const n=Kn[At];n&&!(n.flags&8)&&(n.flags&4&&(n.flags&=-2),ao(n,n.i,n.i?15:14),n.flags&4||(n.flags&=-2))}}finally{for(;At<Kn.length;At++){const n=Kn[At];n&&(n.flags&=-2)}At=-1,Kn.length=0,Sd(),Oo=null,(Kn.length||Vi.length)&&Id()}}let zn=null,kd=null;function Uo(e){const n=zn;return zn=e,kd=e&&e.type.__scopeId||null,n}function Fs(e,n=zn,t){if(!n||e._n)return e;const i=(...s)=>{i._d&&xc(-1);const o=Uo(n);let r;try{r=e(...s)}finally{Uo(o),i._d&&xc(1)}return r};return i._n=!0,i._c=!0,i._d=!0,i}function ft(e,n){if(zn===null)return e;const t=br(zn),i=e.dirs||(e.dirs=[]);for(let s=0;s<n.length;s++){let[o,r,a,l=mn]=n[s];o&&(Je(o)&&(o={mounted:o,updated:o}),o.deep&&Dt(r),i.push({dir:o,instance:t,value:r,oldValue:void 0,arg:a,modifiers:l}))}return e}function yi(e,n,t,i){const s=e.dirs,o=n&&n.dirs;for(let r=0;r<s.length;r++){const a=s[r];o&&(a.oldValue=o[r].value);let l=a.dir[i];l&&(jt(),vt(l,t,8,[e.el,a,e,n]),Ft())}}function Rp(e,n){if(Zn){let t=Zn.provides;const i=Zn.parent&&Zn.parent.provides;i===t&&(t=Zn.provides=Object.create(i)),t[e]=n}}function xs(e,n,t=!1){const i=Al();if(i||Bi){let s=Bi?Bi._context.provides:i?i.parent==null||i.ce?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return t&&Je(n)?n.call(i&&i.proxy):n}}function Np(){return!!(Al()||Bi)}const Mp=Symbol.for("v-scx"),Dp=()=>xs(Mp);function xt(e,n,t){return Ed(e,n,t)}function Ed(e,n,t=mn){const{immediate:i,deep:s,flush:o,once:r}=t,a=On({},t),l=n&&i||!n&&o!=="post";let u;if(zs){if(o==="sync"){const v=Dp();u=v.__watcherHandles||(v.__watcherHandles=[])}else if(!l){const v=()=>{};return v.stop=Ht,v.resume=Ht,v.pause=Ht,v}}const f=Zn;a.call=(v,S,X)=>vt(v,f,S,X);let m=!1;o==="post"?a.scheduler=v=>{Yn(v,f&&f.suspense)}:o!=="sync"&&(m=!0,a.scheduler=(v,S)=>{S?v():yl(v)}),a.augmentJob=v=>{n&&(v.flags|=4),m&&(v.flags|=2,f&&(v.id=f.uid,v.i=f))};const h=Ip(e,n,a);return zs&&(u?u.push(h):l&&h()),h}function qp(e,n,t){const i=this.proxy,s=Bn(e)?e.includes(".")?Td(i,e):()=>i[e]:e.bind(i,i);let o;Je(n)?o=n:(o=n.handler,t=n);const r=co(this),a=Ed(s,o.bind(i),t);return r(),a}function Td(e,n){const t=n.split(".");return()=>{let i=e;for(let s=0;s<t.length&&i;s++)i=i[t[s]];return i}}const Rd=Symbol("_vte"),Lp=e=>e.__isTeleport,Bs=e=>e&&(e.disabled||e.disabled===""),pc=e=>e&&(e.defer||e.defer===""),gc=e=>typeof SVGElement<"u"&&e instanceof SVGElement,yc=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,xa=(e,n)=>{const t=e&&e.to;return Bn(t)?n?n(t):null:t},Nd={name:"Teleport",__isTeleport:!0,process(e,n,t,i,s,o,r,a,l,u){const{mc:f,pc:m,pbc:h,o:{insert:v,querySelector:S,createText:X,createComment:ae}}=u,fe=Bs(n.props);let{shapeFlag:ge,children:R,dynamicChildren:Y}=n;if(e==null){const V=n.el=X(""),ee=n.anchor=X("");v(V,t,i),v(ee,t,i);const ue=(W,Q)=>{ge&16&&f(R,W,Q,s,o,r,a,l)},de=()=>{const W=n.target=xa(n.props,S),Q=Md(W,n,X,v);W&&(r!=="svg"&&gc(W)?r="svg":r!=="mathml"&&yc(W)&&(r="mathml"),s&&s.isCE&&(s.ce._teleportTargets||(s.ce._teleportTargets=new Set)).add(W),fe||(ue(W,Q),Eo(n,!1)))};fe&&(ue(t,ee),Eo(n,!0)),pc(n.props)?(n.el.__isMounted=!1,Yn(()=>{de(),delete n.el.__isMounted},o)):de()}else{if(pc(n.props)&&e.el.__isMounted===!1){Yn(()=>{Nd.process(e,n,t,i,s,o,r,a,l,u)},o);return}n.el=e.el,n.targetStart=e.targetStart;const V=n.anchor=e.anchor,ee=n.target=e.target,ue=n.targetAnchor=e.targetAnchor,de=Bs(e.props),W=de?t:ee,Q=de?V:ue;if(r==="svg"||gc(ee)?r="svg":(r==="mathml"||yc(ee))&&(r="mathml"),Y?(h(e.dynamicChildren,Y,W,s,o,r,a),$l(e,n,!0)):l||m(e,n,W,Q,s,o,r,a,!1),fe)de?n.props&&e.props&&n.props.to!==e.props.to&&(n.props.to=e.props.to):Ho(n,t,V,u,1);else if((n.props&&n.props.to)!==(e.props&&e.props.to)){const L=n.target=xa(n.props,S);L&&Ho(n,L,null,u,0)}else de&&Ho(n,ee,ue,u,1);Eo(n,fe)}},remove(e,n,t,{um:i,o:{remove:s}},o){const{shapeFlag:r,children:a,anchor:l,targetStart:u,targetAnchor:f,target:m,props:h}=e;if(m&&(s(u),s(f)),o&&s(l),r&16){const v=o||!Bs(h);for(let S=0;S<a.length;S++){const X=a[S];i(X,n,t,v,!!X.dynamicChildren)}}},move:Ho,hydrate:Op};function Ho(e,n,t,{o:{insert:i},m:s},o=2){o===0&&i(e.targetAnchor,n,t);const{el:r,anchor:a,shapeFlag:l,children:u,props:f}=e,m=o===2;if(m&&i(r,n,t),(!m||Bs(f))&&l&16)for(let h=0;h<u.length;h++)s(u[h],n,t,2);m&&i(a,n,t)}function Op(e,n,t,i,s,o,{o:{nextSibling:r,parentNode:a,querySelector:l,insert:u,createText:f}},m){function h(X,ae,fe,ge){ae.anchor=m(r(X),ae,a(X),t,i,s,o),ae.targetStart=fe,ae.targetAnchor=ge}const v=n.target=xa(n.props,l),S=Bs(n.props);if(v){const X=v._lpa||v.firstChild;if(n.shapeFlag&16)if(S)h(e,n,X,X&&r(X));else{n.anchor=r(e);let ae=X;for(;ae;){if(ae&&ae.nodeType===8){if(ae.data==="teleport start anchor")n.targetStart=ae;else if(ae.data==="teleport anchor"){n.targetAnchor=ae,v._lpa=n.targetAnchor&&r(n.targetAnchor);break}}ae=r(ae)}n.targetAnchor||Md(v,n,f,u),m(X&&r(X),n,v,t,i,s,o)}Eo(n,S)}else S&&n.shapeFlag&16&&h(e,n,e,r(e));return n.anchor&&r(n.anchor)}const Up=Nd;function Eo(e,n){const t=e.ctx;if(t&&t.ut){let i,s;for(n?(i=e.el,s=e.anchor):(i=e.targetStart,s=e.targetAnchor);i&&i!==s;)i.nodeType===1&&i.setAttribute("data-v-owner",t.uid),i=i.nextSibling;t.ut()}}function Md(e,n,t,i){const s=n.targetStart=t(""),o=n.targetAnchor=t("");return s[Rd]=o,e&&(i(s,e),i(o,e)),o}const $i=Symbol("_leaveCb"),xo=Symbol("_enterCb");function jp(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return as(()=>{e.isMounted=!0}),Cl(()=>{e.isUnmounting=!0}),e}const ct=[Function,Array],Fp={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ct,onEnter:ct,onAfterEnter:ct,onEnterCancelled:ct,onBeforeLeave:ct,onLeave:ct,onAfterLeave:ct,onLeaveCancelled:ct,onBeforeAppear:ct,onAppear:ct,onAfterAppear:ct,onAppearCancelled:ct};function Vp(e,n){const{leavingVNodes:t}=e;let i=t.get(n.type);return i||(i=Object.create(null),t.set(n.type,i)),i}function Ba(e,n,t,i,s){const{appear:o,mode:r,persisted:a=!1,onBeforeEnter:l,onEnter:u,onAfterEnter:f,onEnterCancelled:m,onBeforeLeave:h,onLeave:v,onAfterLeave:S,onLeaveCancelled:X,onBeforeAppear:ae,onAppear:fe,onAfterAppear:ge,onAppearCancelled:R}=n,Y=String(e.key),V=Vp(t,e),ee=(W,Q)=>{W&&vt(W,i,9,Q)},ue=(W,Q)=>{const L=Q[1];ee(W,Q),Le(W)?W.every(P=>P.length<=1)&&L():W.length<=1&&L()},de={mode:r,persisted:a,beforeEnter(W){let Q=l;if(!t.isMounted)if(o)Q=ae||l;else return;W[$i]&&W[$i](!0);const L=V[Y];L&&Li(e,L)&&L.el[$i]&&L.el[$i](),ee(Q,[W])},enter(W){let Q=u,L=f,P=m;if(!t.isMounted)if(o)Q=fe||u,L=ge||f,P=R||m;else return;let G=!1;const _=W[xo]=$=>{G||(G=!0,$?ee(P,[W]):ee(L,[W]),de.delayedLeave&&de.delayedLeave(),W[xo]=void 0)};Q?ue(Q,[W,_]):_()},leave(W,Q){const L=String(e.key);if(W[xo]&&W[xo](!0),t.isUnmounting)return Q();ee(h,[W]);let P=!1;const G=W[$i]=_=>{P||(P=!0,Q(),_?ee(X,[W]):ee(S,[W]),W[$i]=void 0,V[L]===e&&delete V[L])};V[L]=e,v?ue(v,[W,G]):G()},clone(W){return Ba(W,n,t,i)}};return de}function Vs(e,n){e.shapeFlag&6&&e.component?(e.transition=n,Vs(e.component.subTree,n)):e.shapeFlag&128?(e.ssContent.transition=n.clone(e.ssContent),e.ssFallback.transition=n.clone(e.ssFallback)):e.transition=n}function Dd(e,n=!1,t){let i=[],s=0;for(let o=0;o<e.length;o++){let r=e[o];const a=t==null?r.key:String(t)+String(r.key!=null?r.key:o);r.type===qe?(r.patchFlag&128&&s++,i=i.concat(Dd(r.children,n,a))):(n||r.type!==Bt)&&i.push(a!=null?Si(r,{key:a}):r)}if(s>1)for(let o=0;o<i.length;o++)i[o].patchFlag=-2;return i}function qd(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const jo=new WeakMap;function Ss(e,n,t,i,s=!1){if(Le(e)){e.forEach((S,X)=>Ss(S,n&&(Le(n)?n[X]:n),t,i,s));return}if(Wi(i)&&!s){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&Ss(e,n,t,i.component.subTree);return}const o=i.shapeFlag&4?br(i.component):i.el,r=s?null:o,{i:a,r:l}=e,u=n&&n.r,f=a.refs===mn?a.refs={}:a.refs,m=a.setupState,h=an(m),v=m===mn?ed:S=>cn(h,S);if(u!=null&&u!==l){if(Cc(n),Bn(u))f[u]=null,v(u)&&(m[u]=null);else if(xn(u)){u.value=null;const S=n;S.k&&(f[S.k]=null)}}if(Je(l))ao(l,a,12,[r,f]);else{const S=Bn(l),X=xn(l);if(S||X){const ae=()=>{if(e.f){const fe=S?v(l)?m[l]:f[l]:l.value;if(s)Le(fe)&&ll(fe,o);else if(Le(fe))fe.includes(o)||fe.push(o);else if(S)f[l]=[o],v(l)&&(m[l]=f[l]);else{const ge=[o];l.value=ge,e.k&&(f[e.k]=ge)}}else S?(f[l]=r,v(l)&&(m[l]=r)):X&&(l.value=r,e.k&&(f[e.k]=r))};if(r){const fe=()=>{ae(),jo.delete(e)};fe.id=-1,jo.set(e,fe),Yn(fe,t)}else Cc(e),ae()}}}function Cc(e){const n=jo.get(e);n&&(n.flags|=8,jo.delete(e))}gr().requestIdleCallback;gr().cancelIdleCallback;const Wi=e=>!!e.type.__asyncLoader,Ld=e=>e.type.__isKeepAlive;function Wp(e,n){Od(e,"a",n)}function zp(e,n){Od(e,"da",n)}function Od(e,n,t=Zn){const i=e.__wdc||(e.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(_r(n,i,t),t){let s=t.parent;for(;s&&s.parent;)Ld(s.parent.vnode)&&Gp(i,n,t,s),s=s.parent}}function Gp(e,n,t,i){const s=_r(n,e,i,!0);lo(()=>{ll(i[n],s)},t)}function _r(e,n,t=Zn,i=!1){if(t){const s=t[e]||(t[e]=[]),o=n.__weh||(n.__weh=(...r)=>{jt();const a=co(t),l=vt(n,t,e,r);return a(),Ft(),l});return i?s.unshift(o):s.push(o),o}}const Gt=e=>(n,t=Zn)=>{(!zs||e==="sp")&&_r(e,(...i)=>n(...i),t)},Jp=Gt("bm"),as=Gt("m"),Yp=Gt("bu"),Ud=Gt("u"),Cl=Gt("bum"),lo=Gt("um"),Kp=Gt("sp"),Zp=Gt("rtg"),Qp=Gt("rtc");function Xp(e,n=Zn){_r("ec",e,n)}const eg=Symbol.for("v-ndc");function en(e,n,t,i){let s;const o=t,r=Le(e);if(r||Bn(e)){const a=r&&Lt(e);let l=!1,u=!1;a&&(l=!rt(e),u=Vt(e),e=yr(e)),s=new Array(e.length);for(let f=0,m=e.length;f<m;f++)s[f]=n(l?u?Zi(Ct(e[f])):Ct(e[f]):e[f],f,void 0,o)}else if(typeof e=="number"){s=new Array(e);for(let a=0;a<e;a++)s[a]=n(a+1,a,void 0,o)}else if(hn(e))if(e[Symbol.iterator])s=Array.from(e,(a,l)=>n(a,l,void 0,o));else{const a=Object.keys(e);s=new Array(a.length);for(let l=0,u=a.length;l<u;l++){const f=a[l];s[l]=n(e[f],f,l,o)}}else s=[];return s}function Sa(e,n,t={},i,s){if(zn.ce||zn.parent&&Wi(zn.parent)&&zn.parent.ce){const u=Object.keys(t).length>0;return n!=="default"&&(t.name=n),M(),bn(qe,null,[Ln("slot",t,i)],u?-2:64)}let o=e[n];o&&o._c&&(o._d=!1),M();const r=o&&jd(o(t)),a=t.key||r&&r.key,l=bn(qe,{key:(a&&!yt(a)?a:`_${n}`)+(!r&&i?"_fb":"")},r||[],r&&e._===1?64:-2);return o&&o._c&&(o._d=!0),l}function jd(e){return e.some(n=>wl(n)?!(n.type===Bt||n.type===qe&&!jd(n.children)):!0)?e:null}const Ia=e=>e?af(e)?br(e):Ia(e.parent):null,Is=On(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ia(e.parent),$root:e=>Ia(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>Vd(e),$forceUpdate:e=>e.f||(e.f=()=>{yl(e.update)}),$nextTick:e=>e.n||(e.n=Qi.bind(e.proxy)),$watch:e=>qp.bind(e)}),sa=(e,n)=>e!==mn&&!e.__isScriptSetup&&cn(e,n),ng={get({_:e},n){if(n==="__v_skip")return!0;const{ctx:t,setupState:i,data:s,props:o,accessCache:r,type:a,appContext:l}=e;if(n[0]!=="$"){const h=r[n];if(h!==void 0)switch(h){case 1:return i[n];case 2:return s[n];case 4:return t[n];case 3:return o[n]}else{if(sa(i,n))return r[n]=1,i[n];if(s!==mn&&cn(s,n))return r[n]=2,s[n];if(cn(o,n))return r[n]=3,o[n];if(t!==mn&&cn(t,n))return r[n]=4,t[n];ka&&(r[n]=0)}}const u=Is[n];let f,m;if(u)return n==="$attrs"&&Vn(e.attrs,"get",""),u(e);if((f=a.__cssModules)&&(f=f[n]))return f;if(t!==mn&&cn(t,n))return r[n]=4,t[n];if(m=l.config.globalProperties,cn(m,n))return m[n]},set({_:e},n,t){const{data:i,setupState:s,ctx:o}=e;return sa(s,n)?(s[n]=t,!0):i!==mn&&cn(i,n)?(i[n]=t,!0):cn(e.props,n)||n[0]==="$"&&n.slice(1)in e?!1:(o[n]=t,!0)},has({_:{data:e,setupState:n,accessCache:t,ctx:i,appContext:s,props:o,type:r}},a){let l;return!!(t[a]||e!==mn&&a[0]!=="$"&&cn(e,a)||sa(n,a)||cn(o,a)||cn(i,a)||cn(Is,a)||cn(s.config.globalProperties,a)||(l=r.__cssModules)&&l[a])},defineProperty(e,n,t){return t.get!=null?e._.accessCache[n]=0:cn(t,"value")&&this.set(e,n,t.value,null),Reflect.defineProperty(e,n,t)}};function vc(e){return Le(e)?e.reduce((n,t)=>(n[t]=null,n),{}):e}let ka=!0;function tg(e){const n=Vd(e),t=e.proxy,i=e.ctx;ka=!1,n.beforeCreate&&_c(n.beforeCreate,e,"bc");const{data:s,computed:o,methods:r,watch:a,provide:l,inject:u,created:f,beforeMount:m,mounted:h,beforeUpdate:v,updated:S,activated:X,deactivated:ae,beforeDestroy:fe,beforeUnmount:ge,destroyed:R,unmounted:Y,render:V,renderTracked:ee,renderTriggered:ue,errorCaptured:de,serverPrefetch:W,expose:Q,inheritAttrs:L,components:P,directives:G,filters:_}=n;if(u&&ig(u,i,null),r)for(const H in r){const q=r[H];Je(q)&&(i[H]=q.bind(t))}if(s){const H=s.call(t,t);hn(H)&&(e.data=Ne(H))}if(ka=!0,o)for(const H in o){const q=o[H],ne=Je(q)?q.bind(t,t):Je(q.get)?q.get.bind(t,t):Ht,me=!Je(q)&&Je(q.set)?q.set.bind(t):Ht,oe=Oe({get:ne,set:me});Object.defineProperty(i,H,{enumerable:!0,configurable:!0,get:()=>oe.value,set:ve=>oe.value=ve})}if(a)for(const H in a)Fd(a[H],i,t,H);if(l){const H=Je(l)?l.call(t):l;Reflect.ownKeys(H).forEach(q=>{Rp(q,H[q])})}f&&_c(f,e,"c");function A(H,q){Le(q)?q.forEach(ne=>H(ne.bind(t))):q&&H(q.bind(t))}if(A(Jp,m),A(as,h),A(Yp,v),A(Ud,S),A(Wp,X),A(zp,ae),A(Xp,de),A(Qp,ee),A(Zp,ue),A(Cl,ge),A(lo,Y),A(Kp,W),Le(Q))if(Q.length){const H=e.exposed||(e.exposed={});Q.forEach(q=>{Object.defineProperty(H,q,{get:()=>t[q],set:ne=>t[q]=ne,enumerable:!0})})}else e.exposed||(e.exposed={});V&&e.render===Ht&&(e.render=V),L!=null&&(e.inheritAttrs=L),P&&(e.components=P),G&&(e.directives=G),W&&qd(e)}function ig(e,n,t=Ht){Le(e)&&(e=Ea(e));for(const i in e){const s=e[i];let o;hn(s)?"default"in s?o=xs(s.from||i,s.default,!0):o=xs(s.from||i):o=xs(s),xn(o)?Object.defineProperty(n,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:r=>o.value=r}):n[i]=o}}function _c(e,n,t){vt(Le(e)?e.map(i=>i.bind(n.proxy)):e.bind(n.proxy),n,t)}function Fd(e,n,t,i){let s=i.includes(".")?Td(t,i):()=>t[i];if(Bn(e)){const o=n[e];Je(o)&&xt(s,o)}else if(Je(e))xt(s,e.bind(t));else if(hn(e))if(Le(e))e.forEach(o=>Fd(o,n,t,i));else{const o=Je(e.handler)?e.handler.bind(t):n[e.handler];Je(o)&&xt(s,o,e)}}function Vd(e){const n=e.type,{mixins:t,extends:i}=n,{mixins:s,optionsCache:o,config:{optionMergeStrategies:r}}=e.appContext,a=o.get(n);let l;return a?l=a:!s.length&&!t&&!i?l=n:(l={},s.length&&s.forEach(u=>Fo(l,u,r,!0)),Fo(l,n,r)),hn(n)&&o.set(n,l),l}function Fo(e,n,t,i=!1){const{mixins:s,extends:o}=n;o&&Fo(e,o,t,!0),s&&s.forEach(r=>Fo(e,r,t,!0));for(const r in n)if(!(i&&r==="expose")){const a=sg[r]||t&&t[r];e[r]=a?a(e[r],n[r]):n[r]}return e}const sg={data:$c,props:wc,emits:wc,methods:bs,computed:bs,beforeCreate:Jn,created:Jn,beforeMount:Jn,mounted:Jn,beforeUpdate:Jn,updated:Jn,beforeDestroy:Jn,beforeUnmount:Jn,destroyed:Jn,unmounted:Jn,activated:Jn,deactivated:Jn,errorCaptured:Jn,serverPrefetch:Jn,components:bs,directives:bs,watch:rg,provide:$c,inject:og};function $c(e,n){return n?e?function(){return On(Je(e)?e.call(this,this):e,Je(n)?n.call(this,this):n)}:n:e}function og(e,n){return bs(Ea(e),Ea(n))}function Ea(e){if(Le(e)){const n={};for(let t=0;t<e.length;t++)n[e[t]]=e[t];return n}return e}function Jn(e,n){return e?[...new Set([].concat(e,n))]:n}function bs(e,n){return e?On(Object.create(null),e,n):n}function wc(e,n){return e?Le(e)&&Le(n)?[...new Set([...e,...n])]:On(Object.create(null),vc(e),vc(n??{})):n}function rg(e,n){if(!e)return n;if(!n)return e;const t=On(Object.create(null),e);for(const i in n)t[i]=Jn(e[i],n[i]);return t}function Wd(){return{app:null,config:{isNativeTag:ed,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ag=0;function lg(e,n){return function(i,s=null){Je(i)||(i=On({},i)),s!=null&&!hn(s)&&(s=null);const o=Wd(),r=new WeakSet,a=[];let l=!1;const u=o.app={_uid:ag++,_component:i,_props:s,_container:null,_context:o,_instance:null,version:Og,get config(){return o.config},set config(f){},use(f,...m){return r.has(f)||(f&&Je(f.install)?(r.add(f),f.install(u,...m)):Je(f)&&(r.add(f),f(u,...m))),u},mixin(f){return o.mixins.includes(f)||o.mixins.push(f),u},component(f,m){return m?(o.components[f]=m,u):o.components[f]},directive(f,m){return m?(o.directives[f]=m,u):o.directives[f]},mount(f,m,h){if(!l){const v=u._ceVNode||Ln(i,s);return v.appContext=o,h===!0?h="svg":h===!1&&(h=void 0),e(v,f,h),l=!0,u._container=f,f.__vue_app__=u,br(v.component)}},onUnmount(f){a.push(f)},unmount(){l&&(vt(a,u._instance,16),e(null,u._container),delete u._container.__vue_app__)},provide(f,m){return o.provides[f]=m,u},runWithContext(f){const m=Bi;Bi=u;try{return f()}finally{Bi=m}}};return u}}let Bi=null;const cg=(e,n)=>n==="modelValue"||n==="model-value"?e.modelModifiers:e[`${n}Modifiers`]||e[`${ui(n)}Modifiers`]||e[`${hi(n)}Modifiers`];function ug(e,n,...t){if(e.isUnmounted)return;const i=e.vnode.props||mn;let s=t;const o=n.startsWith("update:"),r=o&&cg(i,n.slice(7));r&&(r.trim&&(s=t.map(f=>Bn(f)?f.trim():f)),r.number&&(s=t.map(pr)));let a,l=i[a=Xr(n)]||i[a=Xr(ui(n))];!l&&o&&(l=i[a=Xr(hi(n))]),l&&vt(l,e,6,s);const u=i[a+"Once"];if(u){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,vt(u,e,6,s)}}const dg=new WeakMap;function zd(e,n,t=!1){const i=t?dg:n.emitsCache,s=i.get(e);if(s!==void 0)return s;const o=e.emits;let r={},a=!1;if(!Je(e)){const l=u=>{const f=zd(u,n,!0);f&&(a=!0,On(r,f))};!t&&n.mixins.length&&n.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}return!o&&!a?(hn(e)&&i.set(e,null),null):(Le(o)?o.forEach(l=>r[l]=null):On(r,o),hn(e)&&i.set(e,r),r)}function $r(e,n){return!e||!fr(n)?!1:(n=n.slice(2).replace(/Once$/,""),cn(e,n[0].toLowerCase()+n.slice(1))||cn(e,hi(n))||cn(e,n))}function bc(e){const{type:n,vnode:t,proxy:i,withProxy:s,propsOptions:[o],slots:r,attrs:a,emit:l,render:u,renderCache:f,props:m,data:h,setupState:v,ctx:S,inheritAttrs:X}=e,ae=Uo(e);let fe,ge;try{if(t.shapeFlag&4){const Y=s||i,V=Y;fe=Pt(u.call(V,Y,f,m,v,h,S)),ge=a}else{const Y=n;fe=Pt(Y.length>1?Y(m,{attrs:a,slots:r,emit:l}):Y(m,null)),ge=n.props?a:fg(a)}}catch(Y){ks.length=0,vr(Y,e,1),fe=Ln(Bt)}let R=fe;if(ge&&X!==!1){const Y=Object.keys(ge),{shapeFlag:V}=R;Y.length&&V&7&&(o&&Y.some(al)&&(ge=mg(ge,o)),R=Si(R,ge,!1,!0))}return t.dirs&&(R=Si(R,null,!1,!0),R.dirs=R.dirs?R.dirs.concat(t.dirs):t.dirs),t.transition&&Vs(R,t.transition),fe=R,Uo(ae),fe}const fg=e=>{let n;for(const t in e)(t==="class"||t==="style"||fr(t))&&((n||(n={}))[t]=e[t]);return n},mg=(e,n)=>{const t={};for(const i in e)(!al(i)||!(i.slice(9)in n))&&(t[i]=e[i]);return t};function hg(e,n,t){const{props:i,children:s,component:o}=e,{props:r,children:a,patchFlag:l}=n,u=o.emitsOptions;if(n.dirs||n.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return i?Ac(i,r,u):!!r;if(l&8){const f=n.dynamicProps;for(let m=0;m<f.length;m++){const h=f[m];if(r[h]!==i[h]&&!$r(u,h))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:i===r?!1:i?r?Ac(i,r,u):!0:!!r;return!1}function Ac(e,n,t){const i=Object.keys(n);if(i.length!==Object.keys(e).length)return!0;for(let s=0;s<i.length;s++){const o=i[s];if(n[o]!==e[o]&&!$r(t,o))return!0}return!1}function pg({vnode:e,parent:n},t){for(;n;){const i=n.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i===e)(e=n.vnode).el=t,n=n.parent;else break}}const Gd={},Jd=()=>Object.create(Gd),Yd=e=>Object.getPrototypeOf(e)===Gd;function gg(e,n,t,i=!1){const s={},o=Jd();e.propsDefaults=Object.create(null),Kd(e,n,s,o);for(const r in e.propsOptions[0])r in s||(s[r]=void 0);t?e.props=i?s:_p(s):e.type.props?e.props=s:e.props=o,e.attrs=o}function yg(e,n,t,i){const{props:s,attrs:o,vnode:{patchFlag:r}}=e,a=an(s),[l]=e.propsOptions;let u=!1;if((i||r>0)&&!(r&16)){if(r&8){const f=e.vnode.dynamicProps;for(let m=0;m<f.length;m++){let h=f[m];if($r(e.emitsOptions,h))continue;const v=n[h];if(l)if(cn(o,h))v!==o[h]&&(o[h]=v,u=!0);else{const S=ui(h);s[S]=Ta(l,a,S,v,e,!1)}else v!==o[h]&&(o[h]=v,u=!0)}}}else{Kd(e,n,s,o)&&(u=!0);let f;for(const m in a)(!n||!cn(n,m)&&((f=hi(m))===m||!cn(n,f)))&&(l?t&&(t[m]!==void 0||t[f]!==void 0)&&(s[m]=Ta(l,a,m,void 0,e,!0)):delete s[m]);if(o!==a)for(const m in o)(!n||!cn(n,m))&&(delete o[m],u=!0)}u&&Mt(e.attrs,"set","")}function Kd(e,n,t,i){const[s,o]=e.propsOptions;let r=!1,a;if(n)for(let l in n){if(As(l))continue;const u=n[l];let f;s&&cn(s,f=ui(l))?!o||!o.includes(f)?t[f]=u:(a||(a={}))[f]=u:$r(e.emitsOptions,l)||(!(l in i)||u!==i[l])&&(i[l]=u,r=!0)}if(o){const l=an(t),u=a||mn;for(let f=0;f<o.length;f++){const m=o[f];t[m]=Ta(s,l,m,u[m],e,!cn(u,m))}}return r}function Ta(e,n,t,i,s,o){const r=e[t];if(r!=null){const a=cn(r,"default");if(a&&i===void 0){const l=r.default;if(r.type!==Function&&!r.skipFactory&&Je(l)){const{propsDefaults:u}=s;if(t in u)i=u[t];else{const f=co(s);i=u[t]=l.call(null,n),f()}}else i=l;s.ce&&s.ce._setProp(t,i)}r[0]&&(o&&!a?i=!1:r[1]&&(i===""||i===hi(t))&&(i=!0))}return i}const Cg=new WeakMap;function Zd(e,n,t=!1){const i=t?Cg:n.propsCache,s=i.get(e);if(s)return s;const o=e.props,r={},a=[];let l=!1;if(!Je(e)){const f=m=>{l=!0;const[h,v]=Zd(m,n,!0);On(r,h),v&&a.push(...v)};!t&&n.mixins.length&&n.mixins.forEach(f),e.extends&&f(e.extends),e.mixins&&e.mixins.forEach(f)}if(!o&&!l)return hn(e)&&i.set(e,ji),ji;if(Le(o))for(let f=0;f<o.length;f++){const m=ui(o[f]);Pc(m)&&(r[m]=mn)}else if(o)for(const f in o){const m=ui(f);if(Pc(m)){const h=o[f],v=r[m]=Le(h)||Je(h)?{type:h}:On({},h),S=v.type;let X=!1,ae=!0;if(Le(S))for(let fe=0;fe<S.length;++fe){const ge=S[fe],R=Je(ge)&&ge.name;if(R==="Boolean"){X=!0;break}else R==="String"&&(ae=!1)}else X=Je(S)&&S.name==="Boolean";v[0]=X,v[1]=ae,(X||cn(v,"default"))&&a.push(m)}}const u=[r,a];return hn(e)&&i.set(e,u),u}function Pc(e){return e[0]!=="$"&&!As(e)}const vl=e=>e==="_"||e==="_ctx"||e==="$stable",_l=e=>Le(e)?e.map(Pt):[Pt(e)],vg=(e,n,t)=>{if(n._n)return n;const i=Fs((...s)=>_l(n(...s)),t);return i._c=!1,i},Qd=(e,n,t)=>{const i=e._ctx;for(const s in e){if(vl(s))continue;const o=e[s];if(Je(o))n[s]=vg(s,o,i);else if(o!=null){const r=_l(o);n[s]=()=>r}}},Xd=(e,n)=>{const t=_l(n);e.slots.default=()=>t},ef=(e,n,t)=>{for(const i in n)(t||!vl(i))&&(e[i]=n[i])},_g=(e,n,t)=>{const i=e.slots=Jd();if(e.vnode.shapeFlag&32){const s=n._;s?(ef(i,n,t),t&&od(i,"_",s,!0)):Qd(n,i)}else n&&Xd(e,n)},$g=(e,n,t)=>{const{vnode:i,slots:s}=e;let o=!0,r=mn;if(i.shapeFlag&32){const a=n._;a?t&&a===1?o=!1:ef(s,n,t):(o=!n.$stable,Qd(n,s)),r=n}else n&&(Xd(e,n),r={default:1});if(o)for(const a in s)!vl(a)&&r[a]==null&&delete s[a]},Yn=Hg;function wg(e){return bg(e)}function bg(e,n){const t=gr();t.__VUE__=!0;const{insert:i,remove:s,patchProp:o,createElement:r,createText:a,createComment:l,setText:u,setElementText:f,parentNode:m,nextSibling:h,setScopeId:v=Ht,insertStaticContent:S}=e,X=(T,F,k,D=null,B=null,J=null,se=void 0,te=null,Z=!!F.dynamicChildren)=>{if(T===F)return;T&&!Li(T,F)&&(D=rn(T),ve(T,B,J,!0),T=null),F.patchFlag===-2&&(Z=!1,F.dynamicChildren=null);const{type:pe,ref:ce,shapeFlag:xe}=F;switch(pe){case wr:ae(T,F,k,D);break;case Bt:fe(T,F,k,D);break;case To:T==null&&ge(F,k,D,se);break;case qe:P(T,F,k,D,B,J,se,te,Z);break;default:xe&1?V(T,F,k,D,B,J,se,te,Z):xe&6?G(T,F,k,D,B,J,se,te,Z):(xe&64||xe&128)&&pe.process(T,F,k,D,B,J,se,te,Z,An)}ce!=null&&B?Ss(ce,T&&T.ref,J,F||T,!F):ce==null&&T&&T.ref!=null&&Ss(T.ref,null,J,T,!0)},ae=(T,F,k,D)=>{if(T==null)i(F.el=a(F.children),k,D);else{const B=F.el=T.el;F.children!==T.children&&u(B,F.children)}},fe=(T,F,k,D)=>{T==null?i(F.el=l(F.children||""),k,D):F.el=T.el},ge=(T,F,k,D)=>{[T.el,T.anchor]=S(T.children,F,k,D,T.el,T.anchor)},R=({el:T,anchor:F},k,D)=>{let B;for(;T&&T!==F;)B=h(T),i(T,k,D),T=B;i(F,k,D)},Y=({el:T,anchor:F})=>{let k;for(;T&&T!==F;)k=h(T),s(T),T=k;s(F)},V=(T,F,k,D,B,J,se,te,Z)=>{if(F.type==="svg"?se="svg":F.type==="math"&&(se="mathml"),T==null)ee(F,k,D,B,J,se,te,Z);else{const pe=T.el&&T.el._isVueCE?T.el:null;try{pe&&pe._beginPatch(),W(T,F,B,J,se,te,Z)}finally{pe&&pe._endPatch()}}},ee=(T,F,k,D,B,J,se,te)=>{let Z,pe;const{props:ce,shapeFlag:xe,transition:Te,dirs:we}=T;if(Z=T.el=r(T.type,J,ce&&ce.is,ce),xe&8?f(Z,T.children):xe&16&&de(T.children,Z,null,D,B,oa(T,J),se,te),we&&yi(T,null,D,"created"),ue(Z,T,T.scopeId,se,D),ce){for(const Ve in ce)Ve!=="value"&&!As(Ve)&&o(Z,Ve,null,ce[Ve],J,D);"value"in ce&&o(Z,"value",null,ce.value,J),(pe=ce.onVnodeBeforeMount)&&wt(pe,D,T)}we&&yi(T,null,D,"beforeMount");const le=Ag(B,Te);le&&Te.beforeEnter(Z),i(Z,F,k),((pe=ce&&ce.onVnodeMounted)||le||we)&&Yn(()=>{pe&&wt(pe,D,T),le&&Te.enter(Z),we&&yi(T,null,D,"mounted")},B)},ue=(T,F,k,D,B)=>{if(k&&v(T,k),D)for(let J=0;J<D.length;J++)v(T,D[J]);if(B){let J=B.subTree;if(F===J||sf(J.type)&&(J.ssContent===F||J.ssFallback===F)){const se=B.vnode;ue(T,se,se.scopeId,se.slotScopeIds,B.parent)}}},de=(T,F,k,D,B,J,se,te,Z=0)=>{for(let pe=Z;pe<T.length;pe++){const ce=T[pe]=te?ti(T[pe]):Pt(T[pe]);X(null,ce,F,k,D,B,J,se,te)}},W=(T,F,k,D,B,J,se)=>{const te=F.el=T.el;let{patchFlag:Z,dynamicChildren:pe,dirs:ce}=F;Z|=T.patchFlag&16;const xe=T.props||mn,Te=F.props||mn;let we;if(k&&Ci(k,!1),(we=Te.onVnodeBeforeUpdate)&&wt(we,k,F,T),ce&&yi(F,T,k,"beforeUpdate"),k&&Ci(k,!0),(xe.innerHTML&&Te.innerHTML==null||xe.textContent&&Te.textContent==null)&&f(te,""),pe?Q(T.dynamicChildren,pe,te,k,D,oa(F,B),J):se||q(T,F,te,null,k,D,oa(F,B),J,!1),Z>0){if(Z&16)L(te,xe,Te,k,B);else if(Z&2&&xe.class!==Te.class&&o(te,"class",null,Te.class,B),Z&4&&o(te,"style",xe.style,Te.style,B),Z&8){const le=F.dynamicProps;for(let Ve=0;Ve<le.length;Ve++){const We=le[Ve],Pn=xe[We],wn=Te[We];(wn!==Pn||We==="value")&&o(te,We,Pn,wn,B,k)}}Z&1&&T.children!==F.children&&f(te,F.children)}else!se&&pe==null&&L(te,xe,Te,k,B);((we=Te.onVnodeUpdated)||ce)&&Yn(()=>{we&&wt(we,k,F,T),ce&&yi(F,T,k,"updated")},D)},Q=(T,F,k,D,B,J,se)=>{for(let te=0;te<F.length;te++){const Z=T[te],pe=F[te],ce=Z.el&&(Z.type===qe||!Li(Z,pe)||Z.shapeFlag&198)?m(Z.el):k;X(Z,pe,ce,null,D,B,J,se,!0)}},L=(T,F,k,D,B)=>{if(F!==k){if(F!==mn)for(const J in F)!As(J)&&!(J in k)&&o(T,J,F[J],null,B,D);for(const J in k){if(As(J))continue;const se=k[J],te=F[J];se!==te&&J!=="value"&&o(T,J,te,se,B,D)}"value"in k&&o(T,"value",F.value,k.value,B)}},P=(T,F,k,D,B,J,se,te,Z)=>{const pe=F.el=T?T.el:a(""),ce=F.anchor=T?T.anchor:a("");let{patchFlag:xe,dynamicChildren:Te,slotScopeIds:we}=F;we&&(te=te?te.concat(we):we),T==null?(i(pe,k,D),i(ce,k,D),de(F.children||[],k,ce,B,J,se,te,Z)):xe>0&&xe&64&&Te&&T.dynamicChildren&&T.dynamicChildren.length===Te.length?(Q(T.dynamicChildren,Te,k,B,J,se,te),(F.key!=null||B&&F===B.subTree)&&$l(T,F,!0)):q(T,F,k,ce,B,J,se,te,Z)},G=(T,F,k,D,B,J,se,te,Z)=>{F.slotScopeIds=te,T==null?F.shapeFlag&512?B.ctx.activate(F,k,D,se,Z):_(F,k,D,B,J,se,Z):$(T,F,Z)},_=(T,F,k,D,B,J,se)=>{const te=T.component=Rg(T,D,B);if(Ld(T)&&(te.ctx.renderer=An),Ng(te,!1,se),te.asyncDep){if(B&&B.registerDep(te,A,se),!T.el){const Z=te.subTree=Ln(Bt);fe(null,Z,F,k),T.placeholder=Z.el}}else A(te,T,F,k,B,J,se)},$=(T,F,k)=>{const D=F.component=T.component;if(hg(T,F,k))if(D.asyncDep&&!D.asyncResolved){H(D,F,k);return}else D.next=F,D.update();else F.el=T.el,D.vnode=F},A=(T,F,k,D,B,J,se)=>{const te=()=>{if(T.isMounted){let{next:xe,bu:Te,u:we,parent:le,vnode:Ve}=T;{const Sn=nf(T);if(Sn){xe&&(xe.el=Ve.el,H(T,xe,se)),Sn.asyncDep.then(()=>{T.isUnmounted||te()});return}}let We=xe,Pn;Ci(T,!1),xe?(xe.el=Ve.el,H(T,xe,se)):xe=Ve,Te&&ko(Te),(Pn=xe.props&&xe.props.onVnodeBeforeUpdate)&&wt(Pn,le,xe,Ve),Ci(T,!0);const wn=bc(T),fn=T.subTree;T.subTree=wn,X(fn,wn,m(fn.el),rn(fn),T,B,J),xe.el=wn.el,We===null&&pg(T,wn.el),we&&Yn(we,B),(Pn=xe.props&&xe.props.onVnodeUpdated)&&Yn(()=>wt(Pn,le,xe,Ve),B)}else{let xe;const{el:Te,props:we}=F,{bm:le,m:Ve,parent:We,root:Pn,type:wn}=T,fn=Wi(F);Ci(T,!1),le&&ko(le),!fn&&(xe=we&&we.onVnodeBeforeMount)&&wt(xe,We,F),Ci(T,!0);{Pn.ce&&Pn.ce._def.shadowRoot!==!1&&Pn.ce._injectChildStyle(wn);const Sn=T.subTree=bc(T);X(null,Sn,k,D,T,B,J),F.el=Sn.el}if(Ve&&Yn(Ve,B),!fn&&(xe=we&&we.onVnodeMounted)){const Sn=F;Yn(()=>wt(xe,We,Sn),B)}(F.shapeFlag&256||We&&Wi(We.vnode)&&We.vnode.shapeFlag&256)&&T.a&&Yn(T.a,B),T.isMounted=!0,F=k=D=null}};T.scope.on();const Z=T.effect=new fd(te);T.scope.off();const pe=T.update=Z.run.bind(Z),ce=T.job=Z.runIfDirty.bind(Z);ce.i=T,ce.id=T.uid,Z.scheduler=()=>yl(ce),Ci(T,!0),pe()},H=(T,F,k)=>{F.component=T;const D=T.vnode.props;T.vnode=F,T.next=null,yg(T,F.props,D,k),$g(T,F.children,k),jt(),hc(T),Ft()},q=(T,F,k,D,B,J,se,te,Z=!1)=>{const pe=T&&T.children,ce=T?T.shapeFlag:0,xe=F.children,{patchFlag:Te,shapeFlag:we}=F;if(Te>0){if(Te&128){me(pe,xe,k,D,B,J,se,te,Z);return}else if(Te&256){ne(pe,xe,k,D,B,J,se,te,Z);return}}we&8?(ce&16&&on(pe,B,J),xe!==pe&&f(k,xe)):ce&16?we&16?me(pe,xe,k,D,B,J,se,te,Z):on(pe,B,J,!0):(ce&8&&f(k,""),we&16&&de(xe,k,D,B,J,se,te,Z))},ne=(T,F,k,D,B,J,se,te,Z)=>{T=T||ji,F=F||ji;const pe=T.length,ce=F.length,xe=Math.min(pe,ce);let Te;for(Te=0;Te<xe;Te++){const we=F[Te]=Z?ti(F[Te]):Pt(F[Te]);X(T[Te],we,k,null,B,J,se,te,Z)}pe>ce?on(T,B,J,!0,!1,xe):de(F,k,D,B,J,se,te,Z,xe)},me=(T,F,k,D,B,J,se,te,Z)=>{let pe=0;const ce=F.length;let xe=T.length-1,Te=ce-1;for(;pe<=xe&&pe<=Te;){const we=T[pe],le=F[pe]=Z?ti(F[pe]):Pt(F[pe]);if(Li(we,le))X(we,le,k,null,B,J,se,te,Z);else break;pe++}for(;pe<=xe&&pe<=Te;){const we=T[xe],le=F[Te]=Z?ti(F[Te]):Pt(F[Te]);if(Li(we,le))X(we,le,k,null,B,J,se,te,Z);else break;xe--,Te--}if(pe>xe){if(pe<=Te){const we=Te+1,le=we<ce?F[we].el:D;for(;pe<=Te;)X(null,F[pe]=Z?ti(F[pe]):Pt(F[pe]),k,le,B,J,se,te,Z),pe++}}else if(pe>Te)for(;pe<=xe;)ve(T[pe],B,J,!0),pe++;else{const we=pe,le=pe,Ve=new Map;for(pe=le;pe<=Te;pe++){const In=F[pe]=Z?ti(F[pe]):Pt(F[pe]);In.key!=null&&Ve.set(In.key,pe)}let We,Pn=0;const wn=Te-le+1;let fn=!1,Sn=0;const it=new Array(wn);for(pe=0;pe<wn;pe++)it[pe]=0;for(pe=we;pe<=xe;pe++){const In=T[pe];if(Pn>=wn){ve(In,B,J,!0);continue}let _n;if(In.key!=null)_n=Ve.get(In.key);else for(We=le;We<=Te;We++)if(it[We-le]===0&&Li(In,F[We])){_n=We;break}_n===void 0?ve(In,B,J,!0):(it[_n-le]=pe+1,_n>=Sn?Sn=_n:fn=!0,X(In,F[_n],k,null,B,J,se,te,Z),Pn++)}const Gn=fn?Pg(it):ji;for(We=Gn.length-1,pe=wn-1;pe>=0;pe--){const In=le+pe,_n=F[In],st=F[In+1],kt=In+1<ce?st.el||tf(st):D;it[pe]===0?X(null,_n,k,kt,B,J,se,te,Z):fn&&(We<0||pe!==Gn[We]?oe(_n,k,kt,2):We--)}}},oe=(T,F,k,D,B=null)=>{const{el:J,type:se,transition:te,children:Z,shapeFlag:pe}=T;if(pe&6){oe(T.component.subTree,F,k,D);return}if(pe&128){T.suspense.move(F,k,D);return}if(pe&64){se.move(T,F,k,An);return}if(se===qe){i(J,F,k);for(let xe=0;xe<Z.length;xe++)oe(Z[xe],F,k,D);i(T.anchor,F,k);return}if(se===To){R(T,F,k);return}if(D!==2&&pe&1&&te)if(D===0)te.beforeEnter(J),i(J,F,k),Yn(()=>te.enter(J),B);else{const{leave:xe,delayLeave:Te,afterLeave:we}=te,le=()=>{T.ctx.isUnmounted?s(J):i(J,F,k)},Ve=()=>{J._isLeaving&&J[$i](!0),xe(J,()=>{le(),we&&we()})};Te?Te(J,le,Ve):Ve()}else i(J,F,k)},ve=(T,F,k,D=!1,B=!1)=>{const{type:J,props:se,ref:te,children:Z,dynamicChildren:pe,shapeFlag:ce,patchFlag:xe,dirs:Te,cacheIndex:we}=T;if(xe===-2&&(B=!1),te!=null&&(jt(),Ss(te,null,k,T,!0),Ft()),we!=null&&(F.renderCache[we]=void 0),ce&256){F.ctx.deactivate(T);return}const le=ce&1&&Te,Ve=!Wi(T);let We;if(Ve&&(We=se&&se.onVnodeBeforeUnmount)&&wt(We,F,T),ce&6)Qe(T.component,k,D);else{if(ce&128){T.suspense.unmount(k,D);return}le&&yi(T,null,F,"beforeUnmount"),ce&64?T.type.remove(T,F,k,An,D):pe&&!pe.hasOnce&&(J!==qe||xe>0&&xe&64)?on(pe,F,k,!1,!0):(J===qe&&xe&384||!B&&ce&16)&&on(Z,F,k),D&&_e(T)}(Ve&&(We=se&&se.onVnodeUnmounted)||le)&&Yn(()=>{We&&wt(We,F,T),le&&yi(T,null,F,"unmounted")},k)},_e=T=>{const{type:F,el:k,anchor:D,transition:B}=T;if(F===qe){Ye(k,D);return}if(F===To){Y(T);return}const J=()=>{s(k),B&&!B.persisted&&B.afterLeave&&B.afterLeave()};if(T.shapeFlag&1&&B&&!B.persisted){const{leave:se,delayLeave:te}=B,Z=()=>se(k,J);te?te(T.el,J,Z):Z()}else J()},Ye=(T,F)=>{let k;for(;T!==F;)k=h(T),s(T),T=k;s(F)},Qe=(T,F,k)=>{const{bum:D,scope:B,job:J,subTree:se,um:te,m:Z,a:pe}=T;Hc(Z),Hc(pe),D&&ko(D),B.stop(),J&&(J.flags|=8,ve(se,T,F,k)),te&&Yn(te,F),Yn(()=>{T.isUnmounted=!0},F)},on=(T,F,k,D=!1,B=!1,J=0)=>{for(let se=J;se<T.length;se++)ve(T[se],F,k,D,B)},rn=T=>{if(T.shapeFlag&6)return rn(T.component.subTree);if(T.shapeFlag&128)return T.suspense.next();const F=h(T.anchor||T.el),k=F&&F[Rd];return k?h(k):F};let Ge=!1;const gn=(T,F,k)=>{let D;T==null?F._vnode&&(ve(F._vnode,null,null,!0),D=F._vnode.component):X(F._vnode||null,T,F,null,null,null,k),F._vnode=T,Ge||(Ge=!0,hc(D),Sd(),Ge=!1)},An={p:X,um:ve,m:oe,r:_e,mt:_,mc:de,pc:q,pbc:Q,n:rn,o:e};return{render:gn,hydrate:void 0,createApp:lg(gn)}}function oa({type:e,props:n},t){return t==="svg"&&e==="foreignObject"||t==="mathml"&&e==="annotation-xml"&&n&&n.encoding&&n.encoding.includes("html")?void 0:t}function Ci({effect:e,job:n},t){t?(e.flags|=32,n.flags|=4):(e.flags&=-33,n.flags&=-5)}function Ag(e,n){return(!e||e&&!e.pendingBranch)&&n&&!n.persisted}function $l(e,n,t=!1){const i=e.children,s=n.children;if(Le(i)&&Le(s))for(let o=0;o<i.length;o++){const r=i[o];let a=s[o];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[o]=ti(s[o]),a.el=r.el),!t&&a.patchFlag!==-2&&$l(r,a)),a.type===wr&&(a.patchFlag!==-1?a.el=r.el:a.__elIndex=o+(e.type===qe?1:0)),a.type===Bt&&!a.el&&(a.el=r.el)}}function Pg(e){const n=e.slice(),t=[0];let i,s,o,r,a;const l=e.length;for(i=0;i<l;i++){const u=e[i];if(u!==0){if(s=t[t.length-1],e[s]<u){n[i]=s,t.push(i);continue}for(o=0,r=t.length-1;o<r;)a=o+r>>1,e[t[a]]<u?o=a+1:r=a;u<e[t[o]]&&(o>0&&(n[i]=t[o-1]),t[o]=i)}}for(o=t.length,r=t[o-1];o-- >0;)t[o]=r,r=n[r];return t}function nf(e){const n=e.subTree.component;if(n)return n.asyncDep&&!n.asyncResolved?n:nf(n)}function Hc(e){if(e)for(let n=0;n<e.length;n++)e[n].flags|=8}function tf(e){if(e.placeholder)return e.placeholder;const n=e.component;return n?tf(n.subTree):null}const sf=e=>e.__isSuspense;function Hg(e,n){n&&n.pendingBranch?Le(e)?n.effects.push(...e):n.effects.push(e):Tp(e)}const qe=Symbol.for("v-fgt"),wr=Symbol.for("v-txt"),Bt=Symbol.for("v-cmt"),To=Symbol.for("v-stc"),ks=[];let ot=null;function M(e=!1){ks.push(ot=e?null:[])}function xg(){ks.pop(),ot=ks[ks.length-1]||null}let Ws=1;function xc(e,n=!1){Ws+=e,e<0&&ot&&n&&(ot.hasOnce=!0)}function of(e){return e.dynamicChildren=Ws>0?ot||ji:null,xg(),Ws>0&&ot&&ot.push(e),e}function j(e,n,t,i,s,o){return of(p(e,n,t,i,s,o,!0))}function bn(e,n,t,i,s){return of(Ln(e,n,t,i,s,!0))}function wl(e){return e?e.__v_isVNode===!0:!1}function Li(e,n){return e.type===n.type&&e.key===n.key}const rf=({key:e})=>e??null,Ro=({ref:e,ref_key:n,ref_for:t})=>(typeof e=="number"&&(e=""+e),e!=null?Bn(e)||xn(e)||Je(e)?{i:zn,r:e,k:n,f:!!t}:e:null);function p(e,n=null,t=null,i=0,s=null,o=e===qe?0:1,r=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:n,key:n&&rf(n),ref:n&&Ro(n),scopeId:kd,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:i,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:zn};return a?(bl(l,t),o&128&&e.normalize(l)):t&&(l.shapeFlag|=Bn(t)?8:16),Ws>0&&!r&&ot&&(l.patchFlag>0||o&6)&&l.patchFlag!==32&&ot.push(l),l}const Ln=Bg;function Bg(e,n=null,t=null,i=0,s=null,o=!1){if((!e||e===eg)&&(e=Bt),wl(e)){const a=Si(e,n,!0);return t&&bl(a,t),Ws>0&&!o&&ot&&(a.shapeFlag&6?ot[ot.indexOf(e)]=a:ot.push(a)),a.patchFlag=-2,a}if(Lg(e)&&(e=e.__vccOpts),n){n=Sg(n);let{class:a,style:l}=n;a&&!Bn(a)&&(n.class=ze(a)),hn(l)&&(Cr(l)&&!Le(l)&&(l=On({},l)),n.style=Ki(l))}const r=Bn(e)?1:sf(e)?128:Lp(e)?64:hn(e)?4:Je(e)?2:0;return p(e,n,t,i,s,r,o,!0)}function Sg(e){return e?Cr(e)||Yd(e)?On({},e):e:null}function Si(e,n,t=!1,i=!1){const{props:s,ref:o,patchFlag:r,children:a,transition:l}=e,u=n?kg(s||{},n):s,f={__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&rf(u),ref:n&&n.ref?t&&o?Le(o)?o.concat(Ro(n)):[o,Ro(n)]:Ro(n):o,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:n&&e.type!==qe?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:l,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Si(e.ssContent),ssFallback:e.ssFallback&&Si(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return l&&i&&Vs(f,l.clone(f)),f}function un(e=" ",n=0){return Ln(wr,null,e,n)}function Ig(e,n){const t=Ln(To,null,e);return t.staticCount=n,t}function $e(e="",n=!1){return n?(M(),bn(Bt,null,e)):Ln(Bt,null,e)}function Pt(e){return e==null||typeof e=="boolean"?Ln(Bt):Le(e)?Ln(qe,null,e.slice()):wl(e)?ti(e):Ln(wr,null,String(e))}function ti(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Si(e)}function bl(e,n){let t=0;const{shapeFlag:i}=e;if(n==null)n=null;else if(Le(n))t=16;else if(typeof n=="object")if(i&65){const s=n.default;s&&(s._c&&(s._d=!1),bl(e,s()),s._c&&(s._d=!0));return}else{t=32;const s=n._;!s&&!Yd(n)?n._ctx=zn:s===3&&zn&&(zn.slots._===1?n._=1:(n._=2,e.patchFlag|=1024))}else Je(n)?(n={default:n,_ctx:zn},t=32):(n=String(n),i&64?(t=16,n=[un(n)]):t=8);e.children=n,e.shapeFlag|=t}function kg(...e){const n={};for(let t=0;t<e.length;t++){const i=e[t];for(const s in i)if(s==="class")n.class!==i.class&&(n.class=ze([n.class,i.class]));else if(s==="style")n.style=Ki([n.style,i.style]);else if(fr(s)){const o=n[s],r=i[s];r&&o!==r&&!(Le(o)&&o.includes(r))&&(n[s]=o?[].concat(o,r):r)}else s!==""&&(n[s]=i[s])}return n}function wt(e,n,t,i=null){vt(e,n,7,[t,i])}const Eg=Wd();let Tg=0;function Rg(e,n,t){const i=e.type,s=(n?n.appContext:e.appContext)||Eg,o={uid:Tg++,vnode:e,type:i,parent:n,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new cd(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(s.provides),ids:n?n.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Zd(i,s),emitsOptions:zd(i,s),emit:null,emitted:null,propsDefaults:mn,inheritAttrs:i.inheritAttrs,ctx:mn,data:mn,props:mn,attrs:mn,slots:mn,refs:mn,setupState:mn,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return o.ctx={_:o},o.root=n?n.root:o,o.emit=ug.bind(null,o),e.ce&&e.ce(o),o}let Zn=null;const Al=()=>Zn||zn;let Vo,Ra;{const e=gr(),n=(t,i)=>{let s;return(s=e[t])||(s=e[t]=[]),s.push(i),o=>{s.length>1?s.forEach(r=>r(o)):s[0](o)}};Vo=n("__VUE_INSTANCE_SETTERS__",t=>Zn=t),Ra=n("__VUE_SSR_SETTERS__",t=>zs=t)}const co=e=>{const n=Zn;return Vo(e),e.scope.on(),()=>{e.scope.off(),Vo(n)}},Bc=()=>{Zn&&Zn.scope.off(),Vo(null)};function af(e){return e.vnode.shapeFlag&4}let zs=!1;function Ng(e,n=!1,t=!1){n&&Ra(n);const{props:i,children:s}=e.vnode,o=af(e);gg(e,i,o,n),_g(e,s,t||n);const r=o?Mg(e,n):void 0;return n&&Ra(!1),r}function Mg(e,n){const t=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,ng);const{setup:i}=t;if(i){jt();const s=e.setupContext=i.length>1?qg(e):null,o=co(e),r=ao(i,e,0,[e.props,s]),a=nd(r);if(Ft(),o(),(a||e.sp)&&!Wi(e)&&qd(e),a){if(r.then(Bc,Bc),n)return r.then(l=>{Sc(e,l)}).catch(l=>{vr(l,e,0)});e.asyncDep=r}else Sc(e,r)}else lf(e)}function Sc(e,n,t){Je(n)?e.type.__ssrInlineRender?e.ssrRender=n:e.render=n:hn(n)&&(e.setupState=Hd(n)),lf(e)}function lf(e,n,t){const i=e.type;e.render||(e.render=i.render||Ht);{const s=co(e);jt();try{tg(e)}finally{Ft(),s()}}}const Dg={get(e,n){return Vn(e,"get",""),e[n]}};function qg(e){const n=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,Dg),slots:e.slots,emit:e.emit,expose:n}}function br(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Hd(gl(e.exposed)),{get(n,t){if(t in n)return n[t];if(t in Is)return Is[t](e)},has(n,t){return t in n||t in Is}})):e.proxy}function Lg(e){return Je(e)&&"__vccOpts"in e}const Oe=(e,n)=>Bp(e,n,zs),Og="3.5.26";let Na;const Ic=typeof window<"u"&&window.trustedTypes;if(Ic)try{Na=Ic.createPolicy("vue",{createHTML:e=>e})}catch{}const cf=Na?e=>Na.createHTML(e):e=>e,Ug="http://www.w3.org/2000/svg",jg="http://www.w3.org/1998/Math/MathML",Rt=typeof document<"u"?document:null,kc=Rt&&Rt.createElement("template"),Fg={insert:(e,n,t)=>{n.insertBefore(e,t||null)},remove:e=>{const n=e.parentNode;n&&n.removeChild(e)},createElement:(e,n,t,i)=>{const s=n==="svg"?Rt.createElementNS(Ug,e):n==="mathml"?Rt.createElementNS(jg,e):t?Rt.createElement(e,{is:t}):Rt.createElement(e);return e==="select"&&i&&i.multiple!=null&&s.setAttribute("multiple",i.multiple),s},createText:e=>Rt.createTextNode(e),createComment:e=>Rt.createComment(e),setText:(e,n)=>{e.nodeValue=n},setElementText:(e,n)=>{e.textContent=n},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Rt.querySelector(e),setScopeId(e,n){e.setAttribute(n,"")},insertStaticContent(e,n,t,i,s,o){const r=t?t.previousSibling:n.lastChild;if(s&&(s===o||s.nextSibling))for(;n.insertBefore(s.cloneNode(!0),t),!(s===o||!(s=s.nextSibling)););else{kc.innerHTML=cf(i==="svg"?`<svg>${e}</svg>`:i==="mathml"?`<math>${e}</math>`:e);const a=kc.content;if(i==="svg"||i==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}n.insertBefore(a,t)}return[r?r.nextSibling:n.firstChild,t?t.previousSibling:n.lastChild]}},Zt="transition",ps="animation",Xi=Symbol("_vtc"),uf={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Vg=On({},Fp,uf),vi=(e,n=[])=>{Le(e)?e.forEach(t=>t(...n)):e&&e(...n)},Ec=e=>e?Le(e)?e.some(n=>n.length>1):e.length>1:!1;function Wg(e){const n={};for(const P in e)P in uf||(n[P]=e[P]);if(e.css===!1)return n;const{name:t="v",type:i,duration:s,enterFromClass:o=`${t}-enter-from`,enterActiveClass:r=`${t}-enter-active`,enterToClass:a=`${t}-enter-to`,appearFromClass:l=o,appearActiveClass:u=r,appearToClass:f=a,leaveFromClass:m=`${t}-leave-from`,leaveActiveClass:h=`${t}-leave-active`,leaveToClass:v=`${t}-leave-to`}=e,S=zg(s),X=S&&S[0],ae=S&&S[1],{onBeforeEnter:fe,onEnter:ge,onEnterCancelled:R,onLeave:Y,onLeaveCancelled:V,onBeforeAppear:ee=fe,onAppear:ue=ge,onAppearCancelled:de=R}=n,W=(P,G,_,$)=>{P._enterCancelled=$,Qt(P,G?f:a),Qt(P,G?u:r),_&&_()},Q=(P,G)=>{P._isLeaving=!1,Qt(P,m),Qt(P,v),Qt(P,h),G&&G()},L=P=>(G,_)=>{const $=P?ue:ge,A=()=>W(G,P,_);vi($,[G,A]),Tc(()=>{Qt(G,P?l:o),bt(G,P?f:a),Ec($)||Rc(G,i,X,A)})};return On(n,{onBeforeEnter(P){vi(fe,[P]),bt(P,o),bt(P,r)},onBeforeAppear(P){vi(ee,[P]),bt(P,l),bt(P,u)},onEnter:L(!1),onAppear:L(!0),onLeave(P,G){P._isLeaving=!0;const _=()=>Q(P,G);bt(P,m),P._enterCancelled?(bt(P,h),Ma(P)):(Ma(P),bt(P,h)),Tc(()=>{P._isLeaving&&(Qt(P,m),bt(P,v),Ec(Y)||Rc(P,i,ae,_))}),vi(Y,[P,_])},onEnterCancelled(P){W(P,!1,void 0,!0),vi(R,[P])},onAppearCancelled(P){W(P,!0,void 0,!0),vi(de,[P])},onLeaveCancelled(P){Q(P),vi(V,[P])}})}function zg(e){if(e==null)return null;if(hn(e))return[ra(e.enter),ra(e.leave)];{const n=ra(e);return[n,n]}}function ra(e){return zh(e)}function bt(e,n){n.split(/\s+/).forEach(t=>t&&e.classList.add(t)),(e[Xi]||(e[Xi]=new Set)).add(n)}function Qt(e,n){n.split(/\s+/).forEach(i=>i&&e.classList.remove(i));const t=e[Xi];t&&(t.delete(n),t.size||(e[Xi]=void 0))}function Tc(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Gg=0;function Rc(e,n,t,i){const s=e._endId=++Gg,o=()=>{s===e._endId&&i()};if(t!=null)return setTimeout(o,t);const{type:r,timeout:a,propCount:l}=df(e,n);if(!r)return i();const u=r+"end";let f=0;const m=()=>{e.removeEventListener(u,h),o()},h=v=>{v.target===e&&++f>=l&&m()};setTimeout(()=>{f<l&&m()},a+1),e.addEventListener(u,h)}function df(e,n){const t=window.getComputedStyle(e),i=S=>(t[S]||"").split(", "),s=i(`${Zt}Delay`),o=i(`${Zt}Duration`),r=Nc(s,o),a=i(`${ps}Delay`),l=i(`${ps}Duration`),u=Nc(a,l);let f=null,m=0,h=0;n===Zt?r>0&&(f=Zt,m=r,h=o.length):n===ps?u>0&&(f=ps,m=u,h=l.length):(m=Math.max(r,u),f=m>0?r>u?Zt:ps:null,h=f?f===Zt?o.length:l.length:0);const v=f===Zt&&/\b(?:transform|all)(?:,|$)/.test(i(`${Zt}Property`).toString());return{type:f,timeout:m,propCount:h,hasTransform:v}}function Nc(e,n){for(;e.length<n.length;)e=e.concat(e);return Math.max(...n.map((t,i)=>Mc(t)+Mc(e[i])))}function Mc(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function Ma(e){return(e?e.ownerDocument:document).body.offsetHeight}function Jg(e,n,t){const i=e[Xi];i&&(n=(n?[n,...i]:[...i]).join(" ")),n==null?e.removeAttribute("class"):t?e.setAttribute("class",n):e.className=n}const Dc=Symbol("_vod"),Yg=Symbol("_vsh"),Kg=Symbol(""),Zg=/(?:^|;)\s*display\s*:/;function Qg(e,n,t){const i=e.style,s=Bn(t);let o=!1;if(t&&!s){if(n)if(Bn(n))for(const r of n.split(";")){const a=r.slice(0,r.indexOf(":")).trim();t[a]==null&&No(i,a,"")}else for(const r in n)t[r]==null&&No(i,r,"");for(const r in t)r==="display"&&(o=!0),No(i,r,t[r])}else if(s){if(n!==t){const r=i[Kg];r&&(t+=";"+r),i.cssText=t,o=Zg.test(t)}}else n&&e.removeAttribute("style");Dc in e&&(e[Dc]=o?i.display:"",e[Yg]&&(i.display="none"))}const qc=/\s*!important$/;function No(e,n,t){if(Le(t))t.forEach(i=>No(e,n,i));else if(t==null&&(t=""),n.startsWith("--"))e.setProperty(n,t);else{const i=Xg(e,n);qc.test(t)?e.setProperty(hi(i),t.replace(qc,""),"important"):e[i]=t}}const Lc=["Webkit","Moz","ms"],aa={};function Xg(e,n){const t=aa[n];if(t)return t;let i=ui(n);if(i!=="filter"&&i in e)return aa[n]=i;i=sd(i);for(let s=0;s<Lc.length;s++){const o=Lc[s]+i;if(o in e)return aa[n]=o}return n}const Oc="http://www.w3.org/1999/xlink";function Uc(e,n,t,i,s,o=Qh(n)){i&&n.startsWith("xlink:")?t==null?e.removeAttributeNS(Oc,n.slice(6,n.length)):e.setAttributeNS(Oc,n,t):t==null||o&&!rd(t)?e.removeAttribute(n):e.setAttribute(n,o?"":yt(t)?String(t):t)}function jc(e,n,t,i,s){if(n==="innerHTML"||n==="textContent"){t!=null&&(e[n]=n==="innerHTML"?cf(t):t);return}const o=e.tagName;if(n==="value"&&o!=="PROGRESS"&&!o.includes("-")){const a=o==="OPTION"?e.getAttribute("value")||"":e.value,l=t==null?e.type==="checkbox"?"on":"":String(t);(a!==l||!("_value"in e))&&(e.value=l),t==null&&e.removeAttribute(n),e._value=t;return}let r=!1;if(t===""||t==null){const a=typeof e[n];a==="boolean"?t=rd(t):t==null&&a==="string"?(t="",r=!0):a==="number"&&(t=0,r=!0)}try{e[n]=t}catch{}r&&e.removeAttribute(s||n)}function ii(e,n,t,i){e.addEventListener(n,t,i)}function e0(e,n,t,i){e.removeEventListener(n,t,i)}const Fc=Symbol("_vei");function n0(e,n,t,i,s=null){const o=e[Fc]||(e[Fc]={}),r=o[n];if(i&&r)r.value=i;else{const[a,l]=t0(n);if(i){const u=o[n]=o0(i,s);ii(e,a,u,l)}else r&&(e0(e,a,r,l),o[n]=void 0)}}const Vc=/(?:Once|Passive|Capture)$/;function t0(e){let n;if(Vc.test(e)){n={};let i;for(;i=e.match(Vc);)e=e.slice(0,e.length-i[0].length),n[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):hi(e.slice(2)),n]}let la=0;const i0=Promise.resolve(),s0=()=>la||(i0.then(()=>la=0),la=Date.now());function o0(e,n){const t=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=t.attached)return;vt(r0(i,t.value),n,5,[i])};return t.value=e,t.attached=s0(),t}function r0(e,n){if(Le(n)){const t=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{t.call(e),e._stopped=!0},n.map(i=>s=>!s._stopped&&i&&i(s))}else return n}const Wc=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,a0=(e,n,t,i,s,o)=>{const r=s==="svg";n==="class"?Jg(e,i,r):n==="style"?Qg(e,t,i):fr(n)?al(n)||n0(e,n,t,i,o):(n[0]==="."?(n=n.slice(1),!0):n[0]==="^"?(n=n.slice(1),!1):l0(e,n,i,r))?(jc(e,n,i),!e.tagName.includes("-")&&(n==="value"||n==="checked"||n==="selected")&&Uc(e,n,i,r,o,n!=="value")):e._isVueCE&&(/[A-Z]/.test(n)||!Bn(i))?jc(e,ui(n),i,o,n):(n==="true-value"?e._trueValue=i:n==="false-value"&&(e._falseValue=i),Uc(e,n,i,r))};function l0(e,n,t,i){if(i)return!!(n==="innerHTML"||n==="textContent"||n in e&&Wc(n)&&Je(t));if(n==="spellcheck"||n==="draggable"||n==="translate"||n==="autocorrect"||n==="sandbox"&&e.tagName==="IFRAME"||n==="form"||n==="list"&&e.tagName==="INPUT"||n==="type"&&e.tagName==="TEXTAREA")return!1;if(n==="width"||n==="height"){const s=e.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Wc(n)&&Bn(t)?!1:n in e}const ff=new WeakMap,mf=new WeakMap,Wo=Symbol("_moveCb"),zc=Symbol("_enterCb"),c0=e=>(delete e.props.mode,e),u0=c0({name:"TransitionGroup",props:On({},Vg,{tag:String,moveClass:String}),setup(e,{slots:n}){const t=Al(),i=jp();let s,o;return Ud(()=>{if(!s.length)return;const r=e.moveClass||`${e.name||"v"}-move`;if(!p0(s[0].el,t.vnode.el,r)){s=[];return}s.forEach(f0),s.forEach(m0);const a=s.filter(h0);Ma(t.vnode.el),a.forEach(l=>{const u=l.el,f=u.style;bt(u,r),f.transform=f.webkitTransform=f.transitionDuration="";const m=u[Wo]=h=>{h&&h.target!==u||(!h||h.propertyName.endsWith("transform"))&&(u.removeEventListener("transitionend",m),u[Wo]=null,Qt(u,r))};u.addEventListener("transitionend",m)}),s=[]}),()=>{const r=an(e),a=Wg(r);let l=r.tag||qe;if(s=[],o)for(let u=0;u<o.length;u++){const f=o[u];f.el&&f.el instanceof Element&&(s.push(f),Vs(f,Ba(f,a,i,t)),ff.set(f,{left:f.el.offsetLeft,top:f.el.offsetTop}))}o=n.default?Dd(n.default()):[];for(let u=0;u<o.length;u++){const f=o[u];f.key!=null&&Vs(f,Ba(f,a,i,t))}return Ln(l,null,o)}}}),d0=u0;function f0(e){const n=e.el;n[Wo]&&n[Wo](),n[zc]&&n[zc]()}function m0(e){mf.set(e,{left:e.el.offsetLeft,top:e.el.offsetTop})}function h0(e){const n=ff.get(e),t=mf.get(e),i=n.left-t.left,s=n.top-t.top;if(i||s){const o=e.el.style;return o.transform=o.webkitTransform=`translate(${i}px,${s}px)`,o.transitionDuration="0s",e}}function p0(e,n,t){const i=e.cloneNode(),s=e[Xi];s&&s.forEach(a=>{a.split(/\s+/).forEach(l=>l&&i.classList.remove(l))}),t.split(/\s+/).forEach(a=>a&&i.classList.add(a)),i.style.display="none";const o=n.nodeType===1?n:n.parentNode;o.appendChild(i);const{hasTransform:r}=df(i);return o.removeChild(i),r}const es=e=>{const n=e.props["onUpdate:modelValue"]||!1;return Le(n)?t=>ko(n,t):n};function g0(e){e.target.composing=!0}function Gc(e){const n=e.target;n.composing&&(n.composing=!1,n.dispatchEvent(new Event("input")))}const Ot=Symbol("_assign");function Jc(e,n,t){return n&&(e=e.trim()),t&&(e=pr(e)),e}const uo={created(e,{modifiers:{lazy:n,trim:t,number:i}},s){e[Ot]=es(s);const o=i||s.props&&s.props.type==="number";ii(e,n?"change":"input",r=>{r.target.composing||e[Ot](Jc(e.value,t,o))}),(t||o)&&ii(e,"change",()=>{e.value=Jc(e.value,t,o)}),n||(ii(e,"compositionstart",g0),ii(e,"compositionend",Gc),ii(e,"change",Gc))},mounted(e,{value:n}){e.value=n??""},beforeUpdate(e,{value:n,oldValue:t,modifiers:{lazy:i,trim:s,number:o}},r){if(e[Ot]=es(r),e.composing)return;const a=(o||e.type==="number")&&!/^0\d/.test(e.value)?pr(e.value):e.value,l=n??"";a!==l&&(document.activeElement===e&&e.type!=="range"&&(i&&n===t||s&&e.value.trim()===l)||(e.value=l))}},y0={deep:!0,created(e,n,t){e[Ot]=es(t),ii(e,"change",()=>{const i=e._modelValue,s=Gs(e),o=e.checked,r=e[Ot];if(Le(i)){const a=cl(i,s),l=a!==-1;if(o&&!l)r(i.concat(s));else if(!o&&l){const u=[...i];u.splice(a,1),r(u)}}else if(rs(i)){const a=new Set(i);o?a.add(s):a.delete(s),r(a)}else r(hf(e,o))})},mounted:Yc,beforeUpdate(e,n,t){e[Ot]=es(t),Yc(e,n,t)}};function Yc(e,{value:n,oldValue:t},i){e._modelValue=n;let s;if(Le(n))s=cl(n,i.props.value)>-1;else if(rs(n))s=n.has(i.props.value);else{if(n===t)return;s=ro(n,hf(e,!0))}e.checked!==s&&(e.checked=s)}const Es={deep:!0,created(e,{value:n,modifiers:{number:t}},i){const s=rs(n);ii(e,"change",()=>{const o=Array.prototype.filter.call(e.options,r=>r.selected).map(r=>t?pr(Gs(r)):Gs(r));e[Ot](e.multiple?s?new Set(o):o:o[0]),e._assigning=!0,Qi(()=>{e._assigning=!1})}),e[Ot]=es(i)},mounted(e,{value:n}){Kc(e,n)},beforeUpdate(e,n,t){e[Ot]=es(t)},updated(e,{value:n}){e._assigning||Kc(e,n)}};function Kc(e,n){const t=e.multiple,i=Le(n);if(!(t&&!i&&!rs(n))){for(let s=0,o=e.options.length;s<o;s++){const r=e.options[s],a=Gs(r);if(t)if(i){const l=typeof a;l==="string"||l==="number"?r.selected=n.some(u=>String(u)===String(a)):r.selected=cl(n,a)>-1}else r.selected=n.has(a);else if(ro(Gs(r),n)){e.selectedIndex!==s&&(e.selectedIndex=s);return}}!t&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function Gs(e){return"_value"in e?e._value:e.value}function hf(e,n){const t=n?"_trueValue":"_falseValue";return t in e?e[t]:n}const C0=["ctrl","shift","alt","meta"],v0={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,n)=>C0.some(t=>e[`${t}Key`]&&!n.includes(t))},Xn=(e,n)=>{const t=e._withMods||(e._withMods={}),i=n.join(".");return t[i]||(t[i]=((s,...o)=>{for(let r=0;r<n.length;r++){const a=v0[n[r]];if(a&&a(s,n))return}return e(s,...o)}))},_0={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},pf=(e,n)=>{const t=e._withKeys||(e._withKeys={}),i=n.join(".");return t[i]||(t[i]=(s=>{if(!("key"in s))return;const o=hi(s.key);if(n.some(r=>r===o||_0[r]===o))return e(s)}))},$0=On({patchProp:a0},Fg);let Zc;function w0(){return Zc||(Zc=wg($0))}const b0=((...e)=>{const n=w0().createApp(...e),{mount:t}=n;return n.mount=i=>{const s=P0(i);if(!s)return;const o=n._component;!Je(o)&&!o.render&&!o.template&&(o.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const r=t(s,!1,A0(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),r},n});function A0(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function P0(e){return Bn(e)?document.querySelector(e):e}let gf;const Ar=e=>gf=e,yf=Symbol();function Da(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var Ts;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(Ts||(Ts={}));function H0(){const e=ud(!0),n=e.run(()=>Ce({}));let t=[],i=[];const s=gl({install(o){Ar(s),s._a=o,o.provide(yf,s),o.config.globalProperties.$pinia=s,i.forEach(r=>t.push(r)),i=[]},use(o){return this._a?t.push(o):i.push(o),this},_p:t,_a:null,_e:e,_s:new Map,state:n});return s}const Cf=()=>{};function Qc(e,n,t,i=Cf){e.add(n);const s=()=>{e.delete(n)&&i()};return!t&&dd()&&ep(s),s}function Mi(e,...n){e.forEach(t=>{t(...n)})}const x0=e=>e(),Xc=Symbol(),ca=Symbol();function qa(e,n){e instanceof Map&&n instanceof Map?n.forEach((t,i)=>e.set(i,t)):e instanceof Set&&n instanceof Set&&n.forEach(e.add,e);for(const t in n){if(!n.hasOwnProperty(t))continue;const i=n[t],s=e[t];Da(s)&&Da(i)&&e.hasOwnProperty(t)&&!xn(i)&&!Lt(i)?e[t]=qa(s,i):e[t]=i}return e}const B0=Symbol();function S0(e){return!Da(e)||!Object.prototype.hasOwnProperty.call(e,B0)}const{assign:Xt}=Object;function I0(e){return!!(xn(e)&&e.effect)}function k0(e,n,t,i){const{state:s,actions:o,getters:r}=n,a=t.state.value[e];let l;function u(){a||(t.state.value[e]=s?s():{});const f=Ap(t.state.value[e]);return Xt(f,o,Object.keys(r||{}).reduce((m,h)=>(m[h]=gl(Oe(()=>{Ar(t);const v=t._s.get(e);return r[h].call(v,v)})),m),{}))}return l=vf(e,u,n,t,i,!0),l}function vf(e,n,t={},i,s,o){let r;const a=Xt({actions:{}},t),l={deep:!0};let u,f,m=new Set,h=new Set,v;const S=i.state.value[e];!o&&!S&&(i.state.value[e]={}),Ce({});let X;function ae(de){let W;u=f=!1,typeof de=="function"?(de(i.state.value[e]),W={type:Ts.patchFunction,storeId:e,events:v}):(qa(i.state.value[e],de),W={type:Ts.patchObject,payload:de,storeId:e,events:v});const Q=X=Symbol();Qi().then(()=>{X===Q&&(u=!0)}),f=!0,Mi(m,W,i.state.value[e])}const fe=o?function(){const{state:W}=t,Q=W?W():{};this.$patch(L=>{Xt(L,Q)})}:Cf;function ge(){r.stop(),m.clear(),h.clear(),i._s.delete(e)}const R=(de,W="")=>{if(Xc in de)return de[ca]=W,de;const Q=function(){Ar(i);const L=Array.from(arguments),P=new Set,G=new Set;function _(H){P.add(H)}function $(H){G.add(H)}Mi(h,{args:L,name:Q[ca],store:V,after:_,onError:$});let A;try{A=de.apply(this&&this.$id===e?this:V,L)}catch(H){throw Mi(G,H),H}return A instanceof Promise?A.then(H=>(Mi(P,H),H)).catch(H=>(Mi(G,H),Promise.reject(H))):(Mi(P,A),A)};return Q[Xc]=!0,Q[ca]=W,Q},Y={_p:i,$id:e,$onAction:Qc.bind(null,h),$patch:ae,$reset:fe,$subscribe(de,W={}){const Q=Qc(m,de,W.detached,()=>L()),L=r.run(()=>xt(()=>i.state.value[e],P=>{(W.flush==="sync"?f:u)&&de({storeId:e,type:Ts.direct,events:v},P)},Xt({},l,W)));return Q},$dispose:ge},V=Ne(Y);i._s.set(e,V);const ue=(i._a&&i._a.runWithContext||x0)(()=>i._e.run(()=>(r=ud()).run(()=>n({action:R}))));for(const de in ue){const W=ue[de];if(xn(W)&&!I0(W)||Lt(W))o||(S&&S0(W)&&(xn(W)?W.value=S[de]:qa(W,S[de])),i.state.value[e][de]=W);else if(typeof W=="function"){const Q=R(W,de);ue[de]=Q,a.actions[de]=W}}return Xt(V,ue),Xt(an(V),ue),Object.defineProperty(V,"$state",{get:()=>i.state.value[e],set:de=>{ae(W=>{Xt(W,de)})}}),i._p.forEach(de=>{Xt(V,r.run(()=>de({store:V,app:i._a,pinia:i,options:a})))}),S&&o&&t.hydrate&&t.hydrate(V.$state,S),u=!0,f=!0,V}function E0(e,n,t){let i;const s=typeof n=="function";i=s?t:n;function o(r,a){const l=Np();return r=r||(l?xs(yf,null):null),r&&Ar(r),r=gf,r._s.has(e)||(s?vf(e,n,i,r):k0(e,i,r)),r._s.get(e)}return o.$id=e,o}const kn=(e,n)=>{const t=e.__vccOpts||e;for(const[i,s]of n)t[i]=s;return t},T0={id:"mainMenu"},R0={class:"menu-buttons"},N0={__name:"MainMenu",emits:["enter-player-mode","show-skill-guide","show-question-bank","show-city-info"],setup(e){return(n,t)=>(M(),j("div",T0,[t[4]||(t[4]=p("h1",null,"",-1)),p("div",R0,[p("button",{class:"menu-btn",onClick:t[0]||(t[0]=i=>n.$emit("enter-player-mode"))},"  "),p("button",{class:"menu-btn",onClick:t[1]||(t[1]=i=>n.$emit("show-skill-guide"))},"  "),p("button",{class:"menu-btn",onClick:t[2]||(t[2]=i=>n.$emit("show-question-bank"))},"  "),p("button",{class:"menu-btn",onClick:t[3]||(t[3]=i=>n.$emit("show-city-info"))},"  ")])]))}},M0=kn(N0,[["__scopeId","data-v-a5f7ab71"]]),D0="modulepreload",q0=function(e){return"/"+e},eu={},ua=function(n,t,i){let s=Promise.resolve();if(t&&t.length>0){let u=function(f){return Promise.all(f.map(m=>Promise.resolve(m).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};var r=u;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=u(t.map(f=>{if(f=q0(f),f in eu)return;eu[f]=!0;const m=f.endsWith(".css"),h=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${h}`))return;const v=document.createElement("link");if(v.rel=m?"stylesheet":D0,m||(v.as="script"),v.crossOrigin="",v.href=f,l&&v.setAttribute("nonce",l),document.head.appendChild(v),m)return new Promise((S,X)=>{v.addEventListener("load",S),v.addEventListener("error",()=>X(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return n().catch(o)})},_f=[{name:"",hp:49843},{name:"",hp:53927},{name:"",hp:18024},{name:"",hp:32193},{name:"",hp:28911},{name:"",hp:3572}],$f=[{name:"",hp:8203},{name:"",hp:10004},{name:"",hp:2121},{name:"",hp:4704},{name:"",hp:2766},{name:"",hp:4773},{name:"",hp:1913},{name:"",hp:1963},{name:"",hp:4723},{name:"",hp:3904},{name:"",hp:1972},{name:"",hp:621}],wf=[{name:"",hp:5419},{name:"",hp:1803},{name:"",hp:856},{name:"",hp:2593},{name:"",hp:2410},{name:"",hp:1329},{name:"",hp:1343},{name:"",hp:2643},{name:"",hp:2459},{name:"",hp:2439},{name:"",hp:2191}],bf=[{name:"",hp:4107},{name:"",hp:4575},{name:"",hp:596},{name:"",hp:2322},{name:"",hp:1730},{name:"",hp:808},{name:"",hp:1686},{name:"",hp:1236},{name:"",hp:1214},{name:"",hp:6363},{name:"",hp:1242},{name:"",hp:414}],Af=[{name:"",hp:9027},{name:"",hp:9517},{name:"",hp:2156},{name:"",hp:1011},{name:"",hp:1026},{name:"",hp:1008},{name:"",hp:1354},{name:"",hp:1560},{name:"",hp:650},{name:"",hp:953},{name:"",hp:1414},{name:"",hp:779},{name:"",hp:1153},{name:"",hp:1004}],Pf=[{name:"",hp:7632},{name:"",hp:1633},{name:"",hp:581},{name:"",hp:528},{name:"",hp:766},{name:"",hp:568},{name:"",hp:614},{name:"",hp:1018},{name:"",hp:1002}],Hf=[{name:"",hp:6016},{name:"",hp:1353},{name:"",hp:1051},{name:"",hp:1008},{name:"",hp:2816},{name:"",hp:370},{name:"",hp:623},{name:"",hp:376},{name:"",hp:557},{name:"",hp:237},{name:"",hp:1244},{name:"",hp:711},{name:"",hp:173}],xf=[{name:"",hp:18501},{name:"",hp:16263},{name:"",hp:9537},{name:"",hp:10814},{name:"",hp:26727},{name:"",hp:12422},{name:"",hp:4663},{name:"",hp:5413},{name:"",hp:7779},{name:"",hp:7810},{name:"",hp:5540},{name:"",hp:7021},{name:"",hp:4802}],Bf=[{name:"",hp:21860},{name:"",hp:18148},{name:"",hp:9719},{name:"",hp:8369},{name:"",hp:4213},{name:"",hp:7570},{name:"",hp:6926},{name:"",hp:2263},{name:"",hp:6656},{name:"",hp:2181},{name:"",hp:2226}],Sf=[{name:"",hp:13508},{name:"",hp:5121},{name:"",hp:2313},{name:"",hp:1716},{name:"",hp:2785},{name:"",hp:1406},{name:"",hp:1326},{name:"",hp:3156},{name:"",hp:1134},{name:"",hp:3610},{name:"",hp:2457},{name:"",hp:4034},{name:"",hp:2408},{name:"",hp:2054},{name:"",hp:1178},{name:"",hp:2522}],If=[{name:"",hp:7800},{name:"",hp:4940},{name:"",hp:3711},{name:"",hp:2917},{name:"",hp:3721},{name:"",hp:2173},{name:"",hp:4022},{name:"",hp:1179},{name:"",hp:1211},{name:"",hp:1143},{name:"",hp:1302}],kf=[{name:"",hp:14237},{name:"",hp:3443},{name:"",hp:13095},{name:"",hp:8589},{name:"",hp:6064},{name:"",hp:3419},{name:"",hp:2923},{name:"",hp:2090},{name:"",hp:3902}],Ef=[{name:"",hp:13528},{name:"",hp:16719},{name:"",hp:4884},{name:"",hp:2386},{name:"",hp:4308},{name:"",hp:10783},{name:"",hp:8203},{name:"",hp:5867},{name:"",hp:3622},{name:"",hp:3729},{name:"",hp:2557},{name:"",hp:3405},{name:"",hp:4048},{name:"",hp:3168},{name:"",hp:6556},{name:"",hp:4803}],Tf=[{name:"",hp:14532},{name:"",hp:2761},{name:"",hp:5819},{name:"",hp:2832},{name:"",hp:2672},{name:"",hp:1094},{name:"",hp:3570},{name:"",hp:2369},{name:"",hp:2019},{name:"",hp:3441},{name:"",hp:1870},{name:"",hp:1619},{name:"",hp:3272},{name:"",hp:3636},{name:"",hp:3343},{name:"",hp:4879},{name:"",hp:3073},{name:"",hp:790}],Rf=[{name:"",hp:21106},{name:"",hp:2306},{name:"",hp:2566},{name:"",hp:3506},{name:"",hp:6191},{name:"",hp:6102},{name:"",hp:1341},{name:"",hp:2460},{name:"",hp:3217},{name:"",hp:3259},{name:"",hp:1945},{name:"",hp:1125},{name:"",hp:952},{name:"",hp:49},{name:"",hp:1661},{name:"",hp:785},{name:"",hp:1442}],Nf=[{name:"",hp:15269},{name:"",hp:3902},{name:"",hp:2957},{name:"",hp:4492},{name:"",hp:2926},{name:"",hp:5128},{name:"",hp:654},{name:"",hp:2268},{name:"",hp:4533},{name:"",hp:2132},{name:"",hp:3328},{name:"",hp:2693},{name:"",hp:2094},{name:"",hp:856}],Mf=[{name:"",hp:31033},{name:"",hp:36802},{name:"",hp:4479},{name:"",hp:3168},{name:"",hp:13362},{name:"",hp:1648},{name:"",hp:3840},{name:"",hp:2918},{name:"",hp:4210},{name:"",hp:4702},{name:"",hp:6136},{name:"",hp:1508},{name:"",hp:1501},{name:"",hp:1408},{name:"",hp:1630},{name:"",hp:2253},{name:"",hp:12282},{name:"",hp:4143},{name:"",hp:1403},{name:"",hp:2530},{name:"",hp:1309}],Df=[{name:"",hp:5995},{name:"",hp:2951},{name:"",hp:2517},{name:"",hp:1622},{name:"",hp:1888},{name:"",hp:1313},{name:"",hp:1030},{name:"",hp:1566},{name:"",hp:964},{name:"",hp:2347},{name:"",hp:2005},{name:"",hp:1404},{name:"",hp:1879},{name:"",hp:1168}],qf=[{name:"",hp:2471},{name:"",hp:1005},{name:"",hp:6},{name:"",hp:389},{name:"",hp:393},{name:"",hp:353},{name:"",hp:140},{name:"",hp:116},{name:"",hp:551},{name:"",hp:261},{name:"",hp:49},{name:"",hp:272},{name:"",hp:72},{name:"",hp:165},{name:"",hp:228},{name:"",hp:275},{name:"",hp:87},{name:"",hp:89},{name:"",hp:1013}],Lf=[{name:"",hp:23511},{name:"",hp:4344},{name:"",hp:1876},{name:"",hp:1395},{name:"",hp:2837},{name:"",hp:3265},{name:"",hp:1279},{name:"",hp:1870},{name:"",hp:1943},{name:"",hp:2533},{name:"",hp:1090},{name:"",hp:4006},{name:"",hp:2862},{name:"",hp:2802},{name:"",hp:1083},{name:"",hp:570},{name:"",hp:581},{name:"",hp:2475},{name:"",hp:1616},{name:"",hp:871},{name:"",hp:1890}],Of=[{name:"",hp:5777},{name:"",hp:1711},{name:"",hp:5027},{name:"",hp:1650},{name:"",hp:1479},{name:"",hp:2458},{name:"",hp:1186},{name:"",hp:1432},{name:"",hp:1947}],Uf=[{name:"",hp:8275},{name:"",hp:2017},{name:"",hp:3677},{name:"",hp:2019},{name:"",hp:2582},{name:"",hp:2985},{name:"",hp:1549},{name:"",hp:1189},{name:"",hp:902},{name:"",hp:2011},{name:"",hp:1822},{name:"",hp:620},{name:"",hp:710},{name:"",hp:279},{name:"",hp:307},{name:"",hp:1150}],jf=[{name:"",hp:990},{name:"",hp:386},{name:"",hp:304},{name:"",hp:464},{name:"",hp:246},{name:"",hp:106},{name:"",hp:268}],Ff=[{name:"",hp:13318},{name:"",hp:589},{name:"",hp:2548},{name:"",hp:3163},{name:"",hp:2158},{name:"",hp:1910},{name:"",hp:1141},{name:"",hp:780},{name:"",hp:2383},{name:"",hp:7549}],Vf=[{name:"",hp:3742},{name:"",hp:371},{name:"",hp:620},{name:"",hp:743},{name:"",hp:952},{name:"",hp:1042},{name:"",hp:681},{name:"",hp:750},{name:"",hp:737},{name:"",hp:667},{name:"",hp:723},{name:"",hp:1213},{name:"",hp:506},{name:"",hp:256}],Wf=[{name:"",hp:2940},{name:"",hp:505},{name:"",hp:934},{name:"",hp:464},{name:"",hp:600}],zf=[{name:"",hp:1862},{name:"",hp:605},{name:"",hp:116},{name:"",hp:123},{name:"",hp:235},{name:"",hp:69},{name:"",hp:92},{name:"",hp:848}],Gf=[{name:"",hp:4502},{name:"",hp:2509},{name:"",hp:532},{name:"",hp:540},{name:"",hp:1807},{name:"",hp:999},{name:"",hp:465},{name:"",hp:1327},{name:"",hp:640},{name:"",hp:1084},{name:"",hp:1692},{name:"",hp:1954},{name:"",hp:257},{name:"",hp:1627},{name:"",hp:598}],Jf=[{name:"",hp:7906},{name:"",hp:5954},{name:"",hp:643},{name:"",hp:10288},{name:"",hp:673},{name:"",hp:3885},{name:"",hp:7040},{name:"",hp:1481},{name:"",hp:6464},{name:"",hp:842},{name:"",hp:2296},{name:"",hp:1995},{name:"",hp:169},{name:"",hp:334},{name:"",hp:851},{name:"",hp:1458},{name:"",hp:789},{name:"",hp:1233},{name:"",hp:567},{name:"",hp:1260}],zi=[..._f,...$f,...wf,...bf,...Af,...Pf,...Hf,...xf,...Bf,...Sf,...kf,...If,...Ef,...Tf,...Rf,...Nf,...Mf,...Df,...qf,...Lf,...Of,...Uf,...jf,...Ff,...Vf,...zf,...Wf,...Gf,...Jf],si={},Yf=[{name:"",cities:_f},{name:"",cities:$f},{name:"",cities:wf},{name:"",cities:bf},{name:"",cities:Af},{name:"",cities:Pf},{name:"",cities:Hf},{name:"",cities:xf},{name:"",cities:Bf},{name:"",cities:Sf},{name:"",cities:kf},{name:"",cities:If},{name:"",cities:Ef},{name:"",cities:Tf},{name:"",cities:Rf},{name:"",cities:Nf},{name:"",cities:Mf},{name:"",cities:Df},{name:"",cities:qf},{name:"",cities:Lf},{name:"",cities:Of},{name:"",cities:Uf},{name:"",cities:jf},{name:"",cities:Ff},{name:"",cities:Vf},{name:"",cities:zf},{name:"",cities:Wf},{name:"",cities:Gf},{name:"",cities:Jf}];for(const e of Yf)for(const n of e.cities)si[n.name]=e;function L0(){const e={};for(const n of Yf)e[n.name]=n.cities;return e}const ut=E0("game",()=>{const e=Ce([]),n=Ce(0),t=Ce("2P"),i=Ce([]),s=Ne({}),o=Ce(new Set),r=Ne({}),a=Ne({}),l=Ne({}),u=Ne({}),f=Ne({}),m=Ne({}),h=Ne({}),v=Ne({}),S=Ne({}),X=Ce(null),ae=Ce(null),fe=Ne({}),ge=Ne({}),R=Ne({}),Y=Ce(null),V=Ne({}),ee=Ce(null),ue=Ce(null),de=Ne({}),W=Ne({}),Q=Ne({}),L=Ne({}),P=Ne({}),G=Ne({}),_=Ne({}),$=Ne({}),A=Ne({}),H=Ne({}),q=Ne({}),ne=Ne({}),me=Ne({}),oe=Ne({}),ve=Ne({}),_e=Ne({}),Ye=Ce(null),Qe=Ne({}),on=Ne({}),rn=Ne({}),Ge=Ne({}),gn=Ne({}),An=Ne({}),lt=Ne({}),T=Ne({}),F=Ce([]),k=Ne({}),D=Ce(null),B=Ne({}),J=Ne({}),se=Ne({}),te=Ne({}),Z=Ne({}),pe=Ne({}),ce=Ce([]),xe=Ne({}),Te=Ne({}),we=Ne({}),le=Ne({}),Ve=Ne({}),We=Ce(null),Pn=Ce(null),wn=Ne({}),fn=Ne({}),Sn=Ce(null),it=Ce(null),Gn=Ne({}),In=Ne({}),_n=Ne({}),st=Ne({}),kt=Ce([]),Lr=Oe(()=>e.value.length);function Or(y){const z=y.name;e.value.push({name:z,gold:0,cities:y.cities||[],...y}),In[z]||(In[z]=[{name:"",hp:1,originalHp:1,used:!1,red:0,green:0,blue:0,yellow:0},{name:"",hp:1,originalHp:1,used:!1,red:0,green:0,blue:0,yellow:0},{name:"",hp:1,originalHp:1,used:!1,red:0,green:0,blue:0,yellow:0}]),_n[z]||(_n[z]={red:!1,green:!1,blue:!1}),st[z]||(st[z]=[])}function Ur(y){const z=e.value.findIndex(ye=>ye.name===y);z!==-1&&e.value.splice(z,1)}function nn(y,z="info"){const ye=Date.now();i.value.push({message:y,type:z,timestamp:ye})}function jr(){i.value=[]}function Fr(y,z){const ye=Date.now();st[y]||(st[y]=[]),st[y].push({message:z,timestamp:ye,round:n.value,isPrivate:!0})}function Vr(y,z,ye={}){kt.value.push({round:n.value,player:y,action:z,details:ye,timestamp:Date.now()})}function _o(){for(const y of Object.keys(_n))_n[y]={red:!1,green:!1,blue:!1}}function Wr(y,z){return _n[y]?_n[y][z]===!0:!1}function zr(y,z){_n[y]||(_n[y]={red:!1,green:!1,blue:!1}),_n[y][z]=!0}function Gr(){e.value=[],n.value=0,i.value=[],o.value=new Set,Object.keys(r).forEach(y=>delete r[y]),Object.keys(a).forEach(y=>delete a[y]),Object.keys(l).forEach(y=>delete l[y]),Object.keys(u).forEach(y=>delete u[y]),Object.keys(f).forEach(y=>delete f[y]),Object.keys(m).forEach(y=>delete m[y]),Object.keys(h).forEach(y=>delete h[y]),Object.keys(v).forEach(y=>delete v[y]),Object.keys(S).forEach(y=>delete S[y]),Object.keys(fe).forEach(y=>delete fe[y]),Object.keys(ge).forEach(y=>delete ge[y]),Object.keys(R).forEach(y=>delete R[y]),Object.keys(V).forEach(y=>delete V[y]),Object.keys(de).forEach(y=>delete de[y]),Object.keys(W).forEach(y=>delete W[y]),Object.keys(Q).forEach(y=>delete Q[y]),Object.keys(L).forEach(y=>delete L[y]),Object.keys(P).forEach(y=>delete P[y]),Object.keys(G).forEach(y=>delete G[y]),Object.keys(_).forEach(y=>delete _[y]),Object.keys($).forEach(y=>delete $[y]),Object.keys(A).forEach(y=>delete A[y]),Object.keys(H).forEach(y=>delete H[y]),Object.keys(q).forEach(y=>delete q[y]),Object.keys(ne).forEach(y=>delete ne[y]),Object.keys(me).forEach(y=>delete me[y]),Object.keys(oe).forEach(y=>delete oe[y]),Object.keys(ve).forEach(y=>delete ve[y]),Object.keys(_e).forEach(y=>delete _e[y]),Ye.value=null,Object.keys(Qe).forEach(y=>delete Qe[y]),Object.keys(on).forEach(y=>delete on[y]),Object.keys(rn).forEach(y=>delete rn[y]),Object.keys(Ge).forEach(y=>delete Ge[y]),Object.keys(gn).forEach(y=>delete gn[y]),Object.keys(An).forEach(y=>delete An[y]),Object.keys(lt).forEach(y=>delete lt[y]),Object.keys(T).forEach(y=>delete T[y]),F.value=[],Object.keys(k).forEach(y=>delete k[y]),D.value=null,Object.keys(B).forEach(y=>delete B[y]),Object.keys(J).forEach(y=>delete J[y]),Object.keys(se).forEach(y=>delete se[y]),Object.keys(te).forEach(y=>delete te[y]),Object.keys(Z).forEach(y=>delete Z[y]),Object.keys(pe).forEach(y=>delete pe[y]),ce.value=[],Object.keys(xe).forEach(y=>delete xe[y]),Object.keys(Te).forEach(y=>delete Te[y]),Object.keys(we).forEach(y=>delete we[y]),Object.keys(le).forEach(y=>delete le[y]),Object.keys(Ve).forEach(y=>delete Ve[y]),Object.keys(wn).forEach(y=>delete wn[y]),Object.keys(fn).forEach(y=>delete fn[y]),Object.keys(Gn).forEach(y=>delete Gn[y]),Object.keys(In).forEach(y=>delete In[y]),Object.keys(_n).forEach(y=>delete _n[y]),Object.keys(st).forEach(y=>delete st[y]),kt.value=[],X.value=null,ae.value=null,Y.value=null,ee.value=null,ue.value=null,We.value=null,Pn.value=null,Sn.value=null,it.value=null}function Jr(){n.value++,nn(` ${n.value} `),Pe()}function Yr(){return zi.filter(y=>!o.value.has(y.name))}function $o(y){o.value.add(y)}function Kr(y){return zi.find(z=>z.name===y)}function wo(y){const z=si[Object.keys(si).find(ye=>si[ye].name===y)];return z?z.cities:[]}function Zr(y){return si[y]}function Qr(y,z){return u[y]?u[y].includes(z):!1}function d(y,z){u[y]||(u[y]=[]),u[y].includes(z)||u[y].push(z)}function c(y,z){if(!u[y])return;const ye=u[y].indexOf(z);ye>-1&&u[y].splice(ye,1)}function g(y,z,ye){return!fn[y]||fn[y].roundsLeft<=0?!1:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""].includes(ye)}function C(y,z){return h[y]&&h[y][z]>0}function w(y,z){return m[y]&&m[y][z]>0}function b(y,z){if(!mirage||!mirage[y])return!1;const ye=mirage[y];return!ye.active||ye.roundsLeft<=0?!1:Math.random()<.75?(ye.blocked=(ye.blocked||0)+1,nn(`${y}${z}`),!0):!1}function I(y,z){return C(y,z)?(delete h[y][z],nn(`${y}`),!0):w(y,z)?(m[y][z]--,m[y][z]<=0&&delete m[y][z],nn(`${y}`),!0):!1}function E(y,z){return le[y]===z}function N(y,z,ye){return!S[y]||!S[y][ye]?!1:S[y][ye].includes(z)}function O(y,z,ye){S[y]||(S[y]={}),S[y][ye]||(S[y][ye]=[]),S[y][ye].includes(z)||S[y][ye].push(z)}function ie(y,z){if(S[y])for(const ye of Object.keys(S[y])){const Me=S[y][ye].indexOf(z);Me>-1&&S[y][ye].splice(Me,1)}}function re(y,z,ye){if(!we[y.name]||!we[y.name][z])return;const Me=we[y.name][z];if(Me.count>=Me.maxCount){nn(`${y.name}${ye.name}3`),delete we[y.name][z];return}let sn=ye.province;if(gn[y.name]&&gn[y.name][z]&&(sn=gn[y.name][z].newProvince),!sn){nn(`${y.name}${ye.name}`),delete we[y.name][z];return}if(["","","","","",""].includes(ye.name)){nn(`${y.name}${ye.name}/`),delete we[y.name][z];return}const ke=wo(sn);if(!ke||ke.length===0){nn(`${y.name}${ye.name}`),delete we[y.name][z];return}const De=Me.originalHp||ye.hp,Rn=y.cities.map(gi=>gi.name),Nn=ke.filter(gi=>!o.includes(gi.name)&&gi.hp>De&&!Rn.includes(gi.name));if(Nn.length===0){nn(`${y.name}${ye.name}HP`),delete we[y.name][z];return}Nn.sort((gi,Uh)=>gi.hp-Uh.hp);const jn=Nn[0],Et={...jn,currentHp:jn.hp,isAlive:!0,red:0,green:0,blue:0,yellow:0};y.cities[z]=Et,$o(jn.name),r[y.name]||(r[y.name]={}),r[y.name][z]={name:Et.name,hp:Et.hp,currentHp:Et.hp,baseHp:Et.hp,isAlive:!0},a[y.name]&&a[y.name].includes(z),Me.count++,Me.originalHp=jn.hp,Me.count>=Me.maxCount&&delete we[y.name][z],nn(`${y.name}${ye.name}${jn.name}HP${jn.hp}${Me.maxCount-Me.count}`)}function K(y){const z=y.centerIndex??0,ye=y.cities[z];if(!ye||ye.currentHp>0)return;const Me=Ve[y.name],sn=Me!==void 0?y.cities[Me]:null;sn&&sn.currentHp>0&&sn.isAlive!==!1?(y.centerIndex=Me,ye&&(ye.isCenter=!1),sn.isCenter=!0,delete Ve[y.name],nn(`>>> () ${y.name}${sn.name}`),e.value.forEach(De=>{De.name!==y.name&&(S[De.name]||(S[De.name]={}),S[De.name][y.name]||(S[De.name][y.name]=[]),S[De.name][y.name].includes(Me)||S[De.name][y.name].push(Me))})):y.cities.some((De,Rn)=>Rn!==z&&(De.currentHp||0)>0&&De.isAlive!==!1)&&(y.cities.forEach((De,Rn)=>{Rn!==z&&(De.currentHp=0,De.isAlive=!1)}),nn(`>>> ${y.name}HP`))}function Ae(){it.value={players:JSON.parse(JSON.stringify(e.value)),currentRound:n.value,initialCities:JSON.parse(JSON.stringify(r)),roster:JSON.parse(JSON.stringify(a)),deadCities:JSON.parse(JSON.stringify(l)),cautiousExchange:JSON.parse(JSON.stringify(u)),anchored:JSON.parse(JSON.stringify(f)),ironCities:JSON.parse(JSON.stringify(m)),protections:JSON.parse(JSON.stringify(h)),disguisedCities:JSON.parse(JSON.stringify(v)),knownCities:JSON.parse(JSON.stringify(S)),barrier:JSON.parse(JSON.stringify(V)),buffs:JSON.parse(JSON.stringify(H))}}function Be(){if(!it.value)return!1;const y=it.value;return e.value=JSON.parse(JSON.stringify(y.players)),n.value=y.currentRound,Object.assign(r,y.initialCities),Object.assign(a,y.roster),Object.assign(l,y.deadCities),Object.assign(u,y.cautiousExchange),Object.assign(f,y.anchored),Object.assign(m,y.ironCities),Object.assign(h,y.protections),Object.assign(v,y.disguisedCities),Object.assign(S,y.knownCities),Object.assign(V,y.barrier),Object.assign(H,y.buffs),nn(""),!0}function Pe(){for(const y of Object.keys(W))W[y]>0&&W[y]--;for(const y of Object.keys(Q))for(const z of Object.keys(Q[y]))Q[y][z]>0&&Q[y][z]--;for(const y of Object.keys(h))for(const z of Object.keys(h[y]))h[y][z]>0&&(h[y][z]--,h[y][z]<=0&&delete h[y][z]);for(const y of Object.keys(v))for(const z of Object.keys(v[y])){const ye=v[y][z];ye.roundsLeft>0&&(ye.roundsLeft--,ye.roundsLeft<=0&&(delete v[y][z],nn(`${y}`)))}for(const y of Object.keys(V))V[y].roundsLeft>0&&(V[y].roundsLeft--,V[y].hp=Math.min(V[y].hp+3e3,V[y].maxHp),V[y].roundsLeft<=0&&(delete V[y],nn(`${y}`)));for(const y of Object.keys(fn))fn[y].roundsLeft>0&&(fn[y].roundsLeft--,fn[y].roundsLeft<=0&&(delete fn[y],nn(`${y}`)));for(const y of Object.keys(_))for(const z of Object.keys(_[y]))_[y][z]>0&&(_[y][z]--,_[y][z]===0&&(nn(`${y}`),delete _[y][z]));for(const y of Object.keys(oe))for(const z of Object.keys(oe[y]))oe[y][z]>0&&(oe[y][z]--,oe[y][z]<=0&&(delete oe[y][z],nn(`${y}`)));Ye.value&&Ye.value.roundsLeft>0&&(Ye.value.roundsLeft--,Ye.value.roundsLeft<=0&&(Ye.value=null,nn("")));for(const y of Object.keys(on))on[y].roundsLeft>0&&(on[y].roundsLeft--,on[y].roundsLeft<=0&&(delete on[y],nn(`${y}`)));for(const y of e.value)y.cities&&y.cities.forEach((z,ye)=>{if(!z.modifiers)return;const Me=z.modifiers.findIndex(Se=>Se.type==="healing");if(Me===-1)return;const sn=z.modifiers[Me];sn.roundsLeft>0&&(sn.roundsLeft--,sn.roundsLeft===0&&(z.currentHp=sn.returnHp||z.hp,z.isInHealing=!1,z.modifiers.splice(Me,1),a[y.name]&&a[y.name].push(ye),Q[y.name]&&Q[y.name][ye]&&delete Q[y.name][ye],nn(`${y.name}${z.name}`)))});for(const y of Object.keys(q))q[y]&&Array.isArray(q[y])&&(q[y]=q[y].filter(z=>z.roundsLeft>0?(z.roundsLeft--,z.roundsLeft<=0?(nn(`${y}"${z.skillName}"`),!1):!0):!1));for(const y of Object.keys(ne))ne[y].roundsLeft>0&&(ne[y].roundsLeft--,ne[y].roundsLeft<=0&&(delete ne[y],nn(`${y}`)));X.value=null,ae.value=null,Y.value=null,ue.value=null,Object.keys(de).forEach(y=>delete de[y]),Object.keys(ve).forEach(y=>delete ve[y]),Object.keys(_e).forEach(y=>delete _e[y]),Object.keys(Ge).forEach(y=>delete Ge[y]),Object.keys(rn).forEach(y=>delete rn[y]),Object.keys(An).forEach(y=>delete An[y]),Object.keys(T).forEach(y=>delete T[y]),Object.keys(k).forEach(y=>delete k[y]),D.value=null,Object.keys(B).forEach(y=>delete B[y]);for(const y of Object.keys(se)){const z=se[y];if(z.depositMade&&z.balance>0){const ye=z.balance;let Me,sn;ye<1e4?(Me=.1,sn="10%"):ye<2e4?(Me=.08,sn="8%"):ye<3e4?(Me=.06,sn="6%"):ye<4e4?(Me=.04,sn="4%"):ye<5e4?(Me=.02,sn="2%"):(Me=.01,sn="1%"),z.balance=z.balance*(1+Me),nn(`${y}${sn}${Math.floor(ye)}  ${Math.floor(z.balance)}`),z.balance<2e3&&(nn(`${y}2000`),delete se[y])}z.hasWithdrawnThisRound&&(z.hasWithdrawnThisRound=!1)}for(const y of Object.keys(te))te[y].roundsLeft>0&&(te[y].roundsLeft--,te[y].roundsLeft<=0&&(delete te[y],nn(`${y}`)));for(const y of Object.keys(Z)){const z=Z[y];for(const ye of Object.keys(z))z[ye]>0&&(z[ye]--,z[ye]<=0&&(delete z[ye],nn(`${y}${ye}`)));Object.keys(z).length===0&&delete Z[y]}for(const y of Object.keys(pe))pe[y].roundsLeft>0&&(pe[y].roundsLeft--,pe[y].roundsLeft<=0&&(delete pe[y],nn(`${y}`)));ce.value&&Array.isArray(ce.value)&&(ce.value=ce.value.filter(y=>y.roundsLeft>0?(y.roundsLeft--,y.damagedThisRound=[],y.roundsLeft<=0?(nn(`${y.caster}${y.target}`),!1):!0):!1));for(const y of Object.keys(Ve)){const z=Ve[y];if(z===void 0)continue;const ye=e.value.find(De=>De.name===y);if(!ye)continue;const Me=ye.cities[z];if(!Me||Me.currentHp<=0||Me.isAlive===!1)continue;const sn=r[y]&&r[y][z]?r[y][z].hp:Me.hp,Se=Math.floor(sn*.1),ke=Me.currentHp;Me.currentHp=Math.min(Me.currentHp+Se,12e4),nn(`() ${y}${Me.name} HP${Se}${Math.floor(ke)}  ${Math.floor(Me.currentHp)}`)}for(const y of Object.keys(G)){if(!G[y])continue;const z=e.value.find(Me=>Me.name===y);if(!z)continue;const ye=[];kt.value.forEach(Me=>{Me.round===n.value&&Me.player===y&&Me.action==="deploy"&&Me.details&&Me.details.cityIdx!==void 0&&ye.push(Me.details.cityIdx)});for(const Me of Object.keys(G[y])){const sn=+Me,Se=G[y][sn];if(!Se||!Se.active)continue;const ke=z.cities[sn];if(!ke)continue;if(ke.currentHp<=0||ke.isAlive===!1){Se.everDied||(Se.everDied=!0,Se.active=!1,nn(`() ${y}${ke.name} `));continue}if(ye.includes(sn))Se.idleRounds>0&&nn(`() ${y}${ke.name} `),Se.idleRounds=0;else if(Se.idleRounds+=1,Se.idleRounds%5===0){const Rn=ke.currentHp;ke.currentHp=Math.min(ke.currentHp+1e4,12e4),nn(`() ${y}${ke.name} ${Se.idleRounds}HP +10000${Math.floor(Rn)}  ${Math.floor(ke.currentHp)}`)}}}_o()}function Ee(y,z){Gn[y]||(Gn[y]={}),Gn[y][z]||(Gn[y][z]=0),Gn[y][z]++}function Ue(y,z){return Gn[y]&&Gn[y][z]||0}return{players:e,currentRound:n,gameMode:t,logs:i,playerStates:s,playerCount:Lr,usedCities:o,initialCities:r,roster:a,deadCities:l,cautiousExchange:u,anchored:f,ironCities:m,protections:h,disguisedCities:v,knownCities:S,qinwang:X,cmjb:ae,yueyueyong:fe,attract:ge,jilaizan:R,ironwall:Y,barrier:V,yujia:ee,foresee:ue,reflect:de,goldLoanRounds:W,bannedCities:Q,fatigueStreaks:L,brickJade:P,hiddenGrowth:G,timeBombs:_,cityTrialUsed:$,berserkFired:A,buffs:H,stolenSkills:q,stealth:ne,costIncrease:me,disaster:oe,forceDeployTwo:ve,cannotStandDown:_e,financialCrisis:Ye,burnBridge:Qe,skillProtection:on,yiyidl:rn,sdxj:Ge,changeFlagMark:gn,wwjz:An,wwjzUsageCount:lt,dizzy:T,yqgzMarks:F,ccjj:k,gawhUser:D,tblj:B,reversedCapitals:J,hpBank:se,centerProjection:te,bannedSkills:Z,stareDown:pe,dcgy:ce,forcedSoldierBan:xe,potentialOverflow:Te,bbgs:we,subCenters:le,purpleChamber:Ve,pendingFortuneSwap:We,pendingPreemptiveStrike:Pn,ldtj:wn,jianbukecui:fn,lastSkillUsed:Sn,gameStateSnapshot:it,skillUsageTracking:Gn,standGroundCities:In,colorSkillsUsed:_n,playerPrivateLogs:st,roundActions:kt,addPlayer:Or,removePlayer:Ur,addLog:nn,addPrivateLog:Fr,clearLogs:jr,resetGame:Gr,nextRound:Jr,addRoundAction:Vr,resetColorSkillsUsed:_o,isColorSkillUsed:Wr,markColorSkillUsed:zr,getUnusedCities:Yr,markCityAsUsed:$o,getCityByName:Kr,getCitiesByProvince:wo,getProvinceOfCity:Zr,isInCautiousSet:Qr,addToCautiousSet:d,removeFromCautiousSet:c,isBlockedByJianbukecui:g,hasProtection:C,hasIronShield:w,checkMirageBlock:b,consumeProtection:I,isSubCenter:E,isCityKnown:N,setCityKnown:O,clearCityKnownStatus:ie,handleBuBuGaoShengSummon:re,checkCenterDeathAndPurpleChamberInheritance:K,createGameStateSnapshot:Ae,restoreGameStateSnapshot:Be,updateRoundStates:Pe,recordSkillUsage:Ee,getSkillUsageCount:Ue}}),O0=()=>{};var nu={};const Kf={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const He=function(e,n){if(!e)throw ls(n)},ls=function(e){return new Error("Firebase Database ("+Kf.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};const Zf=function(e){const n=[];let t=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?n[t++]=s:s<2048?(n[t++]=s>>6|192,n[t++]=s&63|128):(s&64512)===55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),n[t++]=s>>18|240,n[t++]=s>>12&63|128,n[t++]=s>>6&63|128,n[t++]=s&63|128):(n[t++]=s>>12|224,n[t++]=s>>6&63|128,n[t++]=s&63|128)}return n},U0=function(e){const n=[];let t=0,i=0;for(;t<e.length;){const s=e[t++];if(s<128)n[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=e[t++];n[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=e[t++],r=e[t++],a=e[t++],l=((s&7)<<18|(o&63)<<12|(r&63)<<6|a&63)-65536;n[i++]=String.fromCharCode(55296+(l>>10)),n[i++]=String.fromCharCode(56320+(l&1023))}else{const o=e[t++],r=e[t++];n[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return n.join("")},Pl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,n){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const o=e[s],r=s+1<e.length,a=r?e[s+1]:0,l=s+2<e.length,u=l?e[s+2]:0,f=o>>2,m=(o&3)<<4|a>>4;let h=(a&15)<<2|u>>6,v=u&63;l||(v=64,r||(h=64)),i.push(t[f],t[m],t[h],t[v])}return i.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(Zf(e),n)},decodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(e):U0(this.decodeStringToByteArray(e,n))},decodeStringToByteArray(e,n){this.init_();const t=n?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const o=t[e.charAt(s++)],a=s<e.length?t[e.charAt(s)]:0;++s;const u=s<e.length?t[e.charAt(s)]:64;++s;const m=s<e.length?t[e.charAt(s)]:64;if(++s,o==null||a==null||u==null||m==null)throw new j0;const h=o<<2|a>>4;if(i.push(h),u!==64){const v=a<<4&240|u>>2;if(i.push(v),m!==64){const S=u<<6&192|m;i.push(S)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class j0 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Qf=function(e){const n=Zf(e);return Pl.encodeByteArray(n,!0)},zo=function(e){return Qf(e).replace(/\./g,"")},La=function(e){try{return Pl.decodeString(e,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};function F0(e){return Xf(void 0,e)}function Xf(e,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:const t=n;return new Date(t.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return n}for(const t in n)!n.hasOwnProperty(t)||!V0(t)||(e[t]=Xf(e[t],n[t]));return e}function V0(e){return e!=="__proto__"}function W0(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const z0=()=>W0().__FIREBASE_DEFAULTS__,G0=()=>{if(typeof process>"u"||typeof nu>"u")return;const e=nu.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},J0=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=e&&La(e[1]);return n&&JSON.parse(n)},em=()=>{try{return O0()||z0()||G0()||J0()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Y0=e=>em()?.emulatorHosts?.[e],K0=e=>{const n=Y0(e);if(!n)return;const t=n.lastIndexOf(":");if(t<=0||t+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const i=parseInt(n.substring(t+1),10);return n[0]==="["?[n.substring(1,t-1),i]:[n.substring(0,t),i]},nm=()=>em()?.config;class Pr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,t)=>{this.resolve=n,this.reject=t})}wrapCallback(n){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(t):n(t,i))}}}function Hl(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Z0(e){return(await fetch(e,{credentials:"include"})).ok}function Q0(e,n){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=n||"demo-project",s=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...e};return[zo(JSON.stringify(t)),zo(JSON.stringify(r)),""].join(".")}const Rs={};function X0(){const e={prod:[],emulator:[]};for(const n of Object.keys(Rs))Rs[n]?e.emulator.push(n):e.prod.push(n);return e}function ey(e){let n=document.getElementById(e),t=!1;return n||(n=document.createElement("div"),n.setAttribute("id",e),t=!0),{created:t,element:n}}let tu=!1;function ny(e,n){if(typeof window>"u"||typeof document>"u"||!Hl(window.location.host)||Rs[e]===n||Rs[e]||tu)return;Rs[e]=n;function t(h){return`__firebase__banner__${h}`}const i="__firebase__banner",o=X0().prod.length>0;function r(){const h=document.getElementById(i);h&&h.remove()}function a(h){h.style.display="flex",h.style.background="#7faaf0",h.style.position="fixed",h.style.bottom="5px",h.style.left="5px",h.style.padding=".5em",h.style.borderRadius="5px",h.style.alignItems="center"}function l(h,v){h.setAttribute("width","24"),h.setAttribute("id",v),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px"}function u(){const h=document.createElement("span");return h.style.cursor="pointer",h.style.marginLeft="16px",h.style.fontSize="24px",h.innerHTML=" &times;",h.onclick=()=>{tu=!0,r()},h}function f(h,v){h.setAttribute("id",v),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline"}function m(){const h=ey(i),v=t("text"),S=document.getElementById(v)||document.createElement("span"),X=t("learnmore"),ae=document.getElementById(X)||document.createElement("a"),fe=t("preprendIcon"),ge=document.getElementById(fe)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(h.created){const R=h.element;a(R),f(ae,X);const Y=u();l(ge,fe),R.append(ge,S,ae,Y),document.body.appendChild(R)}o?(S.innerText="Preview backend disconnected.",ge.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ge.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function ty(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function tm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ty())}function iy(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sy(){return Kf.NODE_ADMIN===!0}function oy(){try{return typeof indexedDB=="object"}catch{return!1}}function ry(){return new Promise((e,n)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{n(s.error?.message||"")}}catch(t){n(t)}})}const ay="FirebaseError";class fo extends Error{constructor(n,t,i){super(t),this.code=n,this.customData=i,this.name=ay,Object.setPrototypeOf(this,fo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,im.prototype.create)}}class im{constructor(n,t,i){this.service=n,this.serviceName=t,this.errors=i}create(n,...t){const i=t[0]||{},s=`${this.service}/${n}`,o=this.errors[n],r=o?ly(o,i):"Error",a=`${this.serviceName}: ${r} (${s}).`;return new fo(s,a,i)}}function ly(e,n){return e.replace(cy,(t,i)=>{const s=n[i];return s!=null?String(s):`<${i}?>`})}const cy=/\{\$([^}]+)}/g;function Js(e){return JSON.parse(e)}function En(e){return JSON.stringify(e)}const sm=function(e){let n={},t={},i={},s="";try{const o=e.split(".");n=Js(La(o[0])||""),t=Js(La(o[1])||""),s=o[2],i=t.d||{},delete t.d}catch{}return{header:n,claims:t,data:i,signature:s}},uy=function(e){const n=sm(e),t=n.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},dy=function(e){const n=sm(e).claims;return typeof n=="object"&&n.admin===!0};function Jt(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function ns(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]}function iu(e){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n))return!1;return!0}function Go(e,n,t){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=n.call(t,e[s],s,e));return i}function Jo(e,n){if(e===n)return!0;const t=Object.keys(e),i=Object.keys(n);for(const s of t){if(!i.includes(s))return!1;const o=e[s],r=n[s];if(su(o)&&su(r)){if(!Jo(o,r))return!1}else if(o!==r)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function su(e){return e!==null&&typeof e=="object"}function fy(e){const n=[];for(const[t,i]of Object.entries(e))Array.isArray(i)?i.forEach(s=>{n.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return n.length?"&"+n.join("&"):""}class my{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let n=1;n<this.blockSize;++n)this.pad_[n]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,t){t||(t=0);const i=this.W_;if(typeof n=="string")for(let m=0;m<16;m++)i[m]=n.charCodeAt(t)<<24|n.charCodeAt(t+1)<<16|n.charCodeAt(t+2)<<8|n.charCodeAt(t+3),t+=4;else for(let m=0;m<16;m++)i[m]=n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3],t+=4;for(let m=16;m<80;m++){const h=i[m-3]^i[m-8]^i[m-14]^i[m-16];i[m]=(h<<1|h>>>31)&4294967295}let s=this.chain_[0],o=this.chain_[1],r=this.chain_[2],a=this.chain_[3],l=this.chain_[4],u,f;for(let m=0;m<80;m++){m<40?m<20?(u=a^o&(r^a),f=1518500249):(u=o^r^a,f=1859775393):m<60?(u=o&r|a&(o|r),f=2400959708):(u=o^r^a,f=3395469782);const h=(s<<5|s>>>27)+u+l+f+i[m]&4294967295;l=a,a=r,r=(o<<30|o>>>2)&4294967295,o=s,s=h}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+r&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(n,t){if(n==null)return;t===void 0&&(t=n.length);const i=t-this.blockSize;let s=0;const o=this.buf_;let r=this.inbuf_;for(;s<t;){if(r===0)for(;s<=i;)this.compress_(n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<t;)if(o[r]=n.charCodeAt(s),++r,++s,r===this.blockSize){this.compress_(o),r=0;break}}else for(;s<t;)if(o[r]=n[s],++r,++s,r===this.blockSize){this.compress_(o),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const n=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let o=24;o>=0;o-=8)n[i]=this.chain_[s]>>o&255,++i;return n}}function xl(e,n){return`${e} failed: ${n} argument `}const hy=function(e){const n=[];let t=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){const o=s-55296;i++,He(i<e.length,"Surrogate pair missing trail surrogate.");const r=e.charCodeAt(i)-56320;s=65536+(o<<10)+r}s<128?n[t++]=s:s<2048?(n[t++]=s>>6|192,n[t++]=s&63|128):s<65536?(n[t++]=s>>12|224,n[t++]=s>>6&63|128,n[t++]=s&63|128):(n[t++]=s>>18|240,n[t++]=s>>12&63|128,n[t++]=s>>6&63|128,n[t++]=s&63|128)}return n},Hr=function(e){let n=0;for(let t=0;t<e.length;t++){const i=e.charCodeAt(t);i<128?n++:i<2048?n+=2:i>=55296&&i<=56319?(n+=4,t++):n+=3}return n};function cs(e){return e&&e._delegate?e._delegate:e}class Ys{constructor(n,t,i){this.name=n,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}const wi="[DEFAULT]";class py{constructor(n,t){this.name=n,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const t=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(t)){const i=new Pr;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(n){const t=this.normalizeInstanceIdentifier(n?.identifier),i=n?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(yy(n))try{this.getOrInitializeService({instanceIdentifier:wi})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});i.resolve(o)}catch{}}}}clearInstance(n=wi){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...n.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=wi){return this.instances.has(n)}getOptions(n=wi){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:t={}}=n,i=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[o,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(o);i===a&&r.resolve(s)}return s}onInit(n,t){const i=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(i)??new Set;s.add(n),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&n(o,i),()=>{s.delete(n)}}invokeOnInitCallbacks(n,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(n,t)}catch{}}getOrInitializeService({instanceIdentifier:n,options:t={}}){let i=this.instances.get(n);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:gy(n),options:t}),this.instances.set(n,i),this.instancesOptions.set(n,t),this.invokeOnInitCallbacks(i,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,i)}catch{}return i||null}normalizeInstanceIdentifier(n=wi){return this.component?this.component.multipleInstances?n:wi:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function gy(e){return e===wi?void 0:e}function yy(e){return e.instantiationMode==="EAGER"}class Cy{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const t=this.getProvider(n.name);if(t.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);t.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const t=new py(n,this);return this.providers.set(n,t),t}getProviders(){return Array.from(this.providers.values())}}var Cn;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Cn||(Cn={}));const vy={debug:Cn.DEBUG,verbose:Cn.VERBOSE,info:Cn.INFO,warn:Cn.WARN,error:Cn.ERROR,silent:Cn.SILENT},_y=Cn.INFO,$y={[Cn.DEBUG]:"log",[Cn.VERBOSE]:"log",[Cn.INFO]:"info",[Cn.WARN]:"warn",[Cn.ERROR]:"error"},wy=(e,n,...t)=>{if(n<e.logLevel)return;const i=new Date().toISOString(),s=$y[n];if(s)console[s](`[${i}]  ${e.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class om{constructor(n){this.name=n,this._logLevel=_y,this._logHandler=wy,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in Cn))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?vy[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,Cn.DEBUG,...n),this._logHandler(this,Cn.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,Cn.VERBOSE,...n),this._logHandler(this,Cn.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,Cn.INFO,...n),this._logHandler(this,Cn.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,Cn.WARN,...n),this._logHandler(this,Cn.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,Cn.ERROR,...n),this._logHandler(this,Cn.ERROR,...n)}}const by=(e,n)=>n.some(t=>e instanceof t);let ou,ru;function Ay(){return ou||(ou=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Py(){return ru||(ru=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rm=new WeakMap,Oa=new WeakMap,am=new WeakMap,da=new WeakMap,Bl=new WeakMap;function Hy(e){const n=new Promise((t,i)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{t(ri(e.result)),s()},r=()=>{i(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",r)});return n.then(t=>{t instanceof IDBCursor&&rm.set(t,e)}).catch(()=>{}),Bl.set(n,e),n}function xy(e){if(Oa.has(e))return;const n=new Promise((t,i)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{t(),s()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)});Oa.set(e,n)}let Ua={get(e,n,t){if(e instanceof IDBTransaction){if(n==="done")return Oa.get(e);if(n==="objectStoreNames")return e.objectStoreNames||am.get(e);if(n==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ri(e[n])},set(e,n,t){return e[n]=t,!0},has(e,n){return e instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in e}};function By(e){Ua=e(Ua)}function Sy(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...t){const i=e.call(fa(this),n,...t);return am.set(i,n.sort?n.sort():[n]),ri(i)}:Py().includes(e)?function(...n){return e.apply(fa(this),n),ri(rm.get(this))}:function(...n){return ri(e.apply(fa(this),n))}}function Iy(e){return typeof e=="function"?Sy(e):(e instanceof IDBTransaction&&xy(e),by(e,Ay())?new Proxy(e,Ua):e)}function ri(e){if(e instanceof IDBRequest)return Hy(e);if(da.has(e))return da.get(e);const n=Iy(e);return n!==e&&(da.set(e,n),Bl.set(n,e)),n}const fa=e=>Bl.get(e);function ky(e,n,{blocked:t,upgrade:i,blocking:s,terminated:o}={}){const r=indexedDB.open(e,n),a=ri(r);return i&&r.addEventListener("upgradeneeded",l=>{i(ri(r.result),l.oldVersion,l.newVersion,ri(r.transaction),l)}),t&&r.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Ey=["get","getKey","getAll","getAllKeys","count"],Ty=["put","add","delete","clear"],ma=new Map;function au(e,n){if(!(e instanceof IDBDatabase&&!(n in e)&&typeof n=="string"))return;if(ma.get(n))return ma.get(n);const t=n.replace(/FromIndex$/,""),i=n!==t,s=Ty.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||Ey.includes(t)))return;const o=async function(r,...a){const l=this.transaction(r,s?"readwrite":"readonly");let u=l.store;return i&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),s&&l.done]))[0]};return ma.set(n,o),o}By(e=>({...e,get:(n,t,i)=>au(n,t)||e.get(n,t,i),has:(n,t)=>!!au(n,t)||e.has(n,t)}));class Ry{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ny(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function Ny(e){return e.getComponent()?.type==="VERSION"}const ja="@firebase/app",lu="0.14.6";const Wt=new om("@firebase/app"),My="@firebase/app-compat",Dy="@firebase/analytics-compat",qy="@firebase/analytics",Ly="@firebase/app-check-compat",Oy="@firebase/app-check",Uy="@firebase/auth",jy="@firebase/auth-compat",Fy="@firebase/database",Vy="@firebase/data-connect",Wy="@firebase/database-compat",zy="@firebase/functions",Gy="@firebase/functions-compat",Jy="@firebase/installations",Yy="@firebase/installations-compat",Ky="@firebase/messaging",Zy="@firebase/messaging-compat",Qy="@firebase/performance",Xy="@firebase/performance-compat",eC="@firebase/remote-config",nC="@firebase/remote-config-compat",tC="@firebase/storage",iC="@firebase/storage-compat",sC="@firebase/firestore",oC="@firebase/ai",rC="@firebase/firestore-compat",aC="firebase",lC="12.6.0";const Fa="[DEFAULT]",cC={[ja]:"fire-core",[My]:"fire-core-compat",[qy]:"fire-analytics",[Dy]:"fire-analytics-compat",[Oy]:"fire-app-check",[Ly]:"fire-app-check-compat",[Uy]:"fire-auth",[jy]:"fire-auth-compat",[Fy]:"fire-rtdb",[Vy]:"fire-data-connect",[Wy]:"fire-rtdb-compat",[zy]:"fire-fn",[Gy]:"fire-fn-compat",[Jy]:"fire-iid",[Yy]:"fire-iid-compat",[Ky]:"fire-fcm",[Zy]:"fire-fcm-compat",[Qy]:"fire-perf",[Xy]:"fire-perf-compat",[eC]:"fire-rc",[nC]:"fire-rc-compat",[tC]:"fire-gcs",[iC]:"fire-gcs-compat",[sC]:"fire-fst",[rC]:"fire-fst-compat",[oC]:"fire-vertex","fire-js":"fire-js",[aC]:"fire-js-all"};const ts=new Map,Va=new Map,Wa=new Map;function cu(e,n){try{e.container.addComponent(n)}catch(t){Wt.debug(`Component ${n.name} failed to register with FirebaseApp ${e.name}`,t)}}function Yo(e){const n=e.name;if(Wa.has(n))return Wt.debug(`There were multiple attempts to register component ${n}.`),!1;Wa.set(n,e);for(const t of ts.values())cu(t,e);for(const t of Va.values())cu(t,e);return!0}function uC(e,n){const t=e.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),e.container.getProvider(n)}function dC(e){return e==null?!1:e.settings!==void 0}const fC={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ai=new im("app","Firebase",fC);class mC{constructor(n,t,i){this._isDeleted=!1,this._options={...n},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Ys("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw ai.create("app-deleted",{appName:this._name})}}const hC=lC;function lm(e,n={}){let t=e;typeof n!="object"&&(n={name:n});const i={name:Fa,automaticDataCollectionEnabled:!0,...n},s=i.name;if(typeof s!="string"||!s)throw ai.create("bad-app-name",{appName:String(s)});if(t||(t=nm()),!t)throw ai.create("no-options");const o=ts.get(s);if(o){if(Jo(t,o.options)&&Jo(i,o.config))return o;throw ai.create("duplicate-app",{appName:s})}const r=new Cy(s);for(const l of Wa.values())r.addComponent(l);const a=new mC(t,i,r);return ts.set(s,a),a}function pC(e=Fa){const n=ts.get(e);if(!n&&e===Fa&&nm())return lm();if(!n)throw ai.create("no-app",{appName:e});return n}async function gC(e){let n=!1;const t=e.name;ts.has(t)?(n=!0,ts.delete(t)):Va.has(t)&&e.decRefCount()<=0&&(Va.delete(t),n=!0),n&&(await Promise.all(e.container.getProviders().map(i=>i.delete())),e.isDeleted=!0)}function Gi(e,n,t){let i=cC[e]??e;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=n.match(/\s|\//);if(s||o){const r=[`Unable to register library "${i}" with version "${n}":`];s&&r.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&r.push("and"),o&&r.push(`version name "${n}" contains illegal characters (whitespace or "/")`),Wt.warn(r.join(" "));return}Yo(new Ys(`${i}-version`,()=>({library:i,version:n}),"VERSION"))}const yC="firebase-heartbeat-database",CC=1,Ks="firebase-heartbeat-store";let ha=null;function cm(){return ha||(ha=ky(yC,CC,{upgrade:(e,n)=>{switch(n){case 0:try{e.createObjectStore(Ks)}catch(t){console.warn(t)}}}}).catch(e=>{throw ai.create("idb-open",{originalErrorMessage:e.message})})),ha}async function vC(e){try{const t=(await cm()).transaction(Ks),i=await t.objectStore(Ks).get(um(e));return await t.done,i}catch(n){if(n instanceof fo)Wt.warn(n.message);else{const t=ai.create("idb-get",{originalErrorMessage:n?.message});Wt.warn(t.message)}}}async function uu(e,n){try{const i=(await cm()).transaction(Ks,"readwrite");await i.objectStore(Ks).put(n,um(e)),await i.done}catch(t){if(t instanceof fo)Wt.warn(t.message);else{const i=ai.create("idb-set",{originalErrorMessage:t?.message});Wt.warn(i.message)}}}function um(e){return`${e.name}!${e.options.appId}`}const _C=1024,$C=30;class wC{constructor(n){this.container=n,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new AC(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=du();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:t}),this._heartbeatsCache.heartbeats.length>$C){const s=PC(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Wt.warn(n)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=du(),{heartbeatsToSend:t,unsentEntries:i}=bC(this._heartbeatsCache.heartbeats),s=zo(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return Wt.warn(n),""}}}function du(){return new Date().toISOString().substring(0,10)}function bC(e,n=_C){const t=[];let i=e.slice();for(const s of e){const o=t.find(r=>r.agent===s.agent);if(o){if(o.dates.push(s.date),fu(t)>n){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),fu(t)>n){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class AC{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return oy()?ry().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await vC(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){if(await this._canUseIndexedDBPromise){const i=await this.read();return uu(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){if(await this._canUseIndexedDBPromise){const i=await this.read();return uu(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...n.heartbeats]})}else return}}function fu(e){return zo(JSON.stringify({version:2,heartbeats:e})).length}function PC(e){if(e.length===0)return-1;let n=0,t=e[0].date;for(let i=1;i<e.length;i++)e[i].date<t&&(t=e[i].date,n=i);return n}function HC(e){Yo(new Ys("platform-logger",n=>new Ry(n),"PRIVATE")),Yo(new Ys("heartbeat",n=>new wC(n),"PRIVATE")),Gi(ja,lu,e),Gi(ja,lu,"esm2020"),Gi("fire-js","")}HC("");var xC="firebase",BC="12.7.0";Gi(xC,BC,"app");var mu={};const hu="@firebase/database",pu="1.1.0";let dm="";function SC(e){dm=e}class IC{constructor(n){this.domStorage_=n,this.prefix_="firebase:"}set(n,t){t==null?this.domStorage_.removeItem(this.prefixedName_(n)):this.domStorage_.setItem(this.prefixedName_(n),En(t))}get(n){const t=this.domStorage_.getItem(this.prefixedName_(n));return t==null?null:Js(t)}remove(n){this.domStorage_.removeItem(this.prefixedName_(n))}prefixedName_(n){return this.prefix_+n}toString(){return this.domStorage_.toString()}}class kC{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(n,t){t==null?delete this.cache_[n]:this.cache_[n]=t}get(n){return Jt(this.cache_,n)?this.cache_[n]:null}remove(n){delete this.cache_[n]}}const fm=function(e){try{if(typeof window<"u"&&typeof window[e]<"u"){const n=window[e];return n.setItem("firebase:sentinel","cache"),n.removeItem("firebase:sentinel"),new IC(n)}}catch{}return new kC},Ai=fm("localStorage"),EC=fm("sessionStorage");const Ji=new om("@firebase/database"),TC=(function(){let e=1;return function(){return e++}})(),mm=function(e){const n=hy(e),t=new my;t.update(n);const i=t.digest();return Pl.encodeByteArray(i)},mo=function(...e){let n="";for(let t=0;t<e.length;t++){const i=e[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?n+=mo.apply(null,i):typeof i=="object"?n+=En(i):n+=i,n+=" "}return n};let Ns=null,gu=!0;const RC=function(e,n){He(!0,"Can't turn on custom loggers persistently."),Ji.logLevel=Cn.VERBOSE,Ns=Ji.log.bind(Ji)},Wn=function(...e){if(gu===!0&&(gu=!1,Ns===null&&EC.get("logging_enabled")===!0&&RC()),Ns){const n=mo.apply(null,e);Ns(n)}},ho=function(e){return function(...n){Wn(e,...n)}},za=function(...e){const n="FIREBASE INTERNAL ERROR: "+mo(...e);Ji.error(n)},zt=function(...e){const n=`FIREBASE FATAL ERROR: ${mo(...e)}`;throw Ji.error(n),new Error(n)},nt=function(...e){const n="FIREBASE WARNING: "+mo(...e);Ji.warn(n)},NC=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&nt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},hm=function(e){return typeof e=="number"&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},MC=function(e){if(document.readyState==="complete")e();else{let n=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}n||(n=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},is="[MIN_NAME]",Ii="[MAX_NAME]",us=function(e,n){if(e===n)return 0;if(e===is||n===Ii)return-1;if(n===is||e===Ii)return 1;{const t=yu(e),i=yu(n);return t!==null?i!==null?t-i===0?e.length-n.length:t-i:-1:i!==null?1:e<n?-1:1}},DC=function(e,n){return e===n?0:e<n?-1:1},gs=function(e,n){if(n&&e in n)return n[e];throw new Error("Missing required key ("+e+") in object: "+En(n))},Sl=function(e){if(typeof e!="object"||e===null)return En(e);const n=[];for(const i in e)n.push(i);n.sort();let t="{";for(let i=0;i<n.length;i++)i!==0&&(t+=","),t+=En(n[i]),t+=":",t+=Sl(e[n[i]]);return t+="}",t},pm=function(e,n){const t=e.length;if(t<=n)return[e];const i=[];for(let s=0;s<t;s+=n)s+n>t?i.push(e.substring(s,t)):i.push(e.substring(s,s+n));return i};function tt(e,n){for(const t in e)e.hasOwnProperty(t)&&n(t,e[t])}const gm=function(e){He(!hm(e),"Invalid JSON number");const n=11,t=52,i=(1<<n-1)-1;let s,o,r,a,l;e===0?(o=0,r=0,s=1/e===-1/0?1:0):(s=e<0,e=Math.abs(e),e>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(e)/Math.LN2),i),o=a+i,r=Math.round(e*Math.pow(2,t-a)-Math.pow(2,t))):(o=0,r=Math.round(e/Math.pow(2,1-i-t))));const u=[];for(l=t;l;l-=1)u.push(r%2?1:0),r=Math.floor(r/2);for(l=n;l;l-=1)u.push(o%2?1:0),o=Math.floor(o/2);u.push(s?1:0),u.reverse();const f=u.join("");let m="";for(l=0;l<64;l+=8){let h=parseInt(f.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),m=m+h}return m.toLowerCase()},qC=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},LC=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function OC(e,n){let t="Unknown Error";e==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":e==="permission_denied"?t="Client doesn't have permission to access the desired data.":e==="unavailable"&&(t="The service is unavailable");const i=new Error(e+" at "+n._path.toString()+": "+t);return i.code=e.toUpperCase(),i}const UC=new RegExp("^-?(0*)\\d{1,10}$"),jC=-2147483648,FC=2147483647,yu=function(e){if(UC.test(e)){const n=Number(e);if(n>=jC&&n<=FC)return n}return null},ds=function(e){try{e()}catch(n){setTimeout(()=>{const t=n.stack||"";throw nt("Exception was thrown by user callback.",t),n},Math.floor(0))}},VC=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ms=function(e,n){const t=setTimeout(e,n);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class WC{constructor(n,t){this.appCheckProvider=t,this.appName=n.name,dC(n)&&n.settings.appCheckToken&&(this.serverAppAppCheckToken=n.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(n){if(this.serverAppAppCheckToken){if(n)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(n):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(t,i):t(null)},0)})}addTokenChangeListener(n){this.appCheckProvider?.get().then(t=>t.addTokenListener(n))}notifyForInvalidToken(){nt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class zC{constructor(n,t,i){this.appName_=n,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(t=>t&&t.code==="auth/token-not-initialized"?(Wn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(t,i):t(null)},0)})}addTokenChangeListener(n){this.auth_?this.auth_.addAuthTokenListener(n):this.authProvider_.get().then(t=>t.addAuthTokenListener(n))}removeTokenChangeListener(n){this.authProvider_.get().then(t=>t.removeAuthTokenListener(n))}notifyForInvalidToken(){let n='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?n+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?n+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':n+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',nt(n)}}class Mo{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}Mo.OWNER="owner";const Il="5",ym="v",Cm="s",vm="r",_m="f",$m=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wm="ls",bm="p",Ga="ac",Am="websocket",Pm="long_polling";class Hm{constructor(n,t,i,s,o=!1,r="",a=!1,l=!1,u=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=o,this.persistenceKey=r,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=u,this._host=n.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ai.get("host:"+n)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(n){n!==this.internalHost&&(this.internalHost=n,this.isCacheableHost()&&Ai.set("host:"+this._host,this.internalHost))}toString(){let n=this.toURLString();return this.persistenceKey&&(n+="<"+this.persistenceKey+">"),n}toURLString(){const n=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${n}${this.host}/${t}`}}function GC(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function xm(e,n,t){He(typeof n=="string","typeof type must == string"),He(typeof t=="object","typeof params must == object");let i;if(n===Am)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(n===Pm)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+n);GC(e)&&(t.ns=e.namespace);const s=[];return tt(t,(o,r)=>{s.push(o+"="+r)}),i+s.join("&")}class JC{constructor(){this.counters_={}}incrementCounter(n,t=1){Jt(this.counters_,n)||(this.counters_[n]=0),this.counters_[n]+=t}get(){return F0(this.counters_)}}const pa={},ga={};function kl(e){const n=e.toString();return pa[n]||(pa[n]=new JC),pa[n]}function YC(e,n){const t=e.toString();return ga[t]||(ga[t]=n()),ga[t]}class KC{constructor(n){this.onMessage_=n,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(n,t){this.closeAfterResponse=n,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(n,t){for(this.pendingResponses[n]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&ds(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Cu="start",ZC="close",QC="pLPCommand",XC="pRTLPCB",Bm="id",Sm="pw",Im="ser",ev="cb",nv="seg",tv="ts",iv="d",sv="dframe",km=1870,Em=30,ov=km-Em,rv=25e3,av=3e4;class Ui{constructor(n,t,i,s,o,r,a){this.connId=n,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.transportSessionId=r,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ho(n),this.stats_=kl(t),this.urlFn=l=>(this.appCheckToken&&(l[Ga]=this.appCheckToken),xm(t,Pm,l))}open(n,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new KC(n),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(av)),MC(()=>{if(this.isClosed_)return;this.scriptTagHolder=new El((...o)=>{const[r,a,l,u,f]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,r===Cu)this.id=a,this.password=l;else if(r===ZC)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+r)},(...o)=>{const[r,a]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(r,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[Cu]="t",i[Im]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[ev]=this.scriptTagHolder.uniqueCallbackIdentifier),i[ym]=Il,this.transportSessionId&&(i[Cm]=this.transportSessionId),this.lastSessionId&&(i[wm]=this.lastSessionId),this.applicationId&&(i[bm]=this.applicationId),this.appCheckToken&&(i[Ga]=this.appCheckToken),typeof location<"u"&&location.hostname&&$m.test(location.hostname)&&(i[vm]=_m);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ui.forceAllow_=!0}static forceDisallow(){Ui.forceDisallow_=!0}static isAvailable(){return Ui.forceAllow_?!0:!Ui.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!qC()&&!LC()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(n){const t=En(n);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=Qf(t),s=pm(i,ov);for(let o=0;o<s.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[o]),this.curSegmentNum++}addDisconnectPingFrame(n,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[sv]="t",i[Bm]=n,i[Sm]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(n){const t=En(n).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class El{constructor(n,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=TC(),window[QC+this.uniqueCallbackIdentifier]=n,window[XC+this.uniqueCallbackIdentifier]=t,this.myIFrame=El.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const r="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(a){Wn("frame writing exception"),a.stack&&Wn(a.stack),Wn(a)}}}static createIFrame_(){const n=document.createElement("iframe");if(n.style.display="none",document.body){document.body.appendChild(n);try{n.contentWindow.document||Wn("No IE domain setting required")}catch{const i=document.domain;n.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return n.contentDocument?n.doc=n.contentDocument:n.contentWindow?n.doc=n.contentWindow.document:n.document&&(n.doc=n.document),n}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const n=this.onDisconnect;n&&(this.onDisconnect=null,n())}startLongPoll(n,t){for(this.myID=n,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const n={};n[Bm]=this.myID,n[Sm]=this.myPW,n[Im]=this.currentSerial;let t=this.urlFn(n),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Em+i.length<=km;){const r=this.pendingSegs.shift();i=i+"&"+nv+s+"="+r.seg+"&"+tv+s+"="+r.ts+"&"+iv+s+"="+r.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(n,t,i){this.pendingSegs.push({seg:n,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(n,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(rv)),o=()=>{clearTimeout(s),i()};this.addTag(n,o)}addTag(n,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=n,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{Wn("Long-poll script failed to load: "+n),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const lv=16384,cv=45e3;let Ko=null;typeof MozWebSocket<"u"?Ko=MozWebSocket:typeof WebSocket<"u"&&(Ko=WebSocket);class dt{constructor(n,t,i,s,o,r,a){this.connId=n,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ho(this.connId),this.stats_=kl(t),this.connURL=dt.connectionURL_(t,r,a,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(n,t,i,s,o){const r={};return r[ym]=Il,typeof location<"u"&&location.hostname&&$m.test(location.hostname)&&(r[vm]=_m),t&&(r[Cm]=t),i&&(r[wm]=i),s&&(r[Ga]=s),o&&(r[bm]=o),xm(n,Am,r)}open(n,t){this.onDisconnect=t,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ai.set("previous_websocket_failure",!0);try{let i;sy(),this.mySock=new Ko(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){dt.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(n=!0)}return!n&&Ko!==null&&!dt.forceDisallow_}static previouslyFailed(){return Ai.isInMemoryStorage||Ai.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ai.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=Js(t);this.onMessage(i)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(He(this.frames===null,"We already have a frame buffer"),n.length<=6){const t=Number(n);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;const t=n.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(n){this.resetKeepAlive();const t=En(n);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=pm(t,lv);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(cv))}sendString_(n){try{this.mySock.send(n)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}dt.responsesRequiredToBeHealthy=2;dt.healthyTimeout=3e4;class Zs{static get ALL_TRANSPORTS(){return[Ui,dt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(n){this.initTransports_(n)}initTransports_(n){const t=dt&&dt.isAvailable();let i=t&&!dt.previouslyFailed();if(n.webSocketOnly&&(t||nt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[dt];else{const s=this.transports_=[];for(const o of Zs.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);Zs.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Zs.globalTransportInitialized_=!1;const uv=6e4,dv=5e3,fv=10*1024,mv=100*1024,ya="t",vu="d",hv="s",_u="r",pv="e",$u="o",wu="a",bu="n",Au="p",gv="h";class yv{constructor(n,t,i,s,o,r,a,l,u,f){this.id=n,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=o,this.onMessage_=r,this.onReady_=a,this.onDisconnect_=l,this.onKill_=u,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ho("c:"+this.id+":"),this.transportManager_=new Zs(t),this.log_("Connection created"),this.start_()}start_(){const n=this.transportManager_.initialTransport();this.conn_=new n(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=n.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=n.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ms(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>mv?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>fv?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(n){return t=>{n===this.conn_?this.onConnectionLost_(t):n===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(n){return t=>{this.state_!==2&&(n===this.rx_?this.onPrimaryMessageReceived_(t):n===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(n){const t={t:"d",d:n};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(n){if(ya in n){const t=n[ya];t===wu?this.upgradeIfSecondaryHealthy_():t===_u?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===$u&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(n){const t=gs("t",n),i=gs("d",n);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Au,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:wu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(n){const t=gs("t",n),i=gs("d",n);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(n){this.onPrimaryResponse_(),this.onMessage_(n)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(n){const t=gs(ya,n);if(vu in n){const i=n[vu];if(t===gv){const s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===bu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===hv?this.onConnectionShutdown_(i):t===_u?this.onReset_(i):t===pv?za("Server Error: "+i):t===$u?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):za("Unknown control packet command: "+t)}}onHandshake_(n){const t=n.ts,i=n.v,s=n.h;this.sessionId=n.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Il!==i&&nt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const n=this.transportManager_.upgradeTransport();n&&this.startUpgrade_(n)}startUpgrade_(n){this.secondaryConn_=new n(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=n.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Ms(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(uv))}onReset_(n){this.log_("Reset packet received.  New host: "+n),this.repoInfo_.host=n,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(n,t){this.log_("Realtime connection established."),this.conn_=n,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ms(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dv))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Au,d:{}}}))}onSecondaryConnectionLost_(){const n=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===n||this.rx_===n)&&this.close()}onConnectionLost_(n){this.conn_=null,!n&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ai.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(n){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(n),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(n){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(n)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Tm{put(n,t,i,s){}merge(n,t,i,s){}refreshAuthToken(n){}refreshAppCheckToken(n){}onDisconnectPut(n,t,i){}onDisconnectMerge(n,t,i){}onDisconnectCancel(n,t){}reportStats(n){}}class Rm{constructor(n){this.allowedEvents_=n,this.listeners_={},He(Array.isArray(n)&&n.length>0,"Requires a non-empty array")}trigger(n,...t){if(Array.isArray(this.listeners_[n])){const i=[...this.listeners_[n]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(n,t,i){this.validateEventType_(n),this.listeners_[n]=this.listeners_[n]||[],this.listeners_[n].push({callback:t,context:i});const s=this.getInitialEvent(n);s&&t.apply(i,s)}off(n,t,i){this.validateEventType_(n);const s=this.listeners_[n]||[];for(let o=0;o<s.length;o++)if(s[o].callback===t&&(!i||i===s[o].context)){s.splice(o,1);return}}validateEventType_(n){He(this.allowedEvents_.find(t=>t===n),"Unknown event: "+n)}}class Zo extends Rm{static getInstance(){return new Zo}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!tm()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(n){return He(n==="online","Unknown event type: "+n),[this.online_]}currentlyOnline(){return this.online_}}const Pu=32,Hu=768;class pn{constructor(n,t){if(t===void 0){this.pieces_=n.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=t}toString(){let n="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(n+="/"+this.pieces_[t]);return n||"/"}}function ln(){return new pn("")}function Ke(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function di(e){return e.pieces_.length-e.pieceNum_}function vn(e){let n=e.pieceNum_;return n<e.pieces_.length&&n++,new pn(e.pieces_,n)}function Nm(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Cv(e){let n="";for(let t=e.pieceNum_;t<e.pieces_.length;t++)e.pieces_[t]!==""&&(n+="/"+encodeURIComponent(String(e.pieces_[t])));return n||"/"}function Mm(e,n=0){return e.pieces_.slice(e.pieceNum_+n)}function Dm(e){if(e.pieceNum_>=e.pieces_.length)return null;const n=[];for(let t=e.pieceNum_;t<e.pieces_.length-1;t++)n.push(e.pieces_[t]);return new pn(n,0)}function Tn(e,n){const t=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);if(n instanceof pn)for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);else{const i=n.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new pn(t,0)}function Xe(e){return e.pieceNum_>=e.pieces_.length}function Qn(e,n){const t=Ke(e),i=Ke(n);if(t===null)return n;if(t===i)return Qn(vn(e),vn(n));throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")}function Tl(e,n){if(di(e)!==di(n))return!1;for(let t=e.pieceNum_,i=n.pieceNum_;t<=e.pieces_.length;t++,i++)if(e.pieces_[t]!==n.pieces_[i])return!1;return!0}function mt(e,n){let t=e.pieceNum_,i=n.pieceNum_;if(di(e)>di(n))return!1;for(;t<e.pieces_.length;){if(e.pieces_[t]!==n.pieces_[i])return!1;++t,++i}return!0}class vv{constructor(n,t){this.errorPrefix_=t,this.parts_=Mm(n,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Hr(this.parts_[i]);qm(this)}}function _v(e,n){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(n),e.byteLength_+=Hr(n),qm(e)}function $v(e){const n=e.parts_.pop();e.byteLength_-=Hr(n),e.parts_.length>0&&(e.byteLength_-=1)}function qm(e){if(e.byteLength_>Hu)throw new Error(e.errorPrefix_+"has a key path longer than "+Hu+" bytes ("+e.byteLength_+").");if(e.parts_.length>Pu)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Pu+") or object contains a cycle "+bi(e))}function bi(e){return e.parts_.length===0?"":"in property '"+e.parts_.join(".")+"'"}class Rl extends Rm{static getInstance(){return new Rl}constructor(){super(["visible"]);let n,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",n="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",n="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",n="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",n="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[n];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(n){return He(n==="visible","Unknown event type: "+n),[this.visible_]}}const ys=1e3,wv=300*1e3,xu=30*1e3,bv=1.3,Av=3e4,Pv="server_kill",Bu=3;class Ut extends Tm{constructor(n,t,i,s,o,r,a,l){if(super(),this.repoInfo_=n,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=r,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=Ut.nextPersistentConnectionId_++,this.log_=ho("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ys,this.maxReconnectDelay_=wv,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Rl.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&Zo.getInstance().on("online",this.onOnline_,this)}sendRequest(n,t,i){const s=++this.requestNumber_,o={r:s,a:n,b:t};this.log_(En(o)),He(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(n){this.initConnection_();const t=new Pr,s={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:r=>{const a=r.d;r.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),t.promise}listen(n,t,i,s){this.initConnection_();const o=n._queryIdentifier,r=n._path.toString();this.log_("Listen called for "+r+" "+o),this.listens.has(r)||this.listens.set(r,new Map),He(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),He(!this.listens.get(r).has(o),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:n,tag:i};this.listens.get(r).set(o,a),this.connected_&&this.sendListen_(a)}sendGet_(n){const t=this.outstandingGets_[n];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(n){const t=n.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const o={p:i},r="q";n.tag&&(o.q=t._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(r,o,a=>{const l=a.d,u=a.s;Ut.warnOnListenWarnings_(l,t),(this.listens.get(i)&&this.listens.get(i).get(s))===n&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(i,s),n.onComplete&&n.onComplete(u,l))})}static warnOnListenWarnings_(n,t){if(n&&typeof n=="object"&&Jt(n,"w")){const i=ns(n,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();nt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||dy(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=xu)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_,t=uy(n)?"auth":"gauth",i={cred:n};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const o=s.s,r=s.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{const t=n.s,i=n.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(n,t){const i=n._path.toString(),s=n._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),He(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,n._queryObject,t)}sendUnlisten_(n,t,i,s){this.log_("Unlisten on "+n+" for "+t);const o={p:n},r="n";s&&(o.q=i,o.t=s),this.sendRequest(r,o)}onDisconnectPut(n,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,t,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:t,onComplete:i})}onDisconnectMerge(n,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,t,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:t,onComplete:i})}onDisconnectCancel(n,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,t):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(n,t,i,s){const o={p:t,d:i};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,r=>{s&&setTimeout(()=>{s(r.s,r.d)},Math.floor(0))})}put(n,t,i,s){this.putInternal("p",n,t,i,s)}merge(n,t,i,s){this.putInternal("m",n,t,i,s)}putInternal(n,t,i,s,o){this.initConnection_();const r={p:t,d:i};o!==void 0&&(r.h=o),this.outstandingPuts_.push({action:n,request:r,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(n){const t=this.outstandingPuts_[n].action,i=this.outstandingPuts_[n].request,s=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(t,i,o=>{this.log_(t+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(n){if(this.connected_){const t={c:n};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+En(n));const t=n.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,t){this.log_("handleServerMessage",n,t),n==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):n==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):n==="c"?this.onListenRevoked_(t.p,t.q):n==="ac"?this.onAuthRevoked_(t.s,t.d):n==="apc"?this.onAppCheckRevoked_(t.s,t.d):n==="sd"?this.onSecurityDebugPacket_(t):za("Unrecognized action received from server: "+En(n)+`
Are you using the latest client?`)}onReady_(n,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){He(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ys,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=ys,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Av&&(this.reconnectDelay_=ys),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const n=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-n);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*bv)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const n=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Ut.nextConnectionId_++,o=this.lastSessionId;let r=!1,a=null;const l=function(){a?a.close():(r=!0,i())},u=function(m){He(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(m)};this.realtime_={close:l,sendRequest:u};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[m,h]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);r?Wn("getToken() completed but was canceled"):(Wn("getToken() completed. Creating connection."),this.authToken_=m&&m.accessToken,this.appCheckToken_=h&&h.token,a=new yv(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,t,i,v=>{nt(v+" ("+this.repoInfo_.toString()+")"),this.interrupt(Pv)},o))}catch(m){this.log_("Failed to get token: "+m),r||(this.repoInfo_.nodeAdmin&&nt(m),l())}}}interrupt(n){Wn("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){Wn("Resuming connection for reason: "+n),delete this.interruptReasons_[n],iu(this.interruptReasons_)&&(this.reconnectDelay_=ys,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){const t=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){const t=this.outstandingPuts_[n];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,t){let i;t?i=t.map(o=>Sl(o)).join("$"):i="default";const s=this.removeListen_(n,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(n,t){const i=new pn(n).toString();let s;if(this.listens.has(i)){const o=this.listens.get(i);s=o.get(t),o.delete(t),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(n,t){Wn("Auth token revoked: "+n+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Bu&&(this.reconnectDelay_=xu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,t){Wn("App check token revoked: "+n+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Bu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const n of this.listens.values())for(const t of n.values())this.sendListen_(t);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){const n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){const n={};let t="js";n["sdk."+t+"."+dm.replace(/\./g,"-")]=1,tm()?n["framework.cordova"]=1:iy()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){const n=Zo.getInstance().currentlyOnline();return iu(this.interruptReasons_)&&n}}Ut.nextPersistentConnectionId_=0;Ut.nextConnectionId_=0;class Ze{constructor(n,t){this.name=n,this.node=t}static Wrap(n,t){return new Ze(n,t)}}class xr{getCompare(){return this.compare.bind(this)}indexedValueChanged(n,t){const i=new Ze(is,n),s=new Ze(is,t);return this.compare(i,s)!==0}minPost(){return Ze.MIN}}let Bo;class Lm extends xr{static get __EMPTY_NODE(){return Bo}static set __EMPTY_NODE(n){Bo=n}compare(n,t){return us(n.name,t.name)}isDefinedOn(n){throw ls("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(n,t){return!1}minPost(){return Ze.MIN}maxPost(){return new Ze(Ii,Bo)}makePost(n,t){return He(typeof n=="string","KeyIndex indexValue must always be a string."),new Ze(n,Bo)}toString(){return".key"}}const Yi=new Lm;class So{constructor(n,t,i,s,o=null){this.isReverse_=s,this.resultGenerator_=o,this.nodeStack_=[];let r=1;for(;!n.isEmpty();)if(n=n,r=t?i(n.key,t):1,s&&(r*=-1),r<0)this.isReverse_?n=n.left:n=n.right;else if(r===0){this.nodeStack_.push(n);break}else this.nodeStack_.push(n),this.isReverse_?n=n.right:n=n.left}getNext(){if(this.nodeStack_.length===0)return null;let n=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(n.key,n.value):t={key:n.key,value:n.value},this.isReverse_)for(n=n.left;!n.isEmpty();)this.nodeStack_.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack_.push(n),n=n.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const n=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(n.key,n.value):{key:n.key,value:n.value}}}class Dn{constructor(n,t,i,s,o){this.key=n,this.value=t,this.color=i??Dn.RED,this.left=s??et.EMPTY_NODE,this.right=o??et.EMPTY_NODE}copy(n,t,i,s,o){return new Dn(n??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,t,i){let s=this;const o=i(n,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(n,t,i),null):o===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(n,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return et.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,t){let i,s;if(i=this,t(n,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(n,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(n,i.key)===0){if(i.right.isEmpty())return et.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(n,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){const n=this.copy(null,null,Dn.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){const n=this.copy(null,null,Dn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){const n=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,t)}checkMaxDepth_(){const n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}Dn.RED=!0;Dn.BLACK=!1;class Hv{copy(n,t,i,s,o){return this}insert(n,t,i){return new Dn(n,t,null)}remove(n,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class et{constructor(n,t=et.EMPTY_NODE){this.comparator_=n,this.root_=t}insert(n,t){return new et(this.comparator_,this.root_.insert(n,t,this.comparator_).copy(null,null,Dn.BLACK,null,null))}remove(n){return new et(this.comparator_,this.root_.remove(n,this.comparator_).copy(null,null,Dn.BLACK,null,null))}get(n){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(n,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(n){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(n,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(n){return this.root_.inorderTraversal(n)}reverseTraversal(n){return this.root_.reverseTraversal(n)}getIterator(n){return new So(this.root_,null,this.comparator_,!1,n)}getIteratorFrom(n,t){return new So(this.root_,n,this.comparator_,!1,t)}getReverseIteratorFrom(n,t){return new So(this.root_,n,this.comparator_,!0,t)}getReverseIterator(n){return new So(this.root_,null,this.comparator_,!0,n)}}et.EMPTY_NODE=new Hv;function xv(e,n){return us(e.name,n.name)}function Nl(e,n){return us(e,n)}let Ja;function Bv(e){Ja=e}const Om=function(e){return typeof e=="number"?"number:"+gm(e):"string:"+e},Um=function(e){if(e.isLeafNode()){const n=e.val();He(typeof n=="string"||typeof n=="number"||typeof n=="object"&&Jt(n,".sv"),"Priority must be a string or number.")}else He(e===Ja||e.isEmpty(),"priority of unexpected type.");He(e===Ja||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Su;class Mn{static set __childrenNodeConstructor(n){Su=n}static get __childrenNodeConstructor(){return Su}constructor(n,t=Mn.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=t,this.lazyHash_=null,He(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Um(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new Mn(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:Mn.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return Xe(n)?this:Ke(n)===".priority"?this.priorityNode_:Mn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,t){return null}updateImmediateChild(n,t){return n===".priority"?this.updatePriority(t):t.isEmpty()&&n!==".priority"?this:Mn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,t).updatePriority(this.priorityNode_)}updateChild(n,t){const i=Ke(n);return i===null?t:t.isEmpty()&&i!==".priority"?this:(He(i!==".priority"||di(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Mn.__childrenNodeConstructor.EMPTY_NODE.updateChild(vn(n),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,t){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+Om(this.priorityNode_.val())+":");const t=typeof this.value_;n+=t+":",t==="number"?n+=gm(this.value_):n+=this.value_,this.lazyHash_=mm(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===Mn.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof Mn.__childrenNodeConstructor?-1:(He(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){const t=typeof n.value_,i=typeof this.value_,s=Mn.VALUE_TYPE_ORDER.indexOf(t),o=Mn.VALUE_TYPE_ORDER.indexOf(i);return He(s>=0,"Unknown leaf type: "+t),He(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){const t=n;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Mn.VALUE_TYPE_ORDER=["object","boolean","number","string"];let jm,Fm;function Sv(e){jm=e}function Iv(e){Fm=e}class kv extends xr{compare(n,t){const i=n.node.getPriority(),s=t.node.getPriority(),o=i.compareTo(s);return o===0?us(n.name,t.name):o}isDefinedOn(n){return!n.getPriority().isEmpty()}indexedValueChanged(n,t){return!n.getPriority().equals(t.getPriority())}minPost(){return Ze.MIN}maxPost(){return new Ze(Ii,new Mn("[PRIORITY-POST]",Fm))}makePost(n,t){const i=jm(n);return new Ze(t,new Mn("[PRIORITY-POST]",i))}toString(){return".priority"}}const Hn=new kv;const Ev=Math.log(2);class Tv{constructor(n){const t=o=>parseInt(Math.log(o)/Ev,10),i=o=>parseInt(Array(o+1).join("1"),2);this.count=t(n+1),this.current_=this.count-1;const s=i(this.count);this.bits_=n+1&s}nextBitIsOne(){const n=!(this.bits_&1<<this.current_);return this.current_--,n}}const Qo=function(e,n,t,i){e.sort(n);const s=function(l,u){const f=u-l;let m,h;if(f===0)return null;if(f===1)return m=e[l],h=t?t(m):m,new Dn(h,m.node,Dn.BLACK,null,null);{const v=parseInt(f/2,10)+l,S=s(l,v),X=s(v+1,u);return m=e[v],h=t?t(m):m,new Dn(h,m.node,Dn.BLACK,S,X)}},o=function(l){let u=null,f=null,m=e.length;const h=function(S,X){const ae=m-S,fe=m;m-=S;const ge=s(ae+1,fe),R=e[ae],Y=t?t(R):R;v(new Dn(Y,R.node,X,null,ge))},v=function(S){u?(u.left=S,u=S):(f=S,u=S)};for(let S=0;S<l.count;++S){const X=l.nextBitIsOne(),ae=Math.pow(2,l.count-(S+1));X?h(ae,Dn.BLACK):(h(ae,Dn.BLACK),h(ae,Dn.RED))}return f},r=new Tv(e.length),a=o(r);return new et(i||n,a)};let Ca;const Di={};class qt{static get Default(){return He(Di&&Hn,"ChildrenNode.ts has not been loaded"),Ca=Ca||new qt({".priority":Di},{".priority":Hn}),Ca}constructor(n,t){this.indexes_=n,this.indexSet_=t}get(n){const t=ns(this.indexes_,n);if(!t)throw new Error("No index defined for "+n);return t instanceof et?t:null}hasIndex(n){return Jt(this.indexSet_,n.toString())}addIndex(n,t){He(n!==Yi,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const o=t.getIterator(Ze.Wrap);let r=o.getNext();for(;r;)s=s||n.isDefinedOn(r.node),i.push(r),r=o.getNext();let a;s?a=Qo(i,n.getCompare()):a=Di;const l=n.toString(),u={...this.indexSet_};u[l]=n;const f={...this.indexes_};return f[l]=a,new qt(f,u)}addToIndexes(n,t){const i=Go(this.indexes_,(s,o)=>{const r=ns(this.indexSet_,o);if(He(r,"Missing index implementation for "+o),s===Di)if(r.isDefinedOn(n.node)){const a=[],l=t.getIterator(Ze.Wrap);let u=l.getNext();for(;u;)u.name!==n.name&&a.push(u),u=l.getNext();return a.push(n),Qo(a,r.getCompare())}else return Di;else{const a=t.get(n.name);let l=s;return a&&(l=l.remove(new Ze(n.name,a))),l.insert(n,n.node)}});return new qt(i,this.indexSet_)}removeFromIndexes(n,t){const i=Go(this.indexes_,s=>{if(s===Di)return s;{const o=t.get(n.name);return o?s.remove(new Ze(n.name,o)):s}});return new qt(i,this.indexSet_)}}let Cs;class je{static get EMPTY_NODE(){return Cs||(Cs=new je(new et(Nl),null,qt.Default))}constructor(n,t,i){this.children_=n,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Um(this.priorityNode_),this.children_.isEmpty()&&He(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Cs}updatePriority(n){return this.children_.isEmpty()?this:new je(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{const t=this.children_.get(n);return t===null?Cs:t}}getChild(n){const t=Ke(n);return t===null?this:this.getImmediateChild(t).getChild(vn(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,t){if(He(t,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(t);{const i=new Ze(n,t);let s,o;t.isEmpty()?(s=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(n,t),o=this.indexMap_.addToIndexes(i,this.children_));const r=s.isEmpty()?Cs:this.priorityNode_;return new je(s,r,o)}}updateChild(n,t){const i=Ke(n);if(i===null)return t;{He(Ke(n)!==".priority"||di(n)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(vn(n),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const t={};let i=0,s=0,o=!0;if(this.forEachChild(Hn,(r,a)=>{t[r]=a.val(n),i++,o&&je.INTEGER_REGEXP_.test(r)?s=Math.max(s,Number(r)):o=!1}),!n&&o&&s<2*i){const r=[];for(const a in t)r[a]=t[a];return r}else return n&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+Om(this.getPriority().val())+":"),this.forEachChild(Hn,(t,i)=>{const s=i.hash();s!==""&&(n+=":"+t+":"+s)}),this.lazyHash_=n===""?"":mm(n)}return this.lazyHash_}getPredecessorChildName(n,t,i){const s=this.resolveIndex_(i);if(s){const o=s.getPredecessorKey(new Ze(n,t));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){const t=this.resolveIndex_(n);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(n){const t=this.getFirstChildName(n);return t?new Ze(t,this.children_.get(t)):null}getLastChildName(n){const t=this.resolveIndex_(n);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(n){const t=this.getLastChildName(n);return t?new Ze(t,this.children_.get(t)):null}forEachChild(n,t){const i=this.resolveIndex_(n);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(n,s=>s);{const s=this.children_.getIteratorFrom(n.name,Ze.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,n)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(n,s=>s);{const s=this.children_.getReverseIteratorFrom(n.name,Ze.Wrap);let o=s.peek();for(;o!=null&&t.compare(o,n)>0;)s.getNext(),o=s.peek();return s}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===po?-1:0}withIndex(n){if(n===Yi||this.indexMap_.hasIndex(n))return this;{const t=this.indexMap_.addIndex(n,this.children_);return new je(this.children_,this.priorityNode_,t)}}isIndexed(n){return n===Yi||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{const t=n;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(Hn),s=t.getIterator(Hn);let o=i.getNext(),r=s.getNext();for(;o&&r;){if(o.name!==r.name||!o.node.equals(r.node))return!1;o=i.getNext(),r=s.getNext()}return o===null&&r===null}else return!1;else return!1}}resolveIndex_(n){return n===Yi?null:this.indexMap_.get(n.toString())}}je.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Rv extends je{constructor(){super(new et(Nl),je.EMPTY_NODE,qt.Default)}compareTo(n){return n===this?0:1}equals(n){return n===this}getPriority(){return this}getImmediateChild(n){return je.EMPTY_NODE}isEmpty(){return!1}}const po=new Rv;Object.defineProperties(Ze,{MIN:{value:new Ze(is,je.EMPTY_NODE)},MAX:{value:new Ze(Ii,po)}});Lm.__EMPTY_NODE=je.EMPTY_NODE;Mn.__childrenNodeConstructor=je;Bv(po);Iv(po);const Nv=!0;function qn(e,n=null){if(e===null)return je.EMPTY_NODE;if(typeof e=="object"&&".priority"in e&&(n=e[".priority"]),He(n===null||typeof n=="string"||typeof n=="number"||typeof n=="object"&&".sv"in n,"Invalid priority type found: "+typeof n),typeof e=="object"&&".value"in e&&e[".value"]!==null&&(e=e[".value"]),typeof e!="object"||".sv"in e){const t=e;return new Mn(t,qn(n))}if(!(e instanceof Array)&&Nv){const t=[];let i=!1;if(tt(e,(r,a)=>{if(r.substring(0,1)!=="."){const l=qn(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new Ze(r,l)))}}),t.length===0)return je.EMPTY_NODE;const o=Qo(t,xv,r=>r.name,Nl);if(i){const r=Qo(t,Hn.getCompare());return new je(o,qn(n),new qt({".priority":r},{".priority":Hn}))}else return new je(o,qn(n),qt.Default)}else{let t=je.EMPTY_NODE;return tt(e,(i,s)=>{if(Jt(e,i)&&i.substring(0,1)!=="."){const o=qn(s);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(i,o))}}),t.updatePriority(qn(n))}}Sv(qn);class Mv extends xr{constructor(n){super(),this.indexPath_=n,He(!Xe(n)&&Ke(n)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(n){return n.getChild(this.indexPath_)}isDefinedOn(n){return!n.getChild(this.indexPath_).isEmpty()}compare(n,t){const i=this.extractChild(n.node),s=this.extractChild(t.node),o=i.compareTo(s);return o===0?us(n.name,t.name):o}makePost(n,t){const i=qn(n),s=je.EMPTY_NODE.updateChild(this.indexPath_,i);return new Ze(t,s)}maxPost(){const n=je.EMPTY_NODE.updateChild(this.indexPath_,po);return new Ze(Ii,n)}toString(){return Mm(this.indexPath_,0).join("/")}}class Dv extends xr{compare(n,t){const i=n.node.compareTo(t.node);return i===0?us(n.name,t.name):i}isDefinedOn(n){return!0}indexedValueChanged(n,t){return!n.equals(t)}minPost(){return Ze.MIN}maxPost(){return Ze.MAX}makePost(n,t){const i=qn(n);return new Ze(t,i)}toString(){return".value"}}const qv=new Dv;function Vm(e){return{type:"value",snapshotNode:e}}function ss(e,n){return{type:"child_added",snapshotNode:n,childName:e}}function Qs(e,n){return{type:"child_removed",snapshotNode:n,childName:e}}function Xs(e,n,t){return{type:"child_changed",snapshotNode:n,childName:e,oldSnap:t}}function Lv(e,n){return{type:"child_moved",snapshotNode:n,childName:e}}class Ml{constructor(n){this.index_=n}updateChild(n,t,i,s,o,r){He(n.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=n.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(r!=null&&(i.isEmpty()?n.hasChild(t)?r.trackChildChange(Qs(t,a)):He(n.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?r.trackChildChange(ss(t,i)):r.trackChildChange(Xs(t,i,a))),n.isLeafNode()&&i.isEmpty())?n:n.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(n,t,i){return i!=null&&(n.isLeafNode()||n.forEachChild(Hn,(s,o)=>{t.hasChild(s)||i.trackChildChange(Qs(s,o))}),t.isLeafNode()||t.forEachChild(Hn,(s,o)=>{if(n.hasChild(s)){const r=n.getImmediateChild(s);r.equals(o)||i.trackChildChange(Xs(s,o,r))}else i.trackChildChange(ss(s,o))})),t.withIndex(this.index_)}updatePriority(n,t){return n.isEmpty()?je.EMPTY_NODE:n.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class eo{constructor(n){this.indexedFilter_=new Ml(n.getIndex()),this.index_=n.getIndex(),this.startPost_=eo.getStartPost_(n),this.endPost_=eo.getEndPost_(n),this.startIsInclusive_=!n.startAfterSet_,this.endIsInclusive_=!n.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(n){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),n)<=0:this.index_.compare(this.getStartPost(),n)<0,i=this.endIsInclusive_?this.index_.compare(n,this.getEndPost())<=0:this.index_.compare(n,this.getEndPost())<0;return t&&i}updateChild(n,t,i,s,o,r){return this.matches(new Ze(t,i))||(i=je.EMPTY_NODE),this.indexedFilter_.updateChild(n,t,i,s,o,r)}updateFullNode(n,t,i){t.isLeafNode()&&(t=je.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(je.EMPTY_NODE);const o=this;return t.forEachChild(Hn,(r,a)=>{o.matches(new Ze(r,a))||(s=s.updateImmediateChild(r,je.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(n,s,i)}updatePriority(n,t){return n}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(n){if(n.hasStart()){const t=n.getIndexStartName();return n.getIndex().makePost(n.getIndexStartValue(),t)}else return n.getIndex().minPost()}static getEndPost_(n){if(n.hasEnd()){const t=n.getIndexEndName();return n.getIndex().makePost(n.getIndexEndValue(),t)}else return n.getIndex().maxPost()}}class Ov{constructor(n){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new eo(n),this.index_=n.getIndex(),this.limit_=n.getLimit(),this.reverse_=!n.isViewFromLeft(),this.startIsInclusive_=!n.startAfterSet_,this.endIsInclusive_=!n.endBeforeSet_}updateChild(n,t,i,s,o,r){return this.rangedFilter_.matches(new Ze(t,i))||(i=je.EMPTY_NODE),n.getImmediateChild(t).equals(i)?n:n.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(n,t,i,s,o,r):this.fullLimitUpdateChild_(n,t,i,o,r)}updateFullNode(n,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=je.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=je.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let r=0;for(;o.hasNext()&&r<this.limit_;){const a=o.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),r++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(je.EMPTY_NODE);let o;this.reverse_?o=s.getReverseIterator(this.index_):o=s.getIterator(this.index_);let r=0;for(;o.hasNext();){const a=o.getNext();r<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?r++:s=s.updateImmediateChild(a.name,je.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(n,s,i)}updatePriority(n,t){return n}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(n,t,i,s,o){let r;if(this.reverse_){const m=this.index_.getCompare();r=(h,v)=>m(v,h)}else r=this.index_.getCompare();const a=n;He(a.numChildren()===this.limit_,"");const l=new Ze(t,i),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),f=this.rangedFilter_.matches(l);if(a.hasChild(t)){const m=a.getImmediateChild(t);let h=s.getChildAfterChild(this.index_,u,this.reverse_);for(;h!=null&&(h.name===t||a.hasChild(h.name));)h=s.getChildAfterChild(this.index_,h,this.reverse_);const v=h==null?1:r(h,l);if(f&&!i.isEmpty()&&v>=0)return o?.trackChildChange(Xs(t,i,m)),a.updateImmediateChild(t,i);{o?.trackChildChange(Qs(t,m));const X=a.updateImmediateChild(t,je.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(o?.trackChildChange(ss(h.name,h.node)),X.updateImmediateChild(h.name,h.node)):X}}else return i.isEmpty()?n:f&&r(u,l)>=0?(o!=null&&(o.trackChildChange(Qs(u.name,u.node)),o.trackChildChange(ss(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(u.name,je.EMPTY_NODE)):n}}class Dl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Hn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return He(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return He(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:is}hasEnd(){return this.endSet_}getIndexEndValue(){return He(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return He(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ii}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return He(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Hn}copy(){const n=new Dl;return n.limitSet_=this.limitSet_,n.limit_=this.limit_,n.startSet_=this.startSet_,n.startAfterSet_=this.startAfterSet_,n.indexStartValue_=this.indexStartValue_,n.startNameSet_=this.startNameSet_,n.indexStartName_=this.indexStartName_,n.endSet_=this.endSet_,n.endBeforeSet_=this.endBeforeSet_,n.indexEndValue_=this.indexEndValue_,n.endNameSet_=this.endNameSet_,n.indexEndName_=this.indexEndName_,n.index_=this.index_,n.viewFrom_=this.viewFrom_,n}}function Uv(e){return e.loadsAllData()?new Ml(e.getIndex()):e.hasLimit()?new Ov(e):new eo(e)}function Iu(e){const n={};if(e.isDefault())return n;let t;if(e.index_===Hn?t="$priority":e.index_===qv?t="$value":e.index_===Yi?t="$key":(He(e.index_ instanceof Mv,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=En(t),e.startSet_){const i=e.startAfterSet_?"startAfter":"startAt";n[i]=En(e.indexStartValue_),e.startNameSet_&&(n[i]+=","+En(e.indexStartName_))}if(e.endSet_){const i=e.endBeforeSet_?"endBefore":"endAt";n[i]=En(e.indexEndValue_),e.endNameSet_&&(n[i]+=","+En(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function ku(e){const n={};if(e.startSet_&&(n.sp=e.indexStartValue_,e.startNameSet_&&(n.sn=e.indexStartName_),n.sin=!e.startAfterSet_),e.endSet_&&(n.ep=e.indexEndValue_,e.endNameSet_&&(n.en=e.indexEndName_),n.ein=!e.endBeforeSet_),e.limitSet_){n.l=e.limit_;let t=e.viewFrom_;t===""&&(e.isViewFromLeft()?t="l":t="r"),n.vf=t}return e.index_!==Hn&&(n.i=e.index_.toString()),n}class Xo extends Tm{reportStats(n){throw new Error("Method not implemented.")}static getListenId_(n,t){return t!==void 0?"tag$"+t:(He(n._queryParams.isDefault(),"should have a tag if it's not a default query."),n._path.toString())}constructor(n,t,i,s){super(),this.repoInfo_=n,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=ho("p:rest:"),this.listens_={}}listen(n,t,i,s){const o=n._path.toString();this.log_("Listen called for "+o+" "+n._queryIdentifier);const r=Xo.getListenId_(n,i),a={};this.listens_[r]=a;const l=Iu(n._queryParams);this.restRequest_(o+".json",l,(u,f)=>{let m=f;if(u===404&&(m=null,u=null),u===null&&this.onDataUpdate_(o,m,!1,i),ns(this.listens_,r)===a){let h;u?u===401?h="permission_denied":h="rest_error:"+u:h="ok",s(h,null)}})}unlisten(n,t){const i=Xo.getListenId_(n,t);delete this.listens_[i]}get(n){const t=Iu(n._queryParams),i=n._path.toString(),s=new Pr;return this.restRequest_(i+".json",t,(o,r)=>{let a=r;o===404&&(a=null,o=null),o===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(n){}restRequest_(n,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,o])=>{s&&s.accessToken&&(t.auth=s.accessToken),o&&o.token&&(t.ac=o.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+n+"?ns="+this.repoInfo_.namespace+fy(t);this.log_("Sending REST request for "+r);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+r+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Js(a.responseText)}catch{nt("Failed to parse JSON response for "+r+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&nt("Got unsuccessful REST response for "+r+" Status: "+a.status),i(a.status);i=null}},a.open("GET",r,!0),a.send()})}}class jv{constructor(){this.rootNode_=je.EMPTY_NODE}getNode(n){return this.rootNode_.getChild(n)}updateSnapshot(n,t){this.rootNode_=this.rootNode_.updateChild(n,t)}}function er(){return{value:null,children:new Map}}function Wm(e,n,t){if(Xe(n))e.value=t,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(n,t);else{const i=Ke(n);e.children.has(i)||e.children.set(i,er());const s=e.children.get(i);n=vn(n),Wm(s,n,t)}}function Ya(e,n,t){e.value!==null?t(n,e.value):Fv(e,(i,s)=>{const o=new pn(n.toString()+"/"+i);Ya(s,o,t)})}function Fv(e,n){e.children.forEach((t,i)=>{n(i,t)})}class Vv{constructor(n){this.collection_=n,this.last_=null}get(){const n=this.collection_.get(),t={...n};return this.last_&&tt(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=n,t}}const Eu=10*1e3,Wv=30*1e3,zv=300*1e3;class Gv{constructor(n,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Vv(n);const i=Eu+(Wv-Eu)*Math.random();Ms(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const n=this.statsListener_.get(),t={};let i=!1;tt(n,(s,o)=>{o>0&&Jt(this.statsToReport_,s)&&(t[s]=o,i=!0)}),i&&this.server_.reportStats(t),Ms(this.reportStats_.bind(this),Math.floor(Math.random()*2*zv))}}var ht;(function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ht||(ht={}));function zm(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ql(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Ll(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}class nr{constructor(n,t,i){this.path=n,this.affectedTree=t,this.revert=i,this.type=ht.ACK_USER_WRITE,this.source=zm()}operationForChild(n){if(Xe(this.path)){if(this.affectedTree.value!=null)return He(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new pn(n));return new nr(ln(),t,this.revert)}}else return He(Ke(this.path)===n,"operationForChild called for unrelated child."),new nr(vn(this.path),this.affectedTree,this.revert)}}class no{constructor(n,t){this.source=n,this.path=t,this.type=ht.LISTEN_COMPLETE}operationForChild(n){return Xe(this.path)?new no(this.source,ln()):new no(this.source,vn(this.path))}}class ki{constructor(n,t,i){this.source=n,this.path=t,this.snap=i,this.type=ht.OVERWRITE}operationForChild(n){return Xe(this.path)?new ki(this.source,ln(),this.snap.getImmediateChild(n)):new ki(this.source,vn(this.path),this.snap)}}class to{constructor(n,t,i){this.source=n,this.path=t,this.children=i,this.type=ht.MERGE}operationForChild(n){if(Xe(this.path)){const t=this.children.subtree(new pn(n));return t.isEmpty()?null:t.value?new ki(this.source,ln(),t.value):new to(this.source,ln(),t)}else return He(Ke(this.path)===n,"Can't get a merge for a child not on the path of the operation"),new to(this.source,vn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class fi{constructor(n,t,i){this.node_=n,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(n){if(Xe(n))return this.isFullyInitialized()&&!this.filtered_;const t=Ke(n);return this.isCompleteForChild(t)}isCompleteForChild(n){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(n)}getNode(){return this.node_}}class Jv{constructor(n){this.query_=n,this.index_=this.query_._queryParams.getIndex()}}function Yv(e,n,t,i){const s=[],o=[];return n.forEach(r=>{r.type==="child_changed"&&e.index_.indexedValueChanged(r.oldSnap,r.snapshotNode)&&o.push(Lv(r.childName,r.snapshotNode))}),vs(e,s,"child_removed",n,i,t),vs(e,s,"child_added",n,i,t),vs(e,s,"child_moved",o,i,t),vs(e,s,"child_changed",n,i,t),vs(e,s,"value",n,i,t),s}function vs(e,n,t,i,s,o){const r=i.filter(a=>a.type===t);r.sort((a,l)=>Zv(e,a,l)),r.forEach(a=>{const l=Kv(e,a,o);s.forEach(u=>{u.respondsTo(a.type)&&n.push(u.createEvent(l,e.query_))})})}function Kv(e,n,t){return n.type==="value"||n.type==="child_removed"||(n.prevName=t.getPredecessorChildName(n.childName,n.snapshotNode,e.index_)),n}function Zv(e,n,t){if(n.childName==null||t.childName==null)throw ls("Should only compare child_ events.");const i=new Ze(n.childName,n.snapshotNode),s=new Ze(t.childName,t.snapshotNode);return e.index_.compare(i,s)}function Br(e,n){return{eventCache:e,serverCache:n}}function Ds(e,n,t,i){return Br(new fi(n,t,i),e.serverCache)}function Gm(e,n,t,i){return Br(e.eventCache,new fi(n,t,i))}function tr(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Ei(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let va;const Qv=()=>(va||(va=new et(DC)),va);class $n{static fromObject(n){let t=new $n(null);return tt(n,(i,s)=>{t=t.set(new pn(i),s)}),t}constructor(n,t=Qv()){this.value=n,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(n,t){if(this.value!=null&&t(this.value))return{path:ln(),value:this.value};if(Xe(n))return null;{const i=Ke(n),s=this.children.get(i);if(s!==null){const o=s.findRootMostMatchingPathAndValue(vn(n),t);return o!=null?{path:Tn(new pn(i),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(n){return this.findRootMostMatchingPathAndValue(n,()=>!0)}subtree(n){if(Xe(n))return this;{const t=Ke(n),i=this.children.get(t);return i!==null?i.subtree(vn(n)):new $n(null)}}set(n,t){if(Xe(n))return new $n(t,this.children);{const i=Ke(n),o=(this.children.get(i)||new $n(null)).set(vn(n),t),r=this.children.insert(i,o);return new $n(this.value,r)}}remove(n){if(Xe(n))return this.children.isEmpty()?new $n(null):new $n(null,this.children);{const t=Ke(n),i=this.children.get(t);if(i){const s=i.remove(vn(n));let o;return s.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,s),this.value===null&&o.isEmpty()?new $n(null):new $n(this.value,o)}else return this}}get(n){if(Xe(n))return this.value;{const t=Ke(n),i=this.children.get(t);return i?i.get(vn(n)):null}}setTree(n,t){if(Xe(n))return t;{const i=Ke(n),o=(this.children.get(i)||new $n(null)).setTree(vn(n),t);let r;return o.isEmpty()?r=this.children.remove(i):r=this.children.insert(i,o),new $n(this.value,r)}}fold(n){return this.fold_(ln(),n)}fold_(n,t){const i={};return this.children.inorderTraversal((s,o)=>{i[s]=o.fold_(Tn(n,s),t)}),t(n,this.value,i)}findOnPath(n,t){return this.findOnPath_(n,ln(),t)}findOnPath_(n,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(Xe(n))return null;{const o=Ke(n),r=this.children.get(o);return r?r.findOnPath_(vn(n),Tn(t,o),i):null}}foreachOnPath(n,t){return this.foreachOnPath_(n,ln(),t)}foreachOnPath_(n,t,i){if(Xe(n))return this;{this.value&&i(t,this.value);const s=Ke(n),o=this.children.get(s);return o?o.foreachOnPath_(vn(n),Tn(t,s),i):new $n(null)}}foreach(n){this.foreach_(ln(),n)}foreach_(n,t){this.children.inorderTraversal((i,s)=>{s.foreach_(Tn(n,i),t)}),this.value&&t(n,this.value)}foreachChild(n){this.children.inorderTraversal((t,i)=>{i.value&&n(t,i.value)})}}class gt{constructor(n){this.writeTree_=n}static empty(){return new gt(new $n(null))}}function qs(e,n,t){if(Xe(n))return new gt(new $n(t));{const i=e.writeTree_.findRootMostValueAndPath(n);if(i!=null){const s=i.path;let o=i.value;const r=Qn(s,n);return o=o.updateChild(r,t),new gt(e.writeTree_.set(s,o))}else{const s=new $n(t),o=e.writeTree_.setTree(n,s);return new gt(o)}}}function Tu(e,n,t){let i=e;return tt(t,(s,o)=>{i=qs(i,Tn(n,s),o)}),i}function Ru(e,n){if(Xe(n))return gt.empty();{const t=e.writeTree_.setTree(n,new $n(null));return new gt(t)}}function Ka(e,n){return Ti(e,n)!=null}function Ti(e,n){const t=e.writeTree_.findRootMostValueAndPath(n);return t!=null?e.writeTree_.get(t.path).getChild(Qn(t.path,n)):null}function Nu(e){const n=[],t=e.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Hn,(i,s)=>{n.push(new Ze(i,s))}):e.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&n.push(new Ze(i,s.value))}),n}function li(e,n){if(Xe(n))return e;{const t=Ti(e,n);return t!=null?new gt(new $n(t)):new gt(e.writeTree_.subtree(n))}}function Za(e){return e.writeTree_.isEmpty()}function os(e,n){return Jm(ln(),e.writeTree_,n)}function Jm(e,n,t){if(n.value!=null)return t.updateChild(e,n.value);{let i=null;return n.children.inorderTraversal((s,o)=>{s===".priority"?(He(o.value!==null,"Priority writes must always be leaf nodes"),i=o.value):t=Jm(Tn(e,s),o,t)}),!t.getChild(e).isEmpty()&&i!==null&&(t=t.updateChild(Tn(e,".priority"),i)),t}}function Sr(e,n){return Qm(n,e)}function Xv(e,n,t,i,s){He(i>e.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),e.allWrites.push({path:n,snap:t,writeId:i,visible:s}),s&&(e.visibleWrites=qs(e.visibleWrites,n,t)),e.lastWriteId=i}function e1(e,n){for(let t=0;t<e.allWrites.length;t++){const i=e.allWrites[t];if(i.writeId===n)return i}return null}function n1(e,n){const t=e.allWrites.findIndex(a=>a.writeId===n);He(t>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[t];e.allWrites.splice(t,1);let s=i.visible,o=!1,r=e.allWrites.length-1;for(;s&&r>=0;){const a=e.allWrites[r];a.visible&&(r>=t&&t1(a,i.path)?s=!1:mt(i.path,a.path)&&(o=!0)),r--}if(s){if(o)return i1(e),!0;if(i.snap)e.visibleWrites=Ru(e.visibleWrites,i.path);else{const a=i.children;tt(a,l=>{e.visibleWrites=Ru(e.visibleWrites,Tn(i.path,l))})}return!0}else return!1}function t1(e,n){if(e.snap)return mt(e.path,n);for(const t in e.children)if(e.children.hasOwnProperty(t)&&mt(Tn(e.path,t),n))return!0;return!1}function i1(e){e.visibleWrites=Ym(e.allWrites,s1,ln()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function s1(e){return e.visible}function Ym(e,n,t){let i=gt.empty();for(let s=0;s<e.length;++s){const o=e[s];if(n(o)){const r=o.path;let a;if(o.snap)mt(t,r)?(a=Qn(t,r),i=qs(i,a,o.snap)):mt(r,t)&&(a=Qn(r,t),i=qs(i,ln(),o.snap.getChild(a)));else if(o.children){if(mt(t,r))a=Qn(t,r),i=Tu(i,a,o.children);else if(mt(r,t))if(a=Qn(r,t),Xe(a))i=Tu(i,ln(),o.children);else{const l=ns(o.children,Ke(a));if(l){const u=l.getChild(vn(a));i=qs(i,ln(),u)}}}else throw ls("WriteRecord should have .snap or .children")}}return i}function Km(e,n,t,i,s){if(!i&&!s){const o=Ti(e.visibleWrites,n);if(o!=null)return o;{const r=li(e.visibleWrites,n);if(Za(r))return t;if(t==null&&!Ka(r,ln()))return null;{const a=t||je.EMPTY_NODE;return os(r,a)}}}else{const o=li(e.visibleWrites,n);if(!s&&Za(o))return t;if(!s&&t==null&&!Ka(o,ln()))return null;{const r=function(u){return(u.visible||s)&&(!i||!~i.indexOf(u.writeId))&&(mt(u.path,n)||mt(n,u.path))},a=Ym(e.allWrites,r,n),l=t||je.EMPTY_NODE;return os(a,l)}}}function o1(e,n,t){let i=je.EMPTY_NODE;const s=Ti(e.visibleWrites,n);if(s)return s.isLeafNode()||s.forEachChild(Hn,(o,r)=>{i=i.updateImmediateChild(o,r)}),i;if(t){const o=li(e.visibleWrites,n);return t.forEachChild(Hn,(r,a)=>{const l=os(li(o,new pn(r)),a);i=i.updateImmediateChild(r,l)}),Nu(o).forEach(r=>{i=i.updateImmediateChild(r.name,r.node)}),i}else{const o=li(e.visibleWrites,n);return Nu(o).forEach(r=>{i=i.updateImmediateChild(r.name,r.node)}),i}}function r1(e,n,t,i,s){He(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=Tn(n,t);if(Ka(e.visibleWrites,o))return null;{const r=li(e.visibleWrites,o);return Za(r)?s.getChild(t):os(r,s.getChild(t))}}function a1(e,n,t,i){const s=Tn(n,t),o=Ti(e.visibleWrites,s);if(o!=null)return o;if(i.isCompleteForChild(t)){const r=li(e.visibleWrites,s);return os(r,i.getNode().getImmediateChild(t))}else return null}function l1(e,n){return Ti(e.visibleWrites,n)}function c1(e,n,t,i,s,o,r){let a;const l=li(e.visibleWrites,n),u=Ti(l,ln());if(u!=null)a=u;else if(t!=null)a=os(l,t);else return[];if(a=a.withIndex(r),!a.isEmpty()&&!a.isLeafNode()){const f=[],m=r.getCompare(),h=o?a.getReverseIteratorFrom(i,r):a.getIteratorFrom(i,r);let v=h.getNext();for(;v&&f.length<s;)m(v,i)!==0&&f.push(v),v=h.getNext();return f}else return[]}function u1(){return{visibleWrites:gt.empty(),allWrites:[],lastWriteId:-1}}function ir(e,n,t,i){return Km(e.writeTree,e.treePath,n,t,i)}function Ol(e,n){return o1(e.writeTree,e.treePath,n)}function Mu(e,n,t,i){return r1(e.writeTree,e.treePath,n,t,i)}function sr(e,n){return l1(e.writeTree,Tn(e.treePath,n))}function d1(e,n,t,i,s,o){return c1(e.writeTree,e.treePath,n,t,i,s,o)}function Ul(e,n,t){return a1(e.writeTree,e.treePath,n,t)}function Zm(e,n){return Qm(Tn(e.treePath,n),e.writeTree)}function Qm(e,n){return{treePath:e,writeTree:n}}class f1{constructor(){this.changeMap=new Map}trackChildChange(n){const t=n.type,i=n.childName;He(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),He(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const o=s.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(i,Xs(i,n.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(i,Qs(i,s.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(i,ss(i,n.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(i,Xs(i,n.snapshotNode,s.oldSnap));else throw ls("Illegal combination of changes: "+n+" occurred after "+s)}else this.changeMap.set(i,n)}getChanges(){return Array.from(this.changeMap.values())}}class m1{getCompleteChild(n){return null}getChildAfterChild(n,t,i){return null}}const Xm=new m1;class jl{constructor(n,t,i=null){this.writes_=n,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(n){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(n))return t.getNode().getImmediateChild(n);{const i=this.optCompleteServerCache_!=null?new fi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ul(this.writes_,n,i)}}getChildAfterChild(n,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ei(this.viewCache_),o=d1(this.writes_,s,t,1,i,n);return o.length===0?null:o[0]}}function h1(e){return{filter:e}}function p1(e,n){He(n.eventCache.getNode().isIndexed(e.filter.getIndex()),"Event snap not indexed"),He(n.serverCache.getNode().isIndexed(e.filter.getIndex()),"Server snap not indexed")}function g1(e,n,t,i,s){const o=new f1;let r,a;if(t.type===ht.OVERWRITE){const u=t;u.source.fromUser?r=Qa(e,n,u.path,u.snap,i,s,o):(He(u.source.fromServer,"Unknown source."),a=u.source.tagged||n.serverCache.isFiltered()&&!Xe(u.path),r=or(e,n,u.path,u.snap,i,s,a,o))}else if(t.type===ht.MERGE){const u=t;u.source.fromUser?r=C1(e,n,u.path,u.children,i,s,o):(He(u.source.fromServer,"Unknown source."),a=u.source.tagged||n.serverCache.isFiltered(),r=Xa(e,n,u.path,u.children,i,s,a,o))}else if(t.type===ht.ACK_USER_WRITE){const u=t;u.revert?r=$1(e,n,u.path,i,s,o):r=v1(e,n,u.path,u.affectedTree,i,s,o)}else if(t.type===ht.LISTEN_COMPLETE)r=_1(e,n,t.path,i,o);else throw ls("Unknown operation type: "+t.type);const l=o.getChanges();return y1(n,r,l),{viewCache:r,changes:l}}function y1(e,n,t){const i=n.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),o=tr(e);(t.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(o)||!i.getNode().getPriority().equals(o.getPriority()))&&t.push(Vm(tr(n)))}}function eh(e,n,t,i,s,o){const r=n.eventCache;if(sr(i,t)!=null)return n;{let a,l;if(Xe(t))if(He(n.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),n.serverCache.isFiltered()){const u=Ei(n),f=u instanceof je?u:je.EMPTY_NODE,m=Ol(i,f);a=e.filter.updateFullNode(n.eventCache.getNode(),m,o)}else{const u=ir(i,Ei(n));a=e.filter.updateFullNode(n.eventCache.getNode(),u,o)}else{const u=Ke(t);if(u===".priority"){He(di(t)===1,"Can't have a priority with additional path components");const f=r.getNode();l=n.serverCache.getNode();const m=Mu(i,t,f,l);m!=null?a=e.filter.updatePriority(f,m):a=r.getNode()}else{const f=vn(t);let m;if(r.isCompleteForChild(u)){l=n.serverCache.getNode();const h=Mu(i,t,r.getNode(),l);h!=null?m=r.getNode().getImmediateChild(u).updateChild(f,h):m=r.getNode().getImmediateChild(u)}else m=Ul(i,u,n.serverCache);m!=null?a=e.filter.updateChild(r.getNode(),u,m,f,s,o):a=r.getNode()}}return Ds(n,a,r.isFullyInitialized()||Xe(t),e.filter.filtersNodes())}}function or(e,n,t,i,s,o,r,a){const l=n.serverCache;let u;const f=r?e.filter:e.filter.getIndexedFilter();if(Xe(t))u=f.updateFullNode(l.getNode(),i,null);else if(f.filtersNodes()&&!l.isFiltered()){const v=l.getNode().updateChild(t,i);u=f.updateFullNode(l.getNode(),v,null)}else{const v=Ke(t);if(!l.isCompleteForPath(t)&&di(t)>1)return n;const S=vn(t),ae=l.getNode().getImmediateChild(v).updateChild(S,i);v===".priority"?u=f.updatePriority(l.getNode(),ae):u=f.updateChild(l.getNode(),v,ae,S,Xm,null)}const m=Gm(n,u,l.isFullyInitialized()||Xe(t),f.filtersNodes()),h=new jl(s,m,o);return eh(e,m,t,s,h,a)}function Qa(e,n,t,i,s,o,r){const a=n.eventCache;let l,u;const f=new jl(s,n,o);if(Xe(t))u=e.filter.updateFullNode(n.eventCache.getNode(),i,r),l=Ds(n,u,!0,e.filter.filtersNodes());else{const m=Ke(t);if(m===".priority")u=e.filter.updatePriority(n.eventCache.getNode(),i),l=Ds(n,u,a.isFullyInitialized(),a.isFiltered());else{const h=vn(t),v=a.getNode().getImmediateChild(m);let S;if(Xe(h))S=i;else{const X=f.getCompleteChild(m);X!=null?Nm(h)===".priority"&&X.getChild(Dm(h)).isEmpty()?S=X:S=X.updateChild(h,i):S=je.EMPTY_NODE}if(v.equals(S))l=n;else{const X=e.filter.updateChild(a.getNode(),m,S,h,f,r);l=Ds(n,X,a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Du(e,n){return e.eventCache.isCompleteForChild(n)}function C1(e,n,t,i,s,o,r){let a=n;return i.foreach((l,u)=>{const f=Tn(t,l);Du(n,Ke(f))&&(a=Qa(e,a,f,u,s,o,r))}),i.foreach((l,u)=>{const f=Tn(t,l);Du(n,Ke(f))||(a=Qa(e,a,f,u,s,o,r))}),a}function qu(e,n,t){return t.foreach((i,s)=>{n=n.updateChild(i,s)}),n}function Xa(e,n,t,i,s,o,r,a){if(n.serverCache.getNode().isEmpty()&&!n.serverCache.isFullyInitialized())return n;let l=n,u;Xe(t)?u=i:u=new $n(null).setTree(t,i);const f=n.serverCache.getNode();return u.children.inorderTraversal((m,h)=>{if(f.hasChild(m)){const v=n.serverCache.getNode().getImmediateChild(m),S=qu(e,v,h);l=or(e,l,new pn(m),S,s,o,r,a)}}),u.children.inorderTraversal((m,h)=>{const v=!n.serverCache.isCompleteForChild(m)&&h.value===null;if(!f.hasChild(m)&&!v){const S=n.serverCache.getNode().getImmediateChild(m),X=qu(e,S,h);l=or(e,l,new pn(m),X,s,o,r,a)}}),l}function v1(e,n,t,i,s,o,r){if(sr(s,t)!=null)return n;const a=n.serverCache.isFiltered(),l=n.serverCache;if(i.value!=null){if(Xe(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return or(e,n,t,l.getNode().getChild(t),s,o,a,r);if(Xe(t)){let u=new $n(null);return l.getNode().forEachChild(Yi,(f,m)=>{u=u.set(new pn(f),m)}),Xa(e,n,t,u,s,o,a,r)}else return n}else{let u=new $n(null);return i.foreach((f,m)=>{const h=Tn(t,f);l.isCompleteForPath(h)&&(u=u.set(f,l.getNode().getChild(h)))}),Xa(e,n,t,u,s,o,a,r)}}function _1(e,n,t,i,s){const o=n.serverCache,r=Gm(n,o.getNode(),o.isFullyInitialized()||Xe(t),o.isFiltered());return eh(e,r,t,i,Xm,s)}function $1(e,n,t,i,s,o){let r;if(sr(i,t)!=null)return n;{const a=new jl(i,n,s),l=n.eventCache.getNode();let u;if(Xe(t)||Ke(t)===".priority"){let f;if(n.serverCache.isFullyInitialized())f=ir(i,Ei(n));else{const m=n.serverCache.getNode();He(m instanceof je,"serverChildren would be complete if leaf node"),f=Ol(i,m)}f=f,u=e.filter.updateFullNode(l,f,o)}else{const f=Ke(t);let m=Ul(i,f,n.serverCache);m==null&&n.serverCache.isCompleteForChild(f)&&(m=l.getImmediateChild(f)),m!=null?u=e.filter.updateChild(l,f,m,vn(t),a,o):n.eventCache.getNode().hasChild(f)?u=e.filter.updateChild(l,f,je.EMPTY_NODE,vn(t),a,o):u=l,u.isEmpty()&&n.serverCache.isFullyInitialized()&&(r=ir(i,Ei(n)),r.isLeafNode()&&(u=e.filter.updateFullNode(u,r,o)))}return r=n.serverCache.isFullyInitialized()||sr(i,ln())!=null,Ds(n,u,r,e.filter.filtersNodes())}}class w1{constructor(n,t){this.query_=n,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Ml(i.getIndex()),o=Uv(i);this.processor_=h1(o);const r=t.serverCache,a=t.eventCache,l=s.updateFullNode(je.EMPTY_NODE,r.getNode(),null),u=o.updateFullNode(je.EMPTY_NODE,a.getNode(),null),f=new fi(l,r.isFullyInitialized(),s.filtersNodes()),m=new fi(u,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=Br(m,f),this.eventGenerator_=new Jv(this.query_)}get query(){return this.query_}}function b1(e){return e.viewCache_.serverCache.getNode()}function A1(e){return tr(e.viewCache_)}function P1(e,n){const t=Ei(e.viewCache_);return t&&(e.query._queryParams.loadsAllData()||!Xe(n)&&!t.getImmediateChild(Ke(n)).isEmpty())?t.getChild(n):null}function Lu(e){return e.eventRegistrations_.length===0}function H1(e,n){e.eventRegistrations_.push(n)}function Ou(e,n,t){const i=[];if(t){He(n==null,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach(o=>{const r=o.createCancelEvent(t,s);r&&i.push(r)})}if(n){let s=[];for(let o=0;o<e.eventRegistrations_.length;++o){const r=e.eventRegistrations_[o];if(!r.matches(n))s.push(r);else if(n.hasAnyCallback()){s=s.concat(e.eventRegistrations_.slice(o+1));break}}e.eventRegistrations_=s}else e.eventRegistrations_=[];return i}function Uu(e,n,t,i){n.type===ht.MERGE&&n.source.queryId!==null&&(He(Ei(e.viewCache_),"We should always have a full cache before handling merges"),He(tr(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,o=g1(e.processor_,s,n,t,i);return p1(e.processor_,o.viewCache),He(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,nh(e,o.changes,o.viewCache.eventCache.getNode(),null)}function x1(e,n){const t=e.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(Hn,(o,r)=>{i.push(ss(o,r))}),t.isFullyInitialized()&&i.push(Vm(t.getNode())),nh(e,i,t.getNode(),n)}function nh(e,n,t,i){const s=i?[i]:e.eventRegistrations_;return Yv(e.eventGenerator_,n,t,s)}let rr;class th{constructor(){this.views=new Map}}function B1(e){He(!rr,"__referenceConstructor has already been defined"),rr=e}function S1(){return He(rr,"Reference.ts has not been loaded"),rr}function I1(e){return e.views.size===0}function Fl(e,n,t,i){const s=n.source.queryId;if(s!==null){const o=e.views.get(s);return He(o!=null,"SyncTree gave us an op for an invalid query."),Uu(o,n,t,i)}else{let o=[];for(const r of e.views.values())o=o.concat(Uu(r,n,t,i));return o}}function ih(e,n,t,i,s){const o=n._queryIdentifier,r=e.views.get(o);if(!r){let a=ir(t,s?i:null),l=!1;a?l=!0:i instanceof je?(a=Ol(t,i),l=!1):(a=je.EMPTY_NODE,l=!1);const u=Br(new fi(a,l,!1),new fi(i,s,!1));return new w1(n,u)}return r}function k1(e,n,t,i,s,o){const r=ih(e,n,i,s,o);return e.views.has(n._queryIdentifier)||e.views.set(n._queryIdentifier,r),H1(r,t),x1(r,t)}function E1(e,n,t,i){const s=n._queryIdentifier,o=[];let r=[];const a=mi(e);if(s==="default")for(const[l,u]of e.views.entries())r=r.concat(Ou(u,t,i)),Lu(u)&&(e.views.delete(l),u.query._queryParams.loadsAllData()||o.push(u.query));else{const l=e.views.get(s);l&&(r=r.concat(Ou(l,t,i)),Lu(l)&&(e.views.delete(s),l.query._queryParams.loadsAllData()||o.push(l.query)))}return a&&!mi(e)&&o.push(new(S1())(n._repo,n._path)),{removed:o,events:r}}function sh(e){const n=[];for(const t of e.views.values())t.query._queryParams.loadsAllData()||n.push(t);return n}function ci(e,n){let t=null;for(const i of e.views.values())t=t||P1(i,n);return t}function oh(e,n){if(n._queryParams.loadsAllData())return Ir(e);{const i=n._queryIdentifier;return e.views.get(i)}}function rh(e,n){return oh(e,n)!=null}function mi(e){return Ir(e)!=null}function Ir(e){for(const n of e.views.values())if(n.query._queryParams.loadsAllData())return n;return null}let ar;function T1(e){He(!ar,"__referenceConstructor has already been defined"),ar=e}function R1(){return He(ar,"Reference.ts has not been loaded"),ar}let N1=1;class ju{constructor(n){this.listenProvider_=n,this.syncPointTree_=new $n(null),this.pendingWriteTree_=u1(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ah(e,n,t,i,s){return Xv(e.pendingWriteTree_,n,t,i,s),s?yo(e,new ki(zm(),n,t)):[]}function Pi(e,n,t=!1){const i=e1(e.pendingWriteTree_,n);if(n1(e.pendingWriteTree_,n)){let o=new $n(null);return i.snap!=null?o=o.set(ln(),!0):tt(i.children,r=>{o=o.set(new pn(r),!0)}),yo(e,new nr(i.path,o,t))}else return[]}function go(e,n,t){return yo(e,new ki(ql(),n,t))}function M1(e,n,t){const i=$n.fromObject(t);return yo(e,new to(ql(),n,i))}function D1(e,n){return yo(e,new no(ql(),n))}function q1(e,n,t){const i=Wl(e,t);if(i){const s=zl(i),o=s.path,r=s.queryId,a=Qn(o,n),l=new no(Ll(r),a);return Gl(e,o,l)}else return[]}function lr(e,n,t,i,s=!1){const o=n._path,r=e.syncPointTree_.get(o);let a=[];if(r&&(n._queryIdentifier==="default"||rh(r,n))){const l=E1(r,n,t,i);I1(r)&&(e.syncPointTree_=e.syncPointTree_.remove(o));const u=l.removed;if(a=l.events,!s){const f=u.findIndex(h=>h._queryParams.loadsAllData())!==-1,m=e.syncPointTree_.findOnPath(o,(h,v)=>mi(v));if(f&&!m){const h=e.syncPointTree_.subtree(o);if(!h.isEmpty()){const v=U1(h);for(let S=0;S<v.length;++S){const X=v[S],ae=X.query,fe=dh(e,X);e.listenProvider_.startListening(Ls(ae),io(e,ae),fe.hashFn,fe.onComplete)}}}!m&&u.length>0&&!i&&(f?e.listenProvider_.stopListening(Ls(n),null):u.forEach(h=>{const v=e.queryToTagMap.get(kr(h));e.listenProvider_.stopListening(Ls(h),v)}))}j1(e,u)}return a}function lh(e,n,t,i){const s=Wl(e,i);if(s!=null){const o=zl(s),r=o.path,a=o.queryId,l=Qn(r,n),u=new ki(Ll(a),l,t);return Gl(e,r,u)}else return[]}function L1(e,n,t,i){const s=Wl(e,i);if(s){const o=zl(s),r=o.path,a=o.queryId,l=Qn(r,n),u=$n.fromObject(t),f=new to(Ll(a),l,u);return Gl(e,r,f)}else return[]}function el(e,n,t,i=!1){const s=n._path;let o=null,r=!1;e.syncPointTree_.foreachOnPath(s,(h,v)=>{const S=Qn(h,s);o=o||ci(v,S),r=r||mi(v)});let a=e.syncPointTree_.get(s);a?(r=r||mi(a),o=o||ci(a,ln())):(a=new th,e.syncPointTree_=e.syncPointTree_.set(s,a));let l;o!=null?l=!0:(l=!1,o=je.EMPTY_NODE,e.syncPointTree_.subtree(s).foreachChild((v,S)=>{const X=ci(S,ln());X&&(o=o.updateImmediateChild(v,X))}));const u=rh(a,n);if(!u&&!n._queryParams.loadsAllData()){const h=kr(n);He(!e.queryToTagMap.has(h),"View does not exist, but we have a tag");const v=F1();e.queryToTagMap.set(h,v),e.tagToQueryMap.set(v,h)}const f=Sr(e.pendingWriteTree_,s);let m=k1(a,n,t,f,o,l);if(!u&&!r&&!i){const h=oh(a,n);m=m.concat(V1(e,n,h))}return m}function Vl(e,n,t){const s=e.pendingWriteTree_,o=e.syncPointTree_.findOnPath(n,(r,a)=>{const l=Qn(r,n),u=ci(a,l);if(u)return u});return Km(s,n,o,t,!0)}function O1(e,n){const t=n._path;let i=null;e.syncPointTree_.foreachOnPath(t,(u,f)=>{const m=Qn(u,t);i=i||ci(f,m)});let s=e.syncPointTree_.get(t);s?i=i||ci(s,ln()):(s=new th,e.syncPointTree_=e.syncPointTree_.set(t,s));const o=i!=null,r=o?new fi(i,!0,!1):null,a=Sr(e.pendingWriteTree_,n._path),l=ih(s,n,a,o?r.getNode():je.EMPTY_NODE,o);return A1(l)}function yo(e,n){return ch(n,e.syncPointTree_,null,Sr(e.pendingWriteTree_,ln()))}function ch(e,n,t,i){if(Xe(e.path))return uh(e,n,t,i);{const s=n.get(ln());t==null&&s!=null&&(t=ci(s,ln()));let o=[];const r=Ke(e.path),a=e.operationForChild(r),l=n.children.get(r);if(l&&a){const u=t?t.getImmediateChild(r):null,f=Zm(i,r);o=o.concat(ch(a,l,u,f))}return s&&(o=o.concat(Fl(s,e,i,t))),o}}function uh(e,n,t,i){const s=n.get(ln());t==null&&s!=null&&(t=ci(s,ln()));let o=[];return n.children.inorderTraversal((r,a)=>{const l=t?t.getImmediateChild(r):null,u=Zm(i,r),f=e.operationForChild(r);f&&(o=o.concat(uh(f,a,l,u)))}),s&&(o=o.concat(Fl(s,e,i,t))),o}function dh(e,n){const t=n.query,i=io(e,t);return{hashFn:()=>(b1(n)||je.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?q1(e,t._path,i):D1(e,t._path);{const o=OC(s,t);return lr(e,t,null,o)}}}}function io(e,n){const t=kr(n);return e.queryToTagMap.get(t)}function kr(e){return e._path.toString()+"$"+e._queryIdentifier}function Wl(e,n){return e.tagToQueryMap.get(n)}function zl(e){const n=e.indexOf("$");return He(n!==-1&&n<e.length-1,"Bad queryKey."),{queryId:e.substr(n+1),path:new pn(e.substr(0,n))}}function Gl(e,n,t){const i=e.syncPointTree_.get(n);He(i,"Missing sync point for query tag that we're tracking");const s=Sr(e.pendingWriteTree_,n);return Fl(i,t,s,null)}function U1(e){return e.fold((n,t,i)=>{if(t&&mi(t))return[Ir(t)];{let s=[];return t&&(s=sh(t)),tt(i,(o,r)=>{s=s.concat(r)}),s}})}function Ls(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(R1())(e._repo,e._path):e}function j1(e,n){for(let t=0;t<n.length;++t){const i=n[t];if(!i._queryParams.loadsAllData()){const s=kr(i),o=e.queryToTagMap.get(s);e.queryToTagMap.delete(s),e.tagToQueryMap.delete(o)}}}function F1(){return N1++}function V1(e,n,t){const i=n._path,s=io(e,n),o=dh(e,t),r=e.listenProvider_.startListening(Ls(n),s,o.hashFn,o.onComplete),a=e.syncPointTree_.subtree(i);if(s)He(!mi(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((u,f,m)=>{if(!Xe(u)&&f&&mi(f))return[Ir(f).query];{let h=[];return f&&(h=h.concat(sh(f).map(v=>v.query))),tt(m,(v,S)=>{h=h.concat(S)}),h}});for(let u=0;u<l.length;++u){const f=l[u];e.listenProvider_.stopListening(Ls(f),io(e,f))}}return r}class Jl{constructor(n){this.node_=n}getImmediateChild(n){const t=this.node_.getImmediateChild(n);return new Jl(t)}node(){return this.node_}}class Yl{constructor(n,t){this.syncTree_=n,this.path_=t}getImmediateChild(n){const t=Tn(this.path_,n);return new Yl(this.syncTree_,t)}node(){return Vl(this.syncTree_,this.path_)}}const W1=function(e){return e=e||{},e.timestamp=e.timestamp||new Date().getTime(),e},Fu=function(e,n,t){if(!e||typeof e!="object")return e;if(He(".sv"in e,"Unexpected leaf node or priority contents"),typeof e[".sv"]=="string")return z1(e[".sv"],n,t);if(typeof e[".sv"]=="object")return G1(e[".sv"],n);He(!1,"Unexpected server value: "+JSON.stringify(e,null,2))},z1=function(e,n,t){if(e==="timestamp")return t.timestamp;He(!1,"Unexpected server value: "+e)},G1=function(e,n,t){e.hasOwnProperty("increment")||He(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;typeof i!="number"&&He(!1,"Unexpected increment value: "+i);const s=n.node();if(He(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const r=s.getValue();return typeof r!="number"?i:r+i},J1=function(e,n,t,i){return Kl(n,new Yl(t,e),i)},fh=function(e,n,t){return Kl(e,new Jl(n),t)};function Kl(e,n,t){const i=e.getPriority().val(),s=Fu(i,n.getImmediateChild(".priority"),t);let o;if(e.isLeafNode()){const r=e,a=Fu(r.getValue(),n,t);return a!==r.getValue()||s!==r.getPriority().val()?new Mn(a,qn(s)):e}else{const r=e;return o=r,s!==r.getPriority().val()&&(o=o.updatePriority(new Mn(s))),r.forEachChild(Hn,(a,l)=>{const u=Kl(l,n.getImmediateChild(a),t);u!==l&&(o=o.updateImmediateChild(a,u))}),o}}class Zl{constructor(n="",t=null,i={children:{},childCount:0}){this.name=n,this.parent=t,this.node=i}}function Ql(e,n){let t=n instanceof pn?n:new pn(n),i=e,s=Ke(t);for(;s!==null;){const o=ns(i.node.children,s)||{children:{},childCount:0};i=new Zl(s,i,o),t=vn(t),s=Ke(t)}return i}function fs(e){return e.node.value}function mh(e,n){e.node.value=n,nl(e)}function hh(e){return e.node.childCount>0}function Y1(e){return fs(e)===void 0&&!hh(e)}function Er(e,n){tt(e.node.children,(t,i)=>{n(new Zl(t,e,i))})}function ph(e,n,t,i){t&&n(e),Er(e,s=>{ph(s,n,!0)})}function K1(e,n,t){let i=e.parent;for(;i!==null;){if(n(i))return!0;i=i.parent}return!1}function Co(e){return new pn(e.parent===null?e.name:Co(e.parent)+"/"+e.name)}function nl(e){e.parent!==null&&Z1(e.parent,e.name,e)}function Z1(e,n,t){const i=Y1(t),s=Jt(e.node.children,n);i&&s?(delete e.node.children[n],e.node.childCount--,nl(e)):!i&&!s&&(e.node.children[n]=t.node,e.node.childCount++,nl(e))}const Q1=/[\[\].#$\/\u0000-\u001F\u007F]/,X1=/[\[\].#$\u0000-\u001F\u007F]/,_a=10*1024*1024,gh=function(e){return typeof e=="string"&&e.length!==0&&!Q1.test(e)},yh=function(e){return typeof e=="string"&&e.length!==0&&!X1.test(e)},e_=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),yh(e)},n_=function(e,n,t,i){Xl(xl(e,"value"),n,t)},Xl=function(e,n,t){const i=t instanceof pn?new vv(t,e):t;if(n===void 0)throw new Error(e+"contains undefined "+bi(i));if(typeof n=="function")throw new Error(e+"contains a function "+bi(i)+" with contents = "+n.toString());if(hm(n))throw new Error(e+"contains "+n.toString()+" "+bi(i));if(typeof n=="string"&&n.length>_a/3&&Hr(n)>_a)throw new Error(e+"contains a string greater than "+_a+" utf8 bytes "+bi(i)+" ('"+n.substring(0,50)+"...')");if(n&&typeof n=="object"){let s=!1,o=!1;if(tt(n,(r,a)=>{if(r===".value")s=!0;else if(r!==".priority"&&r!==".sv"&&(o=!0,!gh(r)))throw new Error(e+" contains an invalid key ("+r+") "+bi(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);_v(i,r),Xl(e,a,i),$v(i)}),s&&o)throw new Error(e+' contains ".value" child '+bi(i)+" in addition to actual children.")}},Ch=function(e,n,t,i){if(!yh(t))throw new Error(xl(e,n)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},t_=function(e,n,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Ch(e,n,t)},vh=function(e,n){if(Ke(n)===".info")throw new Error(e+" failed = Can't modify data under /.info/")},i_=function(e,n){const t=n.path.toString();if(typeof n.repoInfo.host!="string"||n.repoInfo.host.length===0||!gh(n.repoInfo.namespace)&&n.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!e_(t))throw new Error(xl(e,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class s_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ec(e,n){let t=null;for(let i=0;i<n.length;i++){const s=n[i],o=s.getPath();t!==null&&!Tl(o,t.path)&&(e.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(s)}t&&e.eventLists_.push(t)}function _h(e,n,t){ec(e,t),$h(e,i=>Tl(i,n))}function St(e,n,t){ec(e,t),$h(e,i=>mt(i,n)||mt(n,i))}function $h(e,n){e.recursionDepth_++;let t=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];if(s){const o=s.path;n(o)?(o_(e.eventLists_[i]),e.eventLists_[i]=null):t=!1}}t&&(e.eventLists_=[]),e.recursionDepth_--}function o_(e){for(let n=0;n<e.events.length;n++){const t=e.events[n];if(t!==null){e.events[n]=null;const i=t.getEventRunner();Ns&&Wn("event: "+t.toString()),ds(i)}}}const r_="repo_interrupt",a_=25;class l_{constructor(n,t,i,s){this.repoInfo_=n,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new s_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=er(),this.transactionQueueTree_=new Zl,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function c_(e,n,t){if(e.stats_=kl(e.repoInfo_),e.forceRestClient_||VC())e.server_=new Xo(e.repoInfo_,(i,s,o,r)=>{Vu(e,i,s,o,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>Wu(e,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{En(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new Ut(e.repoInfo_,n,(i,s,o,r)=>{Vu(e,i,s,o,r)},i=>{Wu(e,i)},i=>{d_(e,i)},e.authTokenProvider_,e.appCheckProvider_,t),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(i=>{e.server_.refreshAuthToken(i)}),e.appCheckProvider_.addTokenChangeListener(i=>{e.server_.refreshAppCheckToken(i.token)}),e.statsReporter_=YC(e.repoInfo_,()=>new Gv(e.stats_,e.server_)),e.infoData_=new jv,e.infoSyncTree_=new ju({startListening:(i,s,o,r)=>{let a=[];const l=e.infoData_.getNode(i._path);return l.isEmpty()||(a=go(e.infoSyncTree_,i._path,l),setTimeout(()=>{r("ok")},0)),a},stopListening:()=>{}}),tc(e,"connected",!1),e.serverSyncTree_=new ju({startListening:(i,s,o,r)=>(e.server_.listen(i,o,s,(a,l)=>{const u=r(a,l);St(e.eventQueue_,i._path,u)}),[]),stopListening:(i,s)=>{e.server_.unlisten(i,s)}})}function u_(e){const t=e.infoData_.getNode(new pn(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function nc(e){return W1({timestamp:u_(e)})}function Vu(e,n,t,i,s){e.dataUpdateCount++;const o=new pn(n);t=e.interceptServerDataCallback_?e.interceptServerDataCallback_(n,t):t;let r=[];if(s)if(i){const l=Go(t,u=>qn(u));r=L1(e.serverSyncTree_,o,l,s)}else{const l=qn(t);r=lh(e.serverSyncTree_,o,l,s)}else if(i){const l=Go(t,u=>qn(u));r=M1(e.serverSyncTree_,o,l)}else{const l=qn(t);r=go(e.serverSyncTree_,o,l)}let a=o;r.length>0&&(a=Rr(e,o)),St(e.eventQueue_,a,r)}function Wu(e,n){tc(e,"connected",n),n===!1&&h_(e)}function d_(e,n){tt(n,(t,i)=>{tc(e,t,i)})}function tc(e,n,t){const i=new pn("/.info/"+n),s=qn(t);e.infoData_.updateSnapshot(i,s);const o=go(e.infoSyncTree_,i,s);St(e.eventQueue_,i,o)}function wh(e){return e.nextWriteId_++}function f_(e,n,t){const i=O1(e.serverSyncTree_,n);return i!=null?Promise.resolve(i):e.server_.get(n).then(s=>{const o=qn(s).withIndex(n._queryParams.getIndex());el(e.serverSyncTree_,n,t,!0);let r;if(n._queryParams.loadsAllData())r=go(e.serverSyncTree_,n._path,o);else{const a=io(e.serverSyncTree_,n);r=lh(e.serverSyncTree_,n._path,o,a)}return St(e.eventQueue_,n._path,r),lr(e.serverSyncTree_,n,t,null,!0),o},s=>(Tr(e,"get for query "+En(n)+" failed: "+s),Promise.reject(new Error(s))))}function m_(e,n,t,i,s){Tr(e,"set",{path:n.toString(),value:t,priority:i});const o=nc(e),r=qn(t,i),a=Vl(e.serverSyncTree_,n),l=fh(r,a,o),u=wh(e),f=ah(e.serverSyncTree_,n,l,u,!0);ec(e.eventQueue_,f),e.server_.put(n.toString(),r.val(!0),(h,v)=>{const S=h==="ok";S||nt("set at "+n+" failed: "+h);const X=Pi(e.serverSyncTree_,u,!S);St(e.eventQueue_,n,X),y_(e,s,h,v)});const m=Bh(e,n);Rr(e,m),St(e.eventQueue_,m,[])}function h_(e){Tr(e,"onDisconnectEvents");const n=nc(e),t=er();Ya(e.onDisconnect_,ln(),(s,o)=>{const r=J1(s,o,e.serverSyncTree_,n);Wm(t,s,r)});let i=[];Ya(t,ln(),(s,o)=>{i=i.concat(go(e.serverSyncTree_,s,o));const r=Bh(e,s);Rr(e,r)}),e.onDisconnect_=er(),St(e.eventQueue_,ln(),i)}function p_(e,n,t){let i;Ke(n._path)===".info"?i=el(e.infoSyncTree_,n,t):i=el(e.serverSyncTree_,n,t),_h(e.eventQueue_,n._path,i)}function bh(e,n,t){let i;Ke(n._path)===".info"?i=lr(e.infoSyncTree_,n,t):i=lr(e.serverSyncTree_,n,t),_h(e.eventQueue_,n._path,i)}function g_(e){e.persistentConnection_&&e.persistentConnection_.interrupt(r_)}function Tr(e,...n){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":"),Wn(t,...n)}function y_(e,n,t,i){n&&ds(()=>{if(t==="ok")n(null);else{const s=(t||"error").toUpperCase();let o=s;i&&(o+=": "+i);const r=new Error(o);r.code=s,n(r)}})}function Ah(e,n,t){return Vl(e.serverSyncTree_,n,t)||je.EMPTY_NODE}function ic(e,n=e.transactionQueueTree_){if(n||Nr(e,n),fs(n)){const t=Hh(e,n);He(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&C_(e,Co(n),t)}else hh(n)&&Er(n,t=>{ic(e,t)})}function C_(e,n,t){const i=t.map(u=>u.currentWriteId),s=Ah(e,n,i);let o=s;const r=s.hash();for(let u=0;u<t.length;u++){const f=t[u];He(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const m=Qn(n,f.path);o=o.updateChild(m,f.currentOutputSnapshotRaw)}const a=o.val(!0),l=n;e.server_.put(l.toString(),a,u=>{Tr(e,"transaction put response",{path:l.toString(),status:u});let f=[];if(u==="ok"){const m=[];for(let h=0;h<t.length;h++)t[h].status=2,f=f.concat(Pi(e.serverSyncTree_,t[h].currentWriteId)),t[h].onComplete&&m.push(()=>t[h].onComplete(null,!0,t[h].currentOutputSnapshotResolved)),t[h].unwatcher();Nr(e,Ql(e.transactionQueueTree_,n)),ic(e,e.transactionQueueTree_),St(e.eventQueue_,n,f);for(let h=0;h<m.length;h++)ds(m[h])}else{if(u==="datastale")for(let m=0;m<t.length;m++)t[m].status===3?t[m].status=4:t[m].status=0;else{nt("transaction at "+l.toString()+" failed: "+u);for(let m=0;m<t.length;m++)t[m].status=4,t[m].abortReason=u}Rr(e,n)}},r)}function Rr(e,n){const t=Ph(e,n),i=Co(t),s=Hh(e,t);return v_(e,s,i),i}function v_(e,n,t){if(n.length===0)return;const i=[];let s=[];const r=n.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<n.length;a++){const l=n[a],u=Qn(t,l.path);let f=!1,m;if(He(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)f=!0,m=l.abortReason,s=s.concat(Pi(e.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=a_)f=!0,m="maxretry",s=s.concat(Pi(e.serverSyncTree_,l.currentWriteId,!0));else{const h=Ah(e,l.path,r);l.currentInputSnapshot=h;const v=n[a].update(h.val());if(v!==void 0){Xl("transaction failed: Data returned ",v,l.path);let S=qn(v);typeof v=="object"&&v!=null&&Jt(v,".priority")||(S=S.updatePriority(h.getPriority()));const ae=l.currentWriteId,fe=nc(e),ge=fh(S,h,fe);l.currentOutputSnapshotRaw=S,l.currentOutputSnapshotResolved=ge,l.currentWriteId=wh(e),r.splice(r.indexOf(ae),1),s=s.concat(ah(e.serverSyncTree_,l.path,ge,l.currentWriteId,l.applyLocally)),s=s.concat(Pi(e.serverSyncTree_,ae,!0))}else f=!0,m="nodata",s=s.concat(Pi(e.serverSyncTree_,l.currentWriteId,!0))}St(e.eventQueue_,t,s),s=[],f&&(n[a].status=2,(function(h){setTimeout(h,Math.floor(0))})(n[a].unwatcher),n[a].onComplete&&(m==="nodata"?i.push(()=>n[a].onComplete(null,!1,n[a].currentInputSnapshot)):i.push(()=>n[a].onComplete(new Error(m),!1,null))))}Nr(e,e.transactionQueueTree_);for(let a=0;a<i.length;a++)ds(i[a]);ic(e,e.transactionQueueTree_)}function Ph(e,n){let t,i=e.transactionQueueTree_;for(t=Ke(n);t!==null&&fs(i)===void 0;)i=Ql(i,t),n=vn(n),t=Ke(n);return i}function Hh(e,n){const t=[];return xh(e,n,t),t.sort((i,s)=>i.order-s.order),t}function xh(e,n,t){const i=fs(n);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Er(n,s=>{xh(e,s,t)})}function Nr(e,n){const t=fs(n);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,mh(n,t.length>0?t:void 0)}Er(n,i=>{Nr(e,i)})}function Bh(e,n){const t=Co(Ph(e,n)),i=Ql(e.transactionQueueTree_,n);return K1(i,s=>{$a(e,s)}),$a(e,i),ph(i,s=>{$a(e,s)}),t}function $a(e,n){const t=fs(n);if(t){const i=[];let s=[],o=-1;for(let r=0;r<t.length;r++)t[r].status===3||(t[r].status===1?(He(o===r-1,"All SENT items should be at beginning of queue."),o=r,t[r].status=3,t[r].abortReason="set"):(He(t[r].status===0,"Unexpected transaction status in abort"),t[r].unwatcher(),s=s.concat(Pi(e.serverSyncTree_,t[r].currentWriteId,!0)),t[r].onComplete&&i.push(t[r].onComplete.bind(null,new Error("set"),!1,null))));o===-1?mh(n,void 0):t.length=o+1,St(e.eventQueue_,Co(n),s);for(let r=0;r<i.length;r++)ds(i[r])}}function __(e){let n="";const t=e.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}n+="/"+s}return n}function $_(e){const n={};e.charAt(0)==="?"&&(e=e.substring(1));for(const t of e.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?n[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):nt(`Invalid query segment '${t}' in query '${e}'`)}return n}const zu=function(e,n){const t=w_(e),i=t.namespace;t.domain==="firebase.com"&&zt(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&zt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||NC();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Hm(t.host,t.secure,i,s,n,"",i!==t.subdomain),path:new pn(t.pathString)}},w_=function(e){let n="",t="",i="",s="",o="",r=!0,a="https",l=443;if(typeof e=="string"){let u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));let f=e.indexOf("/");f===-1&&(f=e.length);let m=e.indexOf("?");m===-1&&(m=e.length),n=e.substring(0,Math.min(f,m)),f<m&&(s=__(e.substring(f,m)));const h=$_(e.substring(Math.min(e.length,m)));u=n.indexOf(":"),u>=0?(r=a==="https"||a==="wss",l=parseInt(n.substring(u+1),10)):u=n.length;const v=n.slice(0,u);if(v.toLowerCase()==="localhost")t="localhost";else if(v.split(".").length<=2)t=v;else{const S=n.indexOf(".");i=n.substring(0,S).toLowerCase(),t=n.substring(S+1),o=i}"ns"in h&&(o=h.ns)}return{host:n,port:l,domain:t,subdomain:i,secure:r,scheme:a,pathString:s,namespace:o}};class b_{constructor(n,t,i,s){this.eventType=n,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const n=this.snapshot.ref;return this.eventType==="value"?n._path:n.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+En(this.snapshot.exportVal())}}class A_{constructor(n,t,i){this.eventRegistration=n,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Sh{constructor(n,t){this.snapshotCallback=n,this.cancelCallback=t}onValue(n,t){this.snapshotCallback.call(null,n,t)}onCancel(n){return He(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,n)}get hasCancelCallback(){return!!this.cancelCallback}matches(n){return this.snapshotCallback===n.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===n.snapshotCallback.userCallback&&this.snapshotCallback.context===n.snapshotCallback.context}}class sc{constructor(n,t,i,s){this._repo=n,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return Xe(this._path)?null:Nm(this._path)}get ref(){return new Yt(this._repo,this._path)}get _queryIdentifier(){const n=ku(this._queryParams),t=Sl(n);return t==="{}"?"default":t}get _queryObject(){return ku(this._queryParams)}isEqual(n){if(n=cs(n),!(n instanceof sc))return!1;const t=this._repo===n._repo,i=Tl(this._path,n._path),s=this._queryIdentifier===n._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Cv(this._path)}}class Yt extends sc{constructor(n,t){super(n,t,new Dl,!1)}get parent(){const n=Dm(this._path);return n===null?null:new Yt(this._repo,n)}get root(){let n=this;for(;n.parent!==null;)n=n.parent;return n}}class so{constructor(n,t,i){this._node=n,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(n){const t=new pn(n),i=tl(this.ref,n);return new so(this._node.getChild(t),i,Hn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>n(new so(s,tl(this.ref,i),Hn)))}hasChild(n){const t=new pn(n);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function _s(e,n){return e=cs(e),e._checkNotDeleted("ref"),n!==void 0?tl(e._root,n):e._root}function tl(e,n){return e=cs(e),Ke(e._path)===null?t_("child","path",n):Ch("child","path",n),new Yt(e._repo,Tn(e._path,n))}function P_(e){return vh("remove",e._path),il(e,null)}function il(e,n){e=cs(e),vh("set",e._path),n_("set",n,e._path);const t=new Pr;return m_(e._repo,e._path,n,null,t.wrapCallback(()=>{})),t.promise}function H_(e){e=cs(e);const n=new Sh(()=>{}),t=new Mr(n);return f_(e._repo,e,t).then(i=>new so(i,new Yt(e._repo,e._path),e._queryParams.getIndex()))}class Mr{constructor(n){this.callbackContext=n}respondsTo(n){return n==="value"}createEvent(n,t){const i=t._queryParams.getIndex();return new b_("value",this,new so(n.snapshotNode,new Yt(t._repo,t._path),i))}getEventRunner(n){return n.getEventType()==="cancel"?()=>this.callbackContext.onCancel(n.error):()=>this.callbackContext.onValue(n.snapshot,null)}createCancelEvent(n,t){return this.callbackContext.hasCancelCallback?new A_(this,n,t):null}matches(n){return n instanceof Mr?!n.callbackContext||!this.callbackContext?!0:n.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function x_(e,n,t,i,s){const o=new Sh(t,void 0),r=new Mr(o);return p_(e._repo,e,r),()=>bh(e._repo,e,r)}function B_(e,n,t,i){return x_(e,"value",n)}function S_(e,n,t){bh(e._repo,e,null)}B1(Yt);T1(Yt);const I_="FIREBASE_DATABASE_EMULATOR_HOST",sl={};let k_=!1;function E_(e,n,t,i){const s=n.lastIndexOf(":"),o=n.substring(0,s),r=Hl(o);e.repoInfo_=new Hm(n,r,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(e.authTokenProvider_=i)}function T_(e,n,t,i,s){let o=i||e.options.databaseURL;o===void 0&&(e.options.projectId||zt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Wn("Using default host for project ",e.options.projectId),o=`${e.options.projectId}-default-rtdb.firebaseio.com`);let r=zu(o,s),a=r.repoInfo,l;typeof process<"u"&&mu&&(l=mu[I_]),l?(o=`http://${l}?ns=${a.namespace}`,r=zu(o,s),a=r.repoInfo):r.repoInfo.secure;const u=new zC(e.name,e.options,n);i_("Invalid Firebase Database URL",r),Xe(r.path)||zt("Database URL must point to the root of a Firebase Database (not including a child path).");const f=N_(a,e,u,new WC(e,t));return new M_(f,e)}function R_(e,n){const t=sl[n];(!t||t[e.key]!==e)&&zt(`Database ${n}(${e.repoInfo_}) has already been deleted.`),g_(e),delete t[e.key]}function N_(e,n,t,i){let s=sl[n.name];s||(s={},sl[n.name]=s);let o=s[e.toURLString()];return o&&zt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new l_(e,k_,t,i),s[e.toURLString()]=o,o}class M_{constructor(n,t){this._repoInternal=n,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(c_(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Yt(this._repo,ln())),this._rootInternal}_delete(){return this._rootInternal!==null&&(R_(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(n){this._rootInternal===null&&zt("Cannot call "+n+" on a deleted database.")}}function Oi(e=pC(),n){const t=uC(e,"database").getImmediate({identifier:n});if(!t._instanceStarted){const i=K0("database");i&&D_(t,...i)}return t}function D_(e,n,t,i={}){e=cs(e),e._checkNotDeleted("useEmulator");const s=`${n}:${t}`,o=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&Jo(i,o.repoInfo_.emulatorOptions))return;zt("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let r;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&zt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Mo(Mo.OWNER);else if(i.mockUserToken){const a=typeof i.mockUserToken=="string"?i.mockUserToken:Q0(i.mockUserToken,e.app.options.projectId);r=new Mo(a)}Hl(n)&&(Z0(n),ny("Database",!0)),E_(o,s,i,r)}function q_(e){SC(hC),Yo(new Ys("database",(n,{instanceIdentifier:t})=>{const i=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),o=n.getProvider("app-check-internal");return T_(i,s,o,t)},"PUBLIC").setMultipleInstances(!0)),Gi(hu,pu,e),Gi(hu,pu,"esm2020")}Ut.prototype.simpleListen=function(e,n){this.sendRequest("q",{p:e},n)};Ut.prototype.echo=function(e,n){this.sendRequest("echo",{d:e},n)};q_();const Hi={apiKey:"AIzaSyBpBcdlKxzT0lV7HlRUWBHSRCSF1UkEkJc",authDomain:"city-card-game.firebaseapp.com",databaseURL:"https://city-card-game-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"city-card-game",storageBucket:"city-card-game.firebasestorage.app",messagingSenderId:"932830629901",appId:"1:932830629901:web:783d9f30b6cd77e610c544",measurementId:"G-FCX0PQVF9L"};let $s=null,Gu=null,Do=!1;function Ih(){const e=localStorage.getItem("firebase_config");if(e)try{return JSON.parse(e)}catch(n){console.error("Failed to parse Firebase config:",n)}return null}function L_(e){localStorage.setItem("firebase_config",JSON.stringify(e))}function ol(){return Hi.apiKey&&Hi.apiKey!=="YOUR_API_KEY"&&Hi.databaseURL&&Hi.databaseURL!=="YOUR_DATABASE_URL"}function cr(e=null){try{console.log("[Firebase]  Firebase...",{projectId:e?.projectId,databaseURL:e?.databaseURL}),$s&&(console.log("[Firebase]  Firebase "),gC($s),$s=null,Gu=null,Do=!1);const n=e||Hi;return!n.apiKey||n.apiKey==="YOUR_API_KEY"?(console.warn("Firebase"),!1):($s=lm(n),Gu=Oi($s),Do=!0,console.log("[Firebase]  Firebase isInitialized =",Do),!0)}catch(n){return console.error("[Firebase]  Firebase :",n),!1}}function O_(){console.log("[Firebase] ...");const e=Ih();return e?(console.log("[Firebase] "),cr(e)):ol()?(console.log("[Firebase] "),cr(Hi)):(console.log("[Firebase]  Firebase "),!1)}function Nt(){return Do}function U_(){return Hi}const wa=1440*60*1e3,Ju=10*1e3,j_=3;function oc(){const e=Ce(""),n=Ce(null),t=Ce(!1),i=Ce(!1),s=Ce(!1);let o=null,r=null;function a(){return Math.floor(1e8+Math.random()*9e8).toString()}async function l(L,P){const G={...P,lastActivity:Date.now(),lastActivityString:new Date().toLocaleString("zh-CN")};if(Nt()){console.log(`[Firebase]  Firebase: ${L}`);try{const _=Oi();return await il(_s(_,"rooms/"+L),G),console.log(`[Firebase]  : ${L}`),!0}catch(_){return console.error("[Firebase]  Firebase save error:",_),!1}}else return console.log(`[localStorage] : ${L}`),localStorage.setItem(`room_${L}`,JSON.stringify(G)),!0}async function u(L){let P=null;if(Nt()){console.log(`[Firebase]  Firebase : ${L}`);try{const G=Oi();if(P=(await H_(_s(G,"rooms/"+L))).val(),P)console.log(`[Firebase]  : ${L}`);else return console.log(`[Firebase]  : ${L}`),null}catch(G){return console.error("[Firebase]  Firebase read error:",G),null}}else{console.log(`[localStorage] : ${L}`);const G=localStorage.getItem(`room_${L}`);P=G?JSON.parse(G):null}if(P&&P.lastActivity){const _=Date.now()-P.lastActivity;if(_>wa){if(console.log(`[]  ${L} ${Math.floor(_/36e5)}`),Nt()){const $=Oi();await P_(_s($,"rooms/"+L))}else localStorage.removeItem(`room_${L}`);return null}else if(_>wa*.8){const $=Math.floor((wa-_)/36e5);console.warn(`[]  ${L} ${$}`)}}return P}function f(L,P){if(Nt()){console.log(`[Firebase] : ${L}`);const G=Oi(),_=_s(G,"rooms/"+L);return B_(_,$=>{const A=$.val();A&&(console.log(`[Firebase] : ${L}`),P(A))}),_}else return console.log("[localStorage] "),null}function m(L){L&&Nt()&&S_(L)}async function h(L,P){try{if(Nt()){const G={lastSeen:Date.now(),lastSeenString:new Date().toLocaleString("zh-CN")},_=Oi();return await il(_s(_,`rooms/${L}/heartbeats/${P}`),G),console.log(`[]  ${P} `),!0}else{const G=await u(L);return G?(G.heartbeats||(G.heartbeats={}),G.heartbeats[P]={lastSeen:Date.now(),lastSeenString:new Date().toLocaleString("zh-CN")},localStorage.setItem(`room_${L}`,JSON.stringify({...G,lastActivity:Date.now()})),console.log(`[]  ${P} `),!0):(console.log(`[]  ${L} `),!1)}}catch(G){return console.error("[] :",G),!1}}function v(L,P){if(!P||!P.heartbeats)return{online:!1,reason:"no_heartbeat_data"};const G=P.heartbeats[L];if(!G)return{online:!1,reason:"no_heartbeat"};let _=null;if(typeof G=="object"&&G.lastSeen?_=G.lastSeen:typeof G=="number"&&(_=G),!_)return{online:!1,reason:"invalid_heartbeat"};const $=Date.now(),A=Ju*j_,H=$-_;return H>A?{online:!1,reason:"timeout",offlineSeconds:Math.floor(H/1e3),lastSeen:_}:{online:!0,lastSeen:_,secondsAgo:Math.floor(H/1e3)}}function S(L){if(!L||!L.players)return{};const P={};return L.players.forEach(G=>{P[G.name]=v(G.name,L)}),P}function X(L){const P=S(L);return Object.entries(P).filter(([G,_])=>!_.online).map(([G,_])=>({name:G,status:_}))}function ae(L,P){fe(),console.log(`[]  - : ${L}, : ${P}`),h(L,P),o=setInterval(async()=>{await h(L,P)},Ju)}function fe(){o&&(clearInterval(o),o=null,console.log("[] "))}async function ge(L){const P=a();e.value=P,t.value=!0;const G={roomId:P,mode:L.mode||"2P",playerCount:L.playerCount||2,citiesPerPlayer:L.citiesPerPlayer||5,players:[],spectators:[],heartbeats:{},createdAt:Date.now(),roomStatus:"waiting"};return await l(P,G),n.value=G,{success:!0,roomId:P}}async function R(L){if(L.length!==9||!/^\d+$/.test(L))return{success:!1,error:"9"};const P=await u(L);if(!P)return{success:!1,error:""};e.value=L,t.value=!1,n.value=P,P.players||(P.players=[]);const G=S(P),_=P.players.filter(A=>G[A.name]?.online),$=_.length>=P.playerCount;return i.value=$,console.log(`[] : ${P.players.length}, : ${_.length}, : ${P.playerCount}, : ${$}`),{success:!0,roomData:P,isRoomFull:$}}async function Y(L,P,G){const _=await u(L);if(!_)return!1;const $=_.players.findIndex(A=>A.name===P);return $!==-1?(_.players[$]=G,await l(L,_)):!1}async function V(L,P){try{const G=await u(L);if(!G)return{success:!1,error:""};const _=G.players.findIndex($=>$.name===P);if(_>=0&&(G.players.splice(_,1),console.log(`[] : ${P}`)),G.spectators){const $=G.spectators.findIndex(A=>A.name===P);$>=0&&(G.spectators.splice($,1),console.log(`[] : ${P}`))}return G.heartbeats&&G.heartbeats[P]&&(delete G.heartbeats[P],console.log(`[] : ${P}`)),await l(L,G),{success:!0}}catch(G){return console.error("[] :",G),{success:!1,error:G.message}}}async function ee(L,P,G=!1){const _=await u(L);if(!_)return{success:!1,error:""};_.players||(_.players=[]),_.spectators||(_.spectators=[]);const $=_.players.findIndex(H=>H.name===P.name),A=_.spectators.findIndex(H=>H.name===P.name);if(G)if(A>=0)s.value=!0;else{if($>=0)return{success:!1,error:""};_.spectators.push({name:P.name,ready:!0,joinedAt:Date.now()}),s.value=!0}else{if($>=0)console.log("[] ");else{if(A>=0)return{success:!1,error:""};if(_.players.length>=_.playerCount)return{success:!1,error:""};_.players.push({name:P.name,cities:P.cities||[],gold:0,ready:!1,joinedAt:Date.now()})}s.value=!1}return _.heartbeats||(_.heartbeats={}),_.heartbeats[P.name]={lastSeen:Date.now(),lastSeenString:new Date().toLocaleString("zh-CN")},await l(L,_),n.value=_,ae(L,P.name),{success:!0,roomData:_}}async function ue(L,P,G){const _=await u(L);if(!_)return!1;const $=_.players.findIndex(A=>A.name===P);return $!==-1?(_.players[$].ready=G,await l(L,_),n.value=_,!0):!1}function de(L,P){W(),r=f(L,G=>{n.value=G,P(G)})}function W(){r&&(m(r),r=null)}async function Q(L,P){if(fe(),W(),L&&P)try{const G=await u(L);G&&G.heartbeats&&G.heartbeats[P]&&(typeof G.heartbeats[P]=="object"?(G.heartbeats[P].lastSeen=0,G.heartbeats[P].manualExit=!0):G.heartbeats[P]={lastSeen:0,manualExit:!0},await l(L,G),console.log(`[]  ${P} `))}catch(G){console.error("[] :",G)}e.value="",n.value=null,t.value=!1,i.value=!1,s.value=!1}return lo(()=>{fe(),W()}),{roomId:e,roomData:n,isRoomHost:t,forceSpectator:i,isSpectator:s,generateRoomId:a,createRoom:ge,joinRoom:R,saveRoomData:l,getRoomData:u,listenToRoomData:f,stopListeningToRoom:m,sendHeartbeat:h,startHeartbeat:ae,stopHeartbeat:fe,getPlayerOnlineStatus:v,getAllPlayersOnlineStatus:S,getOfflinePlayers:X,updateRoomPlayer:Y,kickOfflinePlayer:V,addPlayerToRoom:ee,setPlayerReady:ue,startRoomListener:de,stopRoomListener:W,leaveRoom:Q}}function vo(e,n,t,i){const s=zi.find(l=>l.name===n);if(!s)return i(`${n}`),!1;if(e.cities.find(l=>l.name===n))return i(`${e.name}${n}`),!1;const r=si[n],a={name:n,hp:s.hp,currentHp:s.hp,isAlive:!0,province:r?r.name:""};return e.cities.push(a),i(`${e.name}${n}`),!0}function Ie(e){return e.cities.filter(n=>{const t=n.currentHp!==void 0?n.currentHp:n.hp;return n.isAlive!==!1&&t>0})}function at(e,n=1/0,t=0){return e.cities.filter(i=>{const s=i.currentHp!==void 0?i.currentHp:i.hp;return i.isAlive!==!1&&s>0&&i.hp>=t&&i.hp<=n})}function dn(e){return[...e].sort((n,t)=>{const i=n.currentHp!==void 0?n.currentHp:n.hp,s=t.currentHp!==void 0?t.currentHp:t.hp;return i-s})}function be(e){return e.currentHp!==void 0?e.currentHp:e.hp}function F_(e){return e.shields||(e.shields={}),e.shields}function $t(e,n,t,i){const s=F_(e);s[n]||(s[n]={}),s[n][t]={hp:i.hp,maxHp:i.hp,roundsLeft:i.roundsLeft||-1,appliedRound:e.currentRound,...i.extra}}function rc(e,n,t=1){e.shield?(e.shield.hp+=n,e.shield.maxHp+=n,e.shield.roundsLeft=Math.max(e.shield.roundsLeft,t)):e.shield={hp:n,maxHp:n,roundsLeft:t}}function V_(e){return e.bannedCities||(e.bannedCities={}),e.bannedCities}function Dr(e,n,t,i,s={}){const o=V_(e);o[n]||(o[n]={}),o[n][t]={roundsLeft:i,fullHealOnReturn:s.fullHealOnReturn||!1,originalHp:s.originalHp||0}}function W_(e){return e.delayedEffects||(e.delayedEffects={}),e.delayedEffects}function qr(e,n,t,i){const s=W_(e);s[n]||(s[n]={}),s[n][t]={type:i.type,effectRoundsLeft:i.roundsLeft,effectData:{appliedRound:e.currentRound,...i.data}}}function Kt(e,n){const t=be(e),i=Math.min(e.hp,t+n);return e.currentHp=i,{oldHp:t,newHp:i,actualHeal:i-t}}function _t(e,n){const t=be(e),i=Math.max(0,t-n);return e.currentHp=i,i<=0&&(e.isAlive=!1),{oldHp:t,newHp:i,actualDamage:t-i}}function Ri(e,n){const t=e.hp,i=be(e);return e.hp=Math.floor(t*n),e.currentHp=Math.floor(i*n),{oldMaxHp:t,newMaxHp:e.hp,oldCurrentHp:i,newCurrentHp:e.currentHp}}function z_(e,n){const t=e.hp,i=be(e);return e.hp=t+n,e.currentHp=i+n,{oldMaxHp:t,newMaxHp:e.hp,oldCurrentHp:i,newCurrentHp:e.currentHp}}function It(e,n){return e.cities.find(t=>t.name===n)}function Re(e,n){return typeof n=="string"?e.cities.findIndex(t=>t.name===n):e.cities.indexOf(n)}function tn(e){return!e||e.length===0?null:e[Math.floor(Math.random()*e.length)]}function G_(e,n,t,i,s,o){o.beijingSkillState||(o.beijingSkillState={}),o.beijingSkillState[e.name]||(o.beijingSkillState[e.name]={powerBoostUsed:0,surrenderUsed:0});const r=o.beijingSkillState[e.name];if(r.powerBoostUsed<2){const a=e.cities.findIndex(l=>l.name==="");a!==-1&&(o.tempAttackBoost||(o.tempAttackBoost={}),o.tempAttackBoost[e.name]||(o.tempAttackBoost[e.name]={}),o.tempAttackBoost[e.name][a]={multiplier:1.2,roundsLeft:1,appliedRound:o.currentRound},r.powerBoostUsed++,s(`${e.name}${i.cityName}""20%${2-r.powerBoostUsed}`))}if(r.surrenderUsed<1&&t&&t.length>0){const a=t.filter(l=>Re(n,l)!==n.centerIndex&&l.isAlive!==!1&&be(l)>0);if(a.length>0){const l=a[Math.floor(Math.random()*a.length)],u=Re(n,l);n.cities.splice(u,1);const f={...l,currentHp:l.hp,isAlive:!0};e.cities.push(f),r.surrenderUsed++,s(`${e.name}${i.cityName}${l.name}${e.name}`)}}o.recordSkillUsage(e.name,i.cityName)}function J_(e,n,t,i){const s=e.cities.findIndex(r=>r.name==="");if(s===-1)return;const o=e.cities[s];if(i.tianjinInitialized||(i.tianjinInitialized={}),!i.tianjinInitialized[e.name]){const r=o.hp;o.hp=Math.floor(r*1.5),o.currentHp=Math.floor(be(o)*1.5),s===e.centerIndex?(o.hp=Math.floor(o.hp*2),o.currentHp=Math.floor(o.currentHp*2),t(`${e.name}${n.cityName}""HP2`),i.tianjinPowerLimit||(i.tianjinPowerLimit={}),i.tianjinPowerLimit[e.name]={cityIndex:s,maxMultiplier:1.5}):t(`${e.name}${n.cityName}""HP50%`),i.tianjinInitialized[e.name]=!0}s!==e.centerIndex&&e.centerIndex!==void 0&&(i.damageTransfer||(i.damageTransfer={}),i.damageTransfer[e.name]||(i.damageTransfer[e.name]={}),i.damageTransfer[e.name][e.centerIndex]={targetIndex:s,transferPercent:.5,appliedRound:i.currentRound}),i.recordSkillUsage(e.name,n.cityName)}function Y_(e,n,t,i,s,o){t.forEach(r=>{if(r&&r.hp>0){const a=be(r),l=Math.floor(a*.5);r.currentHp=l,r.hp!==void 0&&(r.hp=l)}}),s(`${e.name}${i.cityName}""${n.name}HP`),o.recordSkillUsage(e.name,i.cityName)}function K_(e,n,t,i){i.goldBonus||(i.goldBonus={}),i.goldBonus[e.name]||(i.goldBonus[e.name]=[]),i.goldBonus[e.name].push({roundsLeft:3,goldPerRound:2,appliedRound:i.currentRound,skillName:""}),t(`${e.name}${n.cityName}""32`),i.recordSkillUsage(e.name,n.cityName)}function Z_(e,n,t,i){const s=Ie(e);if(s.length===0){t(`${e.name}${n.cityName}""`);return}i.tempAttackBoost||(i.tempAttackBoost={}),i.tempAttackBoost[e.name]||(i.tempAttackBoost[e.name]={}),s.forEach(o=>{const r=Re(e,o);i.tempAttackBoost[e.name][r]={multiplier:1.2,roundsLeft:1,appliedRound:i.currentRound}}),i.damageReduction||(i.damageReduction={}),i.damageReduction[e.name]||(i.damageReduction[e.name]={}),s.forEach(o=>{const r=Re(e,o);i.damageReduction[e.name][r]={percent:.5,roundsLeft:1,appliedRound:i.currentRound}}),t(`${e.name}${n.cityName}""+20%`),i.recordSkillUsage(e.name,n.cityName)}function Q_(e,n,t,i,s,o=null){const r=n.cities.filter((u,f)=>u.isAlive!==!1&&be(u)>0&&!u.isHidden);if(r.length===0){i(`${e.name}${t.cityName}""`);return}let a,l;if(o!=null?(a=n.cities[o],l=o):(a=r[Math.floor(Math.random()*r.length)],l=Re(n,a)),!a||a.isAlive===!1){i(`${e.name}${t.cityName}""`);return}s.skillDisabled||(s.skillDisabled={}),s.skillDisabled[n.name]||(s.skillDisabled[n.name]={}),s.skillDisabled[n.name][l]={permanent:!0,appliedRound:s.currentRound,source:""},i(`${e.name}${t.cityName}""${n.name}${a.name}`),s.recordSkillUsage(e.name,t.cityName)}function X_(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],a=Re(e,r);$t(i,e.name,a,{hp:1e4,roundsLeft:3}),t(`${e.name}${n.cityName}""${r.name}10000HP3`)}i.recordSkillUsage(e.name,n.cityName)}function e$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],{oldHp:a,newHp:l}=Kt(r,5e3);t(`${e.name}${n.cityName}""${r.name}5000HP${a} -> ${l}`)}i.recordSkillUsage(e.name,n.cityName)}function n$(e,n,t,i,s,o){t.forEach(r=>{if(r&&r.hp>0){const{newHp:a}=_t(r,2e3);r.hp!==void 0&&(r.hp=a)}}),s(`${e.name}${i.cityName}""${n.name}2000HP`),o.recordSkillUsage(e.name,i.cityName)}function t$(e,n,t,i,s,o){t.forEach(r=>{if(r&&r.hp>0){const a=be(r),l=Math.floor(a*.5);r.currentHp=l,r.hp!==void 0&&(r.hp=l),Math.random()<.5&&(r.currentHp=0,r.hp=0,r.isAlive=!1,s(`${e.name}${i.cityName}""${n.name}${r.name}`))}}),s(`${e.name}${i.cityName}""${n.name}HP`),o.recordSkillUsage(e.name,i.cityName)}function i$(e,n,t,i){ms(e,n,t,i)}function s$(e,n,t,i){const o=Ie(e).slice(0,5);o.forEach(r=>{Kt(r,2e3)}),t(`${e.name}${n.cityName}""${o.length}2000HP`),i.recordSkillUsage(e.name,n.cityName)}function ms(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],{oldHp:a,newHp:l}=Kt(r,500);t(`${e.name}${n.cityName}""${r.name}500HP${a} -> ${l}`)}i.recordSkillUsage(e.name,n.cityName)}function o$(e,n,t,i){const s=Ie(e),r=dn(s).slice(0,2);r.forEach(a=>{const l=Math.floor(a.hp*.8);a.currentHp=l}),t(`${e.name}${n.cityName}""${r.length}80%HP`),i.recordSkillUsage(e.name,n.cityName)}function r$(e,n,t,i){const s=Re(e,n.cityName);i.tempAttackBoost||(i.tempAttackBoost={}),i.tempAttackBoost[e.name]||(i.tempAttackBoost[e.name]={}),i.tempAttackBoost[e.name][s]={bonus:2e3,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""2000`),i.recordSkillUsage(e.name,n.cityName)}function a$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],a=Re(e,r);$t(i,e.name,a,{hp:5e3,roundsLeft:3,extra:{skillImmune:!0}}),t(`${e.name}${n.cityName}""${r.name}3`)}i.recordSkillUsage(e.name,n.cityName)}function l$(e,n,t,i,s){const o=Ie(n);if(o.length>0){const a=dn(o).reverse()[0],l=Re(n,a);s.forcedDeploy||(s.forcedDeploy={}),s.forcedDeploy[n.name]||(s.forcedDeploy[n.name]={}),s.forcedDeploy[n.name][l]={roundsLeft:2,appliedRound:s.currentRound,fatigued:!0},i(`${e.name}${t.cityName}""${n.name}${a.name}2`)}s.recordSkillUsage(e.name,t.cityName)}function c$(e,n,t,i){const s=Ie(e).filter(o=>(be(o),o.hp<=15e3));if(s.length>0){const r=dn(s)[0],a=Re(e,r);i.delayedEffects||(i.delayedEffects={}),i.delayedEffects[e.name]||(i.delayedEffects[e.name]={}),i.delayedEffects[e.name][a]={type:"huaguoshan",effectRoundsLeft:2,effectData:{hpMultiplier:2,appliedRound:i.currentRound}},t(`${e.name}${n.cityName}""${r.name}2HP2`)}i.recordSkillUsage(e.name,n.cityName)}function u$(e,n,t,i){i.combatModifiers||(i.combatModifiers={}),i.combatModifiers[e.name]||(i.combatModifiers[e.name]={}),i.combatModifiers[e.name].strikeFirst={active:!0,retreat:!0,roundsLeft:1},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function d$(e,n,t,i){const o=Ie(e).slice(0,3);o.forEach(r=>{Kt(r,3e3)}),t(`${e.name}${n.cityName}""${o.length}3000HP`),i.recordSkillUsage(e.name,n.cityName)}function f$(e,n,t,i){const o=at(e,2e4).slice(0,2);o.forEach(r=>{Ri(r,1.4)}),t(`${e.name}${n.cityName}""${o.length}HP40%`),i.recordSkillUsage(e.name,n.cityName)}function m$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],a=Re(e,r);$t(i,e.name,a,{hp:2e3,roundsLeft:2}),t(`${e.name}${n.cityName}""${r.name}2000HP2`)}i.recordSkillUsage(e.name,n.cityName)}function kh(e,n,t,i,s=null){let o;s&&Array.isArray(s)?o=s.map(a=>e.cities[a]).filter(Boolean):o=at(e,2e4).slice(0,3),o.forEach(a=>{Ri(a,1.2)});const r=o.map(a=>a.name).join("");t(`${e.name}${n.cityName}""${r}HP20%`),i.recordSkillUsage(e.name,n.cityName)}function h$(e,n,t,i){const s=at(e,12e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);qr(i,e.name,a,{type:"xihu",roundsLeft:3,data:{attackMultiplier:3,damageReduction:.5,reductionRounds:2,appliedRound:i.currentRound}}),t(`${e.name}${n.cityName}""${r.name}3`)}i.recordSkillUsage(e.name,n.cityName)}function p$(e,n,t,i){i.skillHidden||(i.skillHidden={}),i.skillHidden[e.name]||(i.skillHidden[e.name]={}),i.skillHidden[e.name]={active:!0,skillsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""2`),i.recordSkillUsage(e.name,n.cityName)}function g$(e,n,t,i){i.attackModifiers||(i.attackModifiers={}),i.attackModifiers[e.name]||(i.attackModifiers[e.name]={}),i.attackModifiers[e.name].calligraphy={active:!0,probability:.2,multiplier:1.5,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""20%50%`),i.recordSkillUsage(e.name,n.cityName)}function y$(e,n,t,i){const s=at(e,1e4);if(s.length>0){const r=dn(s)[0],a=Re(e,r);Ri(r,1.2),i.permanentModifiers||(i.permanentModifiers={}),i.permanentModifiers[e.name]||(i.permanentModifiers[e.name]={}),i.permanentModifiers[e.name][a]={attackMultiplier:2,type:"nanhu",appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${r.name}HP20%HP2`)}i.recordSkillUsage(e.name,n.cityName)}function C$(e,n,t,i){i.clones||(i.clones={}),i.clones[e.name]||(i.clones[e.name]=[]);const s={name:"",hp:5e3,currentHp:5e3,isClone:!0,originalCity:"",createdRound:i.currentRound};i.clones[e.name].push(s),t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function v$(e,n,t,i,s,o){if(t.length>0){const r=Math.floor(Math.random()*t.length),a=t[r];if(a&&a.hp>0){const l=be(a),u=Math.floor(l*.2),{newHp:f}=_t(a,u);a.hp!==void 0&&(a.hp=f);const m=Re(n,a);m!==-1&&(o.bannedCities||(o.bannedCities={}),o.bannedCities[n.name]||(o.bannedCities[n.name]={}),o.bannedCities[n.name][m]={roundsLeft:2,halfHpIfForced:!0,appliedRound:o.currentRound}),s(`${e.name}${i.cityName}""${n.name}${a.name}20%HP2`)}}o.recordSkillUsage(e.name,i.cityName)}function _$(e,n,t,i){const s=at(e,8e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);Dr(i,e.name,a,2,{fullHealOnReturn:!0,originalHp:be(r)}),t(`${e.name}${n.cityName}""${r.name}2`)}i.recordSkillUsage(e.name,n.cityName)}function $$(e,n,t,i,s,o){let r=0;if(t.forEach(a=>{if(a&&a.hp>0){const l=be(a),u=Math.floor(l*.2),{newHp:f}=_t(a,u);a.hp!==void 0&&(a.hp=f),f===0&&l-u<0&&(r+=Math.abs(l-u))}}),r>0&&n.centerIndex!==void 0){const a=n.cities[n.centerIndex];if(a){const l=Math.floor(r*.4);_t(a,l),s(`${e.name}${i.cityName}""${n.name}HP20%${l}${a.name}`)}}else s(`${e.name}${i.cityName}""${n.name}HP20%`);o.recordSkillUsage(e.name,i.cityName)}function w$(e,n,t,i,s,o){const r=Ie(n);if(r.length<5){s(`${e.name}${i.cityName}""5`);return}const a=r.filter(h=>be(h)<=5e3);if(a.length===0){s(`${e.name}${i.cityName}""HP5000`);return}const u=dn(a)[0],f=be(u),m=dn(r).reverse().filter(h=>h!==u).slice(0,3);if(m.length>0){const h=m[Math.floor(Math.random()*m.length)];be(h),u.currentHp=0,u.hp=0,u.isAlive=!1;const{newHp:v}=_t(h,f);h.hp!==void 0&&(h.hp=v),v===0?(h.isAlive=!1,s(`${e.name}${i.cityName}""${n.name}${u.name}${h.name}${h.name}`)):s(`${e.name}${i.cityName}""${n.name}${u.name}${h.name}${f}`)}o.recordSkillUsage(e.name,i.cityName)}function Eh(e,n,t,i){const o=Ie(e).slice(0,2);o.forEach(r=>{Kt(r,1e3)}),t(`${e.name}${n.cityName}""${o.length}1000HP`),i.recordSkillUsage(e.name,n.cityName)}function b$(e,n,t,i){Eh(e,n,t,i)}function Th(e,n,t,i,s=null){let o;s&&Array.isArray(s)?o=s.map(a=>e.cities[a]).filter(Boolean):o=Ie(e).slice(0,2),o.forEach(a=>{Kt(a,1e3)});const r=o.map(a=>a.name).join("");t(`${e.name}${n.cityName}""${r}1000HP`),i.recordSkillUsage(e.name,n.cityName)}function A$(e,n,t,i){const s=at(e,15e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);qr(i,e.name,a,{type:"penglai",roundsLeft:2,data:{hpMultiplier:2,shieldHp:8e3}}),t(`${e.name}${n.cityName}""${r.name}22HP28000HP`)}i.recordSkillUsage(e.name,n.cityName)}function P$(e,n,t,i){const s=at(e,8e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);Dr(i,e.name,a,2,{fullHealOnReturn:!0,originalHp:be(r)}),t(`${e.name}${n.cityName}""${r.name}2`)}i.recordSkillUsage(e.name,n.cityName)}function H$(e,n,t,i){ms(e,n,t,i)}function x$(e,n,t,i){ms(e,n,t,i)}function B$(e,n,t,i){const s=at(e,8e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);Dr(i,e.name,a,2,{fullHealOnReturn:!0,originalHp:be(r)}),t(`${e.name}${n.cityName}""${r.name}2`)}i.recordSkillUsage(e.name,n.cityName)}function S$(e,n,t,i){const s=at(e,2e4);if(s.length>0){const r=dn(s)[0],a=Re(e,r);i.permanentModifiers||(i.permanentModifiers={}),i.permanentModifiers[e.name]||(i.permanentModifiers[e.name]={}),i.permanentModifiers[e.name][a]={attackMultiplier:1.5,type:"taierzhuang",appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${r.name}50%`)}i.recordSkillUsage(e.name,n.cityName)}function I$(e,n,t,i,s){const o=[];if(n.cities.forEach((u,f)=>{u.isAlive!==!1&&(s.knownCities?.[e.name]?.[n.name]?.[f]||o.push({city:u,index:f}))}),o.length<3){i(`${e.name}${t.cityName}""3`);return}const r=[],a=[...o].sort(()=>Math.random()-.5);for(let u=0;u<3&&u<a.length;u++)r.push(a[u]);s.knownCities||(s.knownCities={}),s.knownCities[e.name]||(s.knownCities[e.name]={}),s.knownCities[e.name][n.name]||(s.knownCities[e.name][n.name]={});const l=[];r.forEach(({city:u,index:f})=>{s.knownCities[e.name][n.name][f]=!0,l.push(u.name)}),i(`${e.name}${t.cityName}""${n.name}${l.join("")}`),s.recordSkillUsage(e.name,t.cityName)}function k$(e,n,t,i,s){const o=Ie(n);if(o.length>0){const a=dn(o).reverse()[0],l=Re(n,a);s.bannedCities||(s.bannedCities={}),s.bannedCities[n.name]||(s.bannedCities[n.name]={}),s.bannedCities[n.name][l]={roundsLeft:3,halfHpIfForced:!0,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}${a.name}3`)}s.recordSkillUsage(e.name,t.cityName)}function E$(e,n,t,i){const s=e.cities.find(u=>u.name==="");if(!s)return;const o=be(s);if(!i.cityDatabase){t(`${e.name}${n.cityName}""`);return}const r=Object.values(i.cityDatabase).filter(u=>u.hp>=1e4);if(r.length===0){t(`${e.name}${n.cityName}""HP10000`);return}const a=r[Math.floor(Math.random()*r.length)];i.disguisedCities||(i.disguisedCities={}),i.disguisedCities[e.name]||(i.disguisedCities[e.name]={});const l=Re(e,s);i.disguisedCities[e.name][l]={originalCity:"",disguisedAs:a.name,disguisedHp:a.hp,originalHp:o,revealThreshold:o,roundsLeft:999,appliedRound:i.currentRound},i.knownCities&&Object.keys(i.knownCities).forEach(u=>{i.knownCities[u]?.[e.name]?.[l]&&delete i.knownCities[u][e.name][l]}),t(`${e.name}${n.cityName}""${a.name}`),i.recordSkillUsage(e.name,n.cityName)}function T$(e,n,t,i,s){s.skillRedirect||(s.skillRedirect={}),s.skillRedirect[n.name]={active:!0,targetPlayer:e.name,skillsLeft:1,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}`),s.recordSkillUsage(e.name,t.cityName)}function R$(e,n,t,i){if(!i.availableCities){t(`${e.name}${n.cityName}""`);return}const s=i.availableCities.filter(l=>l.hp<=8e3&&!l.isUsed);if(s.length<2){t(`${e.name}${n.cityName}""2`);return}const r=[...s].sort(()=>Math.random()-.5).slice(0,2);r.forEach(l=>{const u={name:l.name,hp:l.hp,currentHp:l.hp,isAlive:!0,province:l.province,red:0,green:0,blue:0,yellow:0};e.cities.push(u),l.isUsed=!0,e.cities.length<=5&&(i.roster||(i.roster={}),i.roster[e.name]||(i.roster[e.name]=[]),i.roster[e.name].push(e.cities.length-1))});const a=r.map(l=>l.name).join("");t(`${e.name}${n.cityName}""${a}`),i.recordSkillUsage(e.name,n.cityName)}function N$(e,n,t,i){i.centerProtection||(i.centerProtection={}),i.centerProtection[e.name]={active:!0,roundsLeft:3,appliedRound:i.currentRound};const s=e.cities[e.centerIndex];t(`${e.name}${n.cityName}""${s?.name||""}3`),i.recordSkillUsage(e.name,n.cityName)}function M$(e,n,t,i,s,o){o.combatModifiers||(o.combatModifiers={}),o.combatModifiers[e.name]||(o.combatModifiers[e.name]={}),o.combatModifiers[n.name]||(o.combatModifiers[n.name]={}),o.combatModifiers[e.name].attackBoost={active:!0,multiplier:1.5,roundsLeft:1,appliedRound:o.currentRound},o.combatModifiers[n.name].attackDebuff={active:!0,multiplier:.5,roundsLeft:1,appliedRound:o.currentRound},s(`${e.name}${i.cityName}""-50%+50%`),o.recordSkillUsage(e.name,i.cityName)}function D$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],a=Re(e,r);$t(i,e.name,a,{hp:1e4,roundsLeft:5}),t(`${e.name}${n.cityName}""${r.name}10000HP5`)}i.recordSkillUsage(e.name,n.cityName)}function q$(e,n,t,i,s){s.forcedReveal||(s.forcedReveal={}),s.forcedReveal[n.name]={active:!0,roundsLeft:2,targetPlayer:e.name,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}2`),s.recordSkillUsage(e.name,t.cityName)}function L$(e,n,t,i,s){const o=Ie(n);if(o.length<2){i(`${e.name}${t.cityName}""2`);return}const r=dn(o).reverse(),a=r[0],l=r[1],u=Re(n,a),f=Re(n,l);s.damageShare||(s.damageShare={}),s.damageShare[n.name]||(s.damageShare[n.name]={}),s.damageShare[n.name][u]={linkedCityIndex:f,shareRatio:.5,roundsLeft:2,appliedRound:s.currentRound},s.damageShare[n.name][f]={linkedCityIndex:u,shareRatio:.5,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}${a.name}${l.name}2`),s.recordSkillUsage(e.name,t.cityName)}function O$(e,n,t,i){ms(e,n,t,i)}function U$(e,n,t,i){i.projections||(i.projections={}),i.projections[e.name]||(i.projections[e.name]=[]);const s={name:"",hp:1e3,currentHp:1e3,attackBonus:500,defenseBonus:300,roundsLeft:1,appliedRound:i.currentRound};i.projections[e.name].push(s),t(`${e.name}${n.cityName}""1000HP`),i.recordSkillUsage(e.name,n.cityName)}function j$(e,n,t,i){const s=at(e,5e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);Dr(i,e.name,a,2,{fullHealOnReturn:!0,originalHp:be(r)}),t(`${e.name}${n.cityName}""${r.name}2HP`)}i.recordSkillUsage(e.name,n.cityName)}function F$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],a=Re(e,r);$t(i,e.name,a,{hp:2e3,roundsLeft:-1}),t(`${e.name}${n.cityName}""${r.name}2000HP`)}i.recordSkillUsage(e.name,n.cityName)}function V$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s).reverse()[0],a=Re(e,r);i.temporaryAttackBoost||(i.temporaryAttackBoost={}),i.temporaryAttackBoost[e.name]||(i.temporaryAttackBoost[e.name]={}),i.temporaryAttackBoost[e.name][a]={multiplier:2,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${r.name}2`)}i.recordSkillUsage(e.name,n.cityName)}function W$(e,n,t,i,s){if(e.gold<1){i(`${e.name}${t.cityName}""`);return}const o=n.cities.filter(l=>l.isAlive!==!1&&l.hp<=1e4);if(o.length===0){i(`${e.name}${t.cityName}""HP10000`);return}const r=o[Math.floor(Math.random()*o.length)];n.cities.indexOf(r);const a={...r,currentHp:be(r)};r.isAlive=!1,r.currentHp=0,r.hp=0,e.cities.push(a),e.gold-=1,i(`${e.name}${t.cityName}""1${n.name}${a.name}`),s.recordSkillUsage(e.name,t.cityName)}function z$(e,n,t,i){const o=at(e,14999).slice(0,3);o.forEach(r=>{Ri(r,2)}),t(`${e.name}${n.cityName}""${o.length}HP2`),i.recordSkillUsage(e.name,n.cityName)}function G$(e,n,t,i){i.damageReduction||(i.damageReduction={}),i.damageReduction[e.name]||(i.damageReduction[e.name]={}),i.damageReduction[e.name].romanticCoast={active:!0,multiplier:.5,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function J$(e,n,t,i){if(!i.availableCities){t(`${e.name}${n.cityName}""`);return}const s=["",""],o=[],r=[];s.forEach(l=>{const u=It(e,l);if(u)Ri(u,2),r.push(l);else{const f=i.availableCities.find(m=>m.name===l&&!m.isUsed);if(f){const m={name:f.name,hp:f.hp,currentHp:f.hp,isAlive:!0,province:f.province,red:0,green:0,blue:0,yellow:0};e.cities.push(m),f.isUsed=!0,o.push(l)}}});let a=`${e.name}${n.cityName}""`;o.length>0&&(a+=`${o.join("")}`),r.length>0&&(a+=`${r.join("")}`),a+="",t(a),i.recordSkillUsage(e.name,n.cityName)}function Y$(e,n,t,i){const s=It(e,"");if(!s)return;const o=be(s),r=Re(e,s);i.conditionalReduction||(i.conditionalReduction={}),i.conditionalReduction[e.name]||(i.conditionalReduction[e.name]={}),i.conditionalReduction[e.name][r]={type:"foshan",condition:"attackerHpLower",threshold:o,multiplier:.6,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""HP${o}40%`),i.recordSkillUsage(e.name,n.cityName)}function K$(e,n,t,i,s){s.attackNullification||(s.attackNullification={}),s.attackNullification[n.name]||(s.attackNullification[n.name]={}),s.attackNullification[n.name].danxia={active:!0,target:"highestHp",halfDamageIfSingle:!0,roundsLeft:1,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}HP`),s.recordSkillUsage(e.name,t.cityName)}function Z$(e,n,t,i){const s=at(e,8e3);if(s.length>0){const r=dn(s)[0],a=Re(e,r);qr(i,e.name,a,{type:"harbor",roundsLeft:3,data:{fullHeal:!0,hpMultiplier:2,originalHp:r.hp}}),t(`${e.name}${n.cityName}""${r.name}33HP2`)}i.recordSkillUsage(e.name,n.cityName)}function Q$(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s)[0],a=Re(e,r);$t(i,e.name,a,{hp:500,roundsLeft:2,extra:{canConvertToPermanent:!0}}),t(`${e.name}${n.cityName}""${r.name}500HP2HP`)}i.recordSkillUsage(e.name,n.cityName)}function X$(e,n,t,i,s){const o=It(e,"");if(!o)return;const r=Ie(e);if(r.length>0){const l=dn(r)[0],u=Re(e,l);$t(s,e.name,u,{hp:1e4,roundsLeft:-1});const f=be(o),m=Math.floor(f*.5);o.currentHp=m;const h=Math.floor(f*.5);if(n&&n.centerIndex!==void 0){const v=n.cities[n.centerIndex];v&&_t(v,h)}i(`${e.name}${t.cityName}""${l.name}10000HPHP${f} -> ${m}${n.name}${h}`)}s.recordSkillUsage(e.name,t.cityName)}function ew(e,n,t,i){ms(e,n,t,i)}function nw(e,n,t,i){const s=It(e,"");if(!s)return;const{oldMaxHp:o}=Ri(s,1.5),r=Re(e,s);qr(i,e.name,r,{type:"daya_heal",roundsLeft:-1,data:{healPercent:.5,healDelay:3,damageTaken:0,healScheduled:!1,healTriggerRound:null}}),t(`${e.name}${n.cityName}""HP50%${o} -> ${s.hp}350%`),i.recordSkillUsage(e.name,n.cityName)}function tw(e,n,t,i){const s=It(e,"");if(!s)return;const o=["","","","","","",""];let r=0,a=0;if(e.cities.forEach(l=>{l.isAlive!==!1&&o.includes(l.name)&&(r+=be(l),a++)}),r>0){const l=Re(e,s);i.temporaryHpBonus||(i.temporaryHpBonus={}),i.temporaryHpBonus[e.name]||(i.temporaryHpBonus[e.name]={}),i.temporaryHpBonus[e.name][l]={bonus:r,roundsLeft:1,appliedRound:i.currentRound},_t(s,500),t(`${e.name}${n.cityName}""${a}+${r}500HP`)}i.recordSkillUsage(e.name,n.cityName)}function iw(e,n,t,i){if(It(e,"")){const o=It(e,"");o&&(Ri(o,2),t(`${e.name}${n.cityName}""HP2`))}i.recordSkillUsage(e.name,n.cityName)}function sw(e,n,t,i,s){const o=It(e,"");if(o&&n.centerIndex!==void 0){_t(o,100);const r=n.cities[n.centerIndex];r&&(_t(r,1e3),i(`${e.name}${t.cityName}""100HP${n.name}1000`))}s.recordSkillUsage(e.name,t.cityName)}function ow(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s).reverse().find(a=>!a.name.includes("")&&!a.name.includes(""));if(r){const a=Re(e,r);i.allegianceImmunity||(i.allegianceImmunity={}),i.allegianceImmunity[e.name]||(i.allegianceImmunity[e.name]={}),i.allegianceImmunity[e.name][a]={permanent:!0,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${r.name}`)}}i.recordSkillUsage(e.name,n.cityName)}function rw(e,n,t,i){const s=It(e,"");if(!s)return;const o=Re(e,s);i.reviveOnDeath||(i.reviveOnDeath={}),i.reviveOnDeath[e.name]||(i.reviveOnDeath[e.name]={}),i.reviveOnDeath[e.name][o]={active:!0,fullHeal:!0,usedOnce:!1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function aw(e,n,t,i){if(!i.availableCities){t(`${e.name}${n.cityName}""`);return}const s=i.availableCities.filter(a=>a.hp>4e3&&a.hp<1e4&&!a.isUsed);if(s.length===0){t(`${e.name}${n.cityName}""`);return}const o=s[Math.floor(Math.random()*s.length)],r={name:o.name,hp:o.hp,currentHp:o.hp,isAlive:!0,province:o.province,red:0,green:0,blue:0,yellow:0};e.cities.push(r),o.isUsed=!0,t(`${e.name}${n.cityName}""${r.name}HP${o.hp}`),i.recordSkillUsage(e.name,n.cityName)}function lw(e,n,t,i,s){const o=It(e,"");if(!o)return;const r=Re(e,o);s.onDeathEffects||(s.onDeathEffects={}),s.onDeathEffects[e.name]||(s.onDeathEffects[e.name]={}),s.onDeathEffects[e.name][r]={type:"zhongshan",targetOpponent:n.name,condition:"hpBelow2000",excludeCenter:!0,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""HP<2000`),s.recordSkillUsage(e.name,t.cityName)}function cw(e,n,t,i){const s=Ie(e);s.forEach(o=>{const r=Re(e,o);$t(i,e.name,r,{hp:300,roundsLeft:3})}),t(`${e.name}${n.cityName}""${s.length}300HP3`),i.recordSkillUsage(e.name,n.cityName)}function uw(e,n,t,i){const s=at(e,4999);if(s.length>0){const o=s[0];o.currentHp=o.hp,t(`${e.name}${n.cityName}""${o.name}HP`)}i.recordSkillUsage(e.name,n.cityName)}function dw(e,n,t,i){const s=Ie(e);if(s.length>0){const r=dn(s).reverse()[0],a=Re(e,r);i.temporaryAttackBoost||(i.temporaryAttackBoost={}),i.temporaryAttackBoost[e.name]||(i.temporaryAttackBoost[e.name]={}),i.temporaryAttackBoost[e.name][a]={bonus:3e3,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${r.name}+30003`)}i.recordSkillUsage(e.name,n.cityName)}function fw(e,n,t,i,s){if(Ie(n).length<3){i(`${e.name}${t.cityName}""3`);return}s.skillFrozen||(s.skillFrozen={}),s.skillFrozen[n.name]||(s.skillFrozen[n.name]={}),n.cities.forEach((r,a)=>{r.isAlive!==!1&&be(r)>0&&(s.skillFrozen[n.name][a]={roundsLeft:2,appliedRound:s.currentRound})}),i(`${e.name}${t.cityName}""${n.name}2`),s.recordSkillUsage(e.name,t.cityName)}function mw(e,n,t,i){if(e.centerIndex===void 0){t(`${e.name}${n.cityName}""`);return}const s=e.cities[e.centerIndex];if(!s||s.isAlive===!1){t(`${e.name}${n.cityName}""`);return}$t(i,e.name,e.centerIndex,{hp:2e3,roundsLeft:3}),t(`${e.name}${n.cityName}""${s.name}2000HP3`),i.recordSkillUsage(e.name,n.cityName)}function hw(e,n,t,i,s=null){let o,r;if(s!=null)o=e.cities[s],r=s;else{const a=Ie(e);if(a.length===0){t(`${e.name}${n.cityName}""`);return}o=[...a].sort((u,f)=>be(u)-be(f))[0],r=Re(e,o)}if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.mirrorLake||(i.mirrorLake={}),i.mirrorLake[e.name]||(i.mirrorLake[e.name]={}),i.mirrorLake[e.name][r]={roundsLeft:3,reflectChance:.5,reflectPercent:.2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}350%20%`),i.recordSkillUsage(e.name,n.cityName)}function pw(e,n,t,i){const s=Ie(e);if(s.length===0){t(`${e.name}${n.cityName}""`);return}let o=0;s.forEach(r=>{z_(r,1e3),o++}),t(`${e.name}${n.cityName}""${o}HP+1000`),i.recordSkillUsage(e.name,n.cityName)}function gw(e,n,t,i,s=null){let o;if(s&&Array.isArray(s))o=s.map(a=>({city:e.cities[a],idx:a})).filter(a=>a.city);else{const a=Ie(e);if(a.length===0){t(`${e.name}${n.cityName}""`);return}o=[...a].sort((u,f)=>be(f)-be(u)).slice(0,2).map(u=>({city:u,idx:Re(e,u)}))}if(o.length===0){t(`${e.name}${n.cityName}""`);return}const r=[];o.forEach(({city:a,idx:l})=>{$t(i,e.name,l,{hp:2e3,roundsLeft:-1}),i.attackBoost||(i.attackBoost={}),i.attackBoost[e.name]||(i.attackBoost[e.name]={}),i.attackBoost[e.name][l]={multiplier:1.3,type:"daqing",appliedRound:i.currentRound},r.push(a.name)}),t(`${e.name}${n.cityName}""${r.join("")}2000HP30%`),i.recordSkillUsage(e.name,n.cityName)}function yw(e,n,t,i,s){const o=Ie(n);if(o.length===0){i(`${e.name}${t.cityName}""`);return}const r=o[Math.floor(Math.random()*o.length)],a=Re(n,r);s.cannotAttack||(s.cannotAttack={}),s.cannotAttack[n.name]||(s.cannotAttack[n.name]={}),s.cannotAttack[n.name][a]={roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}${r.name}2`),s.recordSkillUsage(e.name,t.cityName)}function Cw(e,n,t,i){const s=e.cities.findIndex(o=>o.name==="");s!==-1&&(i.tempAttackBoost||(i.tempAttackBoost={}),i.tempAttackBoost[e.name]||(i.tempAttackBoost[e.name]={}),i.tempAttackBoost[e.name][s]={bonusAttack:2e3,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+2000`),i.recordSkillUsage(e.name,n.cityName))}function vw(e,n,t,i){const s=e.cities.findIndex(r=>r.name==="");if(s===-1)return;const o=Math.floor(Math.random()*500)+1;i.damageReduction||(i.damageReduction={}),i.damageReduction[e.name]||(i.damageReduction[e.name]={}),i.damageReduction[e.name][s]={amount:o,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o}`),i.recordSkillUsage(e.name,n.cityName)}function _w(e,n,t,i){const s=Ie(e);if(s.length===0){t(`${e.name}${n.cityName}""`);return}const o=s[Math.floor(Math.random()*s.length)],r=be(o);o.currentHp=o.hp,t(`${e.name}${n.cityName}""${o.name}HP${Math.floor(r)}  ${o.hp}`),i.recordSkillUsage(e.name,n.cityName)}function $w(e,n,t,i){const s=Ie(e);if(s.length===0){t(`${e.name}${n.cityName}""`);return}const o=s[Math.floor(Math.random()*s.length)],r=Re(e,o);i.tempAttackBoost||(i.tempAttackBoost={}),i.tempAttackBoost[e.name]||(i.tempAttackBoost[e.name]={}),i.tempAttackBoost[e.name][r]={bonusAttack:2e3,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}+2000`),i.recordSkillUsage(e.name,n.cityName)}function ww(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const r=o.hp;o.hp=o.hp*2,o.currentHp=o.currentHp*2,t(`${e.name}${n.cityName}""HP${r}  ${o.hp}`);const l=["","","","","","","","","","","","",""].filter(f=>!e.cities.some(m=>m.name===f)),u=Math.min(2,l.length);for(let f=0;f<u;f++){const m=Math.floor(Math.random()*l.length),h=l.splice(m,1)[0];vo(e,h,i,t)}i.recordSkillUsage(e.name,n.cityName)}function bw(e,n,t,i,s=null,o=null){const a=Ie(e).filter(u=>be(u)<5e3);if(a.length===0){t(`${e.name}${n.cityName}""HP5000`);return}let l;if(s&&Array.isArray(s)?l=s.map(u=>e.cities[u]).filter(u=>u&&be(u)<5e3):l=a.sort((u,f)=>be(u)-be(f)).slice(0,2),l.forEach(u=>{const f=u.hp;u.hp=u.hp*2,u.currentHp=u.currentHp*2,t(`${e.name}${u.name} HP${f}  ${u.hp}`)}),o){const u=Ie(o).filter(f=>be(f)<5e3);if(u.length>0){const f=u[Math.floor(Math.random()*u.length)],m=Re(o,f.name),h=o.cities.splice(m,1)[0];h.currentHp=h.hp,h.isAlive=!0,e.cities.push(h),t(`${e.name}${o.name}${h.name}`)}}i.recordSkillUsage(e.name,n.cityName)}function Aw(e,n,t,i,s=null){const o=Re(e,n.cityName),r=e.cities[o];if(!r||r.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const a=r.hp;r.hp=r.hp*2,r.currentHp=r.currentHp*2,t(`${e.name}${n.cityName} HP${a}  ${r.hp}`);let l;if(s!=null&&s!==o)l=e.cities[s];else{const f=Ie(e).filter(m=>m.name!==n.cityName);f.length>0&&(l=f.sort((m,h)=>be(m)-be(h))[0])}if(l){const f=l.hp;l.hp=l.hp*2,l.currentHp=l.currentHp*2,t(`${e.name}${l.name} HP${f}  ${l.hp}`)}["",""].forEach(f=>{const m=e.cities.find(h=>h.name===f);if(m){const h=m.hp;m.hp=m.hp*2,m.currentHp=m.currentHp*2,t(`${e.name}${f} HP${h}  ${m.hp}`)}else vo(e,f,i,t)}),i.recordSkillUsage(e.name,n.cityName)}function Pw(e,n,t,i,s=null,o=null){if(!s||o===null){t(`${e.name}${n.cityName}""`);return}const r=s.cities[o];if(!r||r.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(be(r)>=3e4){t(`${e.name}${n.cityName}""HP30000`);return}i.forceDeploy||(i.forceDeploy={}),i.forceDeploy[s.name]||(i.forceDeploy[s.name]={}),i.forceDeploy[s.name][o]={roundsLeft:2,appliedRound:i.currentRound,halvePenalty:!0},t(`${e.name}${n.cityName}""${s.name}${r.name}2`),i.recordSkillUsage(e.name,n.cityName)}function Hw(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const r=o.hp;o.hp=o.hp*2,o.currentHp=o.currentHp*2,t(`${e.name}${n.cityName} HP${r}  ${o.hp}`);const l=["","","","","","","","","","","",""].filter(u=>!e.cities.some(f=>f.name===u));if(l.length>0){const u=Math.floor(Math.random()*l.length),f=l[u];vo(e,f,i,t)}i.recordSkillUsage(e.name,n.cityName)}function xw(e,n,t,i,s=null,o=null){if(!s||o===null){t(`${e.name}${n.cityName}""`);return}const r=s.cities[o];if(!r||r.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const a=r.baseHp||r.hp;if(a>=8e3){t(`${e.name}${n.cityName}""HP8000`);return}const l=r.name;if(r.currentHp=0,r.isAlive=!1,t(`${e.name}${n.cityName}""${s.name}${l}`),Math.random()<.5){const u={name:l,hp:a,currentHp:a,isAlive:!0};e.cities.push(u),t(`${e.name}${l}HP${a}`)}i.recordSkillUsage(e.name,n.cityName)}function Bw(e,n,t,i){i.peachBlossom||(i.peachBlossom={}),i.peachBlossom[e.name]={roundsLeft:2,appliedRound:i.currentRound,secret:!0},t(`${e.name}`,!0,e.name),i.recordSkillUsage(e.name,n.cityName)}function Sw(e,n,t,i,s=null){const r=Ie(e).filter(u=>be(u)<5e3);if(r.length===0){t(`${e.name}${n.cityName}""HP5000`);return}let a;s&&Array.isArray(s)?a=s.map(u=>e.cities[u]).filter(u=>u&&be(u)<5e3):a=r.sort((u,f)=>be(u)-be(f)).slice(0,2);const l=Math.min(2,a.length);for(let u=0;u<l;u++){const f=a[u],m=f.hp;f.hp=f.hp*2,f.currentHp=f.currentHp*2,t(`${e.name}${f.name} HP${m}  ${f.hp}`)}i.recordSkillUsage(e.name,n.cityName)}function Iw(e,n,t,i,s=null,o=null,r=null){const a=Re(e,n.cityName),l=e.cities[a];if(!l||l.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const u=l.hp;l.hp=l.hp*2,l.currentHp=l.currentHp*2,t(`${e.name}${n.cityName} HP${u}  ${l.hp}`);const f=Ie(e).filter(h=>h.name!==n.cityName&&be(h)<8e3);let m;if(s!=null&&s!==a?(m=e.cities[s],be(m)>=8e3&&(t(`${e.name}${n.cityName}${m.name}HP8000`),m=null)):f.length>0&&(m=f.sort((h,v)=>be(h)-be(v))[0]),m){const h=m.hp;m.hp=m.hp*2,m.currentHp=m.currentHp*2,t(`${e.name}${m.name} HP${h}  ${m.hp}`)}if(o&&r!==null){const h=o.cities[r];h&&(i.skillBanned||(i.skillBanned={}),i.skillBanned[o.name]||(i.skillBanned[o.name]={}),i.skillBanned[o.name][r]||(i.skillBanned[o.name][r]=[]),i.skillBanned[o.name][r].push(""),t(`${o.name}${h.name}""`))}i.recordSkillUsage(e.name,n.cityName)}function kw(e,n,t,i){i.summonIntercept||(i.summonIntercept={}),i.summonIntercept[e.name]={active:!0,hpThreshold:5e3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""HP`),i.recordSkillUsage(e.name,n.cityName)}function Ew(e,n,t,i,s=null){const r=Ie(e).filter(u=>be(u)<1e4);if(r.length===0){t(`${e.name}${n.cityName}""HP10000`);return}let a;s&&Array.isArray(s)?a=s.map(u=>e.cities[u]).filter(u=>u&&be(u)<1e4):a=r.sort((u,f)=>be(u)-be(f)).slice(0,2);const l=Math.min(2,a.length);for(let u=0;u<l;u++){const f=a[u],m=f.hp;f.hp=f.hp*2,f.currentHp=f.currentHp*2,t(`${e.name}${f.name} HP${m}  ${f.hp}`)}i.recordSkillUsage(e.name,n.cityName)}function Tw(e,n,t,i,s=null,o=null){if(s===null||o===null||s===o){t(`${e.name}${n.cityName}""`);return}const r=e.cities[s],a=e.cities[o];if(!r||!a){t(`${e.name}${n.cityName}""`);return}i.skillSwap||(i.skillSwap={}),i.skillSwap[e.name]||(i.skillSwap[e.name]={});const l=i.skillSwap[e.name][s]||r.name;i.skillSwap[e.name][s]=i.skillSwap[e.name][o]||a.name,i.skillSwap[e.name][o]=l,t(`${e.name}${n.cityName}""${r.name}${a.name}`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:1,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName)}function Rw(e,n,t,i){const s=Re(e,n.cityName),o=e.centerIndex||0;i.ironCities||(i.ironCities={}),i.ironCities[e.name]||(i.ironCities[e.name]={}),i.ironCities[e.name][s]={roundsLeft:-1,permanent:!0},i.ironCities[e.name][o]={roundsLeft:-1,permanent:!0},i.ironCityLimit||(i.ironCityLimit={}),i.ironCityLimit[e.name]=(i.ironCityLimit[e.name]||0)+2,t(`${e.name}${n.cityName}""${n.cityName}${e.cities[o].name}+2`),i.recordSkillUsage(e.name,n.cityName)}function Nw(e,n,t,i){i.damageReduction||(i.damageReduction={}),i.damageReduction[e.name]||(i.damageReduction[e.name]={});const s=["","",""];e.cities.filter(r=>r.province&&s.includes(r.province)).forEach(r=>{const a=Re(e,r.name);i.damageReduction[e.name][a]={percentage:.75,permanent:!0,source:""}}),t(`${e.name}${n.cityName}""75%`),i.recordSkillUsage(e.name,n.cityName)}function Mw(e,n,t,i,s=null){const o=Re(e,n.cityName),r=e.cities[o];if(!r||r.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(s===null||s===o){t(`${e.name}${n.cityName}""`);return}const a=e.cities[s];if(!a||a.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const l=a.hp,u=a.currentHp;a.hp=r.hp,a.currentHp=r.currentHp,t(`${e.name}${n.cityName}""${a.name}HP${l}(${u})${a.hp}(${a.currentHp})`),i.recordSkillUsage(e.name,n.cityName)}function Dw(e,n,t,i,s=null){if(!s){t(`${e.name}${n.cityName}""`);return}i.skillEnhance||(i.skillEnhance={}),i.skillEnhance[e.name]||(i.skillEnhance[e.name]={}),i.skillEnhance[e.name][s]={targetBonus:1,appliedRound:i.currentRound,duration:1},t(`${e.name}${n.cityName}"""${s}"+1`),i.recordSkillUsage(e.name,n.cityName)}function qw(e,n,t,i){i.bishushanzhuang||(i.bishushanzhuang={}),i.bishushanzhuang[e.name]={active:!0,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:4,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName)}function Lw(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const r=be(o),a=e.cities.filter(l=>l.name!==n.cityName&&be(l)>r*20);if(a.length<2){t(`${e.name}${n.cityName}""2HP20`);return}i.langfangAwaken||(i.langfangAwaken={}),i.langfangAwaken[e.name]={active:!0,cityIndex:s,bigCityIndices:a.map(l=>Re(e,l.name)),appliedRound:i.currentRound},t(`${e.name}${n.cityName}""HP`),i.recordSkillUsage(e.name,n.cityName)}function Ow(e,n,t,i){i.hengshuiMode||(i.hengshuiMode={}),i.hengshuiMode[e.name]={active:!0,increaseMultiplier:2,decreaseMultiplier:1.5,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""HP21.5`),i.recordSkillUsage(e.name,n.cityName)}function Uw(e,n,t,i){if(i.currentRound<17){t(`${e.name}${n.cityName}""17`);return}const s=Re(e,n.cityName);if(!(!i.knownCities||Object.values(i.knownCities).every(a=>!a[e.name]||!a[e.name].has(s)))){t(`${e.name}${n.cityName}""`);return}e.cities.find(a=>a.name==="")?t(`${e.name}${n.cityName}""`):summonCity(e,"",i,t),i.recordSkillUsage(e.name,n.cityName)}function jw(e,n,t,i){const s=`${e.name}_${n.cityName}_`;if((i.skillUsageCount[s]||0)>=2){t(`${e.name}${n.cityName}""2`);return}if(e.gold<3){t(`${e.name}${n.cityName}""`);return}e.gold-=3,i.delayedSkillGain||(i.delayedSkillGain={}),i.delayedSkillGain[e.name]||(i.delayedSkillGain[e.name]=[]),i.delayedSkillGain[e.name].push({triggerRound:i.currentRound+5,appliedRound:i.currentRound,cityName:n.cityName}),t(`${e.name}${n.cityName}""35`),i.recordSkillUsage(e.name,n.cityName),i.skillUsageCount[s]||(i.skillUsageCount[s]=0),i.skillUsageCount[s]++}function Fw(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.barrier||(i.barrier={});const r=be(o);i.barrier[e.name]={hp:r,maxHp:r,appliedRound:i.currentRound,source:""},t(`${e.name}${n.cityName}""${r}HP`),i.recordSkillUsage(e.name,n.cityName)}function Vw(e,n,t,i,s=null){if(s===null){t(`${e.name}${n.cityName}""`);return}const o=e.cities[s];if(!o){t(`${e.name}${n.cityName}""`);return}if((o.baseHp||o.hp)>1e4){t(`${e.name}${n.cityName}""HP10000`);return}if(!i.cityHistory||!i.cityHistory[e.name]||!i.cityHistory[e.name][s]){t(`${e.name}${n.cityName}""5`);return}const a=i.cityHistory[e.name][s],l=i.currentRound-5,u=a.find(m=>m.round===l);if(!u){t(`${e.name}${n.cityName}""5`);return}const f=o.currentHp;o.hp=u.hp,o.currentHp=u.currentHp,o.isAlive=u.isAlive,t(`${e.name}${n.cityName}""${o.name}${f}HP5${u.currentHp}HP`),i.recordSkillUsage(e.name,n.cityName)}function Ww(e,n,t,i,s=null){if(s===null){t(`${e.name}${n.cityName}""`);return}const o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(!(!i.knownCities||Object.values(i.knownCities).every(v=>!v[e.name]||!v[e.name].has(s)))){t(`${e.name}${n.cityName}""`);return}const a=i.cityDatabase||[],l=a.find(v=>v.name===o.name);if(!l){t(`${e.name}${n.cityName}""`);return}const u=l.gdpRank;if(!u){t(`${e.name}${n.cityName}""GDP`);return}const f=a.find(v=>v.gdpRank===u-1);if(!f){t(`${e.name}${n.cityName}""GDP`);return}if(e.cities.some(v=>v.name===f.name)){t(`${e.name}${n.cityName}""${f.name}`);return}const h=o.name;o.name=f.name,o.hp=f.hp,o.currentHp=f.hp,o.province=f.province,o.isAlive=!0,t(`${e.name}${n.cityName}""${h}GDP${f.name}`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:1,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName)}function zw(e,n,t,i){i.buddhaBless||(i.buddhaBless={}),i.buddhaBless[e.name]={active:!0,hpPerRound:500,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""HP500`),i.recordSkillUsage(e.name,n.cityName)}function Gw(e,n,t,i){const o=Ie(e).reduce((r,a)=>r+be(a),0);i.hukouWaterfall||(i.hukouWaterfall={}),i.hukouWaterfall[e.name]={totalPower:o,appliedRound:i.currentRound,duration:1},t(`${e.name}${n.cityName}""HP${o}`),i.recordSkillUsage(e.name,n.cityName)}function Jw(e,n,t,i,s=null,o=null){const r=`${e.name}_${n.cityName}_`;if((i.skillUsageCount[r]||0)>=2){t(`${e.name}${n.cityName}""2`);return}if(!s||!o){t(`${e.name}${n.cityName}""`);return}i.rareEarthBoost||(i.rareEarthBoost={}),i.rareEarthBoost[e.name]||(i.rareEarthBoost[e.name]={}),i.rareEarthBoost[e.name][s]={numberType:o,multiplier:2,appliedRound:i.currentRound,duration:1},t(`${e.name}${n.cityName}"""${s}"${o}2`),i.recordSkillUsage(e.name,n.cityName),i.skillUsageCount[r]||(i.skillUsageCount[r]=0),i.skillUsageCount[r]++}function Yw(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o){t(`${e.name}${n.cityName}""`);return}i.coalReserve||(i.coalReserve={}),i.coalReserve[e.name]={cityIndex:s,coalCount:15,initialHp:o.hp,appliedRound:i.currentRound};const r=o.hp*15;o.hp=r,o.currentHp=r,t(`${e.name}${n.cityName}""15""HP${r}HP15`),i.recordSkillUsage(e.name,n.cityName)}function Kw(e,n,t,i){const s=`${e.name}_${n.cityName}__round${i.currentRound}`;if(i.skillUsageThisRound&&i.skillUsageThisRound[s]){t(`${e.name}${n.cityName}""`);return}const r=(i.cityDatabase||[]).filter(l=>l.hp<=1e3&&!e.cities.some(u=>u.name===l.name));if(r.length===0){t(`${e.name}${n.cityName}""HP1000`);return}const a=r[Math.floor(Math.random()*r.length)];vo(e,a.name,i,t),i.skillUsageThisRound||(i.skillUsageThisRound={}),i.skillUsageThisRound[s]=!0,i.recordSkillUsage(e.name,n.cityName)}function Zw(e,n,t,i,s=null,o=null){if(!s||o===null){t(`${e.name}${n.cityName}""`);return}const r=s.cities[o];if(!r||r.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(o===(s.centerIndex||0)){t(`${e.name}${n.cityName}""`);return}if(!(i.knownCities&&i.knownCities[e.name]&&i.knownCities[e.name][s.name]&&i.knownCities[e.name][s.name].has(o))){t(`${e.name}${n.cityName}""`);return}const l=Math.floor(be(r)/3e3);if(e.gold<l){t(`${e.name}${n.cityName}""${l}`);return}e.gold-=l;const u=s.cities.splice(o,1)[0];u.currentHp=u.hp,u.isAlive=!0,e.cities.push(u),t(`${e.name}${n.cityName}""${l}${s.name}${u.name}`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:4,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName)}function Qw(e,n,t,i,s=null,o="send"){const r=Re(e,n.cityName);if(i.spaceStation||(i.spaceStation={}),i.spaceStation[e.name]||(i.spaceStation[e.name]={}),i.spaceStation[e.name][r]||(i.spaceStation[e.name][r]={inStation:!0,enterRound:0,returnRound:null,isInitial:!0}),o==="send"){if(s===null){t(`${e.name}${n.cityName}""`);return}const a=e.cities[s];if(!a||a.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(i.spaceStation[e.name][s]){t(`${e.name}${n.cityName}""`);return}i.spaceStation[e.name][s]={inStation:!0,enterRound:i.currentRound,returnRound:i.currentRound+10,isInitial:!1},t(`${e.name}${n.cityName}""${a.name}10`),i.recordSkillUsage(e.name,n.cityName)}else if(o==="return"){const a=i.spaceStation[e.name][r];if(!a||!a.inStation){t(`${e.name}${n.cityName}`);return}if(!a.isInitial){t(`${e.name}${n.cityName}`);return}a.inStation=!1;const u=["","",""].filter(f=>!e.cities.some(m=>m.name===f));if(u.length>0){const f=u[Math.floor(Math.random()*u.length)];vo(e,f,i,t),t(`${e.name}${n.cityName}${f}`)}else t(`${e.name}${n.cityName}`)}}function Xw(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];!o||o.isAlive===!1||(i.mindurong||(i.mindurong={}),i.mindurong[e.name]||(i.mindurong[e.name]={active:!0,discountPercent:0,usedSkills:new Set,appliedRound:i.currentRound}),t(`${e.name}${n.cityName}""5%`),i.recordSkillUsage(e.name,n.cityName))}function eb(e,n,t,i){i.mazuBlessing||(i.mazuBlessing={}),i.mazuBlessing[e.name]={active:!0,dodgeChance:.2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""20%`),i.recordSkillUsage(e.name,n.cityName)}function nb(e,n,t,i){const s=Re(e,n.cityName);if(!(!i.knownCities||Object.values(i.knownCities).every(r=>!r[e.name]||!r[e.name].has(s)))){t(`${e.name}${n.cityName}""`);return}i.haiSiOrigin||(i.haiSiOrigin={}),i.haiSiOrigin[e.name]||(i.haiSiOrigin[e.name]={active:!0,freeSkillsAvailable:["","",""],freeSkillCount:0,canUseFreeSkill:!0,nextFreeRound:i.currentRound+3,appliedRound:i.currentRound}),t(`${e.name}${n.cityName}""3`),i.recordSkillUsage(e.name,n.cityName)}function tb(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];!o||o.isAlive===!1||(i.seaGarden||(i.seaGarden={}),i.seaGarden[e.name]||(i.seaGarden[e.name]={active:!0,damageReduction:.5,firstDeploy:!0,xiamenInitialHp:o.hp,opponentHighDamageRounds:[],canReactivate:!1,appliedRound:i.currentRound}),t(`${e.name}${n.cityName}""50%`),i.recordSkillUsage(e.name,n.cityName))}function ib(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!(!o||o.isAlive===!1)){if(i.narcissus||(i.narcissus={}),!i.narcissus[e.name]){const r=be(o);i.narcissus[e.name]={active:!0,zhangzhouPower:r,targetTotalDamage:r*5,minDamagePerRound:r,damageRounds:[],canDoubleEffect:!1,appliedRound:i.currentRound}}t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}}function sb(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];!o||o.isAlive===!1||(i.gutianConference||(i.gutianConference={}),i.gutianConference[e.name]||(i.gutianConference[e.name]={active:!0,skillCount:0,discounts:[1,2,3,4,5],bonusSkill:null,bonusSkillAvailableUntil:null,appliedRound:i.currentRound}),t(`${e.name}${n.cityName}""51-5`),i.recordSkillUsage(e.name,n.cityName))}function ob(e,n,t,i){const s=Re(e,n.cityName);if(!(e.roster&&e.roster.includes(s))){t(`${e.name}${n.cityName}""`);return}i.minrenOrigin||(i.minrenOrigin={}),i.minrenOrigin[e.name]||(i.minrenOrigin[e.name]={active:!0,baseDamageReduction:.05,currentDamageReduction:.05,maxDamageReduction:.25,incrementPerSkill:.05,nextTriggerRound:i.currentRound+3,appliedRound:i.currentRound}),t(`${e.name}${n.cityName}""5%5%`),i.recordSkillUsage(e.name,n.cityName)}function rb(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.wuyiMountain||(i.wuyiMountain={}),i.wuyiMountain[e.name]={active:!0,maxCostForDiscount:6,discountRate:.5,roundUp:!0,appliedRound:i.currentRound,duration:1},t(`${e.name}${n.cityName}""6`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:2,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName)}function ab(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.fudingMeat||(i.fudingMeat={}),i.fudingMeat[e.name]={active:!0,healingSkills:["","",""],discountRate:.5,appliedRound:i.currentRound,duration:1},t(`${e.name}${n.cityName}""`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:3,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName)}function lb(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.bayiMemory||(i.bayiMemory={}),i.bayiMemory[e.name]={active:!0,cityIndex:s,initialHp:o.hp,roundsTracked:3,startRound:i.currentRound,killCount:0,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""3nHPHPn`),i.recordSkillUsage(e.name,n.cityName)}function cb(e,n,t,i,s=null){const o=e.centerIndex||0,r=e.cities[o];if(!r){t(`${e.name}${n.cityName}""`);return}const a=r.hp;if(be(r)>=a/2){t(`${e.name}${n.cityName}""HPHP`);return}if(s===null||s===o){t(`${e.name}${n.cityName}""`);return}const l=e.cities[s];if(!l||l.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const u=r.currentHp;r.currentHp=r.currentHp*1.5;const f=l.currentHp;l.currentHp=l.currentHp*2,l.hp=l.hp*2,e.centerIndex=s,t(`${e.name}${n.cityName}""${r.name}HP50%${Math.floor(u)}  ${Math.floor(r.currentHp)}${l.name}HP2${Math.floor(f)}  ${Math.floor(l.currentHp)}`),i.recordSkillUsage(e.name,n.cityName)}function ub(e,n,t,i,s=null){if(s===null){t(`${e.name}${n.cityName}""`);return}const o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(be(o)>8e3){t(`${e.name}${n.cityName}""HP8000`);return}i.mingyueMountain||(i.mingyueMountain={}),i.mingyueMountain[e.name]||(i.mingyueMountain[e.name]={}),i.mingyueMountain[e.name][s]={offFieldRounds:2,returnRound:i.currentRound+2,restoreToInitialHp:!0,initialHp:o.hp,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}2HP${o.hp}`),i.recordSkillUsage(e.name,n.cityName)}function db(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.jinggangMountain||(i.jinggangMountain={});const r=be(o),a=o.hp;i.jinggangMountain[e.name]={active:!0,cityIndex:s,roundsLeft:3,damagePerRound:Math.floor(r*.5),overflowDamagePercent:.1,startRound:i.currentRound,endRound:i.currentRound+3,initialHp:a,restoreAndMultiply:!0,secret:!0,appliedRound:i.currentRound},t(`${e.name}`,!0,e.name),i.recordSkillUsage(e.name,n.cityName)}function fb(e,n,t,i,s=null,o=null){if(!s||!o||o.length!==3){t(`${e.name}${n.cityName}""3`);return}const r=o.filter(u=>{const f=s.cities[u];return f&&f.isAlive!==!1});if(r.length===0){t(`${e.name}${n.cityName}""`);return}let a=0;const l=[];if(r.forEach(u=>{const f=s.cities[u],m=f.currentHp;f.currentHp-=3e3,f.currentHp<=0?(f.currentHp=0,f.isAlive=!1,a++,t(`${s.name}${f.name}${n.cityName}`)):(l.push(u),t(`${s.name}${f.name}3000${m}  ${f.currentHp}`))}),a>0&&l.length>0){const u=1e3*a;l.forEach(f=>{const m=s.cities[f],h=m.currentHp;m.currentHp-=u,m.currentHp<=0?(m.currentHp=0,m.isAlive=!1,t(`${s.name}${m.name}`)):t(`${s.name}${m.name}${u}${h}  ${m.currentHp}`)})}t(`${e.name}${n.cityName}""${a}`),i.recordSkillUsage(e.name,n.cityName)}function mb(e,n,t,i,s=null){const o=Re(e,n.cityName),r=e.cities[o];if(!r){t(`${e.name}${n.cityName}""`);return}const a=r.province;if(["","","","","",""].includes(a)){t(`${e.name}${n.cityName}""`);return}if(s===null){t(`${e.name}${n.cityName}""`);return}const u=e.centerIndex||0;if(s===u){t(`${e.name}${n.cityName}""`);return}const f=e.cities[s];if(!f||f.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const m=e.cities.filter(v=>v.province===a&&v.isAlive!==!1);if(m.length===0){t(`${e.name}${n.cityName}""`);return}const h=Math.min(...m.map(v=>be(v)));i.lushanShield||(i.lushanShield={}),i.lushanShield[e.name]||(i.lushanShield[e.name]={}),i.lushanShield[e.name][s]={shieldHp:h,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${f.name}${h}HP`),i.recordSkillUsage(e.name,n.cityName)}function hb(e,n,t,i){const s=`${e.name}_${n.cityName}_`;if((i.skillUsageCount[s]||0)>=2){t(`${e.name}${n.cityName}""2`);return}i.porcelainShield||(i.porcelainShield={}),i.porcelainShield[e.name]={active:!0,reflectPercent:.5,appliedRound:i.currentRound,duration:1},t(`${e.name}${n.cityName}""50%`),i.recordSkillUsage(e.name,n.cityName),i.skillUsageCount[s]||(i.skillUsageCount[s]=0),i.skillUsageCount[s]++}function pb(e,n,t,i,s=null,o=null){if(i.currentRound<5){t(`${e.name}${n.cityName}""5`);return}const r=`${e.name}_${n.cityName}_`;if((i.skillUsageCount[r]||0)>=2){t(`${e.name}${n.cityName}""2`);return}if(!s||o===null){t(`${e.name}${n.cityName}""`);return}const l=s.cities[o];if(!l||l.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(!(!i.knownCities||!i.knownCities[e.name]||!i.knownCities[e.name][s.name]||!i.knownCities[e.name][s.name].has(o))){t(`${e.name}${n.cityName}""`);return}l.currentHp,l.currentHp-=3e3,l.currentHp<=0?(l.currentHp=0,l.isAlive=!1,t(`${e.name}${n.cityName}""${s.name}`)):t(`${e.name}${n.cityName}""${s.name}3000`),i.skillCooldown||(i.skillCooldown={}),i.skillCooldown[e.name]||(i.skillCooldown[e.name]={}),i.skillCooldown[e.name][n.cityName]={roundsLeft:3,appliedRound:i.currentRound},i.recordSkillUsage(e.name,n.cityName),i.skillUsageCount[r]||(i.skillUsageCount[r]=0),i.skillUsageCount[r]++}function gb(e,n,t,i,s=null){const r=Ie(e).filter(u=>be(u)<5e3);if(r.length===0){t(`${e.name}${n.cityName}""HP5000`);return}let a;s&&Array.isArray(s)?a=s.map(u=>e.cities[u]).filter(u=>u&&be(u)<5e3):a=r.sort((u,f)=>be(u)-be(f)).slice(0,3);const l=Math.min(3,a.length);for(let u=0;u<l;u++){const f=a[u],m=f.hp;f.hp=f.hp*2,f.currentHp=f.currentHp*2,t(`${e.name}${f.name} HP${m}  ${f.hp}`)}t(`${e.name}${n.cityName}""${l}HP`),i.recordSkillUsage(e.name,n.cityName)}function yb(e,n,t,i){const s=Re(e,n.cityName),o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}i.southSeaGuard||(i.southSeaGuard={}),i.southSeaGuard[e.name]={active:!0,cityIndex:s,triggered:!1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function Cb(e,n,t,i,s=null,o=null){if(!s||o===null){t(`${e.name}${n.cityName}""`);return}const r=s.cities[o];if(!r||r.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(be(r)>=5e3){t(`${e.name}${n.cityName}""HP5000`);return}if(!(i.knownCities&&i.knownCities[e.name]&&i.knownCities[e.name][s.name]&&i.knownCities[e.name][s.name].has(o))){t(`${e.name}${n.cityName}""`);return}const l=Re(e,n.cityName),u=e.cities[l];if(!u||u.isAlive===!1){t(`${e.name}${n.cityName}""`);return}const f=u.currentHp,m=u.hp,h=r.currentHp,v=r.hp;u.currentHp=h,u.hp=v,r.currentHp=f,r.hp=m,t(`${e.name}${n.cityName}""${s.name}${r.name}HP${f}${u.currentHp}${r.name}${h}${r.currentHp}`),i.recordSkillUsage(e.name,n.cityName)}function vb(e,n,t,i,s=null){if(!s){t(`${e.name}${n.cityName}""`);return}i.wenchangSatellite||(i.wenchangSatellite={}),i.wenchangSatellite[e.name]={active:!0,targetPlayer:s.name,roundsLeft:2,startRound:i.currentRound,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""2${s.name}`,!0,e.name),i.recordSkillUsage(e.name,n.cityName)}function _b(e,n,t,i,s=null){if(s===null){t(`${e.name}${n.cityName}""`);return}const o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(be(o)>5e3){t(`${e.name}${n.cityName}""HP5000`);return}i.shenzhouPeninsula||(i.shenzhouPeninsula={}),i.shenzhouPeninsula[e.name]||(i.shenzhouPeninsula[e.name]={}),i.shenzhouPeninsula[e.name][s]={offFieldRounds:2,returnRound:i.currentRound+2,fullHealOnReturn:!0,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}2`),i.recordSkillUsage(e.name,n.cityName)}function $b(e,n,t,i,s=null){if(s===null){t(`${e.name}${n.cityName}""`);return}const o=e.cities[s];if(!o||o.isAlive===!1){t(`${e.name}${n.cityName}""`);return}if(be(o)>8e3){t(`${e.name}${n.cityName}""HP8000`);return}i.wuzhiMountain||(i.wuzhiMountain={}),i.wuzhiMountain[e.name]||(i.wuzhiMountain[e.name]={}),i.wuzhiMountain[e.name][s]={bannedRounds:3,returnRound:i.currentRound+3,hpMultiplier:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}33HP3`),i.recordSkillUsage(e.name,n.cityName)}function wb(e,n,t,i){i.powerBoost||(i.powerBoost={}),i.powerBoost[e.name]||(i.powerBoost[e.name]={}),i.powerBoost[e.name].shengJingGlory={active:!0,multiplier:1.15,roundsLeft:2,appliedRound:i.currentRound},i.deathImmunity||(i.deathImmunity={}),i.deathImmunity[e.name]||(i.deathImmunity[e.name]={});const s=e.centerIndex??0;i.deathImmunity[e.name][s]={active:!0,count:1},t(`${e.name}${n.cityName}""+15%2`),i.recordSkillUsage(e.name,n.cityName)}function bb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.reflectDamage||(i.reflectDamage={}),i.reflectDamage[e.name]||(i.reflectDamage[e.name]={}),i.reflectDamage[e.name][r]={active:!0,chance:.5,multiplier:.5,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}50%50%3`),i.recordSkillUsage(e.name,n.cityName)}function Ab(e,n,t,i){const s=e.centerIndex??0,o=e.cities[s];$t(o,3e3,3),t(`${e.name}${n.cityName}""${o.name}30003`),i.recordSkillUsage(e.name,n.cityName)}function Pb(e,n,t,i){let s=0;e.cities.forEach(o=>{if(o.isAlive!==!1){const r=o.initialHp||o.hp,a=Math.floor(r*.5);be(o)<a&&(o.currentHp=a,o.hp=a,s++)}}),t(`${e.name}${n.cityName}""${s}HP50%`),i.recordSkillUsage(e.name,n.cityName)}function Hb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.damageReduction||(i.damageReduction={}),i.damageReduction[e.name]||(i.damageReduction[e.name]={}),i.damageReduction[e.name][r]||(i.damageReduction[e.name][r]={}),i.damageReduction[e.name][r].benxiCave={active:!0,multiplier:.7,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}30%2`),i.recordSkillUsage(e.name,n.cityName)}function xb(e,n,t,i,s){s.attackMiss||(s.attackMiss={}),s.attackMiss[n.name]={active:!0,chance:.2,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}20%2`),s.recordSkillUsage(e.name,t.cityName)}function Bb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.battleHealing||(i.battleHealing={}),i.battleHealing[e.name]||(i.battleHealing[e.name]={}),i.battleHealing[e.name][r]={active:!0,amount:1e3,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}1000HP3`),i.recordSkillUsage(e.name,n.cityName)}function Sb(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;const r=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],a=tn(o),l=n.cities.indexOf(a);if(r.includes(a.name)){i(`${e.name}${t.cityName}""${a.name}`);return}s.bayuTrap||(s.bayuTrap={}),s.bayuTrap[n.name]||(s.bayuTrap[n.name]={}),s.bayuTrap[n.name][l]={active:!0,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}${a.name}`),s.recordSkillUsage(e.name,t.cityName)}function Ib(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.counterWeaken||(i.counterWeaken={}),i.counterWeaken[e.name]||(i.counterWeaken[e.name]={}),i.counterWeaken[e.name][r]={active:!0,chance:.4,multiplier:.8,duration:1,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}40%20%2`),i.recordSkillUsage(e.name,n.cityName)}function kb(e,n,t,i){i.defenseBoost||(i.defenseBoost={}),i.defenseBoost[e.name]||(i.defenseBoost[e.name]={}),i.defenseBoost[e.name].whiteTower={active:!0,multiplier:1.15,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+15%2`),i.recordSkillUsage(e.name,n.cityName)}function Eb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.poisonCounter||(i.poisonCounter={}),i.poisonCounter[e.name]||(i.poisonCounter[e.name]={}),i.poisonCounter[e.name][r]={active:!0,chance:.3,damage:500,duration:2,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}30%3`),i.recordSkillUsage(e.name,n.cityName)}function Tb(e,n,t,i,s){(Math.random()<.5?"buff":"debuff")==="buff"?(s.powerBoost||(s.powerBoost={}),s.powerBoost[e.name]||(s.powerBoost[e.name]={}),s.powerBoost[e.name].xiaopinBoost={active:!0,multiplier:1.5,roundsLeft:1,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""+50%`)):(s.powerReduction||(s.powerReduction={}),s.powerReduction[n.name]||(s.powerReduction[n.name]={}),s.powerReduction[n.name].xiaopinDebuff={active:!0,multiplier:.5,roundsLeft:1,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}-50%`)),s.recordSkillUsage(e.name,t.cityName)}function Rb(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;const r=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],a=o.filter(h=>!r.includes(h.name)),l=Math.min(5,a.length);if(l===0){i(`${e.name}${t.cityName}""`);return}const f=[...a].sort(()=>Math.random()-.5).slice(0,l);s.seaWaves||(s.seaWaves={}),s.seaWaves[n.name]||(s.seaWaves[n.name]={}),f.forEach(h=>{const v=n.cities.indexOf(h);s.seaWaves[n.name][v]={active:!0,damage:500,roundsLeft:5,appliedRound:s.currentRound}});const m=f.map(h=>h.name).join("");i(`${e.name}${t.cityName}""${n.name}${m}5005`),s.recordSkillUsage(e.name,t.cityName)}function Nb(e,n,t,i){i.powerBoost||(i.powerBoost={}),i.powerBoost[e.name]||(i.powerBoost[e.name]={}),i.powerBoost[e.name].autoCity={active:!0,multiplier:1.2,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+20%2`),i.recordSkillUsage(e.name,n.cityName)}function Mb(e,n,t,i,s){if(Ie(n).length<3){i(`${e.name}${t.cityName}""3`);return}s.skillDisabled||(s.skillDisabled={}),s.skillDisabled[n.name]={active:!0,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}2`),s.recordSkillUsage(e.name,t.cityName)}function Db(e,n,t,i,s){const o=Ie(n);if(o.length<2){i(`${e.name}${t.cityName}""2`);return}const r=tn(o);be(r)<=1e3?(r.currentHp=0,r.hp=0,r.isAlive=!1,i(`${e.name}${t.cityName}""${n.name}${r.name}`)):(_t(r,1e3),i(`${e.name}${t.cityName}""${n.name}${r.name}1000HP`)),s.recordSkillUsage(e.name,t.cityName)}function qb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.nextBattleEffect||(i.nextBattleEffect={}),i.nextBattleEffect[e.name]||(i.nextBattleEffect[e.name]={}),i.nextBattleEffect[e.name][r]={active:!0,powerMultiplier:1.4,hpMultiplier:.5,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}+40%HP`),i.recordSkillUsage(e.name,n.cityName)}function Lb(e,n,t,i){i.skillBoost||(i.skillBoost={}),i.skillBoost[e.name]||(i.skillBoost[e.name]={}),i.skillBoost[e.name].heroCity={active:!0,multiplier:1.15,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+15%3`),i.recordSkillUsage(e.name,n.cityName)}function Ob(e,n,t,i){i.hpRegen||(i.hpRegen={}),i.hpRegen[e.name]||(i.hpRegen[e.name]={}),i.hpRegen[e.name].deerHome={active:!0,percent:.04,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""4%HP3`),i.recordSkillUsage(e.name,n.cityName)}function Ub(e,n,t,i){i.skillBoost||(i.skillBoost={}),i.skillBoost[e.name]||(i.skillBoost[e.name]={}),i.skillBoost[e.name].changbaiMountain={active:!0,multiplier:1.2,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+20%3`),i.recordSkillUsage(e.name,n.cityName)}function jb(e,n,t,i){i.defenseBoost||(i.defenseBoost={}),i.defenseBoost[e.name]||(i.defenseBoost[e.name]={}),i.defenseBoost[e.name].centralHub={active:!0,multiplier:1.2,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+20%2`),i.recordSkillUsage(e.name,n.cityName)}function Fb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.reflectDamage||(i.reflectDamage={}),i.reflectDamage[e.name]||(i.reflectDamage[e.name]={}),i.reflectDamage[e.name][r]={active:!0,chance:1,multiplier:.3,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}30%3`),i.recordSkillUsage(e.name,n.cityName)}function Vb(e,n,t,i){const s=e.centerIndex??0,o=e.cities[s],l=e.cities.findIndex(u=>u.name===n.cityName)===s?.5:.2;i.reflectDamage||(i.reflectDamage={}),i.reflectDamage[e.name]||(i.reflectDamage[e.name]={}),i.reflectDamage[e.name][s]={active:!0,chance:1,multiplier:l,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}${Math.floor(l*100)}%2`),i.recordSkillUsage(e.name,n.cityName)}function Wb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=be(o),a=Math.min(Math.floor(r*.5),15e3);o.currentHp=r+a,o.hp=o.currentHp,i.powerBoost||(i.powerBoost={}),i.powerBoost[e.name]||(i.powerBoost[e.name]={}),i.powerBoost[e.name].greatBuddha={active:!0,multiplier:1.05,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}HP+${a}+5%1`),i.recordSkillUsage(e.name,n.cityName)}function zb(e,n,t,i,s){s.selfReflect||(s.selfReflect={}),s.selfReflect[n.name]={active:!0,percent:.1,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}10%2`),s.recordSkillUsage(e.name,t.cityName)}function Gb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.battleHealing||(i.battleHealing={}),i.battleHealing[e.name]||(i.battleHealing[e.name]={}),i.battleHealing[e.name][r]={active:!0,amount:1200,powerBoost:1.1,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}1200HP+10%3`),i.recordSkillUsage(e.name,n.cityName)}function Jb(e,n,t,i,s){const o=Ie(e);if(o.length===0)return;const r=tn(o),a=e.cities.indexOf(r);s.explosiveShield||(s.explosiveShield={}),s.explosiveShield[e.name]||(s.explosiveShield[e.name]={}),s.explosiveShield[e.name][a]={active:!0,damageReduction:.6,explosionRate:.3,absorbedDamage:0,roundsLeft:2,appliedRound:s.currentRound,targetPlayer:n.name},i(`${e.name}${t.cityName}""${r.name}40%2`),s.recordSkillUsage(e.name,t.cityName)}function Yb(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;const r=tn(o),a=n.cities.indexOf(r);s.attackDisabled||(s.attackDisabled={}),s.attackDisabled[n.name]||(s.attackDisabled[n.name]={}),s.attackDisabled[n.name][a]={active:!0,roundsLeft:3,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}${r.name}3`),s.recordSkillUsage(e.name,t.cityName)}function Kb(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.confuseCounter||(i.confuseCounter={}),i.confuseCounter[e.name]||(i.confuseCounter[e.name]={}),i.confuseCounter[e.name][r]={active:!0,chance:.5,duration:1,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}50%3`),i.recordSkillUsage(e.name,n.cityName)}function Zb(e,n,t,i){i.extraAttack||(i.extraAttack={}),i.extraAttack[e.name]||(i.extraAttack[e.name]={}),i.extraAttack[e.name].wolongSite={active:!0,chance:.3,multiplier:.5,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""30%2`),i.recordSkillUsage(e.name,n.cityName)}function Qb(e,n,t,i){i.goldPerKill||(i.goldPerKill={}),i.goldPerKill[e.name]={active:!0,amount:1,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""13`),i.recordSkillUsage(e.name,n.cityName)}function Xb(e,n,t,i,s){s.weakenAttack||(s.weakenAttack={}),s.weakenAttack[n.name]={active:!0,chance:.5,multiplier:.8,duration:1,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}50%-20%2`),s.recordSkillUsage(e.name,t.cityName)}function eA(e,n,t,i,s){s.citySkillDisabled||(s.citySkillDisabled={}),s.citySkillDisabled[n.name]={active:!0,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}2`),s.recordSkillUsage(e.name,t.cityName)}function nA(e,n,t,i){const s=e.cities.findIndex(r=>r.name===n.cityName),o=Math.floor(Math.random()*750)+1;i.cityShield||(i.cityShield={}),i.cityShield[e.name]||(i.cityShield[e.name]={}),i.cityShield[e.name][s]={active:!0,amount:o,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o}`),i.recordSkillUsage(e.name,n.cityName)}function tA(e,n,t,i,s){s.chengduSurrenderBonus||(s.chengduSurrenderBonus={}),s.chengduSurrenderBonus[e.name]||(s.chengduSurrenderBonus[e.name]={active:!0,powerBoost:0,maxBoost:.3,surrenderedCities:[]}),i(`${e.name}${t.cityName}""`),s.recordSkillUsage(e.name,t.cityName)}function iA(e,n,t,i){const s=e.cities.findIndex(u=>u.name===n.cityName),o=e.cities[s];if(!o)return;const r=2+Math.floor(Math.random()*2),l=be(o)*r;o.currentHp=l,o.hp=l,t(`${e.name}${n.cityName}""${r}HP${r}`),i.recordSkillUsage(e.name,n.cityName)}function sA(e,n,t,i,s){const o=e.cities.findIndex(l=>l.name===t.cityName),r=e.cities[o];if(!r)return;const a=be(r);s.lanternSummons||(s.lanternSummons={}),s.lanternSummons[e.name]||(s.lanternSummons[e.name]=[]),s.lanternSummons[e.name].push({hp:a,active:!0},{hp:a,active:!0}),i(`${e.name}${t.cityName}""2${a}HP`),s.recordSkillUsage(e.name,t.cityName)}function oA(e,n,t,i,s){const o=n.cities.filter(l=>l.isAlive!==!1&&(l.initialHp||l.hp)<1e4);if(o.length===0){e.gold+=5,i(`${e.name}${t.cityName}""+5`),s.recordSkillUsage(e.name,t.cityName);return}const r=tn(o),a=r.initialHp||r.hp;if(r.currentHp=a,r.hp=a,Math.random()<.5){n.cities.indexOf(r),r.isAlive=!1,r.currentHp=0,r.hp=0;const l={...r,currentHp:a,hp:a,isAlive:!0};e.cities.push(l),i(`${e.name}${t.cityName}""${r.name}`)}else e.gold+=5,i(`${e.name}${t.cityName}""${r.name}+5`);s.recordSkillUsage(e.name,t.cityName)}function rA(e,n,t,i){i.dataHidden||(i.dataHidden={}),i.dataHidden[e.name]={active:!0,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""1`),i.recordSkillUsage(e.name,n.cityName)}function aA(e,n,t,i,s){s.delayedAttack||(s.delayedAttack={}),s.delayedAttack[`${n.name}->${e.name}`]={active:!0,nextRound:!0,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""`),s.recordSkillUsage(e.name,t.cityName)}function lA(e,n,t,i){i.neijiangSweetness||(i.neijiangSweetness={}),i.neijiangSweetness[e.name]||(i.neijiangSweetness[e.name]={stacks:0,threshold:5}),t(`${e.name}${n.cityName}""`)}function cA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.damageReduction||(i.damageReduction={}),i.damageReduction[e.name]||(i.damageReduction[e.name]={}),i.damageReduction[e.name][s]||(i.damageReduction[e.name][s]={}),i.damageReduction[e.name][s].emeiDefense={active:!0,multiplier:.2,roundsLeft:3,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""80%3`),i.recordSkillUsage(e.name,n.cityName)}function uA(e,n,t,i,s){s.lemonAcid||(s.lemonAcid={}),s.lemonAcid[e.name]={active:!0,percent:.1,roundsLeft:1,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""10%HP`),s.recordSkillUsage(e.name,t.cityName)}function dA(e,n,t,i){const s=e.cities.find(f=>f.name===n.cityName);if(!s)return;const o=Ie(e).filter(f=>f.name!==n.cityName);if(o.length===0)return;const r=tn(o),a=r.initialHp||r.hp,l=Math.floor(a*.5),u=be(s);s.currentHp=Math.floor(u*.5),s.hp=s.currentHp,r.currentHp=be(r)+l,r.hp=r.currentHp,t(`${e.name}${n.cityName}""50%HP${r.name}${l}HP`),i.recordSkillUsage(e.name,n.cityName)}function fA(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;const r=tn(o),a=n.cities.indexOf(r);s.healingRestriction||(s.healingRestriction={}),s.healingRestriction[n.name]||(s.healingRestriction[n.name]={}),s.healingRestriction[n.name][a]={active:!0,limitCount:1,additionalCost:3},i(`${e.name}${t.cityName}""${n.name}${r.name}`),s.recordSkillUsage(e.name,t.cityName)}function mA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.disguiseCity||(i.disguiseCity={}),i.disguiseCity[e.name]={active:!0,realCityIndex:s,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function hA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.onDeathEffect||(i.onDeathEffect={}),i.onDeathEffect[e.name]||(i.onDeathEffect[e.name]={}),i.onDeathEffect[e.name][s]={type:"jiuzhaigou",healPercent:.5,removeDebuff:!0},t(`${e.name}${n.cityName}""`)}function pA(e,n,t,i){i.ganziStacks||(i.ganziStacks={}),i.ganziStacks[e.name]={active:!0,stacks:0,threshold:5,healPerRound:1e3,duration:3},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function gA(e,n,t,i,s){s.torchFestival||(s.torchFestival={}),s.torchFestival[e.name]={active:!0,interval:5,damage:1e3,targetCount:2,lastTriggered:s.currentRound},i(`${e.name}${t.cityName}""`)}function yA(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.literatiMark||(i.literatiMark={}),i.literatiMark[e.name]||(i.literatiMark[e.name]={}),i.literatiMark[e.name][r]={active:!0,damageThreshold:2e4,followUpDamage:1e3,attackCount:0},t(`${e.name}${n.cityName}""${o.name}`),i.recordSkillUsage(e.name,n.cityName)}function CA(e,n,t,i){i.bigDataCenter||(i.bigDataCenter={}),i.bigDataCenter[e.name]={active:!0,recording:!0,recordedDamage:0,recordDuration:2,damagePercent:.5,damageLimit:1e4,startRound:i.currentRound},t(`${e.name}${n.cityName}""2`),i.recordSkillUsage(e.name,n.cityName)}function vA(e,n,t,i,s){const o=["","","","","","","","","","","","","",""],r=n.cities.filter(l=>l.isAlive!==!1&&be(l)<2e4&&o.includes(l.name));if(r.length===0){i(`${e.name}${t.cityName}""`),s.recordSkillUsage(e.name,t.cityName);return}let a=0;r.forEach(l=>{const u=be(l);l.isAlive=!1,l.currentHp=0,l.hp=0;const f={...l,currentHp:u,hp:u,isAlive:!0};e.cities.push(f),a++}),i(`${e.name}${t.cityName}""${a}`),s.recordSkillUsage(e.name,t.cityName)}function _A(e,n,t,i){i.zunyiAwakening||(i.zunyiAwakening={}),i.zunyiAwakening[e.name]={active:!0,triggered:!1,threshold:3,centerPowerBonus:1.2,selectedCityPowerBonus:1.5,goldPerDeadCity:2},t(`${e.name}${n.cityName}""`)}function $A(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.cityProtection||(i.cityProtection={}),i.cityProtection[e.name]||(i.cityProtection[e.name]={}),i.cityProtection[e.name][r]={active:!0,noCost:!0,protected:!0},t(`${e.name}${n.cityName}""${o.name}`),i.recordSkillUsage(e.name,n.cityName)}function wA(e,n,t,i){i.goldProduction||(i.goldProduction={}),i.goldProduction[e.name]={active:!0,goldPerRound:1,blockSkill:"",canBeDisabled:!0},t(`${e.name}${n.cityName}""1`)}function bA(e,n,t,i,s){const o=Ie(e);if(o.length===0)return;const r=tn(o),a=e.cities.indexOf(r);s.azaleaStacks||(s.azaleaStacks={}),s.azaleaStacks[e.name]||(s.azaleaStacks[e.name]={}),s.azaleaStacks[e.name][a]||(s.azaleaStacks[e.name][a]={active:!0,stacks:0,maxStacks:5,damagePercent:.5,damageLimit:5e3}),s.azaleaStacks[e.name][a].stacks+=1;const l=s.azaleaStacks[e.name][a].stacks;if(l>=5){const u=be(r),f=Math.min(Math.floor(u*.5),5e3);Ie(n).forEach(m=>{_t(m,f)}),i(`${e.name}${t.cityName}""${r.name}5${n.name}${f}`),s.azaleaStacks[e.name][a].stacks=0}else i(`${e.name}${t.cityName}""${r.name}${l}/5`);s.recordSkillUsage(e.name,t.cityName)}function AA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.waterfallTokens||(i.waterfallTokens={}),i.waterfallTokens[e.name]||(i.waterfallTokens[e.name]={}),i.waterfallTokens[e.name][s]||(i.waterfallTokens[e.name][s]={active:!0,tokens:5,damageBoostPerToken:.5,maxTokensPerUse:3}),t(`${e.name}${n.cityName}""5`)}function PA(e,n,t,i){i.extraDeploySlot||(i.extraDeploySlot={}),i.extraDeploySlot[e.name]={active:!0,extraSlots:1,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""4`),i.recordSkillUsage(e.name,n.cityName)}function HA(e,n,t,i,s){s.chinaEye||(s.chinaEye={}),s.chinaEye[e.name]={active:!0,revealPerRound:1,drawIfAllKnown:!0,drawCondition:"higherPower"},i(`${e.name}${t.cityName}""`)}function xA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.hpLossLimit||(i.hpLossLimit={}),i.hpLossLimit[e.name]||(i.hpLossLimit[e.name]={}),i.hpLossLimit[e.name][s]={active:!0,maxLossPercent:.5,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""50%HP`),i.recordSkillUsage(e.name,n.cityName)}function BA(e,n,t,i){const s=Ie(e).filter(u=>be(u)<7e3);if(s.length===0){t(`${e.name}${n.cityName}""HP7000`);return}const o=tn(s),r=be(o),a=r*2;o.currentHp=a,o.hp=a;const l=e.cities.indexOf(o);i.temporaryHpBoost||(i.temporaryHpBoost={}),i.temporaryHpBoost[e.name]||(i.temporaryHpBoost[e.name]={}),i.temporaryHpBoost[e.name][l]={active:!0,multiplier:2,roundsLeft:2,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}HP${r} -> ${a}2`),i.recordSkillUsage(e.name,n.cityName)}function SA(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s);e.cities.indexOf(o),rc(o,5e3,3),t(`${e.name}${n.cityName}""${o.name}5000HP3`),i.recordSkillUsage(e.name,n.cityName)}function IA(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s),r=e.cities.indexOf(o);i.fatigueRemoval||(i.fatigueRemoval={}),i.fatigueRemoval[e.name]||(i.fatigueRemoval[e.name]={}),i.fatigueRemoval[e.name][r]={active:!0,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""${o.name}`),i.recordSkillUsage(e.name,n.cityName)}function kA(e,n,t,i){const s=Ie(e).filter(a=>a.name!==n.cityName);if(s.length===0)return;const o=tn(s),r=e.cities.find(a=>a.name===n.cityName);if(r){const a=be(r),u=be(o)+a;o.currentHp=u,o.hp=u,t(`${e.name}${n.cityName}""${o.name}HP+${a}`)}else Kt(o,1500),t(`${e.name}${n.cityName}""${o.name}1500HP`);i.recordSkillUsage(e.name,n.cityName)}function EA(e,n,t,i){const s=e.centerIndex??0,o=e.cities[s];o&&(rc(o,1200,1),t(`${e.name}${n.cityName}""${o.name}1200HP`),i.recordSkillUsage(e.name,n.cityName))}function TA(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=tn(s);Kt(o,1500),t(`${e.name}${n.cityName}""${o.name}1500HP`),i.recordSkillUsage(e.name,n.cityName)}function RA(e,n,t,i){i.enemyDamageReduction||(i.enemyDamageReduction={}),i.enemyDamageReduction[e.name]={active:!0,multiplier:.8,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""20%`),i.recordSkillUsage(e.name,n.cityName)}function NA(e,n,t,i){const s=e.cities.filter(a=>a.isAlive===!1&&(a.initialHp||a.hp)<13e3);if(s.length===0){t(`${e.name}${n.cityName}""`);return}const o=tn(s),r=o.initialHp||o.hp;o.isAlive=!0,o.currentHp=r,o.hp=r,t(`${e.name}${n.cityName}""${o.name}`),i.recordSkillUsage(e.name,n.cityName)}function MA(e,n,t,i){i.powerBoost||(i.powerBoost={}),i.powerBoost[e.name]||(i.powerBoost[e.name]={}),i.powerBoost[e.name].haniTerrace={active:!0,multiplier:1.2,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+20%`),i.recordSkillUsage(e.name,n.cityName)}function DA(e,n,t,i){const s=Ie(e);if(s.length===0)return;const o=Math.min(2,s.length),a=[...s].sort(()=>Math.random()-.5).slice(0,o);a.forEach(u=>{Kt(u,500)});const l=a.map(u=>u.name).join("");t(`${e.name}${n.cityName}""${l}500HP`),i.recordSkillUsage(e.name,n.cityName)}function qA(e,n,t,i){i.summonYunnanCity||(i.summonYunnanCity={}),i.summonYunnanCity[e.name]={active:!0,province:"",excludeCities:[""],appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function LA(e,n,t,i){const s=e.cities.filter(u=>u.isAlive!==!1&&u.name!==n.cityName&&(u.initialHp||u.hp)<9e3);if(s.length===0){t(`${e.name}${n.cityName}""`);return}const o=tn(s),r=o.initialHp||o.hp;o.currentHp=r,o.hp=r;const a=e.cities.indexOf(o),l=e.cities.findIndex(u=>u.name===n.cityName);i.battleBanned||(i.battleBanned={}),i.battleBanned[e.name]||(i.battleBanned[e.name]={}),i.battleBanned[e.name][a]={active:!0,roundsLeft:2,appliedRound:i.currentRound},i.battleBanned[e.name][l]={active:!0,roundsLeft:2,appliedRound:i.currentRound},i.powerBoost||(i.powerBoost={}),i.powerBoost[e.name]||(i.powerBoost[e.name]={}),i.powerBoost[e.name][`dali_${a}`]={active:!0,multiplier:1.5,permanent:!0},t(`${e.name}${n.cityName}""${o.name}+50%2`),i.recordSkillUsage(e.name,n.cityName)}function OA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.damageTransfer||(i.damageTransfer={}),i.damageTransfer[e.name]||(i.damageTransfer[e.name]={}),i.damageTransfer[e.name].nujiang={active:!0,transferTo:s,noOverflow:!0,onlySkillDamage:!0,targetCenter:!0},t(`${e.name}${n.cityName}""`)}function UA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.disguiseTransform||(i.disguiseTransform={}),i.disguiseTransform[e.name]={active:!0,originalCityIndex:s,hpRange:{min:1e4,max:2e4},transformAttack:!0,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function jA(e,n,t,i){const s=Ie(e).filter(a=>be(a)<3e4);if(s.length===0)return;const o=tn(s),r=o.initialHp||o.hp;o.currentHp=r,o.hp=r,rc(o,3e3,1),i.nextRoundSummon||(i.nextRoundSummon={}),i.nextRoundSummon[e.name]||(i.nextRoundSummon[e.name]=[]),i.nextRoundSummon[e.name].push({maxHp:1500,appliedRound:i.currentRound}),t(`${e.name}${n.cityName}""${o.name}+3000`),i.recordSkillUsage(e.name,n.cityName)}function FA(e,n,t,i){i.powerBoost||(i.powerBoost={}),i.powerBoost[e.name]||(i.powerBoost[e.name]={}),i.powerBoost[e.name].qomolangma={active:!0,multiplier:1.1,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""+10%`),i.recordSkillUsage(e.name,n.cityName)}function VA(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;const r=tn(o),a=n.cities.indexOf(r);s.battleBanned||(s.battleBanned={}),s.battleBanned[n.name]||(s.battleBanned[n.name]={}),s.battleBanned[n.name][a]={active:!0,roundsLeft:2,appliedRound:s.currentRound},i(`${e.name}${t.cityName}""${n.name}${r.name}2`),s.recordSkillUsage(e.name,t.cityName)}function WA(e,n,t,i){i.believerSummon||(i.believerSummon={}),i.believerSummon[e.name]={active:!0,hp:1300,roundsLeft:1,appliedRound:i.currentRound},t(`${e.name}${n.cityName}""1300HP`),i.recordSkillUsage(e.name,n.cityName)}function zA(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.onDeathEffect||(i.onDeathEffect={}),i.onDeathEffect[e.name]||(i.onDeathEffect[e.name]={}),i.onDeathEffect[e.name][s]={type:"yellowRiverPearl",disableAttackersSkills:!0,makeAttackersUntargetable:!0,trackDamagers:[]},t(`${e.name}${n.cityName}""`)}function GA(e,n,t,i){i.provinceChange||(i.provinceChange={}),i.provinceChange[e.name]={active:!0,cooldown:1,lastUsed:i.currentRound},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function JA(e,n,t,i){i.rainbowDanxia||(i.rainbowDanxia={}),i.rainbowDanxia[e.name]={active:!0,canReplaceWithCapitals:!0,sevenRegions:["","","","","","",""]},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function YA(e,n,t,i){i.mogaoGrottoes||(i.mogaoGrottoes={}),i.mogaoGrottoes[e.name]={active:!0,cooldown:2,lastUsed:i.currentRound,refundGold:!0,requiresQuiz:!0},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function KA(e,n,t,i){i.bronzeGorge||(i.bronzeGorge={}),i.bronzeGorge[e.name]={active:!0,shuffleAllSkills:!0,originalSkills:[],newSkills:[]},e.cities.forEach(s=>{s.citySkill&&i.bronzeGorge[e.name].originalSkills.push({cityName:s.name,skill:s.citySkill})}),t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function ZA(e,n,t,i){const s=e.cities.findIndex(l=>l.name===n.cityName),o=e.centerIndex??0,r=s===o;i.asiaCenter||(i.asiaCenter={}),i.asiaCenter[e.name]={active:!0,cityIndex:s,isCenter:r,centerAttackPower:8e4,subCenterMultiplier:1.5};const a=r?"80000":"1.5";t(`${e.name}${n.cityName}""${a}`)}function QA(e,n,t,i,s){const o=Ie(e),r=Ie(n);if(o.length===0||r.length===0)return;const a=tn(o),l=tn(r),u=be(a),f=be(l);if(u>f){n.cities.indexOf(l),l.isAlive=!1,l.currentHp=0,l.hp=0;const m={...l,currentHp:f,hp:f,isAlive:!0};e.cities.push(m),i(`${e.name}${t.cityName}""${a.name}${u}HP${l.name}${f}HP`)}else{s.copiedSkills||(s.copiedSkills={}),s.copiedSkills[e.name]||(s.copiedSkills[e.name]={});const m=e.cities.findIndex(h=>h.name===t.cityName);s.copiedSkills[e.name][m]={active:!0,copiedFrom:l.name,copiedSkill:l.citySkill},i(`${e.name}${t.cityName}""${a.name}${u}HP${l.name}${f}HP`)}s.recordSkillUsage(e.name,t.cityName)}function XA(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;let r=0,a=null;if(o.forEach(u=>{const f=be(u);f>r&&(r=f,a=u)}),!a)return;const l=n.cities.indexOf(a);s.burnEffect||(s.burnEffect={}),s.burnEffect[n.name]||(s.burnEffect[n.name]={}),s.burnEffect[n.name][l]||(s.burnEffect[n.name][l]={active:!0,stacks:0,percentPerStack:.2,stopWhenLowest:!0}),s.burnEffect[n.name][l].stacks+=1,i(`${e.name}${t.cityName}""${n.name}${a.name}-20%HP`),s.recordSkillUsage(e.name,t.cityName)}function e2(e,n,t,i){i.melonTokens||(i.melonTokens={}),i.melonTokens[e.name]||(i.melonTokens[e.name]={active:!0,initialTokens:3,damageMultiplier:2,lossThreshold:15e3,cityTokens:{}});const s=Ie(e);for(let o=0;o<3;o++){const r=tn(s),a=e.cities.indexOf(r);i.melonTokens[e.name].cityTokens[a]||(i.melonTokens[e.name].cityTokens[a]=0),i.melonTokens[e.name].cityTokens[a]+=1}t(`${e.name}${n.cityName}""3`)}function n2(e,n,t,i){i.skillReset||(i.skillReset={}),i.skillReset[e.name]={active:!0,resetAllSkills:!0,appliedRound:i.currentRound},i.skillUsage&&i.skillUsage[e.name]&&(i.skillUsage[e.name]={}),t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function t2(e,n,t,i){i.overflowLake||(i.overflowLake={}),i.overflowLake[e.name]={active:!0,storedDamage:0,storagePercent:.5,canActivate:!0},t(`${e.name}${n.cityName}""`)}function i2(e,n,t,i,s){const o=Ie(n);if(o.length===0)return;const r=tn(o),a=n.cities.indexOf(r),l=be(r);s.missingState||(s.missingState={}),s.missingState[n.name]||(s.missingState[n.name]={}),s.missingState[n.name][a]={active:!0,roundsLeft:5,damagePerRound:l,appliedRound:s.currentRound,cannotBattle:!0,untargetable:!0},i(`${e.name}${t.cityName}""${n.name}${r.name}5`),s.recordSkillUsage(e.name,t.cityName)}function s2(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.debuffImmune||(i.debuffImmune={}),i.debuffImmune[e.name]||(i.debuffImmune[e.name]={}),i.debuffImmune[e.name][s]={active:!0,immuneToDebuff:!0,immuneToClearBuff:!0,lockSkill:!0},t(`${e.name}${n.cityName}""`)}function o2(e,n,t,i){const s=Ie(e);if(s.length===0)return;let o=0,r=null,a=0;if(s.forEach(u=>{const f=be(u);f>o?(o=f,r=u,a=1):f===o&&(a+=1)}),a!==1||!r){t(`${e.name}${n.cityName}""HP`);return}const l=o*2;r.currentHp=l,r.hp=l,t(`${e.name}${n.cityName}""${r.name}HP${o} -> ${l}`),i.recordSkillUsage(e.name,n.cityName)}function r2(e,n,t,i,s){const o=Ie(e),r=Ie(n);if(o.length===0||r.length===0)return;const a=tn(r),l=e.cities.find(m=>m.name===t.cityName);if(!l)return;const f=tn(["province","hp","skill"]);if(f==="province"){const m=l.province;l.province=a.province,a.province=m,i(`${e.name}${t.cityName}""${a.name}`)}else if(f==="hp"){const m=be(l),h=be(a);l.currentHp=h,l.hp=h,a.currentHp=m,a.hp=m,i(`${e.name}${t.cityName}""${a.name}HP`)}else{const m=l.citySkill;l.citySkill=a.citySkill,a.citySkill=m,i(`${e.name}${t.cityName}""${a.name}`)}s.recordSkillUsage(e.name,t.cityName)}function a2(e,n,t,i){i.yiliToggle||(i.yiliToggle={}),i.yiliToggle[e.name]||(i.yiliToggle[e.name]={active:!0,isYin:!0,yinEffect:{goldPerCity:3},yangEffect:{sacrificeDamage:!0},lastToggled:i.currentRound});const s=i.yiliToggle[e.name].isYin?"":"";t(`${e.name}${n.cityName}""${s}`)}function l2(e,n,t,i){i.cancelBattle||(i.cancelBattle={}),i.cancelBattle[e.name]={active:!0,currentRound:i.currentRound,cancelAllDamage:!0},t(`${e.name}${n.cityName}""`),i.recordSkillUsage(e.name,n.cityName)}function c2(e,n,t,i){i.snowTokens||(i.snowTokens={}),i.snowTokens[e.name]||(i.snowTokens[e.name]={active:!0,tokens:0,canSummonCity:!0,regionFilter:["","",""]}),t(`${e.name}${n.cityName}""`)}function u2(e,n,t,i){const s=e.cities.findIndex(o=>o.name===n.cityName);i.militaryReclamation||(i.militaryReclamation={}),i.militaryReclamation[e.name]||(i.militaryReclamation[e.name]={}),i.militaryReclamation[e.name][s]={active:!0,summonOnBattle:!0,provinceBonus:!0,hpMultiplierByProvince:!0},t(`${e.name}${n.cityName}""`)}const d2={:G_,:J_,:Y_,:K_,:Z_,:Q_,:X_,:a$,:e$,:n$,:t$,:l$,:c$,:i$,:u$,:s$,:ms,:o$,:r$,:h$,:d$,:p$,:f$,:g$,:y$,:C$,:v$,:_$,:m$,:kh,:$$,:w$,:Eh,:S$,:b$,:A$,:I$,:Th,:k$,:P$,:E$,:H$,:x$,:T$,:B$,:R$,:N$,:M$,:D$,:q$,:L$,:O$,:U$,:j$,:F$,:V$,:W$,:z$,:G$,:J$,:Y$,:K$,:Z$,:Q$,:X$,:ew,:nw,:tw,:iw,:sw,:ow,:rw,:aw,:lw,:cw,:uw,:dw,:fw,:mw,:hw,:pw,:gw,:yw,:Cw,:vw,:_w,:$w,:ww,:bw,:Aw,:Pw,:Hw,:xw,:Bw,:Sw,:Iw,:kw,:Ew,:Tw,:Rw,:Nw,:Mw,:Dw,:qw,:Lw,:Ow,:Uw,:jw,:Fw,:Vw,:Ww,:zw,:Gw,:Jw,:Yw,:Kw,:Zw,:Qw,:Xw,:eb,:nb,:tb,:ib,:sb,:ob,:rb,:ab,:lb,:cb,:ub,:db,:fb,:mb,:hb,:pb,:gb,:yb,:Cb,:vb,:_b,:$b,:wb,:bb,:Ab,:Pb,:Hb,:xb,:Bb,:Sb,:Ib,:kb,:Eb,:Tb,:Rb,:Nb,:Mb,:Db,:qb,:Lb,:Ob,:Ub,:jb,:Fb,:Vb,:Wb,:zb,:Gb,:Jb,:Yb,:Kb,:Zb,:Qb,:Xb,:eA,:nA,"":tA,:iA,:sA,:oA,:rA,:aA,:lA,"":cA,:uA,:dA,:fA,:mA,:hA,:pA,:gA,:yA,:CA,:vA,"":_A,:$A,:wA,:bA,:AA,:PA,:HA,:xA,:BA,:SA,:IA,:kA,:EA,:TA,:RA,:NA,:MA,:DA,:qA,:LA,:OA,:UA,:jA,:FA,:VA,:WA,:zA,:GA,:JA,:YA,:KA,:ZA,"":QA,"":XA,:e2,"":n2,:t2,:i2,:s2,:o2,:r2,"":a2,:l2,"":c2,:u2};function f2(e,n,t,i,s,o){if(console.log("[] processActivatedCitySkills "),console.log("[] attacker:",e.name),console.log("[] attackerState.activatedCitySkills:",n.activatedCitySkills),!n.activatedCitySkills){console.log("[] ");return}const r=Object.keys(n.activatedCitySkills).length;console.log(`[] ${e.name}  ${r} `),Object.keys(n.activatedCitySkills).forEach(a=>{const l=n.activatedCitySkills[a];console.log(`[] : ${l.skillName} (: ${a}, : ${l.cityName})`);const u=d2[l.skillName];if(u){console.log(`[] : ${l.skillName}`);try{m2(l.skillName)?u(e,t,i,l,s,o):h2(l.skillName)?u(e,t,l,s,o):u(e,l,s,o),console.log(`[]  ${l.skillName} `)}catch(f){console.error(`"${l.skillName}":`,f),s(`"${l.skillName}"`)}}else console.warn(`"${l.skillName}"`),s(`${e.name}${l.cityName}"${l.skillName}"`)})}function m2(e){return["","","","","","","","",""].includes(e)}function h2(e){return["","","","","","","","","","","","",""].includes(e)}function Yu(e,n,t,i,s){const o=ut();f2(e,n,t,i,s,o)}function p2(e,n,t,i){if(!e.isAlive)return 0;let s=e.currentHp;const o=t.centerIndex??0;n===o&&(s*=2),i.subCenters&&i.subCenters[t.name]===n&&(s=Math.floor(s*1.5)),i.purpleChamber&&i.purpleChamber[t.name]===n&&(s*=2),t.battleModifiers?.some(a=>a.type==="desperate_battle")&&(s*=2),t.battleModifiers?.some(a=>a.type==="berserk_mode")&&(s*=5),t.battleModifiers?.some(a=>a.type==="jade_shatter")&&(s*=2),i.disaster?.[t.name]?.[n]&&(s=1),i.hjbf?.[t.name]?.[n]&&(s=1);const r=e.red||0;if(r>=1){const a=g2(r);s+=a}return Math.floor(s)}function g2(e){return e>=3?2e3:e>=2?1e3:e>=1?500:0}function y2(e){return e>=3?2e3:e>=2?1e3:e>=1?500:0}function ws(e,n,t,i,s,o={}){const r=e.reduce((v,S)=>{const X=S.cityIdx;return v+p2(S,X,t,s)},0),a=n.filter(v=>v.isAlive),l=a.reduce((v,S)=>v+(S.green||0),0),u=y2(l);let f=Math.max(0,r-u),m=[...a];o.captureKing?m.sort((v,S)=>S.currentHp-v.currentHp):m.sort((v,S)=>v.currentHp-S.currentHp);const h=[];for(const v of m){if(f<=0)break;if(!v.isAlive||s.anchored?.[i.name]?.[v.name])continue;const S=Math.min(v.currentHp,f);v.currentHp-=S,f-=S,v.currentHp<=0&&(v.currentHp=0,v.isAlive=!1,h.push(v.name))}return{totalAttackPower:r,greenReduction:u,netDamage:r-u,remainingDamage:f,destroyedCities:h,defenderRemaining:n.filter(v=>v.isAlive).length}}function C2(){const e=ut(),n=Ce(!1),t=Ce(null),i=Ce(null);function s(R){e.addLog(R,"battle"),console.log(`[] ${R}`)}function o(R,Y){e.addLog(`[${R}] ${Y}`,"info"),console.log(`[-${R}] ${Y}`)}function r(R,Y){const V=R.cities[Y];return V?V.name:""}function a(R,Y,V){if(!R||R.hp<=0)return 0;let ee=R.hp;if(V.strengthBoost&&V.strengthBoost[Y.name]){const ue=V.strengthBoost[Y.name];ue.active&&ue.roundsLeft>0&&(ee*=2)}if(V.morale&&V.morale[Y.name]){const ue=V.morale[Y.name];ue.active&&ue.roundsLeft>0&&(ee*=1.5)}return Math.floor(ee)}function l(R,Y,V){return!V.protections||!V.protections[R.name]?!1:V.protections[R.name][Y]>0}function u(R,Y,V){return!V.ironCities||!V.ironCities[R.name]?!1:V.ironCities[R.name][Y]>0}function f(R,Y,V,ee,ue){if(l(V,ee,ue))return delete ue.protections[V.name][ee],{actualDamage:0,blocked:!0,reason:"protection"};if(u(V,ee,ue))return ue.ironCities[V.name][ee]--,ue.ironCities[V.name][ee]<=0&&delete ue.ironCities[V.name][ee],{actualDamage:0,blocked:!0,reason:"iron"};const de=R.currentHp!==void 0?R.currentHp:R.hp,W=Math.max(0,de-Y),Q=de-W;return R.currentHp=W,R.hp!==void 0&&(R.hp=W),W<=0&&(R.isAlive=!1),{actualDamage:Q,blocked:!1,isDead:W<=0}}function m(R,Y){s(`
=== 2 ===`);const V=R[0],ee=R[1];(V.centerIndex===null||V.centerIndex===void 0)&&(console.warn(`[] ${V.name} centerIndex0`),V.centerIndex=0),(ee.centerIndex===null||ee.centerIndex===void 0)&&(console.warn(`[] ${ee.name} centerIndex0`),ee.centerIndex=0);const ue=Y.playerStates[V.name],de=Y.playerStates[ee.name];ue.deadCities||(ue.deadCities=[]),de.deadCities||(de.deadCities=[]),[{player:V,state:ue},{player:ee,state:de}].forEach(({player:$,state:A})=>{if(A.battleGoldSkill){const H=A.battleGoldSkill;let q=0;if(q={:e.gameMode==="3P"?4:2,:3,:3,:3,:4,:4,:5,:5,:6,:6,:6,:7,:7,:7,:8,:8,:8,:9,:9,:10,:10,:10,:10,:11,:13,:15,:20}[H]||0,q>0){const me=$.gold;$.gold=Math.max(0,$.gold-q),s(`${$.name} ${H}${q}${me}  ${$.gold}`),console.log(`[] ${$.name}  ${H} ${me} -> ${$.gold}`)}else s(`${$.name} ${H}`)}}),[{player:V,state:ue},{player:ee,state:de}].forEach(({player:$,state:A})=>{if(!A.currentBattleCities)return;A.currentBattleCities.filter(q=>q.isStandGroundCity).length>0&&(s(`${$.name}""HP=1=1`),A.currentBattleCities=A.currentBattleCities.filter(q=>!q.isStandGroundCity))}),console.log("[] =====  ====="),console.log("[] player1:",V.name,"cities:",V.cities.length),console.log("[] player1:"),V.cities.forEach(($,A)=>console.log(`  [${A}] ${$.name} HP:${$.currentHp??$.hp}`)),console.log("[] player2:",ee.name,"cities:",ee.cities.length),console.log("[] player2:"),ee.cities.forEach(($,A)=>console.log(`  [${A}] ${$.name} HP:${$.currentHp??$.hp}`)),console.log("[] state1.currentBattleCities:",ue.currentBattleCities),console.log("[] state2.currentBattleCities:",de.currentBattleCities);const W=(ue.currentBattleCities||[]).map($=>{const A=V.cities[$.cityIdx];return console.log(`[] ${V.name} cityIdx=${$.cityIdx}, city.name=${A?.name}`),{...A,cityIdx:$.cityIdx}}),Q=(de.currentBattleCities||[]).map($=>{const A=ee.cities[$.cityIdx];return console.log(`[] ${ee.name} cityIdx=${$.cityIdx}, city.name=${A?.name}`),{...A,cityIdx:$.cityIdx}});if(W&&W.length>0){const $=W.filter(A=>A&&A.name).map(A=>A.name).join("");$&&s(`${V.name} ${$}`)}if(Q&&Q.length>0){const $=Q.filter(A=>A&&A.name).map(A=>A.name).join("");$&&s(`${ee.name} ${$}`)}W.forEach($=>{$&&$.cityIdx!==void 0&&e.setCityKnown(V.name,$.cityIdx,ee.name)}),Q.forEach($=>{$&&$.cityIdx!==void 0&&e.setCityKnown(ee.name,$.cityIdx,V.name)}),Yu(V,ue,ee,Q,s),Yu(ee,de,V,W,s);let L=0,P=0;W.forEach($=>{if($.hp>0){const A=a($,V,Y);L+=A}}),Q.forEach($=>{if($.hp>0){const A=a($,ee,Y);P+=A}}),s(`${V.name} : ${L}`),s(`${ee.name} : ${P}`);let G=Y.barrier;if(G&&G.active){let $=null,A=null,H=0;if(G.owner===V.name?($=V,A=ee,H=P):G.owner===ee.name&&($=ee,A=V,H=L),$&&A){const q=G.hp;G.hp=Math.max(0,G.hp-H);const ne=q-G.hp;if(s(`${A.name}${$.name}${ne}HP: ${G.hp}`),G.hp<=0){s(`${$.name}`),G.active=!1;const me=H-ne;me>0&&s(`${me}`)}G.roundsLeft--,G.roundsLeft<=0&&(s(`${$.name}`),G.active=!1),G.owner===V.name?P=0:L=0}}if(L>0&&Q.length>0){const A={captureKing:e.qinwang&&e.qinwang.caster===V.name&&e.qinwang.target===ee.name},H=W.map(me=>({...V.cities[me.cityIdx],cityIdx:me.cityIdx})),q=Q.map(me=>({...ee.cities[me.cityIdx],cityIdx:me.cityIdx})),ne=ws(H,q,V,ee,e,A);s(`${V.name}  ${ee.name}:  ${ne.totalAttackPower} ${ne.greenReduction} ${ne.netDamage}`),ne.destroyedCities.length>0&&(s(`: ${ne.destroyedCities.join("")}`),ne.destroyedCities.forEach(me=>{const oe=q.findIndex(ve=>ve.name===me);oe!==-1&&!de.deadCities.includes(q[oe].cityIdx)&&de.deadCities.push(q[oe].cityIdx)})),q.forEach(me=>{const oe=ee.cities[me.cityIdx];oe.currentHp=me.currentHp,oe.isAlive=me.isAlive,oe.hp!==void 0&&(oe.hp=me.currentHp)})}if(P>0&&W.length>0){const A={captureKing:e.qinwang&&e.qinwang.caster===ee.name&&e.qinwang.target===V.name},H=Q.map(me=>({...ee.cities[me.cityIdx],cityIdx:me.cityIdx})),q=W.map(me=>({...V.cities[me.cityIdx],cityIdx:me.cityIdx})),ne=ws(H,q,ee,V,e,A);s(`${ee.name}  ${V.name}:  ${ne.totalAttackPower} ${ne.greenReduction} ${ne.netDamage}`),ne.destroyedCities.length>0&&(s(`: ${ne.destroyedCities.join("")}`),ne.destroyedCities.forEach(me=>{const oe=q.findIndex(ve=>ve.name===me);oe!==-1&&!ue.deadCities.includes(q[oe].cityIdx)&&ue.deadCities.push(q[oe].cityIdx)})),q.forEach(me=>{const oe=V.cities[me.cityIdx];oe.currentHp=me.currentHp,oe.isAlive=me.isAlive,oe.hp!==void 0&&(oe.hp=me.currentHp)})}e.cmjb&&(Object.keys(e.cmjb).forEach($=>{const A=e.cmjb[$];if(A&&A.mode==="2P"){const H=R.find(ne=>ne.name===$),q=R.find(ne=>ne.name===A.target);if(H&&q&&(Y.playerStates[q.name].currentBattleCities||[]).length===0){const oe=Math.min(1,q.gold||0);if(oe>0){const ve=H.gold,_e=q.gold;q.gold=Math.max(0,q.gold-oe),H.gold=Math.min(24,H.gold+oe),s(`${H.name}  ${q.name} ${q.name}${oe}${H.name} ${ve} -> ${H.gold}${q.name} ${_e} -> ${q.gold}`)}else s(`${H.name}  ${q.name} ${q.name}`)}}}),e.cmjb={});const _=3;V.gold=Math.min(24,V.gold+_+de.deadCities.filter($=>Q.some(A=>A.cityIdx===$&&ee.cities[$].hp<=0)).length),ee.gold=Math.min(24,ee.gold+_+ue.deadCities.filter($=>W.some(A=>A.cityIdx===$&&V.cities[$].hp<=0)).length),ue.currentBattleCities=[],de.currentBattleCities=[],ue.battleGoldSkill=null,de.battleGoldSkill=null,h(V,ue),h(ee,de),v(R)}function h(R,Y){const V=e.gameMode==="2v2"?4:5;e.gameMode;const ee=R.cities.map((W,Q)=>{const L=W.currentHp!==void 0?W.currentHp:W.hp;return{i:Q,alive:W.isAlive!==!1&&L>0}}).filter(W=>W.alive).map(W=>W.i);if(ee.length<=V){R.roster=ee,Y.needsRosterRefill=!1,console.log(`[] ${R.name} ${V}`);return}const ue=R.roster||[],de=ee.filter(W=>ue.includes(W));if(de.length<V){Y.needsRosterRefill=!0,Y.rosterRefillReason="",console.log(`[] ${R.name} ${de.length}${V}`);return}R.roster=de,Y.needsRosterRefill=!1,console.log(`[] ${R.name} `),console.log(`[] ${R.name} roster:`,de.map(W=>`[${W}]${R.cities[W]?.name}`).join(", "))}function v(R,Y){const V=R.filter(ee=>{const ue=ee.cities[ee.centerIndex||0];return ue&&ue.hp>0});return V.length===1?(t.value=V[0],n.value=!0,s(`
 ${t.value.name} `),!0):V.length===0?(n.value=!0,s(`
`),!0):!1}function S(){e.nextRound(),s(`
==========  ${e.currentRound}  ==========`)}function X(R){s(`${R} `)}function ae(R,Y){e.resetGame(),e.gameMode=Y,e.initPlayers(R),battleLogs.value=[],n.value=!1,t.value=null,S()}function fe(R,Y){s(`
=== 3 ===`),R.forEach(V=>{const ee=Y.playerStates[V.name];if(ee&&ee.battleGoldSkill){const ue=ee.battleGoldSkill,W={:4,:3,:3,:3,:4,:4,:5,:5,:6,:6,:6,:7,:7,:7,:8,:8,:8,:9,:9,:10,:10,:10,:10,:11,:13,:15,:20}[ue]||0;if(W>0){const Q=V.gold;V.gold=Math.max(0,V.gold-W),s(`${V.name} ${ue}${W}${Q}  ${V.gold}`)}else s(`${V.name} ${ue}`)}}),R.forEach((V,ee)=>{const ue=Y.playerStates[V.name];if(!ue||!ue.currentBattleData)return;R.filter(W=>W.name!==V.name).forEach(W=>{const Q=Y.playerStates[W.name],L=ue.currentBattleData[W.name]||[];if(L.length>0){const G={captureKing:e.qinwang&&e.qinwang.caster===V.name&&e.qinwang.target===W.name},_=L.map(H=>({...V.cities[H.cityIdx],cityIdx:H.cityIdx})),A=(Q.currentBattleData?.[V.name]||[]).map(H=>({...W.cities[H.cityIdx],cityIdx:H.cityIdx}));if(_.length>0){const H=ws(_,A,V,W,e,G);s(`${V.name}  ${W.name}:  ${H.totalAttackPower} ${H.greenReduction} ${H.netDamage}`),H.destroyedCities.length>0&&(s(`: ${H.destroyedCities.join("")}`),H.destroyedCities.forEach(q=>{const ne=A.findIndex(me=>me.name===q);if(ne!==-1){const me=A[ne].cityIdx;Q.deadCities||(Q.deadCities=[]),Q.deadCities.includes(me)||Q.deadCities.push(me)}})),A.forEach(q=>{const ne=W.cities[q.cityIdx];ne.currentHp=q.currentHp,ne.isAlive=q.isAlive,ne.hp!==void 0&&(ne.hp=q.currentHp)})}}})}),R.forEach(V=>{const ee=Y.playerStates[V.name];ee.currentBattleData={},ee.battleGoldSkill=null}),v(R)}function ge(R,Y){s(`
=== 2v2  ===`),R.forEach(P=>{const G=Y.playerStates[P.name];if(G&&G.battleGoldSkill){const _=G.battleGoldSkill,A={:2,:3,:3,:3,:4,:4,:5,:5,:6,:6,:6,:7,:7,:7,:8,:8,:8,:9,:9,:10,:10,:10,:10,:11,:13,:15,:20}[_]||0;if(A>0){const H=P.gold;P.gold=Math.max(0,P.gold-A),s(`${P.name} ${_}${A}${H}  ${P.gold}`)}else s(`${P.name} ${_}`)}});const V=[R[0],R[1]],ee=[R[2],R[3]],ue=[],de=[];V.forEach(P=>{(Y.playerStates[P.name].currentBattleCities||[]).forEach(_=>{ue.push({player:P,city:P.cities[_.cityIdx],cityIdx:_.cityIdx})})}),ee.forEach(P=>{(Y.playerStates[P.name].currentBattleCities||[]).forEach(_=>{de.push({player:P,city:P.cities[_.cityIdx],cityIdx:_.cityIdx})})});let W=Y.barrier;if(W&&W.active){if(W.team===""){const P=de.reduce((G,{city:_,cityIdx:$,player:A})=>{const H=A.cities.indexOf(_);return G+calculateCityPower(_,H,A,e)},0);W.hp,W.hp=Math.max(0,W.hp-P),s(`${P}HP: ${W.hp}`),W.hp<=0&&(s(""),W.active=!1)}else if(W.team===""){const P=ue.reduce((G,{city:_,cityIdx:$,player:A})=>{const H=A.cities.indexOf(_);return G+calculateCityPower(_,H,A,e)},0);W.hp,W.hp=Math.max(0,W.hp-P),s(`${P}HP: ${W.hp}`),W.hp<=0&&(s(""),W.active=!1)}}if(de.length>0&&ue.length>0&&(!W||!W.active||W.team!=="")){const P={captureKing:!1},G=de.map(q=>({...q.city,cityIdx:q.cityIdx})),_=ue.map(q=>({...q.city,cityIdx:q.cityIdx})),$=ee[0],A=V[0],H=ws(G,_,$,A,e,P);s(`  :  ${H.totalAttackPower} ${H.greenReduction} ${H.netDamage}`),H.destroyedCities.length>0&&(s(`: ${H.destroyedCities.join("")}`),H.destroyedCities.forEach(q=>{const ne=ue.find(me=>me.city.name===q);if(ne){const me=Y.playerStates[ne.player.name];me.deadCities||(me.deadCities=[]),me.deadCities.includes(ne.cityIdx)||me.deadCities.push(ne.cityIdx)}})),_.forEach((q,ne)=>{const me=ue[ne],oe=me.player.cities[me.cityIdx];oe.currentHp=q.currentHp,oe.isAlive=q.isAlive,oe.hp!==void 0&&(oe.hp=q.currentHp)})}if(ue.length>0&&de.length>0&&(!W||!W.active||W.team!=="")){const P={captureKing:!1},G=ue.map(q=>({...q.city,cityIdx:q.cityIdx})),_=de.map(q=>({...q.city,cityIdx:q.cityIdx})),$=V[0],A=ee[0],H=ws(G,_,$,A,e,P);s(`  :  ${H.totalAttackPower} ${H.greenReduction} ${H.netDamage}`),H.destroyedCities.length>0&&(s(`: ${H.destroyedCities.join("")}`),H.destroyedCities.forEach(q=>{const ne=de.find(me=>me.city.name===q);if(ne){const me=Y.playerStates[ne.player.name];me.deadCities||(me.deadCities=[]),me.deadCities.includes(ne.cityIdx)||me.deadCities.push(ne.cityIdx)}})),_.forEach((q,ne)=>{const me=de[ne],oe=me.player.cities[me.cityIdx];oe.currentHp=q.currentHp,oe.isAlive=q.isAlive,oe.hp!==void 0&&(oe.hp=q.currentHp)})}R.forEach(P=>{P.gold+=1}),R.forEach(P=>{const G=Y.playerStates[P.name];G.currentBattleCities=[],G.battleGoldSkill=null});const Q=V.some(P=>{const G=P.cities[P.centerIndex||0];return G&&G.hp>0}),L=ee.some(P=>{const G=P.cities[P.centerIndex||0];return G&&G.hp>0});!Q&&L?(t.value=ee[0],n.value=!0,s(`
 (${ee.map(P=>P.name).join("+")}) `)):!L&&Q?(t.value=V[0],n.value=!0,s(`
 (${V.map(P=>P.name).join("+")}) `)):!Q&&!L&&(n.value=!0,s(`
`))}return{isGameOver:n,winner:t,currentBattle:i,initGame:ae,startNewRound:S,endTurn:X,battle2P:m,battle3P:fe,battle2v2:ge,checkWinCondition:v,addPublicLog:s,addPrivateLog:o,calculateCityAttack:a,applyCityDamage:f,getEffectiveCityName:r}}function ur(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];for(let i=0;i<e.length;i++)t[i]=ur(e[i]);return t}const n={};for(const t in e)e.hasOwnProperty(t)&&(n[t]=ur(e[t]));return n}function dr(e,n=[]){if(!zi||zi.length===0)return console.error("[] ALL_CITIES"),[];const t=zi.filter(o=>!n.includes(o.name));t.length<e&&(console.warn(`${e}${t.length}`),e=t.length);const i=t.filter(o=>o.hp>=1e4);t.filter(o=>o.hp<1e4);const s=[];if(i.length>0&&e>0){const o=[...i].sort(()=>Math.random()-.5);s.push(ur(o[0])),e--}if(e>0){const r=[...t.filter(a=>!s.some(l=>l.name===a.name))].sort(()=>Math.random()-.5);s.push(...r.slice(0,e).map(a=>ur(a)))}return s}function Rh(e,n=-1){const t=[];return e.forEach((i,s)=>{n!==-1&&s===n||(i.cities&&i.cities.forEach(o=>{t.push(o.name)}),i.drawnCities&&i.drawnCities.forEach(o=>{t.push(o.name)}))}),t}function Nh(e){const n=e.baseHp&&e.baseHp>3e4?1e5:8e4;return e.hp>n&&(e.hp=n),e.hp}function ac(e){e.drawnCities||(e.drawnCities=[]),e.drawCount===void 0&&(e.drawCount=0)}function lc(e){return(e.drawCount||0)<5}function v2(e,n,t,i){if(ac(e),!lc(e))return{success:!1,cities:[],message:"5"};const s=Rh(t,i),o=dr(n,s);return o.length<n?{success:!1,cities:o,message:`${o.length}`}:(o.forEach(r=>{r.baseHp||(r.baseHp=r.hp),r.red===void 0&&(r.red=0),r.green===void 0&&(r.green=0),r.blue===void 0&&(r.blue=0),r.yellow===void 0&&(r.yellow=0),Nh(r),r.currentHp||(r.currentHp=r.hp),r.isAlive===void 0&&(r.isAlive=!0)}),e.drawnCities=o,e.drawCount++,{success:!0,cities:o,message:`${o.length}${e.drawCount}`,drawCount:e.drawCount,canRedraw:e.drawCount<5})}function _2(e){return!e.drawnCities||e.drawnCities.length===0?{success:!1,message:""}:(e.cities=[...e.drawnCities],e.drawnCities=[],{success:!0,message:`${e.cities.length}`,cities:e.cities})}function $2(e,n,t){if(ac(e),!lc(e))return{success:!1,cities:[],message:"5"};const i=new Set;t.players.forEach(r=>{r.name!==e.name&&(r.cities&&r.cities.length>0&&r.cities.forEach(a=>{i.add(a.name)}),r.drawnCities&&r.drawnCities.length>0&&r.drawnCities.forEach(a=>{i.add(a.name)}))});const s=Array.from(i),o=dr(n,s);return o.length<n?{success:!1,cities:o,message:`${o.length}`}:(o.forEach(r=>{r.baseHp||(r.baseHp=r.hp),r.red===void 0&&(r.red=0),r.green===void 0&&(r.green=0),r.blue===void 0&&(r.blue=0),r.yellow===void 0&&(r.yellow=0),Nh(r),r.currentHp||(r.currentHp=r.hp),r.isAlive===void 0&&(r.isAlive=!0)}),e.drawnCities=o,e.drawCount++,{success:!0,cities:o,message:`${o.length}${e.drawCount}`,drawCount:e.drawCount,canRedraw:e.drawCount<5})}function w2(e){e.drawnCities=[],e.drawCount=0,e.cities=[]}function Mh(){function e(u,f=[]){return dr(u,f)}function n(u,f){const m=f==="2v2"?7:10,h=new Set;return u.forEach(v=>{if(v.cities&&v.cities.length>0){v.cities.forEach(X=>h.add(X.name));return}const S=dr(m,Array.from(h));S.forEach(X=>h.add(X.name)),v.cities=S,v.gold=2}),u}function t(u,f,m,h){return v2(u,f,m,h)}function i(u,f,m){return $2(u,f,m)}function s(u){return _2(u)}function o(u){ac(u)}function r(u){return lc(u)}function a(u){w2(u)}function l(u,f=-1){return Rh(u,f)}return{drawCities:e,assignCitiesToPlayers:n,drawCitiesWithLimit:t,drawCitiesInRoom:i,confirmCities:s,initDrawState:o,canRedraw:r,resetDrawState:a,getUsedNames:l}}function pi(){const e=Ce([]);let n=0;function t(o,r="success",a=null){const l=n++,f=a||(r==="error"?5e3:r==="warning"?4e3:3e3),m={id:l,message:o,type:r,visible:!1};e.value.push(m),setTimeout(()=>{const h=e.value.findIndex(v=>v.id===l);h!==-1&&(e.value[h].visible=!0)},100),setTimeout(()=>{i(l)},f)}function i(o){const r=e.value.findIndex(a=>a.id===o);r!==-1&&(e.value[r].visible=!1,setTimeout(()=>{const a=e.value.findIndex(l=>l.id===o);a!==-1&&e.value.splice(a,1)},300))}function s(){e.value=[]}return{notifications:e,showNotification:t,hideNotification:i,clearAllNotifications:s}}const b2={class:"firebase-config-panel panel"},A2={style:{background:"#1f2937",padding:"20px","border-radius":"8px",margin:"20px 0"}},P2={key:0},H2={key:1,style:{background:"rgba(251, 191, 36, 0.1)",border:"1px solid var(--warn)","border-radius":"6px",padding:"15px","margin-bottom":"15px"}},x2={style:{margin:"20px 0"}},B2={style:{padding:"15px",background:"#0b1220","border-radius":"6px","margin-top":"10px"}},S2={style:{margin:"15px 0"}},I2={__name:"FirebaseConfig",emits:["initialized","skip"],setup(e,{emit:n}){const t=n,{showNotification:i}=pi(),s=Ce(""),o=Oe(()=>ol());as(()=>{const u=Ih();u&&(s.value=JSON.stringify(u,null,2))});function r(){if(console.log("[Firebase] ..."),!ol()){console.error("[Firebase] "),i("","error");return}console.log("[Firebase]  Firebase..."),cr(U_())?(console.log("[Firebase]  "),i(" ","success"),t("initialized")):i("","error")}function a(){const u=s.value.trim();if(!u){i(" Firebase ","warning");return}try{const f=JSON.parse(u);if(!f.apiKey||!f.databaseURL){i(" apiKey  databaseURL ","error");return}L_(f),cr(f)?(i("Firebase ","success"),t("initialized")):i("Firebase ","error")}catch(f){i(""+f.message,"error")}}function l(){console.log("[Firebase] "),t("skip")}return(u,f)=>(M(),j("div",b2,[f[7]||(f[7]=p("h2",{style:{"text-align":"center"}},"",-1)),p("div",{class:ze(["firebase-status",Fe(Nt)?"connected":"disconnected"])},U(Fe(Nt)?" ":" "),3),p("div",A2,[f[3]||(f[3]=p("h3",{style:{"margin-top":"0",color:"var(--accent)"}},"",-1)),o.value?(M(),j("div",P2,[p("button",{class:"menu-btn",onClick:r,style:{width:"100%","margin-bottom":"10px"}},"   "),f[1]||(f[1]=p("div",{class:"muted",style:{"font-size":"12px","margin-bottom":"15px"}},"  ",-1))])):(M(),j("div",H2,[...f[2]||(f[2]=[p("div",{style:{color:"var(--warn)","font-weight":"bold","margin-bottom":"8px"}}," ",-1),p("div",{class:"muted",style:{"font-size":"13px","line-height":"1.6"}},[un("  Firebase  DEFAULT_FIREBASE_CONFIG"),p("br"),un("  ")],-1)])])),p("button",{class:"btn",onClick:l,style:{width:"100%"}},"   ")]),p("details",x2,[f[6]||(f[6]=p("summary",{style:{cursor:"pointer",padding:"10px",background:"#1f2937","border-radius":"6px","margin-bottom":"10px"}},"   Firebase  ",-1)),p("div",B2,[f[5]||(f[5]=p("div",{style:{"margin-bottom":"15px"}},[p("h4",{style:{"margin-top":"0"}}," Firebase "),p("ol",{style:{"line-height":"1.8",color:"var(--muted)","font-size":"13px"}},[p("li",null,[un(" "),p("a",{href:"https://console.firebase.google.com/",target:"_blank",style:{color:"var(--accent)"}},"Firebase Console")]),p("li",null,"   Realtime Database"),p("li",null,"  "),p("li",null,"")])],-1)),p("div",S2,[f[4]||(f[4]=p("label",null,"Firebase  (JSON )",-1)),ft(p("textarea",{"onUpdate:modelValue":f[0]||(f[0]=m=>s.value=m),style:{"min-height":"120px"},placeholder:`{
  "apiKey": "your-api-key",
  "databaseURL": "https://your-project.firebaseio.com",
  "projectId": "your-project-id"
}`},null,512),[[uo,s.value]])]),p("button",{class:"confirm-cities-btn",onClick:a,style:{width:"100%"}},"  ")])]),f[8]||(f[8]=p("div",{class:"muted",style:{"margin-top":"20px","font-size":"12px","line-height":"1.6","text-align":"center"}},"   ",-1))]))}},k2=kn(I2,[["__scopeId","data-v-1b13f46a"]]),E2={class:"room-setup panel"},T2={class:"mode-selector"},R2={class:"mode-description"},N2={class:"action-section"},M2={class:"join-section"},D2={__name:"RoomSelection",emits:["room-created","room-joined"],setup(e,{emit:n}){const t=n,{showNotification:i}=pi(),{createRoom:s,joinRoom:o}=oc(),r=Ce(""),a=Ce("2P");function l(){return{"2P":"21015","3P":"3105","2v2":"4714"}[a.value]||""}async function u(){const m={"2P":2,"3P":3,"2v2":4},h=await s({mode:a.value,playerCount:m[a.value],citiesPerPlayer:a.value==="2v2"?7:10});h.success?(i(`${h.roomId}`,"success"),t("room-created",h.roomId)):i("","error")}async function f(){if(!r.value.trim()){i("","warning");return}const m=await o(r.value.trim());m.success?(i("","success"),t("room-joined",{roomId:r.value.trim(),roomData:m.roomData,isRoomFull:m.isRoomFull})):i(m.error||"","error")}return(m,h)=>(M(),j("div",E2,[h[8]||(h[8]=Ig('<h2 class="room-title" data-v-aca3daab></h2><div class="info-box" data-v-aca3daab><div class="info-header" data-v-aca3daab> </div><div class="info-content" data-v-aca3daab>  </div></div><div class="tips-box" data-v-aca3daab><div class="tips-header" data-v-aca3daab> </div><div class="tips-content" data-v-aca3daab>  24<br data-v-aca3daab>  <br data-v-aca3daab>   </div></div>',3)),p("div",T2,[h[3]||(h[3]=p("label",{class:"mode-label"},"",-1)),ft(p("select",{"onUpdate:modelValue":h[0]||(h[0]=v=>a.value=v),class:"mode-select"},[...h[2]||(h[2]=[p("option",{value:"2P"},"2 (1v1)",-1),p("option",{value:"3P"},"3",-1),p("option",{value:"2v2"},"2v2 ",-1)])],512),[[Es,a.value]]),p("div",R2,U(l()),1)]),p("div",N2,[p("button",{class:"action-btn action-btn-create",onClick:u},[...h[4]||(h[4]=[p("span",{class:"btn-icon"},"",-1),p("span",{class:"btn-text"},"",-1)])]),h[7]||(h[7]=p("div",{class:"divider"},[p("span",{class:"divider-text"},"")],-1)),p("div",M2,[h[6]||(h[6]=p("label",{class:"join-label"},"",-1)),ft(p("input",{"onUpdate:modelValue":h[1]||(h[1]=v=>r.value=v),type:"text",class:"room-input",placeholder:"9",maxlength:"9",onKeyup:pf(f,["enter"])},null,544),[[uo,r.value]]),p("button",{class:"action-btn action-btn-join",onClick:f},[...h[5]||(h[5]=[p("span",{class:"btn-icon"},"",-1),p("span",{class:"btn-text"},"",-1)])])])])]))}},q2=kn(D2,[["__scopeId","data-v-aca3daab"]]),L2={class:"room-setup panel"},O2={class:"room-id-display"},U2={class:"room-id-number"},j2={key:0,style:{"margin-top":"10px"}},F2={key:1,class:"muted",style:{"margin-top":"10px"}},V2={key:0,class:"nickname-section"},W2={class:"join-mode-section"},z2={key:0,class:"room-full-notice"},G2={key:1,class:"join-mode-label"},J2={class:"join-buttons"},Y2=["disabled"],K2=["disabled"],Z2={key:1,class:"waiting-room"},Q2={key:0,class:"spectator-view"},X2={key:0,style:{"text-align":"center",padding:"40px 20px"}},eP={style:{"font-size":"14px",color:"#6b7280"}},nP={key:0,style:{"margin-top":"10px",color:"#10b981","font-size":"14px"}},tP={key:1,style:{"text-align":"center",padding:"20px"}},iP={style:{"font-size":"16px",color:"#e5e7eb","margin-bottom":"15px"}},sP={style:{"margin-top":"20px"}},oP={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"10px"}},rP={style:{"font-size":"16px",color:"#60a5fa","font-weight":"bold"}},aP={style:{"font-size":"14px",color:"#fbbf24"}},lP={style:{"margin-bottom":"8px","font-size":"14px",color:"#9ca3af"}},cP={key:0,style:{"margin-top":"10px","padding-top":"10px","border-top":"1px solid #374151"}},uP={key:0,style:{"font-size":"12px",color:"#e5e7eb"}},dP={style:{color:"#fbbf24"}},fP={key:1,style:{"font-size":"12px",color:"#6b7280"}},mP={key:1,style:{"margin-top":"10px","padding-top":"10px","border-top":"1px solid #374151"}},hP={style:{"max-height":"120px","overflow-y":"auto","font-size":"12px"}},pP={style:{color:"#fbbf24"}},gP={key:0,style:{color:"#6b7280","font-size":"11px"}},yP={style:{"text-align":"center","margin-top":"20px"}},CP={style:{"font-size":"12px",color:"#6b7280"}},vP={key:1},_P={key:0,style:{background:"#7f1d1d",border:"1px solid #991b1b","border-radius":"8px",padding:"12px","margin-bottom":"12px"}},$P={style:{"margin-top":"8px",display:"flex",gap:"8px"}},wP={class:"player-list"},bP={style:{display:"flex","justify-content":"space-between","align-items":"center"}},AP={style:{display:"flex","align-items":"center",gap:"8px"}},PP={key:0,style:{color:"var(--error)","font-size":"11px"}},HP={key:1,style:{"margin-top":"15px"}},xP=["disabled"],BP={__name:"WaitingRoom",props:{roomId:{type:String,required:!0},forceSpectator:{type:Boolean,default:!1},initialRoomData:{type:Object,default:null}},emits:["all-ready","player-joined"],setup(e,{emit:n}){const t=e,i=n,{showNotification:s}=pi(),{assignCitiesToPlayers:o}=Mh(),{roomData:r,isSpectator:a,getAllPlayersOnlineStatus:l,getOfflinePlayers:u,addPlayerToRoom:f,setPlayerReady:m,kickOfflinePlayer:h,getRoomData:v,saveRoomData:S,startRoomListener:X}=oc(),ae=Ce(""),fe=Ce(!1),ge=Ce(""),R=Ce(!1),Y=Ce(!1),V=Ce(!1);t.initialRoomData&&(r.value=t.initialRoomData);const ee=Oe(()=>r.value?l(r.value):{}),ue=Oe(()=>r.value?u(r.value):[]);function de(_){return ee.value[_]||{online:!1}}function W(){navigator.clipboard.writeText(t.roomId).then(()=>{Y.value=!0,s("","success"),setTimeout(()=>{Y.value=!1},2e3)}).catch(_=>{s(""+_.message,"error")})}async function Q(_=!1){if(!ae.value.trim()){s("","warning");return}const $=await f(t.roomId,{name:ae.value.trim()},_);$.success?(fe.value=!0,ge.value=ae.value.trim(),s("","success"),i("player-joined",{name:ae.value.trim(),asSpectator:_})):s($.error||"","error")}async function L(){if(!ge.value)return;V.value=!0;const _=!R.value;await m(t.roomId,ge.value,_)?(R.value=_,s(_?"":"","success")):s("","error"),V.value=!1}async function P(_){if(!confirm(` ${_} 


1. 
2. 
3. `))return;const $=await h(t.roomId,_);$.success?s(`: ${_}`,"success"):s($.error||"","error")}async function G(){console.log("[] ");const _=await v(t.roomId);_&&(r.value=_)}return xt(()=>r.value,async _=>{if(_&&_.players?.length===_.playerCount&&_.players.every($=>$.ready)){console.log("[WaitingRoom] ");const $=o(_.players,_.mode||"2P");_.players=$,await S(t.roomId,_),console.log("[WaitingRoom] all-ready"),i("all-ready",_.players)}},{deep:!0}),as(()=>{X(t.roomId,_=>{r.value=_})}),lo(()=>{}),(_,$)=>(M(),j("div",L2,[p("div",O2,[$[7]||($[7]=p("h3",null,"",-1)),p("div",U2,U(e.roomId),1),p("button",{class:ze(["copy-btn",{copied:Y.value}]),onClick:W},U(Y.value?" ":" "),3),Fe(Nt)()?(M(),j("div",j2,[...$[5]||($[5]=[p("div",{style:{color:"var(--good)","font-weight":"bold"}}," ",-1),p("div",{class:"muted",style:{"margin-top":"5px"}},"  ",-1)])])):(M(),j("div",F2,[...$[6]||($[6]=[un("   ",-1),p("div",{style:{"margin-top":"5px"}},"  ",-1)])]))]),fe.value?$e("",!0):(M(),j("div",V2,[$[11]||($[11]=p("div",{class:"nickname-header"},"",-1)),ft(p("input",{"onUpdate:modelValue":$[0]||($[0]=A=>ae.value=A),type:"text",class:"nickname-input",placeholder:"",maxlength:"20",onKeyup:$[1]||($[1]=pf(A=>ae.value.trim()&&!e.forceSpectator&&Q(!1),["enter"]))},null,544),[[uo,ae.value]]),p("div",W2,[e.forceSpectator?(M(),j("div",z2,[...$[8]||($[8]=[p("span",{class:"notice-icon"},"",-1),p("span",{class:"notice-text"},"",-1)])])):(M(),j("div",G2,"")),p("div",J2,[e.forceSpectator?$e("",!0):(M(),j("button",{key:0,class:"join-btn join-btn-battle",onClick:$[2]||($[2]=A=>Q(!1)),disabled:!ae.value.trim()},[...$[9]||($[9]=[p("span",{class:"btn-emoji"},"",-1),p("span",{class:"btn-label"},"",-1)])],8,Y2)),p("button",{class:"join-btn join-btn-spectate",onClick:$[3]||($[3]=A=>Q(!0)),disabled:!ae.value.trim()},[...$[10]||($[10]=[p("span",{class:"btn-emoji"},"",-1),p("span",{class:"btn-label"},"",-1)])],8,K2)])])])),fe.value&&Fe(r)?(M(),j("div",Z2,[Fe(a)?(M(),j("div",Q2,[$[17]||($[17]=p("h3",{style:{"text-align":"center",color:"#3b82f6","margin-bottom":"20px"}}," ",-1)),!Fe(r).gameState||!Fe(r).gameState.currentRound?(M(),j("div",X2,[$[12]||($[12]=p("div",{style:{"font-size":"18px",color:"#9ca3af","margin-bottom":"15px"}}," ... ",-1)),p("div",eP," "+U(Fe(r).players?.length||0)+" / "+U(Fe(r).playerCount)+"  ",1),Fe(r).players?.length===Fe(r).playerCount?(M(),j("div",nP,"  ... ")):$e("",!0)])):(M(),j("div",tP,[$[15]||($[15]=p("div",{style:{"font-size":"20px",color:"#10b981","margin-bottom":"20px","font-weight":"bold"}},"   ",-1)),p("div",iP,"  "+U(Fe(r).gameState.currentRound)+"  ",1),p("div",sP,[(M(!0),j(qe,null,en(Fe(r).players,A=>(M(),j("div",{key:A.name,style:{background:"#1f2937","border-radius":"8px",padding:"15px","margin-bottom":"10px"}},[p("div",oP,[p("div",rP,U(A.name),1),p("div",aP,"  "+U(A.gold||0)+"  ",1)]),p("div",lP," "+U(A.cities?.filter(H=>H.isAlive!==!1).length||0)+" / "+U(A.cities?.length||0),1),Fe(r).gameState.playerStates&&Fe(r).gameState.playerStates[A.name]?(M(),j("div",cP,[$[13]||($[13]=p("div",{style:{"font-size":"12px",color:"#60a5fa","margin-bottom":"5px","font-weight":"bold"}},"   ",-1)),Fe(r).gameState.playerStates[A.name].currentBattleCities&&Fe(r).gameState.playerStates[A.name].currentBattleCities.length>0?(M(),j("div",uP,[(M(!0),j(qe,null,en(Fe(r).gameState.playerStates[A.name].currentBattleCities,H=>(M(),j("div",{key:H.cityIdx,style:{margin:"3px 0"}},[un("  "+U(A.cities[H.cityIdx]?.name||"")+" ",1),p("span",dP,"(HP: "+U(Math.floor(A.cities[H.cityIdx]?.currentHp||A.cities[H.cityIdx]?.hp||0))+")",1)]))),128))])):(M(),j("div",fP,"  "))])):$e("",!0),A.cities?(M(),j("div",mP,[$[14]||($[14]=p("div",{style:{"font-size":"12px",color:"#60a5fa","margin-bottom":"5px","font-weight":"bold"}},"   ",-1)),p("div",hP,[(M(!0),j(qe,null,en(A.cities.filter(H=>!H.isUnknown&&H.isAlive!==!1),(H,q)=>(M(),j("div",{key:q,style:{color:"#10b981",margin:"2px 0"}},[un("  "+U(H.name)+" ",1),p("span",pP,"(HP: "+U(Math.floor(H.currentHp||H.hp||0))+")",1)]))),128)),A.cities.filter(H=>!H.isUnknown&&H.isAlive!==!1).length===0?(M(),j("div",gP,"  ")):$e("",!0)])])):$e("",!0)]))),128))]),$[16]||($[16]=p("div",{style:{"margin-top":"20px",padding:"15px",background:"#374151","border-radius":"8px"}},[p("div",{style:{"font-size":"14px",color:"#9ca3af"}},"   ")],-1))])),p("div",yP,[p("div",CP," "+U(ge.value),1)])])):(M(),j("div",vP,[p("h4",null," ("+U(Fe(r).players?.length||0)+" / "+U(Fe(r).playerCount)+")",1),ue.value.length>0?(M(),j("div",_P,[$[18]||($[18]=p("div",{style:{color:"#fca5a5","font-weight":"bold","margin-bottom":"8px"}}," ",-1)),$[19]||($[19]=p("div",{style:{color:"#fecaca","font-size":"12px","margin-bottom":"8px"}}," 30 ",-1)),(M(!0),j(qe,null,en(ue.value,({name:A,status:H})=>(M(),j("div",{key:A,style:{color:"#fef2f2","font-size":"12px",padding:"4px 0"}},"  "+U(A)+" ( "+U(H.offlineSeconds||"?")+" ) ",1))),128)),p("div",$P,[p("button",{class:"btn",onClick:$[4]||($[4]=A=>P(ue.value[0].name)),style:{"font-size":"12px",padding:"6px 12px",background:"#991b1b","border-color":"#7f1d1d"}},"  "),p("button",{class:"btn",onClick:G,style:{"font-size":"12px",padding:"6px 12px"}},"  ")])])):$e("",!0),p("div",wP,[(M(!0),j(qe,null,en(Fe(r).players,A=>(M(),j("div",{key:A.name,class:ze(["player-item",{ready:A.ready}])},[p("div",bP,[p("div",AP,[p("span",{style:Ki({display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",background:de(A.name).online?"#34d399":"#ef4444"})},null,4),p("span",null,U(A.name),1),de(A.name).online?$e("",!0):(M(),j("span",PP,"()"))]),p("span",{style:Ki({color:A.ready?"var(--good)":"var(--warn)"})},U(A.ready?" ":"..."),5)])],2))),128))]),ge.value?(M(),j("div",HP,[p("button",{class:"confirm-cities-btn",onClick:L,disabled:V.value,style:{width:"100%"}},U(R.value?"":""),9,xP)])):$e("",!0)]))])):$e("",!0)]))}},SP=kn(BP,[["__scopeId","data-v-1d8bbb2e"]]),x={PASSIVE:"passive",ACTIVE:"active",TOGGLE:"toggle"},IP={:{name:"",description:"20%21",type:x.PASSIVE,category:"battle",powerBoostLimit:2,surrenderLimit:1,powerBoostMultiplier:1.2},:{name:"",description:"HP50%50%HPx250%",type:x.PASSIVE,category:"nonBattle",hpBonus:1.5,damageTransfer:.5,capitalBonus:{hp:2,powerLimit:1.5}},:{name:"",description:"2HP",type:x.ACTIVE,category:"battle",limit:2,hpReduction:.5},:{name:"",description:"22",type:x.ACTIVE,category:"battle",limit:2,duration:3,goldPerRound:2},:{name:"",description:"220%",type:x.ACTIVE,category:"battle",limit:2,powerBonus:1.2,damageReduction:.5},:{name:"",description:"2",type:x.ACTIVE,category:"nonBattle",limit:2,requiresTarget:!0},:{name:"",description:"2310000HP",type:x.ACTIVE,category:"battle",limit:2,duration:3,shieldHp:1e4},:{name:"",description:"23",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,requiresTarget:!0,skillImmune:!0},:{name:"",description:"2+5000HP",type:x.ACTIVE,category:"nonBattle",limit:2,healAmount:5e3,requiresTarget:!0},:{name:"",description:"2000HP",type:x.PASSIVE,category:"battle",damageToAll:2e3},:{name:"",description:"150%HP50%",type:x.ACTIVE,category:"battle",limit:1,hpReduction:.5,destroyChance:.5},:{name:"",description:"12",type:x.ACTIVE,category:"battle",limit:1,duration:2,requiresTarget:!0},:{name:"",description:"222HP2HP15000",type:x.ACTIVE,category:"nonBattle",limit:2,duration:2,hpMultiplier:2,hpRequirement:{max:15e3},requiresTarget:!0},:{name:"",description:"3+500HP",type:x.ACTIVE,category:"nonBattle",limit:3,healAmount:500,requiresTarget:!0},:{name:"",description:"2",type:x.PASSIVE,category:"battle",limit:2,strikeFirst:!0},:{name:"",description:"15+2000HP",type:x.ACTIVE,category:"nonBattle",limit:1,healAmount:2e3,targetCount:5,requiresMultipleSelfCities:!0},:{name:"",description:"3+500HP",type:x.ACTIVE,category:"nonBattle",limit:3,healAmount:500,requiresTarget:!0},:{name:"",description:"22HPHP80%",type:x.ACTIVE,category:"nonBattle",limit:2,healPercent:.8,targetCount:2,requiresMultipleSelfCities:!0},:{name:"",description:"2000",type:x.PASSIVE,category:"battle",powerBonus:2e3},:{name:"",description:"133HPx3HP12000",type:x.ACTIVE,category:"battle",limit:1,duration:3,powerMultiplier:3,damageReduction:.5,afterDuration:2,hpRequirement:{max:12e3},requiresTarget:!0},:{name:"",description:"23+3000HP",type:x.ACTIVE,category:"nonBattle",limit:2,healAmount:3e3,targetCount:3,requiresMultipleSelfCities:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,hiddenSkills:2},:{name:"",description:"12HP40%HP20000",type:x.ACTIVE,category:"nonBattle",limit:1,hpBonus:.4,targetCount:2,hpRequirement:{max:2e4},requiresMultipleSelfCities:!0},:{name:"",description:"20%50%",type:x.PASSIVE,category:"battle",chance:.2,powerBonus:1.5},:{name:"",description:"1HP20%HP2HP10000",type:x.ACTIVE,category:"nonBattle",limit:1,hpBonus:.2,powerMultiplier:2,hpRequirement:{max:1e4},requiresTarget:!0},:{name:"",description:"",type:x.ACTIVE,category:"nonBattle",limit:1,summon:""},:{name:"",description:"220%HP2HP",type:x.PASSIVE,category:"battle",limit:2,hpReduction:.2,duration:2},:{name:"",description:"122HPHP8000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpRequirement:{max:8e3},requiresTarget:!0,restoreToInitialHp:!0},:{name:"",description:"12000HP",type:x.ACTIVE,category:"battle",limit:1,shieldHp:2e3,duration:2,requiresTarget:!0},:{name:"",description:"13HP20%HP20000",type:x.ACTIVE,category:"nonBattle",limit:1,hpBonus:.2,targetCount:3,hpRequirement:{max:2e4},requiresMultipleSelfCities:!0},:{name:"",description:"2HP20%40%",type:x.PASSIVE,category:"battle",limit:2,hpReduction:.2,overflowDamage:.4},:{name:"",description:"2HP5000HPHPHPHP5",type:x.ACTIVE,category:"nonBattle",limit:2,targetHpRequirement:{max:5e3},minEnemyCities:5,requiresTarget:!0},:{name:"",description:"22+1000HP",type:x.ACTIVE,category:"nonBattle",limit:2,healAmount:1e3,targetCount:2,requiresMultipleSelfCities:!0},:{name:"",description:"150%HP20000",type:x.ACTIVE,category:"nonBattle",limit:1,powerBonus:1.5,permanent:!0,hpRequirement:{max:2e4},requiresTarget:!0},:{name:"",description:"22+1000HP",type:x.ACTIVE,category:"nonBattle",limit:2,healAmount:1e3,targetCount:2,requiresMultipleSelfCities:!0},:{name:"",description:"122HP28000HPHP15000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpMultiplier:2,shieldHp:8e3,hpRequirement:{max:15e3},requiresTarget:!0},:{name:"",description:"13",type:x.ACTIVE,category:"nonBattle",limit:1,revealCount:3,minUnknownCities:3},:{name:"",description:"22+1000HP",type:x.ACTIVE,limit:2,healAmount:1e3,targetCount:2,category:"nonBattle",requiresMultipleSelfCities:!0},:{name:"",description:"13HP",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,requiresTarget:!0,forcedHpPenalty:.5},:{name:"",description:"122HPHP8000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpRequirement:{max:8e3},requiresTarget:!0,restoreToInitialHp:!0},:{name:"",description:"1HP10000",type:x.ACTIVE,category:"battle",limit:1,disguiseHpRequirement:{min:1e4},requiresTarget:!0},:{name:"",description:"3+500HP",type:x.ACTIVE,category:"nonBattle",limit:3,healAmount:500,requiresTarget:!0},:{name:"",description:"3+500HP",type:x.ACTIVE,category:"nonBattle",limit:3,healAmount:500,requiresTarget:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,stealNextSkill:!0},:{name:"",description:"122HPHP8000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpRequirement:{max:8e3},requiresTarget:!0,restoreToInitialHp:!0},:{name:"",description:"22HP8000",type:x.ACTIVE,category:"nonBattle",limit:2,summonCount:2,summonHpRequirement:{max:8e3}},:{name:"",description:"13",type:x.PASSIVE,category:"nonBattle",limit:1,duration:3,capitalProtection:!0},:{name:"",description:"250%50%",type:x.PASSIVE,category:"battle",limit:2,enemyPowerReduction:.5,allyPowerBonus:1.5},:{name:"",description:"1510000HP",type:x.ACTIVE,category:"nonBattle",limit:1,duration:5,shieldHp:1e4},:{name:"",description:"12",type:x.ACTIVE,category:"nonBattle",limit:1,revealRounds:2,requiresTarget:!0},:{name:"",description:"1250%2",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,targetCount:2,sharedDamage:.5,requiresTarget:!0},:{name:"",description:"2+500HP",type:x.ACTIVE,category:"nonBattle",limit:2,healAmount:500,requiresTarget:!0},:{name:"",description:"1HP1000",type:x.PASSIVE,category:"battle",limit:1,duration:1,projectionHp:1e3,projectionBonus:!0},:{name:"",description:"12000HP",type:x.ACTIVE,category:"nonBattle",limit:1,shieldHp:2e3,requiresTarget:!0},:{name:"",description:"12",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,powerMultiplier:2,requiresTarget:!0},:{name:"",description:"1HP10000()",type:x.ACTIVE,category:"nonBattle",limit:1,goldCost:1,captureHpRequirement:{max:1e4},canBeBlocked:!0},:{name:"",description:"1HP15000HP2",type:x.ACTIVE,category:"nonBattle",limit:1,targetCount:3,hpMultiplier:2,targetHpRequirement:{max:15e3},requiresMultipleSelfCities:!0},:{name:"",description:"2",type:x.PASSIVE,category:"battle",limit:2,damageReduction:.5},:{name:"",description:"1HPx2",type:x.ACTIVE,category:"nonBattle",limit:1,summonCities:["",""],hpMultiplier:2},:{name:"",description:"HP40%",type:x.PASSIVE,category:"battle",damageReductionFromWeaker:.4},:{name:"",description:"1HP",type:x.ACTIVE,category:"nonBattle",limit:1,nullifyHighestHp:!0,singleTargetReduction:.5},:{name:"",description:"13HP2(HP8000)",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,hpMultiplier:2,hpRequirement:{max:8e3},requiresTarget:!0,fullHeal:!0},:{name:"",description:"3500HPHP",type:x.ACTIVE,category:"nonBattle",limit:3,duration:2,shieldHp:500,permanentIfSurvives:!0,requiresTarget:!0},:{name:"",description:"1:10000HPHP50%HP",type:x.ACTIVE,category:"nonBattle",limit:1,shieldHp:1e4,selfHpReduction:.5,enemyCenterDamagePercent:.5,requiresTarget:!0},:{name:"",description:"3+500HP",type:x.ACTIVE,category:"nonBattle",limit:3,healAmount:500,requiresTarget:!0},:{name:"",description:"HP50%50%HP",type:x.PASSIVE,category:"nonBattle",hpBonus:1.5,healDelay:3,healPercent:.5},:{name:"",description:"1500HP",type:x.ACTIVE,category:"battle",limit:1,hakkaBonus:!0,selfHpCost:500},:{name:"",description:"HPx2",type:x.PASSIVE,category:"nonBattle",hpMultiplier:2,requiresAlly:""},:{name:"",description:"1100HP1000",type:x.ACTIVE,category:"nonBattle",limit:1,selfHpCost:100,enemyCenterDamage:1e3},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,surrenderImmunity:!0,requiresTarget:!0},:{name:"",description:"1",type:x.PASSIVE,category:"nonBattle",limit:1,revive:!0,fullHeal:!0},:{name:"",description:"1HP400010000",type:x.ACTIVE,category:"nonBattle",limit:1,summonHpRequirement:{min:4e3,max:1e4}},:{name:"",description:"1HP2000",type:x.PASSIVE,category:"nonBattle",limit:1,destroyOnDeath:!0,targetHpRequirement:{max:2e3}},:{name:"",description:"33300HP",type:x.ACTIVE,category:"nonBattle",limit:3,duration:3,shieldHp:300,allyCities:!0},:{name:"",description:"2HP5000",type:x.ACTIVE,category:"nonBattle",limit:2,targetHpRequirement:{max:5e3},requiresTarget:!0,fullHeal:!0},:{name:"",description:"23000()",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,powerBonus:3e3,requiresTarget:!0},:{name:"",description:"123",type:x.PASSIVE,limit:1,category:"nonBattle",minOpponentCities:3,freezeDuration:2},:{name:"",description:"232000HP",type:x.PASSIVE,limit:2,category:"battle",shieldHp:2e3,shieldDuration:3,targetCenter:!0},:{name:"",description:"1350%20%",type:x.ACTIVE,limit:1,category:"battle",duration:3,reflectChance:.5,reflectPercent:.2,requiresTarget:!0},:{name:"",description:"1+1000HP",type:x.ACTIVE,limit:1,category:"nonBattle",hpIncrease:1e3,targetAll:!0},:{name:"",description:"22+2000HP30%",type:x.ACTIVE,limit:2,category:"battle",targetCount:2,shieldHp:2e3,attackBoost:1.3,requiresMultipleSelfCities:!0},:{name:"",description:"22",type:x.PASSIVE,limit:2,category:"battle",disableDuration:2},:{name:"",description:"22000",type:x.PASSIVE,limit:2,category:"battle",attackBonus:2e3},:{name:"",description:"21-500",type:x.PASSIVE,limit:2,category:"battle",damageBlockMin:1,damageBlockMax:500},:{name:"",description:"1",type:x.PASSIVE,limit:1,category:"battle",fullHealRandom:!0},:{name:"",description:"22000",type:x.PASSIVE,limit:2,category:"battle",attackBonus:2e3,targetRandom:!0},:{name:"",description:"12",type:x.ACTIVE,limit:1,category:"nonBattle",duration:2,requiresTarget:!0,invisibility:!0},:{name:"",description:"1HPx2",type:x.ACTIVE,limit:1,category:"nonBattle",hpMultiplier:2,summonCount:2,summonProvince:""},:{name:"",description:"12HP5000HPx2HP5000",type:x.ACTIVE,limit:1,category:"nonBattle",targetCount:2,hpMultiplier:2,targetHpRequirement:{max:5e3},captureHpRequirement:{max:5e3},requiresMultipleSelfCities:!0},:{name:"",description:"1HPx2HPx2",type:x.ACTIVE,limit:1,category:"nonBattle",hpMultiplier:2,summonCities:["",""]},:{name:"",description:"1HP3000022HP",type:x.ACTIVE,limit:1,category:"nonBattle",targetHpRequirement:{max:3e4},forceBattleDuration:2,hpPenalty:.5,requiresTarget:!0},:{name:"",description:"1HPx2",type:x.ACTIVE,limit:1,category:"nonBattle",hpMultiplier:2,summonProvince:"",excludeCities:[""]},:{name:"",description:"1HP800050%HP",type:x.ACTIVE,limit:1,category:"nonBattle",targetHpRequirement:{max:8e3},destroyChance:1,captureChance:.5,requiresTarget:!0},:{name:"",description:"12",type:x.ACTIVE,limit:1,category:"nonBattle",duration:2,secretUse:!0,nullifyAttack:!0},:{name:"",description:"12HP5000HPx2",type:x.ACTIVE,limit:1,category:"nonBattle",targetCount:2,hpMultiplier:2,targetHpRequirement:{max:5e3},requiresMultipleSelfCities:!0},:{name:"",description:"1HP8000HPx2",type:x.ACTIVE,limit:1,category:"nonBattle",hpMultiplier:2,targetHpRequirement:{max:8e3},disableEnemySkill:"",requiresTarget:!0},:{name:"",description:"1HP5000",type:x.PASSIVE,limit:1,category:"nonBattle",interceptSummon:!0,interceptHpRequirement:{max:5e3}},:{name:"",description:"12HP10000HPx2",type:x.ACTIVE,limit:1,category:"nonBattle",targetCount:2,hpMultiplier:2,targetHpRequirement:{max:1e4}},:{name:"",description:"4000HP",type:x.ACTIVE,limit:3,category:"nonBattle",healAmount:4e3,requiresTarget:!0},:{name:"",description:"1(15,000)",type:x.ACTIVE,limit:1,category:"nonBattle",targetCount:3,fullHeal:!0,totalHpLimit:15e3,requiresMultipleSelfCities:!0},:{name:"",description:"12000HP/",type:x.ACTIVE,limit:1,category:"nonBattle",healAmount:2e3,refreshSkill:!0,requiresTarget:!0},:{name:"",description:"100HP",type:x.ACTIVE,limit:1,category:"nonBattle",goldGain:3,selfHpCost:100},:{name:"",description:"",type:x.ACTIVE,limit:1,category:"nonBattle",summonCity:"",canSteal:!0},:{name:"",description:"600HP",type:x.ACTIVE,limit:1,category:"battle",nullifyDamage:!0,nextRoundHpCost:600},:{name:"",description:"",type:x.PASSIVE,category:"nonBattle",skillCountForGold:2,goldGain:1},:{name:"",description:"HP9000",type:x.ACTIVE,limit:1,category:"battle",absorbDamage:!0,absorbLimit:9e3,cannotRefresh:!0},:{name:"",description:"/  1",type:x.PASSIVE,category:"nonBattle",specialSummon:["","",""]},:{name:"",description:"",type:x.ACTIVE,limit:3,category:"battle",duration:2,applyGreenSkill:!0},:{name:"",description:'2""HP9000',type:x.ACTIVE,limit:1,category:"nonBattle",selfDestroy:!0,goldCost:2,destroyCount:2,destroyHpRequirement:{max:9e3}},:{name:"",description:"HP1000HP",type:x.PASSIVE,category:"nonBattle",bonusHpOnHeal:1e3},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",cooldown:1,targetCount:2,swapSkills:!0,requiresMultipleSelfCities:!0},:{name:"",description:'""""+2',type:x.PASSIVE,category:"nonBattle",permanentIronCity:!0,ironCityLimitBonus:2},:{name:"",description:"-75%",type:x.PASSIVE,category:"nonBattle",protectProvinces:["","",""],damageReduction:.75},:{name:"",description:"1HP",type:x.ACTIVE,limit:1,category:"nonBattle",copyHp:!0,requiresTarget:!0},:{name:"",description:"1+1",type:x.ACTIVE,limit:1,category:"nonBattle",increaseSkillTarget:1},:{name:"",description:"4HP1",type:x.ACTIVE,cooldown:4,category:"nonBattle",preventDeath:!0,reviveHp:1},:{name:"",description:"HP20HPnHP[n/5]",type:x.PASSIVE,category:"nonBattle",awakeningCondition:{hpRatio:20,minCities:2},hpShareRatio:.2},:{name:"",description:"HP*2*1.5",type:x.PASSIVE,category:"nonBattle",hpIncreaseMultiplier:2,hpDecreaseMultiplier:1.5},:{name:"",description:"17",type:x.PASSIVE,category:"nonBattle",awakeningRound:17,summonCity:"",requireUnknown:!0},:{name:"",description:"235",type:x.ACTIVE,limit:2,category:"nonBattle",goldCost:3,delay:5,gainCitySkill:!0},:{name:"",description:"1HP",type:x.ACTIVE,limit:1,category:"nonBattle",barrierHp:"self"},:{name:"",description:"1HP100005",type:x.ACTIVE,limit:1,category:"nonBattle",restoreRounds:5,targetHpRequirement:{max:1e4},requiresTarget:!0},:{name:"",description:"1GDP1",type:x.ACTIVE,cooldown:1,category:"nonBattle",upgradeCity:!0,requireUnknown:!0},:{name:"",description:"HP500",type:x.PASSIVE,category:"nonBattle",hpPerRound:500,allyCities:!0},:{name:"",description:"1HP",type:x.ACTIVE,limit:1,category:"nonBattle",powerEqualsTotalHp:!0},:{name:"",description:"5%10%325%10%",type:x.PASSIVE,category:"nonBattle",costReductionPerSkill:.05,goldBonusInterval:.1,goldBonus:3,maxReduction:.25,orangeCardMaxReduction:.1},:{name:"",description:"20%",type:x.PASSIVE,category:"nonBattle",dodgeChance:.2,allCities:!0},:{name:"",description:"//50%",type:x.PASSIVE,category:"nonBattle",freeSkillInterval:3,freeSkills:["","",""],bonusAfterFreeSkills:3,effectBonus:1.5,unknownBeforeBattle:!0},:{name:"",description:"50%HP",type:x.PASSIVE,category:"battle",firstBattleDamageReduction:.5,reactivateCondition:{differentRounds:3,damageThreshold:"initialHP"}},:{name:"",description:"",type:x.PASSIVE,category:"nonBattle",damageRequirement:{rounds:3,totalMultiplier:5,minPerRound:"initialPower"},doubleSkillEffect:!0,onlyEffectNotTarget:!0},:{name:"",description:"123458",type:x.PASSIVE,category:"nonBattle",costReductions:[1,2,3,4,5],bonusSkillAfter:5,bonusSkillMaxCost:8,bonusSkillDuration:3},:{name:"",description:"5%5%25%",type:x.PASSIVE,category:"nonBattle",baseDamageReduction:.05,reductionPerSkill:.05,maxReduction:.25,triggerInterval:3},:{name:"",description:"62",type:x.PASSIVE,category:"nonBattle",maxCostAffected:6,costReduction:.5,roundUp:!0,cooldown:2},:{name:"",description:"",type:x.PASSIVE,category:"nonBattle",affectedSkills:["","",""],costReduction:.5,cooldown:3},:{name:"",description:"1nHPHPxn",type:x.ACTIVE,category:"battle",limit:1,trackRounds:3,hpMultiplierByKills:!0},:{name:"",description:"1HPHPHPx2HP50%",type:x.ACTIVE,category:"nonBattle",limit:1,centerHpRequirement:{max:.5},newCenterMultiplier:2,oldCenterBonus:1.5,requiresTarget:!0},:{name:"",description:"122HPHP8000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpRequirement:{max:8e3},requiresTarget:!0,restoreToInitialHp:!0},:{name:"",description:"13HP50%310%03HPHPHPx3",type:x.ACTIVE,category:"battle",limit:1,duration:3,damagePercent:.5,overflowDamagePercent:.1,secretUntilEnd:!0,noFatigue:!0,finalHpMultiplier:3,restoreToInitialHp:!0},:{name:"",description:"133000HPnn1000",type:x.ACTIVE,category:"nonBattle",limit:1,targetCount:3,initialDamage:3e3,splashDamage:1e3,requiresTarget:!0},:{name:"",description:"HPHP",type:x.ACTIVE,category:"nonBattle",limit:1,shieldBasedOnProvince:!0,requiresTarget:!0,cannotUseInSpecialRegions:!0},:{name:"",description:"250%",type:x.ACTIVE,category:"battle",limit:2,nullifyAttack:!0,reflectPercent:.5},:{name:"",description:"2530003",type:x.ACTIVE,category:"nonBattle",limit:2,minRound:5,damage:3e3,requireUnknown:!0,cooldown:3,requiresTarget:!0},:{name:"",description:"13HPx2HP5000",type:x.ACTIVE,category:"nonBattle",limit:1,targetCount:3,hpMultiplier:2,targetHpRequirement:{max:5e3},requiresMultipleSelfCities:!0},:{name:"",description:"",type:x.PASSIVE,category:"nonBattle",transferFirstCenterDamage:!0,transferAll:!0},:{name:"",description:"1HP5000HP",type:x.ACTIVE,category:"nonBattle",limit:1,targetHpRequirement:{max:5e3},swapHp:!0,requiresTarget:!0},:{name:"",description:"12",type:x.ACTIVE,category:"nonBattle",limit:1,revealRounds:2,secret:!0},:{name:"",description:"122HPHP5000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpRequirement:{max:5e3},requiresTarget:!0,restoreToInitialHp:!0},:{name:"",description:"133HPx3HP8000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,hpMultiplier:3,hpRequirement:{max:8e3},requiresTarget:!0},:{name:"",description:"22",type:x.ACTIVE,limit:2,category:"nonBattle",doubleSkillNumber:!0},:{name:"",description:'15""1""HPHPnn""""0',type:x.PASSIVE,category:"nonBattle",coalTokens:15,hpMultiplierByCoal:!0},:{name:"",description:"1HP1000",type:x.ACTIVE,limit:1,category:"nonBattle",summonHpRequirement:{max:1e3}},:{name:"",description:"4nn[HP/3000]",type:x.ACTIVE,cooldown:4,category:"nonBattle",goldCostFormula:"hp/3000",captureCity:!0,requiresTarget:!0},:{name:"",description:'110""""""',type:x.ACTIVE,limit:1,category:"nonBattle",spaceStationDuration:10,protectFromAll:!0,summonOnReturn:["","",""],initialInSpace:!0},:{name:"",description:"12HP2HP1000050%HP//",type:x.ACTIVE,category:"nonBattle",limit:1,targetCount:2,restoreToInitialHp:!0,enemyTargetCount:2,targetHpRequirement:{max:1e4},hpReduction:.5,disableSkills:["","",""],requiresMultipleSelfCities:!0},:{name:"",description:"1HPx33HP3000",type:x.ACTIVE,category:"battle",limit:1,hpMultiplier:3,secretBattleDuration:3,noFatigue:!0,noDamage:!0,captureHpRequirement:{max:3e3}},:{name:"",description:"1HPx350%HP20%HP50%",type:x.PASSIVE,category:"battle",limit:1,hpMultiplier:3,powerBonus:1.5,surrenderProvince:"",excludeSurrender:["",""],xianPenalty:.2,hanzhongPenalty:.5},:{name:"",description:"1HPHPx240%HP",type:x.ACTIVE,category:"battle",limit:1,duel:!0,winHpMultiplier:2,restoreToInitialHp:!0,loseEnemyDamage:.4},:{name:"",description:"1HPx350%HP50%",type:x.ACTIVE,category:"battle",limit:1,hpMultiplier:3,powerBonus:1.5,surrenderProvince:"",excludeSurrender:["",""],xianSurrender:!0,xiangyangPenalty:.5},:{name:"",description:"13",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,shieldType:"invincible",disableEnemySkill:"",requiresTarget:!0},:{name:"",description:"1HPx2HP30005000HP2x3",type:x.ACTIVE,category:"nonBattle",limit:1,centerHpMultiplier:2,targetHpRequirement:{max:3e3},shieldHp:5e3,powerMultiplier:3,powerDuration:2,requiresTarget:!0},:{name:"",description:"2",type:x.PASSIVE,category:"nonBattle",freeSkillUses:3,freeSkill:"",cannotBeBlocked:!0,enemySkillCostIncrease:2,affectedEnemySkill:""},:{name:"",description:"1250%10000",type:x.ACTIVE,category:"battle",limit:1,recordDuration:2,damagePercent:.5,damageLimit:1e4},:{name:"",description:"1HP20000",type:x.ACTIVE,category:"battle",limit:1,surrenderCondition:"",targetHpRequirement:{max:2e4}},:{name:"",description:"320%HPHP50%2",type:x.PASSIVE,category:"battle",triggerCondition:{maxCities:3},centerPowerBonus:1.2,restoreToInitialHp:!0,selectedCityPowerBonus:1.5,goldPerDeadCity:2},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,protectionEffect:!0,noCost:!0,requiresTarget:!0},:{name:"",description:'1""',type:x.PASSIVE,category:"nonBattle",goldPerRound:1,blockSkill:"",disableOnBlock:!0},:{name:"",description:"25HP50%5000",type:x.ACTIVE,category:"battle",limit:2,stackMechanic:!0,maxStacks:5,damagePercent:.5,damageLimit:5e3,targetAll:!0,requiresTarget:!0},:{name:"",description:"550%3",type:x.ACTIVE,category:"battle",waterTokens:5,damageBoostPerToken:1.5,maxTokensPerUse:3},:{name:"",description:"34",type:x.ACTIVE,category:"nonBattle",limit:3,extraDeploySlot:1},:{name:"",description:"1",type:x.PASSIVE,category:"nonBattle",revealPerRound:1,drawIfAllKnown:!0,drawCondition:"higherPower"},:{name:"",description:"120%2",type:x.ACTIVE,category:"nonBattle",limit:1,powerBonus:1.2,duration:2,allyCities:!0},:{name:"",description:"123",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,freezeSkills:!0,minOpponentCities:3},:{name:"",description:"1HP1000HP10002",type:x.ACTIVE,category:"nonBattle",limit:1,damage:1e3,destroyIfLow:!0,minOpponentCities:2,requiresTarget:!0},:{name:"",description:"140%HP",type:x.ACTIVE,category:"nonBattle",limit:1,powerBonus:1.4,hpPenalty:.5,requiresTarget:!0},:{name:"",description:"2315%",type:x.PASSIVE,category:"battle",limit:2,duration:3,skillEffectBonus:1.15,allyCities:!0},:{name:"",description:"24%HP",type:x.PASSIVE,category:"battle",limit:2,duration:3,healPercentPerRound:.04,allyCities:!0},:{name:"",description:"1333HP10000",type:x.ACTIVE,category:"nonBattle",limit:1,hideDuration:3,shieldDuration:3,invincibleShield:!0,hpRequirement:{max:1e4},requiresTarget:!0},:{name:"",description:"220%",type:x.PASSIVE,category:"battle",limit:2,duration:3,skillEffectBonus:1.2,allyCities:!0},:{name:"",description:"150%HP",type:x.ACTIVE,category:"battle",limit:1,maxHpLoss:.5},:{name:"",description:"2HPx22HP7000",type:x.ACTIVE,category:"nonBattle",limit:2,hpMultiplier:2,duration:2,targetHpRequirement:{max:7e3},requiresTarget:!0},:{name:"",description:"135000HP",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,shieldHp:5e3,requiresTarget:!0},:{name:"",description:"3",type:x.ACTIVE,category:"battle",limit:3,removeFatigue:!0,requiresTarget:!0},:{name:"",description:"2HP/1500HP",type:x.ACTIVE,category:"nonBattle",limit:2,stackOwnHp:!0,alternativeHeal:1500,requiresTarget:!0},:{name:"",description:"21200HP",type:x.ACTIVE,category:"nonBattle",limit:2,shieldHp:1200,targetCenter:!0},:{name:"",description:"21500HP",type:x.ACTIVE,category:"nonBattle",limit:2,healAmount:1500,requiresTarget:!0},:{name:"",description:"220%",type:x.ACTIVE,category:"battle",limit:2,damageReduction:.2},:{name:"",description:"1HP13000",type:x.ACTIVE,category:"nonBattle",limit:1,revive:!0,targetHpRequirement:{max:13e3},fullHeal:!0,noSkillRefresh:!0,requiresTarget:!0},:{name:"",description:"120%",type:x.ACTIVE,category:"battle",limit:1,powerBonus:1.2},:{name:"",description:"32500HP",type:x.ACTIVE,category:"nonBattle",limit:3,healAmount:500,targetCount:2,requiresMultipleSelfCities:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,summonProvince:"",excludeCities:[""]},:{name:"",description:"1HP9000HP50%2",type:x.ACTIVE,category:"nonBattle",limit:1,targetHpRequirement:{max:9e3},restoreToInitialHp:!0,powerBonus:1.5,banDuration:2,requiresTarget:!0},:{name:"",description:"",type:x.PASSIVE,category:"nonBattle",transferCenterSkillDamage:!0,noOverflow:!0},:{name:"",description:"1HP1000020000",type:x.ACTIVE,category:"battle",limit:1,disguiseHpRequirement:{min:1e4,max:2e4},transformAttack:!0},:{name:"",description:"1HP30000HP3000HPHP1500",type:x.ACTIVE,category:"nonBattle",limit:1,targetHpRequirement:{max:3e4},restoreToInitialHp:!0,shieldHp:3e3,summonNextRound:!0,summonHpRequirement:{max:1500},requiresTarget:!0},:{name:"",description:"210%",type:x.PASSIVE,category:"battle",limit:2,powerBonus:1.1},:{name:"",description:"22",type:x.ACTIVE,category:"nonBattle",limit:2,banDuration:2,requiresTarget:!0},:{name:"",description:"11300HP",type:x.ACTIVE,category:"battle",limit:1,summonMinion:!0,minionHp:1300,minionDuration:1},:{name:"",description:"13/3",type:x.ACTIVE,category:"nonBattle",limit:1,revealDuration:3,choiceDestroyOrShield:!0,invincibleDuration:3},:{name:"",description:"122HPHP8000",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,hpRequirement:{max:8e3},requiresTarget:!0,restoreToInitialHp:!0},:{name:"",description:"1HPHPHP",type:x.ACTIVE,category:"nonBattle",limit:1,swapThirdHighestHp:!0,canTargetCenter:!0},:{name:"",description:"1HPHP/",type:x.ACTIVE,category:"nonBattle",limit:1,restoreToInitialHp:!0,summonCities:["",""],randomSummon:!0,summonCount:1},:{name:"",description:"1HPHPHPx22/",type:x.ACTIVE,category:"nonBattle",limit:1,restoreToInitialHp:!0,hpMultiplier:2,summonProvince:"",excludeCities:[""],summonCount:2,conditionalSummon:!0},:{name:"",description:"1HP8000HPx2",type:x.ACTIVE,category:"nonBattle",limit:1,targetHpRequirement:{max:8e3},hpMultiplier:2,disableEnemySkill:"",requiresTarget:!0},:{name:"",description:"1HP",type:x.ACTIVE,category:"battle",limit:1,hpReduction:.5,requiresTarget:!0},:{name:"",description:"133HPx3",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,hpMultiplier:3,requiresTarget:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,freeSkill:"",cannotBeBlocked:!0},:{name:"",description:"1HPHPHPx2/",type:x.ACTIVE,category:"nonBattle",limit:1,restoreToInitialHp:!0,hpMultiplier:2,summonCities:["",""],randomSummon:!0,summonCount:1},:{name:"",description:"215%2",type:x.PASSIVE,category:"battle",limit:2,powerBonus:1.15,duration:2,allyCities:!0,centerImmuneOnce:!0},:{name:"",description:"2350%50%",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,reflectChance:.5,reflectPercent:.5,requiresTarget:!0},:{name:"",description:"233000",type:x.ACTIVE,category:"battle",limit:2,duration:3,shieldHp:3e3,targetCenter:!0},:{name:"",description:"1HP50%HP",type:x.PASSIVE,category:"nonBattle",limit:1,healPercent:.5,allyCities:!0},:{name:"",description:"2230%",type:x.ACTIVE,category:"battle",limit:2,duration:2,damageReduction:.3,requiresTarget:!0},:{name:"",description:"1220%",type:x.PASSIVE,category:"battle",limit:1,duration:2,missChance:.2},:{name:"",description:"231000HP",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,healPerBattle:1e3,requiresTarget:!0},:{name:"",description:"1",type:x.ACTIVE,category:"battle",limit:1,randomTarget:!0,coastalImmune:!0,selfDestructOnAttack:!0,secret:!0},:{name:"",description:"1240%20%1",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,debuffChance:.4,powerDebuff:.2,debuffDuration:1,requiresTarget:!0},:{name:"",description:"215%2",type:x.PASSIVE,category:"battle",limit:2,defenseBonus:1.15,duration:2,allyCities:!0},:{name:"",description:"2330%500HP2",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,poisonChance:.3,poisonDamage:500,poisonDuration:2,requiresTarget:!0},:{name:"",description:"250%50%",type:x.ACTIVE,category:"battle",limit:2,choiceBuffOrDebuff:!0,powerModifier:.5},:{name:"",description:"155500",type:x.ACTIVE,category:"nonBattle",limit:1,targetCount:5,randomTarget:!0,duration:5,damagePerRound:500,coastalImmune:!0},:{name:"",description:"80000",type:x.PASSIVE,category:"nonBattle",centerAttackPower:8e4,subCenterMultiplier:1.5},:{name:"",description:"2HPHP",type:x.ACTIVE,category:"nonBattle",limit:2,requiresTarget:!0,compareCities:!0,canStealOrCopy:!0},:{name:"",description:"2HP20%HPHP",type:x.ACTIVE,category:"nonBattle",cooldown:2,requiresTarget:!0,burnDamagePercent:.2,stackable:!0},:{name:"",description:'3""""""*215000""""',type:x.PASSIVE,category:"battle",initialTokens:3,damageMultiplier:2,tokenLossThreshold:15e3,stackable:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,resetAllSkills:!0},:{name:"",description:'""50%',type:x.PASSIVE,category:"battle",overflowStorage:.5,canActivateStorage:!0},:{name:"",description:"15HP",type:x.ACTIVE,category:"nonBattle",limit:1,duration:5,requiresTarget:!0,missingState:!0,damageEqualToHp:!0},:{name:"",description:'""',type:x.PASSIVE,category:"nonBattle",immuneToDebuff:!0,lockSkill:!0},:{name:"",description:"1HPHP*2",type:x.ACTIVE,category:"nonBattle",perCityLimit:1,requiresHighestHpCity:!0,hpMultiplier:2},:{name:"",description:'"""HP"""1',type:x.ACTIVE,category:"battle",requiresTarget:!0,canSwapAttribute:!0,swapOptions:["province","hp","skill"]},:{name:"",description:"131[n/m]nm",type:x.TOGGLE,category:"nonBattle",yinEffect:{goldPerCity:3},yangEffect:{sacrificeDamage:!0}},:{name:"",description:"2",type:x.ACTIVE,category:"nonBattle",limit:2,cancelBattle:!0},:{name:"",description:'1""""HP4^nn""',type:x.PASSIVE,category:"nonBattle",tokenPerCityChange:1,canSummonCity:!0,regionFilter:["","",""]},:{name:"",description:"1HP*nn",type:x.PASSIVE,category:"nonBattle",summonOnBattle:!0,provinceBonus:!0,hpMultiplierByProvince:!0},:{name:"",description:"1HP1000010%30%",type:x.PASSIVE,category:"battle",limit:1,bonusSurrender:!0,powerBoostPerDeath:.1,maxPowerBoost:.3},:{name:"",description:"160nHPxn",type:x.ACTIVE,category:"nonBattle",limit:1,requiresPoetryRecital:!0,timeLimit:60,hpMultiplierByCount:!0},:{name:"",description:"22HP1500",type:x.ACTIVE,category:"battle",limit:2,summonLanterns:2,captureOnDestroy:!0,captureHpThreshold:1500},:{name:"",description:"1HP10000HP50%+5",type:x.ACTIVE,category:"nonBattle",limit:1,requiresTarget:!0,healAndSurrenderChance:.5,goldOnFail:5,targetHpLimit:1e4},:{name:"",description:"11",type:x.ACTIVE,category:"nonBattle",limit:1,hideData:!0,duration:1},:{name:"",description:"1",type:x.ACTIVE,category:"battle",limit:1,forceRetreat:!0,delayedAttack:!0},:{name:"",description:"5x10",type:x.PASSIVE,category:"battle",stackToken:!0,tokenThreshold:5,forceBattleOnThreshold:!0,powerMultiplier:10},:{name:"",description:"1380%",type:x.ACTIVE,category:"battle",limit:1,damageReduction:.8,roundLimit:3},:{name:"",description:"310%HP",type:x.ACTIVE,category:"battle",limit:3,percentDamage:.1},:{name:"",description:"150%50%HP",type:x.ACTIVE,category:"nonBattle",limit:1,selfSacrifice:.5,healAmount:.5,requiresTarget:!0},:{name:"",description:"1/HP/1/3",type:x.ACTIVE,category:"nonBattle",limit:1,requiresTarget:!0,revertHealing:!0,limitHealingSkills:!0,additionalCost:3},:{name:"",description:"1HP20",type:x.ACTIVE,category:"battle",limit:1,disguise:!0,redirectSkills:!0,topCityCount:20},:{name:"",description:"50%HP",type:x.PASSIVE,category:"nonBattle",onDeath:!0,healAllPercent:.5,removeDebuff:!0},:{name:"",description:"151000HP3",type:x.PASSIVE,category:"nonBattle",limit:1,stackOnSkillUse:!0,stackThreshold:5,barrierEffect:!0,healAllPerRound:1e3,duration:3},:{name:"",description:"51000HP",type:x.PASSIVE,category:"nonBattle",roundInterval:5,targetCount:2,damage:1e3,randomTarget:!0},:{name:"",description:"200001000",type:x.ACTIVE,category:"battle",requiresTarget:!0,followUpAttack:!0,damageThreshold:2e4,followUpDamage:1e3},:{name:"",description:"220%2",type:x.ACTIVE,category:"battle",limit:2,defenseBonus:1.2,duration:2,allyCities:!0},:{name:"",description:"2330%",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,requiresTarget:!0,reflectDamage:.3},:{name:"",description:"2220%50%",type:x.ACTIVE,category:"nonBattle",limit:2,duration:2,reflectDamage:.2,centerReflectDamage:.5},:{name:"",description:"1HP50%150005%1",type:x.ACTIVE,category:"nonBattle",limit:1,requiresTarget:!0,hpBonus:.5,hpBonusMax:15e3,powerBonus:1.05,duration:1},:{name:"",description:"1210%",type:x.ACTIVE,category:"battle",limit:1,duration:2,reflectDamagePercent:.1},:{name:"",description:"231200HP10%",type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,requiresTarget:!0,healPerBattle:1200,powerBonus:1.1},:{name:"",description:"2240%30%",type:x.ACTIVE,category:"nonBattle",limit:2,duration:2,requiresTarget:!0,damageReduction:.4,shieldBreakDamage:.3},:{name:"",description:'1""3',type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,randomTarget:!0,disableAttack:!0},:{name:"",description:'2350%""1',type:x.ACTIVE,category:"nonBattle",limit:2,duration:3,requiresTarget:!0,confuseChance:.5,confuseDuration:1},:{name:"",description:'15""4750HP',type:x.ACTIVE,category:"nonBattle",limit:1,targetCount:5,randomTarget:!0,duration:4,damagePerRound:750},:{name:"",description:"2230%50%",type:x.ACTIVE,category:"battle",limit:2,duration:2,extraAttackChance:.3,extraAttackDamage:.5},:{name:"",description:"131",type:x.ACTIVE,category:"nonBattle",limit:1,duration:3,goldPerKill:1},:{name:"",description:"2250%20%1",type:x.ACTIVE,category:"battle",limit:2,duration:2,weakenChance:.5,powerReduction:.2,weakenDuration:1},:{name:"",description:"12",type:x.ACTIVE,category:"nonBattle",limit:1,duration:2,disableCitySkills:!0},:{name:"",description:"11-750HP",type:x.ACTIVE,category:"battle",limit:1,randomShield:!0,shieldMin:1,shieldMax:750},:{name:"",description:"",type:x.PASSIVE,category:"nonBattle",onDeath:!0,disableAllSkills:!0,untargetable:!0,lockSkill:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",cooldown:1,requiresMultipleSelfCities:!0,changeProvince:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,replaceWithCapital:!0,sevenRegions:!0},:{name:"",description:'2""',type:x.PASSIVE,category:"nonBattle",cooldown:2,refundGold:!0,requiresQuiz:!0},:{name:"",description:"1",type:x.ACTIVE,category:"nonBattle",limit:1,shuffleAllSkills:!0}};function Un(e){return IP[e]||null}const kP={class:"player-setup panel"},EP={style:{"text-align":"center"}},TP={class:"draw-info"},RP={class:"draw-count"},NP={class:"value"},MP={key:0,class:"warning"},DP=["disabled"],qP={key:1,class:"muted",style:{"font-size":"12px"}},LP={class:"city-preview"},OP=["onClick"],UP={class:"muted",style:{"font-size":"11px","margin-top":"2px"}},jP={class:"muted",style:{"font-size":"10px"}},FP={style:{color:"#f093fb","font-size":"12px",margin:"6px 0"}},VP={key:1,style:{color:"#999","font-style":"italic"}},WP={style:{"margin-top":"8px","font-size":"12px",color:"var(--accent)"}},zP=["disabled"],GP={__name:"CenterCitySelection",props:{playerName:{type:String,required:!0},cities:{type:Array,required:!0},initialCenterIndex:{type:Number,default:null},currentDrawCount:{type:Number,default:1}},emits:["confirm","redraw"],setup(e,{emit:n}){const t=e,i=n,{showNotification:s}=pi(),o=Ce(t.initialCenterIndex),r=Ce(t.currentDrawCount),a=Ce(!1),l=Oe(()=>r.value<5);function u(v){o.value=v;const S=t.cities[v]?.name||"";console.log(`[] ${t.playerName} : ${S} (${v})`),i("center-selected",v)}function f(){o.value!==null&&i("confirm",o.value)}async function m(){if(!l.value){s("","warning");return}if(confirm(`

: ${5-r.value}`)){a.value=!0;try{i("redraw"),r.value++,o.value=null,s("","success")}catch(v){s(": "+v.message,"error")}finally{a.value=!1}}}function h(v){const S=si[v];return S?S.name===""?v===""?"":v===""?"":v.includes("")?"":S.name:S.name:""}return(v,S)=>(M(),j("div",kP,[p("h2",EP,": "+U(e.playerName),1),S[1]||(S[1]=p("h3",null,"",-1)),S[2]||(S[2]=p("div",{class:"muted",style:{"margin-bottom":"10px"}},"",-1)),p("div",TP,[p("div",RP,[S[0]||(S[0]=p("span",{class:"label"},":",-1)),p("span",NP,U(r.value)+" / 5",1),r.value>=5?(M(),j("span",MP,"")):$e("",!0)]),l.value?(M(),j("button",{key:0,class:"redraw-btn",onClick:m,disabled:a.value},"   ("+U(5-r.value)+" ) ",9,DP)):(M(),j("div",qP,U(r.value>=5?"":""),1))]),S[3]||(S[3]=p("div",{class:"muted",style:{margin:"10px 0",padding:"10px",background:"#1f2937","border-radius":"6px","font-size":"13px"}},[un("  "),p("strong",null,""),un(" ")],-1)),p("div",LP,[(M(!0),j(qe,null,en(e.cities,(X,ae)=>(M(),j("div",{key:ae,class:ze(["city-card",{selected:o.value===ae}]),onClick:fe=>u(ae)},[p("div",null,[p("strong",null,U(X.name),1),p("div",UP,U(h(X.name)),1)]),p("div",null,[p("div",null,"HP: "+U(X.hp),1),p("div",jP," : "+U(X.hp),1)]),p("div",FP,[Fe(Un)(X.name)?(M(),j(qe,{key:0},[un("  "+U(Fe(Un)(X.name).name),1)],64)):(M(),j("span",VP,""))]),p("div",WP,U(o.value===ae?" ":""),1)],10,OP))),128))]),p("button",{class:"confirm-cities-btn",disabled:o.value===null,onClick:f},"  ",8,zP)]))}},JP=kn(GP,[["__scopeId","data-v-c8a02e20"]]),YP={class:"player-setup panel"},KP={style:{"text-align":"center"}},ZP={key:0,class:"muted",style:{"margin-bottom":"10px",color:"var(--warn)"}},QP={class:"city-preview"},XP=["onClick"],eH={class:"muted",style:{"font-size":"11px","margin-top":"2px"}},nH={class:"muted",style:{"font-size":"10px"}},tH={style:{color:"#f093fb","font-size":"12px",margin:"6px 0"}},iH={key:1,style:{color:"#999","font-style":"italic"}},sH={style:{"margin-top":"8px","font-size":"12px",color:"var(--accent)"}},oH={style:{"text-align":"center",margin:"10px 0"}},rH=["disabled"],aH={__name:"RosterSelection",props:{playerName:{type:String,required:!0},cities:{type:Array,required:!0},mode:{type:String,default:"2P"},centerIndex:{type:Number,default:null},initialRoster:{type:Array,default:()=>[]}},emits:["confirm","roster-updated"],setup(e,{emit:n}){const t=e,i=n,{showNotification:s}=pi(),o=Ce([...t.initialRoster]),r=t.mode==="2v2"?4:5;as(()=>{t.centerIndex!==null&&t.centerIndex!==void 0&&(o.value.includes(t.centerIndex)||(o.value.push(t.centerIndex),console.log("[Roster] "),i("roster-updated",o.value)))});function a(m){const h=o.value.indexOf(m);if(h>-1){if(t.centerIndex===m){s("","warning");return}o.value.splice(h,1)}else{if(o.value.length>=r){s(` ${r} `,"warning");return}o.value.push(m)}i("roster-updated",o.value)}function l(){o.value.length===r&&i("confirm",o.value)}xt(()=>t.centerIndex,m=>{m!=null&&!o.value.includes(m)&&(o.value.push(m),i("roster-updated",o.value))});function u(m){const h=si[m];return h?h.name===""?m===""?"":m===""?"":m.includes("")?"":h.name:h.name:""}function f(m){return m.hp}return(m,h)=>(M(),j("div",YP,[p("h2",KP,": "+U(e.playerName),1),p("h3",null," ( "+U(Fe(r))+" )",1),h[0]||(h[0]=p("div",{class:"muted",style:{"margin-bottom":"10px"}},"/",-1)),e.centerIndex!==null&&e.centerIndex!==void 0?(M(),j("div",ZP,"   ")):$e("",!0),h[1]||(h[1]=p("div",{class:"muted",style:{margin:"10px 0",padding:"10px",background:"#1f2937","border-radius":"6px","font-size":"13px"}},[un("  "),p("strong",null,""),un(" ")],-1)),p("div",QP,[(M(!0),j(qe,null,en(e.cities,(v,S)=>(M(),j("div",{key:S,class:ze(["city-card",{selected:o.value.includes(S)}]),onClick:X=>a(S)},[p("div",null,[p("strong",null,U(v.name),1),p("div",eH,U(u(v.name))+" "+U(e.centerIndex===S?"  ":""),1)]),p("div",null,[p("div",null,"HP: "+U(v.hp),1),p("div",nH," : "+U(f(v)),1)]),p("div",tH,[Fe(Un)(v.name)?(M(),j(qe,{key:0},[un("  "+U(Fe(Un)(v.name).name),1)],64)):(M(),j("span",iH,""))]),p("div",sH,U(o.value.includes(S)?" ":""),1)],10,XP))),128))]),p("div",oH,[p("span",null,": "+U(o.value.length)+" / "+U(Fe(r)),1)]),p("button",{class:"confirm-cities-btn",disabled:o.value.length!==Fe(r),onClick:l},"  ",8,rH)]))}},lH=kn(aH,[["__scopeId","data-v-8ae74b52"]]),cc={:2,:3,:3,:3,:4,:4,:5,:6,:6,:6,:7,:7,:7,:8,:8,:9,:9,:7,:10,:10,:10,:10,:11,:13,:5,:15,:20,:0,:2,:1,:1,:1,:1,:1,:2,:2,:2,:3,:3,:3,:3,:3,:4,:4,:4,:4,:4,:4,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:6,:6,:6,:6,:6,:6,:6,:7,:7,:7,:7,:7,:7,:8,:8,:8,:8,:8,:8,:8,:9,:9,:9,:9,:9,:10,:10,:11,"":11,:11,:11,:11,:11,"":11,:12,:12,:12,:12,:0,:13,"":13,"":13,:13,:13,"":14,:15,:15,:16,:16,:16,:17,"":19,:23};function cH(e,n,t){const i=cc[e]||0;return i>=8&&t.costIncrease&&t.costIncrease[n.name]?Math.ceil(i*1.5):i}function he(e,n,t){const i=cc[e];if(i===void 0)return{success:!1,message:`${e}`,cost:0};const s=cH(e,n,t);return n.gold<s?{success:!1,message:`${n.name} ${s}${n.gold}`,cost:s}:(n.gold-=s,i>=8&&t.costIncrease&&t.costIncrease[n.name]&&(t.addLog(`() ${n.name} ${i}${s}`),delete t.costIncrease[n.name]),{success:!0,cost:s})}const uH={:"22P/2v243P33",:"3",:"312",:"312",:"4132",:"42",:"553",:"615000HP",:"6150002500/2500",:"63A1BCBC3",:"75",:"73",:"8HPHP",:"91551",:"922000/2",:"7212",:"101500110",:"102",:"1031",:"102v21",:"11/",:"132/2v210000/2",:"15150005+30001500050%50%",:"20HP2350%2/2v23HP2",:"83P2v2+15000HP3P1",:"5HP2",:"024",:"2HP525HP20%1",:"215000750032",:"112/2v232",:"1521",:"12+3+1+3+331",:"111013",:"21///2",:"311",:"311011052",:"4HPHP8932",:"3132",:"252v242",:"4150%HP500053",:"42HP10001",:"4HP1000030001",:"42232",:"53-5HP31",:"511",:"51HP232",:"51213",:"535",:"51HP500002/2v25",:"41HP150003HP315",:"5HP3HP44",:"5850%32",:"5322232",:"5HPHPHP51",:"5",:"52",:"5101",:"532V2//52",:"65",:"6111",:"61121",:"61HP2500030/1/2/3HP1/1.25/1.5/212152",:"6HPHP1000010000HPHP<1000010%10000-199998%20000-299996%30000-399994%40000-499992%500001%2000HPHP20001",:'62P/2v2""575%/1',:"53",:"71HP32/2v25",:"713",:"711",:"7353",:"7,HP0HP800001000001",:"72HP2",:"8",:"81500",:"8///1",:"81HP50%13",:"821-1511-1532",:"81200010005001",:"81HP2000HP1",:"931",:"952V251",:"9HPHP15HP5HP<3000080000300001000001",:"9-111/119",:"91HP100003",:"513",:"101510000HP1",:"10135002/2v210001",:"11/14115","":"11122",:"11331250%1",:"11",:"11HP50%",:"1116+1915","":"1112",:"1211HPHPHPHP",:"121",:"12HP<10000HP>10000HP1001","":"131HPHP",:"131/11",:"131231",:"1311","":"13102","":"1412",:"15HP31",:"15HP20%1",:'16""2HPHP10%1)HP>HP>HPHP50%2)HPmax{HP,HP}HP50%3)HP<HP2',:"1611.5HP1",:"161////////////+1//////1",:"17HPXXXHP33%30%20%15%2%","":"1911",:"23HP1",:"1-813",:"11HPHP2",:"6HPHP1",:"322",:"332",:"12HP0HP33HP1"},dH=[{name:"",cost:2,description:""},{name:"",cost:3,description:""},{name:"",cost:3,description:"1"},{name:"",cost:3,description:""},{name:"",cost:4,description:""},{name:"",cost:4,description:""},{name:"",cost:5,description:""},{name:"",cost:5,description:""},{name:"",cost:6,description:"2"},{name:"",cost:6,description:""},{name:"",cost:6,description:"3P",modes:["3P"]},{name:"",cost:7,description:""},{name:"",cost:7,description:"3P",modes:["3P"]},{name:"",cost:7,description:""},{name:"",cost:8,description:"HP"},{name:"",cost:8,description:""},{name:"",cost:9,description:"5"},{name:"",cost:9,description:""},{name:"",cost:10,description:""},{name:"",cost:10,description:""},{name:"",cost:10,description:"3P",modes:["3P"]},{name:"",cost:10,description:"2v2",modes:["2v2"]},{name:"",cost:11,description:""},{name:"",cost:13,description:"2"},{name:"",cost:15,description:"15000HP5"},{name:"",cost:20,description:"HP2"}];function Dh(){const e=ut();function n(_,$){const A=he("",_,e);return A.success?(_.battleModifiers||(_.battleModifiers=[]),_.battleModifiers.push({type:"attack_priority",value:"highest_hp",duration:1}),e.addLog(`${_.name} `),{success:!0,message:""}):A}function t(_,$){const A=he("",_,e);return A.success?($.battleModifiers||($.battleModifiers=[]),$.battleModifiers.push({type:"damage_reduction",value:.5,duration:1,source:_.name}),e.cmjb||(e.cmjb={}),e.cmjb[_.name]={target:$.name,mode:e.gameMode},e.addLog(`${_.name}  ${$.name} ${$.name}${_.name}${$.name}1`),{success:!0,message:` ${$.name} 1`}):A}function i(_,$){if(!$)return{success:!1,message:""};const A=_.cities.indexOf($);if(A===-1)return{success:!1,message:""};if(_.streaks||(_.streaks={}),(_.streaks[A]||0)===0)return{success:!1,message:`${$.name} `};const q=he("",_,e);return q.success?($.modifiers=$.modifiers||[],$.modifiers.push({type:"ignore_fatigue",duration:1}),e.addLog(`${_.name}  ${$.name} `),{success:!0,message:`${$.name} `}):q}function s(_,$){if(!$)return{success:!1,message:""};const A=he("",_,e);return A.success?($.modifiers=$.modifiers||[],$.modifiers.push({type:"attract_damage",duration:1}),e.addLog(`${_.name}  ${$.name} `),{success:!0,message:`${$.name} `}):A}function o(_,$){if(e.isBlockedByJianbukecui($.name,_.name,""))return e.addLog(`${_.name}${$.name}`),{success:!1,message:`${$.name}`};const A=he("",_,e);return A.success?(_.battleModifiers||(_.battleModifiers=[]),_.battleModifiers.push({type:"damage_immunity",duration:1,source:_.name}),e.addLog(`${_.name} ${$.name}`),{success:!0,message:` ${$.name} `}):A}function r(_,$){if(!$)return{success:!1,message:""};const A=he("",_,e);return A.success?($.modifiers=$.modifiers||[],$.modifiers.push({type:"power_multiplier",value:2,duration:1}),$.modifiers.push({type:"suicide_attack",duration:1}),e.addLog(`${_.name}  ${$.name} 2`),{success:!0,message:`${$.name} `}):A}function a(_,$,A){const H=he("",_,e);if(!H.success)return H;const q=e.playerStates[_.name],ne=e.playerStates[$.name],me=q.currentBattleCities||[],oe=ne.currentBattleCities||[];if(me.length===0||oe.length===0)return{success:!1,message:`${_.name} `};function ve(Ge,gn){const An=Ge.cities[gn];return An?e.hjbf&&e.hjbf[Ge.name]&&e.hjbf[Ge.name][gn]&&e.hjbf[Ge.name][gn].roundsLeft>0?1:An.currentHp||An.hp:0}const _e=me.map(Ge=>({cityIdx:Ge.cityIdx,power:ve(_,Ge.cityIdx)})).sort((Ge,gn)=>Ge.power-gn.power)[0],Ye=oe.map(Ge=>({cityIdx:Ge.cityIdx,power:ve($,Ge.cityIdx)})).sort((Ge,gn)=>Ge.power-gn.power)[0];if(e.isBlockedByJianbukecui&&e.isBlockedByJianbukecui($.name,_.name,""))return e.addLog(`${$.name}${_.name}`),{success:!1,message:`${$.name}`};if(_e.power>=Ye.power)return{success:!1,message:""};const Qe=$.cities[Ye.cityIdx],on=$.centerIndex||0,rn=Ye.cityIdx===on;if(e.barrier[$.name]){const Ge=e.barrier[$.name],gn=Math.min(2500,Ge.hp);Ge.hp-=gn;const An=2500-gn;if(Ge.hp<=0&&(delete e.barrier[$.name],e.addLog(`${$.name}`)),An>0)if(rn&&e.checkMirageBlock&&e.checkMirageBlock($.name,`${_.name}`))e.addLog(`${$.name}`);else{const F=Qe.currentHp||Qe.hp;Qe.currentHp=Math.max(0,F-An),Qe.currentHp<=0&&(Qe.isAlive=!1)}const lt=Math.min(2500,Ge.hp);Ge.hp-=lt;const T=2500-lt;if(T>0&&me.length>0){const F=me.map(B=>({cityIdx:B.cityIdx,hp:_.cities[B.cityIdx].currentHp||_.cities[B.cityIdx].hp})).sort((B,J)=>B.hp-J.hp)[0],k=_.cities[F.cityIdx],D=k.currentHp||k.hp;k.currentHp=Math.max(0,D-T),k.currentHp<=0&&(k.isAlive=!1)}e.addLog(`${_.name}  ${$.name}  ${Qe.name}25002500HP`)}else if(rn&&e.checkMirageBlock&&e.checkMirageBlock($.name,`${_.name}`))e.addLog(`${$.name}`);else{const Ge=Qe.currentHp||Qe.hp;Qe.currentHp=Math.max(0,Ge-5e3),Qe.currentHp<=0&&(Qe.isAlive=!1),e.addLog(`${_.name}  ${$.name}  ${Qe.name}5000`)}return q.currentBattleCities=q.currentBattleCities.filter(Ge=>Ge.cityIdx!==_e.cityIdx),{success:!0,message:""}}function l(_,$){if(!$)return{success:!1,message:""};const A=he("",_,e);return A.success?($.modifiers=$.modifiers||[],$.modifiers.push({type:"mutual_destruction",duration:5}),e.addLog(`${_.name}  ${$.name} `),{success:!0,message:`${$.name} `}):A}function u(_){if(e.barrier[_.name])return{success:!1,message:`${e.barrier[_.name].hp}HP`};const $=he("",_,e);return $.success?(e.barrier[_.name]={hp:15e3,maxHp:15e3,roundsLeft:5,team:_.team||0},e.addLog(`${_.name} 15000HP5`),{success:!0,message:"15000HP5"}):$}function f(_){const $=he("",_,e);if(!$.success)return $;let A=0;return _.cities.forEach(H=>{if(H.isAlive!==!1){const q=H.currentHp||H.hp;H.currentHp=Math.min(q*2,1e5),A++}}),e.addLog(`${_.name} ${A}HP`),{success:!0,message:"HP100000"}}function m(_,$){if(e.isBlockedByJianbukecui($.name,_.name,""))return e.addLog(`${_.name}${$.name}`),{success:!1,message:`${$.name}`};const A=_.cities.find(q=>q.isCenter);if(!A)return{success:!1,message:""};const H=he("",_,e);return H.success?(e.yujia||(e.yujia={}),e.yujia[_.name]={target:$.name},e.addLog(`${_.name}${A.name}HPHP`),{success:!0,message:"HPHP"}):H}function h(_,$){if(!$)return{success:!1,message:""};const A=_.cities.indexOf($);if(A===-1)return{success:!1,message:""};if(e.berserkFired[_.name]&&e.berserkFired[_.name][A])return{success:!1,message:""};const H=he("",_,e);return H.success?($.modifiers=$.modifiers||[],$.modifiers.push({type:"berserk",powerMultiplier:5,duration:1,afterEffect:{hpMultiplier:.5,disableDuration:5}}),e.berserkFired[_.name]||(e.berserkFired[_.name]={}),e.berserkFired[_.name][A]=$.currentHp||$.hp,e.addLog(`${_.name}${$.name}5`),{success:!0,message:`${$.name}5`}):H}function v(_){const $=he("",_,e);return $.success?(_.battleModifiers=_.battleModifiers||[],_.battleModifiers.push({type:"no_deploy",duration:1}),e.addLog(`${_.name}`),{success:!0,message:""}):$}function S(_,$){if(!$)return{success:!1,message:""};const A=_.cities.indexOf($);if(A===-1)return{success:!1,message:""};const H=he("",_,e);return H.success?(e.jilaizan[_.name]||(e.jilaizan[_.name]={}),e.jilaizan[_.name][A]={used:!1},e.addLog(`${_.name}${$.name}`),{success:!0,message:`${$.name}`}):H}function X(_,$){if(!$)return{success:!1,message:""};const A=_.cities.filter(ne=>ne.isAlive!==!1),H=$.cities.filter(ne=>ne.isAlive!==!1);if(A.length<2||H.length<2)return{success:!1,message:"2"};const q=he("",_,e);return q.success?(e.reflect||(e.reflect={}),e.reflect[_.name]={target:$.name,active:!0},e.addLog(`${_.name}${$.name}${$.name}${_.name}`),{success:!0,message:`${$.name}`}):q}function ae(_){if(e.gameMode!=="3P")return{success:!1,message:"3"};const $=he("",_,e);if(!$.success)return $;const A=e.roster[_.name]||[],H=[];if(_.cities.forEach((me,oe)=>{me.isAlive!==!1&&!A.includes(oe)&&H.push({city:me,idx:oe})}),H.length===0)return{success:!1,message:""};const q=Math.floor(Math.random()*H.length),ne=H[q];return e.roster[_.name]||(e.roster[_.name]=[]),e.roster[_.name].push(ne.idx),e.addLog(`${_.name}${ne.city.name}(HP:${Math.floor(ne.city.currentHp||ne.city.hp)})`),{success:!0,message:`${ne.city.name}(HP:${Math.floor(ne.city.currentHp||ne.city.hp)})`}}function fe(_,$){if(e.gameMode!=="3P")return{success:!1,message:"3"};if(!$)return{success:!1,message:""};if(e.players.filter(q=>q.name!==_.name).length!==2)return{success:!1,message:"2"};const H=he("",_,e);return H.success?(e.sdxj[_.name]={target:$.name,active:!0},e.addLog(`${_.name}${$.name}${$.name}`),{success:!0,message:`${$.name}`}):H}function ge(_,$){if(!$)return{success:!1,message:""};const A=he("",_,e);return A.success?(e.yiyidl[_.name]={target:$.name,goldMark:$.gold},e.addLog(`${_.name}${$.name}(+2000)`),{success:!0,message:`${$.name}+2000`}):A}function R(_,$){if(!$)return{success:!1,message:""};const A=he("",_,e);return A.success?(e.ccjj[_.name]={active:!0},e.addLog(`${_.name}${$.name}`),{success:!0,message:`${$.name}`}):A}function Y(_,$){if(!$)return{success:!1,message:""};if(e.wwjzUsageCount[_.name]||(e.wwjzUsageCount[_.name]=0),e.wwjzUsageCount[_.name]>=2)return{success:!1,message:"2"};const A=he("",_,e);return A.success?(e.wwjzUsageCount[_.name]++,e.wwjz[_.name]={active:!0},e.addLog(`${_.name}${$.name}${2-e.wwjzUsageCount[_.name]}`),{success:!0,message:`${$.name}${2-e.wwjzUsageCount[_.name]}`}):A}function V(_,$,A){if(!$)return{success:!1,message:""};if(!A)return{success:!1,message:""};const H=e.roster[$.name]||[],q=$.cities.indexOf(A);if(q===-1||!H.includes(q))return{success:!1,message:""};if(A.isCenter)return{success:!1,message:""};const ne=he("",_,e);return ne.success?(e.yqgzMarks.push({player:_.name,target:$.name,cityIdx:q,cityName:A.name,roundCreated:e.currentRound}),e.addLog(`${_.name}${$.name}${A.name}`),{success:!0,message:`${$.name}${A.name}`}):ne}function ee(_,$){if(!$)return{success:!1,message:""};const A=e.roster[_.name]||[],H=e.roster[$.name]||[];if(A.length===0||H.length===0)return{success:!1,message:""};function q(Qe,on){return on.filter(rn=>!(Qe.cities[rn].isCenter||e.hasIronShield(Qe.name,rn)||e.anchored[Qe.name]&&e.anchored[Qe.name][rn]))}const ne=q(_,A),me=q($,H);if(ne.length===0||me.length===0)return{success:!1,message:""};const oe=he("",_,e);if(!oe.success)return oe;e.dizzy[_.name]={mode:"swap",target:$.name};const ve=[],_e=Math.min(ne.length,me.length);for(let Qe=0;Qe<_e;Qe++){const on=ne[Qe],rn=me[Qe],Ge=_.cities[on];if(_.cities[on]=$.cities[rn],$.cities[rn]=Ge,e.initialCities[_.name]&&e.initialCities[$.name]){const gn=e.initialCities[_.name][on];e.initialCities[_.name][on]=e.initialCities[$.name][rn],e.initialCities[$.name][rn]=gn}e.disguisedCities&&e.disguisedCities[_.name]&&e.disguisedCities[_.name][on]&&(delete e.disguisedCities[_.name][on],e.addLog(`${_.name}${_.cities[on].name}`)),e.disguisedCities&&e.disguisedCities[$.name]&&e.disguisedCities[$.name][rn]&&(delete e.disguisedCities[$.name][rn],e.addLog(`${$.name}${$.cities[rn].name}`)),ve.push({casterCity:$.cities[rn].name,targetCity:_.cities[on].name})}const Ye=ve.map((Qe,on)=>`${on+1}${_.name}${Qe.casterCity}  ${$.name}${Qe.targetCity}`).join("");return e.addLog(`${_.name}${$.name}${Ye}`),{success:!0,message:`${ve.length}`}}function ue(_,$){if(e.gameMode!=="3P")return{success:!1,message:"3"};if(!$)return{success:!1,message:""};if(e.gawhUser.value&&e.gawhUser.value.round===e.currentRound)return{success:!1,message:`${e.gawhUser.value.player}`};e.gawhUser.value={player:_.name,round:e.currentRound};const A=e.players;if(A.length!==3)return{success:!1,message:"3"};const H=A.filter(q=>q.name!==_.name);return H.length!==2?{success:!1,message:""}:(e.addLog(`${_.name}${$.name}${_.name}${H[0].name}${H[1].name}`),{success:!0,message:`${H[0].name}${H[1].name}`})}function de(_,$){if(e.gameMode!=="2v2")return{success:!1,message:"2v2"};if(!$)return{success:!1,message:""};const H=e.players.filter(ne=>ne.name!==_.name&&ne.name!==$.name&&ne.team===$.team);if(H.length===0)return{success:!1,message:""};const q=H[0];return e.isBlockedByJianbukecui($.name,_.name,"")?(e.addLog(`${_.name}${$.name}`),{success:!1,message:`${$.name}`}):e.isBlockedByJianbukecui(q.name,_.name,"")?(e.addLog(`${_.name}${q.name}`),{success:!1,message:`${q.name}`}):(e.tblj[_.name]={mode:"2v2",targetTeam:$.team},e.addLog(`${_.name}${$.name}${_.name}${$.name}${q.name}`),{success:!0,message:`${$.name}${q.name}`})}function W(_,$){if(!$)return{success:!1,message:""};const A=he("",_,e);if(!A.success)return A;e.chhdj||(e.chhdj={});const H=e.gameMode||"2P";return e.chhdj[_.name]={mode:H,target:$.name,damageDealt:0},e.addLog(`${_.name}${$.name}1500110`),{success:!0,message:`${$.name}`}}function Q(_,$,A){if(!$)return{success:!1,message:""};if(A==null)return{success:!1,message:""};const H=$.cities[A];if(!H||H.isAlive===!1)return{success:!1,message:""};if(e.yswqUsageCount||(e.yswqUsageCount={}),e.yswqUsageCount[_.name]||(e.yswqUsageCount[_.name]=0),e.yswqUsageCount[_.name]>=2)return{success:!1,message:"2"};const q=he("",_,e);return q.success?(e.yswqUsageCount[_.name]++,e.protections&&e.protections[$.name]&&e.protections[$.name][A]&&(delete e.protections[$.name][A],e.addLog(`() ${$.name}${H.name}`)),e.yswq||(e.yswq={}),e.yswq[_.name]={targetPlayer:$.name,targetCityIdx:A,bannedProtection:!0,round:e.currentRound},e.addLog(`${_.name}${$.name}${H.name}HP`),{success:!0,message:`${$.name}${H.name}${2-e.yswqUsageCount[_.name]}`,data:{targetCityName:H.name,usagesLeft:2-e.yswqUsageCount[_.name]}}):q}function L(_,$){if(e.gameMode!=="3P")return{success:!1,message:"3"};if(!$)return{success:!1,message:""};const A=e.players.filter(ne=>ne.name!==_.name);if(A.length!==2)return{success:!1,message:"2"};if(!A.some(ne=>ne.name===$.name))return{success:!1,message:""};const H=he("",_,e);if(!H.success)return H;const q=A.find(ne=>ne.name!==$.name);return e.hzlh||(e.hzlh={}),e.hzlh[_.name]={ally:$.name,target:q.name,roundsLeft:2,startRound:e.currentRound},e.addLog(`${_.name}${$.name}${$.name}2${q.name}`),{success:!0,message:`${$.name}2${q.name}`}}function P(_,$){if(!$)return{success:!1,message:""};if(e.muBuZhuanJingUsageCount||(e.muBuZhuanJingUsageCount={}),e.muBuZhuanJingUsageCount[_.name]||(e.muBuZhuanJingUsageCount[_.name]=0),e.muBuZhuanJingUsageCount[_.name]>=3)return{success:!1,message:"3"};if(e.cooldowns&&e.cooldowns[_.name]&&e.cooldowns[_.name].>0)return{success:!1,message:`${e.cooldowns[_.name].}`};const A=he("",_,e);return A.success?(e.muBuZhuanJingUsageCount[_.name]++,e.cooldowns||(e.cooldowns={}),e.cooldowns[_.name]||(e.cooldowns[_.name]={}),e.cooldowns[_.name].=5,e.stareDown||(e.stareDown={}),e.stareDown[$.name]={roundsLeft:3,source:_.name},e.addLog(`${_.name}${$.name}${$.name}3${3-e.muBuZhuanJingUsageCount[_.name]}`),{success:!0,message:`${$.name}3${3-e.muBuZhuanJingUsageCount[_.name]}`}):A}function G(_){if(e.pzyyUsed&&e.pzyyUsed[_.name])return{success:!1,message:"1"};const $=e.roster[_.name]||[];if($.length===0)return{success:!1,message:""};const A=$.filter(ve=>{const _e=_.cities[ve];return _e&&!_e.isCenter&&_e.isAlive!==!1});if(A.length===0)return{success:!1,message:""};let H=A[0],q=_.cities[H].currentHp||_.cities[H].hp;for(let ve of A){const _e=_.cities[ve],Ye=_e.currentHp||_e.hp;Ye<q&&(q=Ye,H=ve)}const ne=_.cities[H],me=he("",_,e);if(!me.success)return me;e.pzyyUsed||(e.pzyyUsed={}),e.pzyyUsed[_.name]=!0,e.paozhuanyinyu||(e.paozhuanyinyu={}),e.paozhuanyinyu[_.name]||(e.paozhuanyinyu[_.name]={}),e.paozhuanyinyu[_.name][H]={roundsLeft:5,originalHp:q,cityName:ne.name};const oe=e.roster[_.name].indexOf(H);return oe>-1&&e.roster[_.name].splice(oe,1),e.addLog(`${_.name}${ne.name}525HP20%`),{success:!0,message:`${ne.name}5+25HP20%`}}return{executeQinZeiQinWang:n,executeCaoMuJieBing:t,executeYueZhanYueYong:i,executeXiYinGongJi:s,executeTongQiangTieBi:o,executeBeiShuiYiZhan:r,executeLiaoShiRuShen:a,executeTongGuiYuJin:l,executeSetBarrier:u,executeQianNengJiFa:f,executeYuJiaQinZheng:m,executeKuangBaoMoShi:h,executeAnBingBuDong:v,executeJiLaiZeAn:S,executeFanGeYiJi:X,executeAnDuChenCang:ae,executeShengDongJiXi:fe,executeYiYiDaiLao:ge,executeCaoChuanJieJian:R,executeWeiWeiJiuZhao:Y,executeYuQinGuZong:V,executeYunTouZhuanXiang:ee,executeGeAnGuanHuo:ue,executeTiaoBoBaoLiJian:de,executeChenHuoDaJie:W,executeYuSuiWaQuan:Q,executeHeZongLianHeng:L,executeMuBuZhuanJing:P,executePaoZhuanYinYu:G}}const fH=Object.freeze(Object.defineProperty({__proto__:null,useBattleSkills:Dh},Symbol.toStringTag,{value:"Module"}));function qh(){const e=ut();function n(d,c,g){return!g||g<=0?{success:!1,message:""}:d.gold<g?{success:!1,message:""}:c.gold+g>24?{success:!1,message:"24"}:(d.gold-=g,c.gold+=g,e.addLog(`${d.name} ${g} ${c.name}`),{success:!0,message:`${g}`})}function t(d,c){const g=he("",d,e);if(!g.success)return g;if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=d.cities.filter(re=>re.isAlive!==!1&&(re.currentHp||re.hp)>0);if(C.length===0)return{success:!1,message:""};const w=C.reduce((re,K)=>(K.currentHp||K.hp)<(re.currentHp||re.hp)?K:re),b=d.cities.indexOf(w),I=w.currentHp||w.hp,E=b===(d.centerIndex||0);let N=I;E&&(N*=2),N=Math.min(N,E?15e3:7500),w.isAlive=!1,w.currentHp=0,e.deadCities[d.name]||(e.deadCities[d.name]=[]),b!==-1&&!e.deadCities[d.name].includes(b)&&e.deadCities[d.name].push(b);let ie=N;if(e.barrier[c.name]&&e.barrier[c.name].hp>0){const re=e.barrier[c.name],K=Math.min(ie,re.hp);re.hp-=K,ie-=K,e.addLog(`${c.name}${K}${re.hp}HP`),re.hp<=0&&(delete e.barrier[c.name],e.addLog(`${c.name}`))}if(ie>0){const re=c.cities.find(K=>K.isCenter);if(re){const K=re.currentHp||re.hp;re.currentHp=Math.max(0,K-ie),re.currentHp<=0?(re.isAlive=!1,e.addLog(`${c.name}${re.name}`)):e.addLog(`${c.name}${ie}`)}}return e.addLog(`${d.name}${w.name}${E?"2":""}${c.name}${N}`),{success:!0,message:`${w.name}${N}${E?"2":""}`}}function i(d,c){if(!c)return{success:!1,message:""};if(!c.isAlive)return{success:!1,message:""};const g=c.currentHp||c.hp;if(g>=c.hp)return{success:!1,message:""};const C=he("",d,e);if(!C.success)return C;const w=c.hp-g;return c.currentHp=c.hp,e.addLog(`${d.name} ${c.name}${w}HP`),{success:!0,message:`${c.name}`}}function s(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(e.protections[d.name]?.[g])return{success:!1,message:""};const C=he("",d,e);return C.success?(e.protections[d.name]||(e.protections[d.name]={}),e.protections[d.name][g]=10,e.addLog(`${d.name} ${c.name}101`),{success:!0,message:`${c.name}101`}):C}function o(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(e.ironCities[d.name]&&e.ironCities[d.name][g])return{success:!1,message:""};const C=he("",d,e);return C.success?(e.ironCities[d.name]||(e.ironCities[d.name]={}),e.ironCities[d.name][g]=2,e.addLog(`${d.name} ${c.name}2`),{success:!0,message:`${c.name}2`}):C}function r(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c),C=e.gameMode||"2P";if((C==="2P"||C==="2v2")&&g===d.centerIndex)return{success:!1,message:""};const w=he("",d,e);if(!w.success)return w;const b=c.currentHp||c.hp;return c.currentHp=Math.min(b*2,5e4),e.addLog(`${d.name} ${c.name}HP`),{success:!0,message:`${c.name}HP50000`}}function a(d,c){if(!c)return{success:!1,message:""};if(c.isAlive!==!1)return{success:!1,message:""};if(e.pendingPreemptiveStrike)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;const C=e.getCityByName(c.name),w=c.baseHp||C?.hp||c.hp,b=Math.min(Math.floor(w*.5),5e3);c.isAlive=!0,c.currentHp=b;const I=d.cities.indexOf(c);if(I!==-1&&(e.fatigueStreaks[d.name]||(e.fatigueStreaks[d.name]={}),e.fatigueStreaks[d.name][I]=0),e.deadCities[d.name]){const E=e.deadCities[d.name].indexOf(I);E>-1&&e.deadCities[d.name].splice(E,1)}return d.cities.length<=5&&I!==-1&&(e.roster[d.name]||(e.roster[d.name]=[]),e.roster[d.name].includes(I)||e.roster[d.name].push(I)),e.addLog(`${d.name} ${c.name}${b}HP`),{success:!0,message:`${c.name}${b}HP`}}function l(d){const c=he("",d,e);if(!c.success)return c;const g=e.roster[d.name]||[];if(g.length===0)return{success:!1,message:""};let C=0;return g.forEach(w=>{const b=d.cities[w];b&&b.isAlive!==!1&&(b.currentHp=b.hp,C++)}),e.addLog(`${d.name} ${C}`),{success:!0,message:""}}function u(d,c,g){if(!g)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.cities.indexOf(g);return e.consumeProtection(c.name,w)?(e.addLog(`${c.name}${g.name}`),{success:!0,message:""}):(g.modifiers=[],(g.currentHp||g.hp)>g.hp&&(g.currentHp=g.hp),e.addLog(`${c.name}${g.name}`),{success:!0,message:`${g.name}`})}function f(d,c){const g=he("",d,e);if(!g.success)return g;if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};function C(Pe){const Ee=[];return Pe.cities.forEach((Ue,y)=>{Ue.isAlive!==!1&&(e.isInCautiousSet(Pe.name,y)||e.hasProtection(Pe.name,y)||e.anchored[Pe.name]&&e.anchored[Pe.name][y]||Ue.isCenter||e.hasIronShield(Pe.name,y)||Ee.push(y))}),Ee}const w=C(d),b=C(c);if(w.length<3||b.length<3)return{success:!1,message:`${d.name}${w.length}${c.name}${b.length}3`};function I(Pe){const Ee=[...Pe];for(let Ue=Ee.length-1;Ue>0;Ue--){const y=Math.floor(Math.random()*(Ue+1));[Ee[Ue],Ee[y]]=[Ee[y],Ee[Ue]]}return Ee.slice(0,3)}const E=I(w),N=I(b),O=[],ie=[],re=[],K=[];E.forEach(Pe=>{const Ee=e.disguisedCities[d.name]?.[Pe];if(Ee&&Ee.roundsLeft>0){const Ue=d.cities[Pe];Ue.isAlive=!1,Ue.currentHp=0,Ee.paid||(d.gold=Math.max(0,d.gold-9),Ee.paid=!0),Ee.roundsLeft=0,O.push({fake:Ee.fakeName,real:Ue.name})}else re.push({idx:Pe,name:d.cities[Pe].name})}),N.forEach(Pe=>{const Ee=e.disguisedCities[c.name]?.[Pe];if(Ee&&Ee.roundsLeft>0){const Ue=c.cities[Pe];Ue.isAlive=!1,Ue.currentHp=0,Ee.paid||(c.gold=Math.max(0,c.gold-9),Ee.paid=!0),Ee.roundsLeft=0,ie.push({fake:Ee.fakeName,real:Ue.name})}else K.push({idx:Pe,name:c.cities[Pe].name})});const Ae=Math.min(re.length,K.length),Be=[];for(let Pe=0;Pe<Ae;Pe++){const Ee=re[Pe].idx,Ue=K[Pe].idx,y=d.cities[Ee];if(d.cities[Ee]=c.cities[Ue],c.cities[Ue]=y,e.initialCities[d.name]&&e.initialCities[c.name]){const z=e.initialCities[d.name][Ee];e.initialCities[d.name][Ee]=e.initialCities[c.name][Ue],e.initialCities[c.name][Ue]=z}e.setCityKnown(d.name,Ee,c.name),e.setCityKnown(c.name,Ue,d.name),Be.push({casterCity:c.cities[Ue].name,targetCity:d.cities[Ee].name})}if(e.fatigueStreaks[d.name]&&Object.keys(e.fatigueStreaks[d.name]).forEach(Pe=>{e.fatigueStreaks[d.name][Pe]=0}),e.fatigueStreaks[c.name]&&Object.keys(e.fatigueStreaks[c.name]).forEach(Pe=>{e.fatigueStreaks[c.name][Pe]=0}),e.addLog(`>>> ${d.name}${c.name}`),Be.length>0){const Pe=Be.map((Ee,Ue)=>`${Ue+1}${d.name}${Ee.casterCity}  ${c.name}${Ee.targetCity}`).join("");e.addLog(Pe)}if(O.length>0){const Pe=O.map(Ee=>`${Ee.fake}${Ee.real}`).join("");e.addLog(`${d.name}${Pe}`)}if(ie.length>0){const Pe=ie.map(Ee=>`${Ee.fake}${Ee.real}`).join("");e.addLog(`${c.name}${Pe}`)}return{success:!0,message:`${Be.length}${O.length+ie.length>0?"":""}`}}function m(d,c,g={}){const{casterCityIdx:C,targetCityIdx:w}=g;if(e.pendingPreemptiveStrike)return{success:!1,message:""};const b=he("",d,e);if(!b.success)return b;function I(Be){const Pe=[];return Be.cities.forEach((Ee,Ue)=>{Ee.isAlive!==!1&&(e.isInCautiousSet(Be.name,Ue)||Ee.isCenter||e.anchored[Be.name]&&e.anchored[Be.name][Ue]||e.hasIronShield(Be.name,Ue)||e.hasProtection(Be.name,Ue)||Pe.push(Ue))}),Pe}const E=I(d),N=I(c);if(E.length===0||N.length===0)return{success:!1,message:""};let O,ie;if(C!==void 0&&w!==void 0){if(O=C,ie=w,!E.includes(O))return{success:!1,message:""};if(!N.includes(ie))return{success:!1,message:""}}else O=E[Math.floor(Math.random()*E.length)],ie=N[Math.floor(Math.random()*N.length)];const re=d.cities[O],K=c.cities[ie],Ae=d.cities[O];if(d.cities[O]=c.cities[ie],c.cities[ie]=Ae,e.initialCities[d.name]&&e.initialCities[c.name]){const Be=e.initialCities[d.name][O];e.initialCities[d.name][O]=e.initialCities[c.name][ie],e.initialCities[c.name][ie]=Be}return e.disguisedCities[d.name]&&delete e.disguisedCities[d.name][O],e.disguisedCities[c.name]&&delete e.disguisedCities[c.name][ie],e.setCityKnown(d.name,O,c.name),e.setCityKnown(c.name,ie,d.name),e.addLog(`${d.name}${c.name}${re.name}${K.name}`),{success:!0,message:`${re.name}${K.name}`}}function h(d){const c=he("",d,e);return c.success?(d.gold=Math.min(d.gold+5,24),d.loanCooldown=2,e.addLog(`${d.name}52`),{success:!0,message:"52"}):c}function v(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};const C=he("",d,e);return C.success?(e.anchored[d.name]||(e.anchored[d.name]={}),e.anchored[d.name][g]=10,e.addLog(`${d.name}${c.name}10`),{success:!0,message:`${c.name}10`}):C}function S(d,c){if(!c)return{success:!1,message:""};const g=he("",d,e);return g.success?(c.red=c.baseSkills?.red||0,c.green=c.baseSkills?.green||0,c.blue=c.baseSkills?.blue||0,c.yellow=c.baseSkills?.yellow||0,e.addLog(`${d.name}${c.name}`),{success:!0,message:`${c.name}`}):g}function X(d){const g=e.getUnusedCities().filter(E=>E.hp<1e3);if(g.length<2)return{success:!1,message:`HP<1000${g.length}`};const C=he("",d,e);if(!C.success)return C;const b=g.sort(()=>Math.random()-.5).slice(0,2),I=[];for(const E of b){const N={name:E.name,hp:E.hp,currentHp:E.hp,baseHp:E.hp,isAlive:!0,red:E.red||0,green:E.green||0,blue:E.blue||0,yellow:E.yellow||0,modifiers:[]};d.cities.push(N),I.push(N),e.markCityAsUsed(E.name),e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push(N)}if(d.cities.length<=5){e.roster[d.name]||(e.roster[d.name]=[]);const E=d.cities.length-2,N=d.cities.length-1;e.roster[d.name].includes(E)||e.roster[d.name].push(E),e.roster[d.name].includes(N)||e.roster[d.name].push(N)}return e.addLog(`${d.name}${I.map(E=>`${E.name}(${E.hp})`).join("")}`),{success:!0,message:`2${I.map(E=>E.name).join("")}`}}function ae(d,c){if(!c||c.length!==2)return{success:!1,message:"2"};const g=c.map(b=>{const I=d.cities[b];return!I||!(e.roster[d.name]&&e.roster[d.name].includes(b))||I.isAlive===!1||(I.currentHp||I.hp)>=I.hp?null:{city:I,idx:b}}).filter(b=>b!==null);if(g.length!==2)return{success:!1,message:"2"};const C=he("",d,e);if(!C.success)return C;g.forEach(({idx:b})=>{const I=e.roster[d.name].indexOf(b);I>-1&&e.roster[d.name].splice(I,1)}),g.forEach(({city:b,idx:I})=>{b.modifiers=b.modifiers||[],b.modifiers.push({type:"healing",roundsLeft:2,returnHp:b.hp,originalIdx:I}),b.isInHealing=!0}),e.bannedCities[d.name]||(e.bannedCities[d.name]={}),g.forEach(({idx:b})=>{e.bannedCities[d.name][b]=2});const w=g.map(({city:b})=>b.name).join("");return e.addLog(`${d.name}${w}2`),{success:!0,message:`${w}2`}}function fe(d,c){if(d.cities.filter(E=>E.isAlive!==!1).length<3)return{success:!1,message:"3"};if(!c||c.length<3||c.length>5)return{success:!1,message:"3-5"};const C=c.map(E=>d.cities[E]).filter(E=>E&&E.isAlive!==!1);if(C.length<3)return{success:!1,message:"3"};const w=he("",d,e);if(!w.success)return w;const b=C.reduce((E,N)=>E+(N.currentHp||N.hp),0),I=Math.floor(b/C.length);return C.forEach(E=>{E.currentHp=I}),e.addLog(`${d.name}${C.length}HP${I}`),{success:!0,message:`${C.length}HP${I}`}}function ge(d){const c=e.getUnusedCities();if(c.length===0)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;const C=c[Math.floor(Math.random()*c.length)],w={name:C.name,hp:C.hp,currentHp:C.hp,baseHp:C.hp,isAlive:!0,red:C.red||0,green:C.green||0,blue:C.blue||0,yellow:C.yellow||0,modifiers:[]};if(d.cities.push(w),e.markCityAsUsed(C.name),e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push(w),d.cities.length<=5){e.roster[d.name]||(e.roster[d.name]=[]);const b=d.cities.length-1;e.roster[d.name].includes(b)||e.roster[d.name].push(b)}return e.addLog(`${d.name}${w.name}(HP: ${w.hp})`),{success:!0,message:`${w.name}(HP: ${w.hp})`}}function R(d,c){if(!c)return{success:!1,message:""};const g=c.currentHp||c.hp,w=e.getUnusedCities().filter(O=>O.hp>g);if(w.length===0)return{success:!1,message:"HP"};const b=he("",d,e);if(!b.success)return b;const I=w[Math.floor(Math.random()*w.length)],E={name:I.name,hp:I.hp,currentHp:I.hp,baseHp:I.hp,isAlive:!0,red:c.red||0,green:c.green||0,blue:c.blue||0,yellow:c.yellow||0,modifiers:c.modifiers||[]},N=d.cities.indexOf(c);return N===-1?{success:!1,message:""}:(d.cities[N]=E,e.markCityAsUsed(I.name),e.initialCities[d.name]&&(e.initialCities[d.name][N]={name:E.name,hp:E.hp,currentHp:E.hp,baseHp:E.hp,isAlive:!0,red:E.red,green:E.green,blue:E.blue,yellow:E.yellow}),e.addLog(`${d.name}${c.name}(${g})${E.name}(${E.hp})`),{success:!0,message:`${c.name}  ${E.name}(HP: ${E.hp})`})}function Y(d,c){if(!c)return{success:!1,message:""};const C=e.getUnusedCities().filter(E=>E.hp>=1e4);if(C.length===0)return{success:!1,message:"HP10000"};const w=he("",d,e);if(!w.success)return w;const b=C[Math.floor(Math.random()*C.length)],I=d.cities.indexOf(c);return I===-1?{success:!1,message:""}:(e.disguisedCities[d.name]||(e.disguisedCities[d.name]={}),e.disguisedCities[d.name][I]={m:b.hp,cur:b.hp,n:c.currentHp||c.hp,fakeName:b.name,paid:!1,roundsLeft:3},e.clearCityKnownStatus(d.name,I),e.addLog(`${d.name}${c.name}${b.name}(${b.hp}HP)3`),{success:!0,message:`${c.name}${b.name}3`})}function V(d){const c=d.cities.filter(w=>w.isAlive&&!w.isCenter);if(c.length===0)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;const C=c.reduce((w,b)=>(b.currentHp||b.hp)<(w.currentHp||w.hp)?b:w);return C.modifiers=C.modifiers||[],C.modifiers.push({type:"forbidden_battle",duration:5,goldBonus:2,finalHpMultiplier:.2}),e.addLog(`${d.name}${C.name}5`),{success:!0,message:`${C.name}5+2`}}function ee(d,c,g){if(!g)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.cities.indexOf(g);if(e.consumeProtection(c.name,w))return e.addLog(`${c.name}${g.name}`),{success:!0,message:""};const b=g.currentHp||g.hp,I=b.toString();if(I.includes("8")||I.includes("9"))return{success:!1,message:"HP89"};const E=parseInt(I,8);return g.currentHp=E,E<=0?(g.isAlive=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),w!==-1&&!e.deadCities[c.name].includes(w)&&e.deadCities[c.name].push(w),e.addLog(`${d.name}${c.name}${g.name}HP${b}${E}`)):e.addLog(`${d.name}${c.name}${g.name}HP${b}${E}`),{success:!0,message:`HP${b}()${E}()`}}function ue(d,c,g){if(!g)return{success:!1,message:""};if(g.isCenter)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.cities.indexOf(g);if(e.consumeProtection(c.name,w))return e.addLog(`${c.name}${g.name}`),{success:!0,message:""};const b=g.currentHp||g.hp,I=Math.floor(b/3);return g.currentHp=I,I<=0?(g.isAlive=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),w!==-1&&!e.deadCities[c.name].includes(w)&&e.deadCities[c.name].push(w),e.addLog(`${d.name}${c.name}${g.name}HP${b}${I}`)):e.addLog(`${d.name}${c.name}${g.name}HP${b}${I}`),{success:!0,message:`${g.name}HP${I}`}}function de(d,c,g){if(!g||g.length!==2)return{success:!1,message:"2"};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=[];for(const E of g){const N=c.cities[E];!N||N.isAlive===!1||N.isCenter||w.push({city:N,idx:E})}if(w.length!==2)return{success:!1,message:"2"};const b=[],I=[];for(const{city:E,idx:N}of w){if(e.consumeProtection(c.name,N)){I.push(E.name);continue}const O=E.currentHp||E.hp,ie=Math.floor(O/2);E.currentHp=ie,ie<=0&&(E.isAlive=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(N)||e.deadCities[c.name].push(N)),b.push(E.name)}return I.length>0&&e.addLog(`${c.name}${I.join("")}`),b.length>0&&e.addLog(`${d.name}${c.name}${b.join("")}HP`),b.length===0&&I.length>0?{success:!0,message:""}:{success:!0,message:`${b.join("")}HP${I.length>0?`${I.join("")}`:""}`}}function W(d,c){if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=[];if(c.cities.forEach((I,E)=>{I.isAlive!==!1&&I.isCoastal&&C.push({city:I,idx:E})}),C.length===0)return{success:!1,message:""};const w=[],b=[];for(const{city:I,idx:E}of C){if(e.consumeProtection(c.name,E)){b.push(I.name);continue}const N=I.currentHp||I.hp,O=Math.floor(N/2);I.currentHp=O,O<=0&&(I.isAlive=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(E)||e.deadCities[c.name].push(E)),w.push(I.name)}return b.length>0&&e.addLog(`${c.name}${b.join("")}`),w.length>0&&e.addLog(`${d.name}${c.name}${w.length}`),w.length===0&&b.length>0?{success:!0,message:""}:{success:!0,message:`${w.length}HP${b.length>0?`${b.length}`:""}`}}function Q(d,c){if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=[];if(c.cities.forEach((E,N)=>{E.isAlive!==!1&&!E.isInBattle&&C.push({city:E,idx:N})}),C.length===0)return{success:!1,message:""};let w=0,b=0,I=0;for(const{city:E,idx:N}of C){if(e.consumeProtection(c.name,N)){b++;continue}const O=E.currentHp||E.hp,ie=Math.max(0,O-1500);E.currentHp=ie,ie<=0&&(E.isAlive=!1,I++,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(N)||e.deadCities[c.name].push(N)),w++}return b>0&&e.addLog(`${c.name}${b}`),w>0&&e.addLog(`${d.name}${c.name}${w}${I}`),w===0&&b>0?{success:!0,message:""}:{success:!0,message:`${w}1500${I}${b>0?`${b}`:""}`}}function L(d,c){if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;let C=0;return c.cities.forEach(w=>{(w.red||w.green||w.blue||w.yellow)&&(w.red=0,w.green=0,w.blue=0,w.yellow=0,C++)}),e.addLog(`${d.name}${c.name}${C}`),{success:!0,message:`${C}`}}function P(d,c,g){if(!g)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=d.cities.filter(E=>E.isAlive!==!1).reduce((E,N)=>E+Math.floor((N.currentHp||N.hp)*.5),0),b=c.cities.indexOf(g);if(e.consumeProtection(c.name,b))return e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}`};const I=g.currentHp||g.hp;return g.currentHp=Math.max(0,I-w),g.currentHp<=0?(g.isAlive=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),b!==-1&&!e.deadCities[c.name].includes(b)&&e.deadCities[c.name].push(b),e.addLog(`${d.name}${c.name}${g.name}${w}`)):e.addLog(`${d.name}${c.name}${g.name}${w}`),{success:!0,message:`${w}`}}function G(d,c,g){if(!g)return{success:!1,message:""};if(g.name==="")return{success:!1,message:""};const C=he("",d,e);if(!C.success)return C;const w=e.getProvinceOfCity(g.name);if(!w)return{success:!1,message:""};const b=w.cities,I=g.hp,E=e.getUnusedCities(),N=b.filter(K=>K.hp>=I?!1:E.some(Be=>Be.name===K.name));if(N.length===0)return{success:!1,message:`${w.name}HP`};const O=N[Math.floor(Math.random()*N.length)],ie={name:O.name,hp:O.hp,currentHp:O.hp,baseHp:O.hp,isAlive:!0,red:O.red||0,green:O.green||0,blue:O.blue||0,yellow:O.yellow||0,modifiers:[]},re=c.cities.indexOf(g);return re===-1?{success:!1,message:""}:(c.cities[re]=ie,e.markCityAsUsed(O.name),e.initialCities[c.name]&&e.initialCities[c.name][re]&&(e.initialCities[c.name][re]=ie),e.addLog(`${c.name}${g.name}(${I})${ie.name}(${ie.hp})`),{success:!0,message:`${g.name}  ${ie.name}(HP: ${ie.hp})`})}function _(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};const C=he("",d,e);return C.success?(e.hiddenGrowth[d.name]||(e.hiddenGrowth[d.name]={}),e.hiddenGrowth[d.name][g]={idleRounds:0,active:!0,everDied:!1},e.addLog(`>>> ${d.name}${c.name}510000HP`),{success:!0,message:`${c.name}510000HP`}):C}function $(d,c,g){if(!g)return{success:!1,message:""};if(g.isCenter)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.cities.indexOf(g);return e.consumeProtection(c.name,w)?(e.addLog(`${c.name}${g.name}`),{success:!0,message:""}):(e.timeBombs[c.name]||(e.timeBombs[c.name]={}),e.timeBombs[c.name][w]={countdown:3,damage:500,centerDamage:1e3},e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}3`})}function A(d,c,g){if(!g)return{success:!1,message:""};if(g.isCenter)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.cities.indexOf(g);if(e.consumeProtection(c.name,w))return e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}`};if(c.cities.splice(w,1),e.deadCities[c.name]){const b=e.deadCities[c.name].indexOf(w);b>-1&&e.deadCities[c.name].splice(b,1),e.deadCities[c.name]=e.deadCities[c.name].map(I=>I>w?I-1:I)}return e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}`}}function H(d,c){if(!c)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;const C=d.cities.find(b=>b.isCenter);C&&(C.isCenter=!1),c.isCenter=!0;const w=c.currentHp||c.hp;return c.currentHp=Math.floor(w*1.5),e.addLog(`${d.name}${c.name}(HP+50%)`),{success:!0,message:`${c.name}HP+50%`}}function q(d,c,g){if(!g)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.cities.indexOf(g);if(w===-1)return{success:!1,message:""};if(e.consumeProtection(c.name,w))return e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}`};const b=g.name,I=g.currentHp||g.hp,E=Math.max(0,I-2e3);g.currentHp=E;const N=E<=0;if(N&&(g.isAlive=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(w)||e.deadCities[c.name].push(w)),e.addLog(`${d.name}${c.name}${b}2000${N?"":`${Math.floor(E)}`}`),!N)return{success:!0,message:`${b}2000`};const ie=(e.roster[c.name]||[]).filter(Be=>Be!==w&&c.cities[Be]&&c.cities[Be].isAlive!==!1);if(ie.length===0)return e.addLog(`${b}`),{success:!0,message:`${b}`};const re=[];if(ie.forEach(Be=>{const Pe=c.cities[Be],Ee=Pe.name;if(e.consumeProtection(c.name,Be)){e.addLog(`${Ee}1000`);return}const Ue=Pe.currentHp||Pe.hp,y=Math.max(0,Ue-1e3);Pe.currentHp=y,y<=0&&(Pe.isAlive=!1,e.deadCities[c.name].includes(Be)||e.deadCities[c.name].push(Be),re.push(Ee))}),re.length===0){const Be=ie.map(Pe=>c.cities[Pe].name).join("");return e.addLog(`${b}${Be}1000`),{success:!0,message:`${b}1000`}}const K=ie.filter(Be=>c.cities[Be].isAlive!==!1),Ae=[];return K.forEach(Be=>{const Pe=c.cities[Be],Ee=Pe.name;if(e.consumeProtection(c.name,Be)){e.addLog(`${Ee}500`);return}const Ue=Pe.currentHp||Pe.hp,y=Math.max(0,Ue-500);Pe.currentHp=y,y<=0&&(Pe.isAlive=!1,e.deadCities[c.name].includes(Be)||e.deadCities[c.name].push(Be),Ae.push(Ee))}),e.addLog(`${b}${re.join("")}1000500${Ae.length>0?`${Ae.join("")}`:""}`),{success:!0,message:`${b}${re.length+Ae.length}`}}function ne(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=d.cities.filter(O=>O&&O.isAlive!==!1&&O.hp>0&&O.hp<=2e3);if(C.length===0)return{success:!1,message:"HP2000"};const w=Math.floor(Math.random()*C.length),I=C[w].hp,E=[];if(c.cities.forEach((O,ie)=>{!O||O.isAlive===!1||O.isCenter||e.isInCautiousSet(c.name,ie)||e.hasIronShield(c.name,ie)||e.anchored[c.name]&&e.anchored[c.name][ie]>0||O.hp<I&&E.push({city:O,index:ie})}),E.length===0)return{success:!1,message:`${c.name}HP<${Math.floor(I)}//`};const N=[];for(const O of E){const ie={...O.city},re=d.cities.length;d.cities.push(ie),N.push(ie.name),e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[c.name]&&e.initialCities[c.name][O.index]?e.initialCities[d.name].push(e.initialCities[c.name][O.index]):e.initialCities[d.name].push({name:ie.name,hp:ie.hp}),e.setCityKnown(d.name,re,c.name),c.cities[O.index].isAlive=!1,c.cities[O.index].currentHp=0,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(O.index)||e.deadCities[c.name].push(O.index),c.cities[O.index].red=0,c.cities[O.index].green=0,c.cities[O.index].blue=0,c.cities[O.index].yellow=0}if(d.cities.length<=5){e.roster[d.name]||(e.roster[d.name]=[]);const O=d.cities.length-N.length;for(let ie=O;ie<d.cities.length;ie++)e.roster[d.name].includes(ie)||e.roster[d.name].push(ie)}return e.addLog(`${d.name}${Math.floor(I)}${c.name}${N.length}${N.join("")}`),{success:!0,message:`${N.length}${N.join("")}`}}function me(d,c){if(!c)return{success:!1,message:""};const g=e.lastSkillUsed;if(!g)return{success:!1,message:""};if(g.userName!==c.name||g.roundNumber!==e.currentRound)return{success:!1,message:""};if(g.revoked)return{success:!1,message:""};const w=(g.cost||0)<=15?11:19;return d.gold<w?{success:!1,message:`${w}`}:e.isBlockedByJianbukecui(c.name,d.name,"")?(e.addLog(`${d.name}${c.name}"${g.skillName}"`),{success:!1,message:`${c.name}`}):e.gameStateSnapshot?(d.gold-=w,e.restoreGameStateSnapshot()?(e.lastSkillUsed.revoked=!0,e.addLog(`${d.name}${w}${c.name}"${g.skillName}"`),{success:!0,message:`${c.name}"${g.skillName}"`}):{success:!1,message:""}):{success:!1,message:""}}function oe(d){if(e.jianbukecui[d.name]&&e.jianbukecui[d.name].roundsLeft>0)return{success:!1,message:""};const c=he("",d,e);return c.success?(e.jianbukecui[d.name]={roundsLeft:3},e.addLog(`${d.name}3`),{success:!0,message:"340+"}):c}function ve(d,c){if(!c)return{success:!1,message:""};if(e.yihuajiemuUsageCount||(e.yihuajiemuUsageCount={}),e.yihuajiemuUsageCount[d.name]||(e.yihuajiemuUsageCount[d.name]=0),e.yihuajiemuUsageCount[d.name]>=2)return{success:!1,message:"2"};const g=e.skillUsageTracking[c.name];if(!g||Object.keys(g).length<2)return{success:!1,message:`${c.name}2`};const C=he("",d,e);if(!C.success)return C;const w=Object.keys(g).filter(E=>{if(g[E]<=0)return!1;const N=SKILL_COSTS[E]||0;return N>=1&&N<=15});if(w.length<2)return{success:!1,message:`${c.name}2`};const b=w[Math.floor(Math.random()*w.length)];e.yihuajiemuUsageCount[d.name]++,e.stolenSkills||(e.stolenSkills={}),e.stolenSkills[d.name]||(e.stolenSkills[d.name]=[]),e.stolenSkills[d.name].push({skillName:b,roundsLeft:3,usedCount:0,from:c.name});const I=2-e.yihuajiemuUsageCount[d.name];return e.addLog(`${d.name}${c.name}"${b}"3${I}`),{success:!0,message:`${c.name}"${b}"3${I}`}}function _e(d){if(e.stealth&&e.stealth[d.name]&&e.stealth[d.name].roundsLeft>0)return{success:!1,message:""};const c=he("",d,e);return c.success?(e.stealth||(e.stealth={}),e.stealth[d.name]={roundsLeft:3},e.addLog(`${d.name}3`),{success:!0,message:"3"}):c}function Ye(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=e.roster[c.name]||[];if(C.length===0)return{success:!1,message:""};const w=[];for(const b of C){const I=c.cities[b];if(!I||I.isAlive===!1)continue;const E=I.currentHp||I.hp;let N;E<1e4?N=3e3:N=Math.floor(E/1e4)*1e4,I.currentHp=N,w.push(`${I.name}(${Math.floor(E)}${Math.floor(N)})`)}return w.length>0?e.addLog(`${d.name}${c.name}${w.join("")}`):e.addLog(`${d.name}${c.name}`),{success:!0,message:`${w.length}`}}function Qe(d,c){if(!c)return{success:!1,message:""};if(d.cities.length<4||c.cities.length<4)return{success:!1,message:"4"};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=e.roster[d.name]||[],w=e.roster[c.name]||[];if(C.length<4)return{success:!1,message:`4${C.length}`};if(w.length<3)return{success:!1,message:`3${w.length}`};const b=C.map(K=>({idx:K,hp:d.cities[K].currentHp||d.cities[K].hp})).sort((K,Ae)=>Ae.hp-K.hp),I=w.map(K=>({idx:K,hp:c.cities[K].currentHp||c.cities[K].hp})).sort((K,Ae)=>Ae.hp-K.hp),E=b[3].idx,N=d.cities[E];let O=-1;for(let K=0;K<I.length;K++){const Ae=I[K].idx;if(!e.isInCautiousSet(c.name,Ae)&&K>=2){O=Ae;break}}if(O===-1){if(I.length<3)return{success:!1,message:""};O=I[2].idx}const ie=c.cities[O],re=d.cities[E];if(d.cities[E]=c.cities[O],c.cities[O]=re,e.initialCities[d.name]&&e.initialCities[c.name]){const K=e.initialCities[d.name][E];e.initialCities[d.name][E]=e.initialCities[c.name][O],e.initialCities[c.name][O]=K}return e.setCityKnown(d.name,E,c.name),e.setCityKnown(c.name,O,d.name),e.addLog(`${d.name}${c.name}${N.name}${ie.name}`),{success:!0,message:`${N.name}${ie.name}`}}function on(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);return g.success?(e.costIncrease||(e.costIncrease={}),e.costIncrease[c.name]=1,e.addLog(`${d.name}${c.name}${c.name}850%`),{success:!0,message:`${c.name}8+50%`}):g}function rn(d){if(e.financialCrisis&&e.financialCrisis.roundsLeft>0)return{success:!1,message:`${e.financialCrisis.roundsLeft}`};const c=he("",d,e);return c.success?(e.players.forEach(g=>{g.gold=Math.min(24,g.gold+2)}),e.financialCrisis={roundsLeft:3},e.addLog(`${d.name}23+3+1`),{success:!0,message:"23"}):c}function Ge(d,c){if(!c)return{success:!1,message:""};const g=d.cities.filter(ie=>ie&&(ie.currentHp||ie.hp)>0),C=c.cities.filter(ie=>ie&&(ie.currentHp||ie.hp)>0);if(g.length<5)return{success:!1,message:`${d.name}5${g.length}`};if(C.length<5)return{success:!1,message:`${c.name}5${C.length}`};const w=he("",d,e);if(!w.success)return w;const b=c.cities.map((ie,re)=>({city:ie,index:re,hp:ie.currentHp||ie.hp||0})).filter(ie=>ie.hp>0).sort((ie,re)=>re.hp-ie.hp).slice(0,3),I=d.cities.map((ie,re)=>({city:ie,index:re,hp:ie.currentHp||ie.hp||0})).filter(ie=>ie.hp>0).sort((ie,re)=>ie.hp-re.hp).slice(0,3);if(b.length===0||I.length===0)return{success:!1,message:""};const E=b[Math.floor(Math.random()*b.length)],N=I[Math.floor(Math.random()*I.length)],O=Math.round((E.hp+N.hp)/2);return E.city.currentHp=O,E.city.hp=O,N.city.currentHp=O,N.city.hp=O,e.addLog(`${d.name}${c.name}${E.city.name}HP:${Math.round(E.hp)}${d.name}${N.city.name}HP:${Math.round(N.hp)}HP${O}`),{success:!0,message:`${E.city.name}${N.city.name}HP${O}`}}function gn(d){const g=(e.gameMode||"2P")==="2v2"?4:5;if(d.cities.length<g)return{success:!1,message:`${g}`};const C=he("",d,e);return C.success?(e.roster||(e.roster={}),e.roster[d.name]=[],e.playerStates[d.name]||(e.playerStates[d.name]={}),e.playerStates[d.name].needsRosterRefill=!0,e.playerStates[d.name].rosterRefillReason="",e.addLog(`${d.name}`),{success:!0,message:""}):C}function An(d,c){const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};const C=d.centerIndex??0;if(g===C)return{success:!1,message:""};const w=c.currentHp||c.hp;if(w>15e3)return{success:!1,message:`15000${c.name}${Math.floor(w)}`};if(e.cooldowns||(e.cooldowns={}),e.cooldowns[d.name]||(e.cooldowns[d.name]={}),e.cooldowns[d.name].>0)return{success:!1,message:`${e.cooldowns[d.name].}`};const b=he("",d,e);return b.success?(e.cooldowns[d.name].=5,e.cityTrialField||(e.cityTrialField={}),e.cityTrialField[d.name]||(e.cityTrialField[d.name]={}),e.cityTrialField[d.name][g]={originalHp:w,roundsLeft:3,startRound:e.currentRound,selfDestructOnDeploy:!0},e.addLog(`${d.name}${c.name}3HP3`),{success:!0,message:`${c.name}3HP3`}):b}function lt(d,c,g){if(!c||!g)return{success:!1,message:""};const C=c.cities.indexOf(g);if(C===-1)return{success:!1,message:""};if(e.knownCities||(e.knownCities={}),e.knownCities[d.name]||(e.knownCities[d.name]={}),e.knownCities[d.name][c.name]||(e.knownCities[d.name][c.name]=[]),!e.knownCities[d.name][c.name].includes(C))return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const w=he("",d,e);return w.success?(e.disasterDebuff||(e.disasterDebuff={}),e.disasterDebuff[c.name]||(e.disasterDebuff[c.name]={}),e.disasterDebuff[c.name][C]=2,e.addLog(`${d.name}${c.name}${g.name}12`),{success:!0,message:`${g.name}12`}):w}function T(d){if(e.ldtj||(e.ldtj={}),e.ldtj[d.name])return{success:!1,message:""};const c=he("",d,e);return c.success?(e.ldtj[d.name]=!0,e.addLog(`${d.name}`),{success:!0,message:""}):c}function F(d,c,g){if(!c||!g)return{success:!1,message:""};const C=c.cities.filter(N=>N&&(N.currentHp||N.hp)>0);if(C.length<2)return{success:!1,message:`2${C.length}`};const w=c.cities.indexOf(g);if(w===-1)return{success:!1,message:""};if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(w))return{success:!1,message:""};if(!(e.roster[c.name]||[]).includes(w))return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const I=he("",d,e);if(!I.success)return I;const E=C.length===2?2:3;return e.forcedBench||(e.forcedBench={}),e.forcedBench[c.name]||(e.forcedBench[c.name]={}),e.forcedBench[c.name][w]=E,e.addLog(`${d.name}${c.name}${g.name}${E}`),{success:!0,message:`${g.name}${E}`}}function k(d){const c=[],g=e.playerStates[d.name],C=e.currentRound;if(g&&g.skillLastUsed)for(const[b,I]of Object.entries(g.skillLastUsed))C-I<5&&c.push(b);if(c.length===0)return{success:!1,message:""};const w=he("",d,e);return w.success?{success:!0,message:"",data:{coolingSkills:c,needSelection:!0}}:w}function D(d,c){const g=e.playerStates[d.name];return!g||!g.skillLastUsed||!g.skillLastUsed[c]?{success:!1,message:""}:(g.skillLastUsed[c]=0,e.addLog(`${d.name}${c}`),{success:!0,message:`${c}`})}function B(d){const c=he("",d,e);return c.success?(e.skillProtection||(e.skillProtection={}),e.skillProtection[d.name]={roundsLeft:10},e.addLog(`${d.name}10`),{success:!0,message:"10"}):c}function J(d){const c=[];if(e.skillUsageTracking||(e.skillUsageTracking={}),e.skillUsageTracking[d.name]||(e.skillUsageTracking[d.name]={}),e.skillUsageTracking[d.name],c.length===0)return{success:!1,message:""};const g=he("",d,e);return g.success?{success:!0,message:"",data:{limitedSkills:c,needSelection:!0}}:g}function se(d,c){return e.skillUsageTracking[d.name]||(e.skillUsageTracking[d.name]={}),e.skillUsageTracking[d.name][c]&&e.skillUsageTracking[d.name][c]--,e.addLog(`${d.name}${c}+1`),{success:!0,message:`${c}1`}}function te(d,c,g){e.hpBank||(e.hpBank={}),e.hpBank[d.name]||(e.hpBank[d.name]={balance:0,depositMade:!1,hasWithdrawnThisRound:!1});const C=e.hpBank[d.name];if(g==="deposit"){if(C.depositMade)return{success:!1,message:""};if(!c)return{success:!1,message:""};if((c.currentHp||c.hp)<=1e4)return{success:!1,message:"HP10000"};const b=he("",d,e);return b.success?(c.currentHp=(c.currentHp||c.hp)-1e4,C.balance=1e4,C.depositMade=!0,e.addLog(`${d.name}${c.name}10000HP`),{success:!0,message:`10000HP${c.name}HP${Math.floor(c.currentHp)}`}):b}else if(g==="withdraw"){if(!C.depositMade)return{success:!1,message:""};if(C.hasWithdrawnThisRound)return{success:!1,message:""};if(C.balance===0)return{success:!1,message:"0"};if(!c)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:"HP"};const w=Math.min(3e3,C.balance);return c.currentHp=(c.currentHp||c.hp)+w,C.balance-=w,C.hasWithdrawnThisRound=!0,e.addLog(`${d.name}${w}HP${c.name}${C.balance}`),{success:!0,message:`${w}HP${C.balance}`,data:{withdrawn:w,remaining:C.balance}}}return{success:!1,message:""}}function Z(d){const c=e.gameMode||"2P";if(!(c==="2P"||c==="2v2"))return{success:!1,message:"2/2v2"};if(e.mirageUsageCount||(e.mirageUsageCount={}),e.mirageUsageCount[d.name])return{success:!1,message:"1"};const C=he("",d,e);return C.success?(e.mirageUsageCount[d.name]=!0,e.mirage||(e.mirage={}),e.mirage[d.name]={roundsLeft:5,blocked:0,active:!0},e.addLog(`${d.name}575%`),{success:!0,message:"5"}):C}function pe(d,c){const g=new Set;if(e.bannedSkills&&e.bannedSkills[d.name]&&Object.keys(e.bannedSkills[d.name]).forEach(b=>g.add(b)),e.burnBridge)for(const b in e.burnBridge){if(b===d.name)continue;const I=e.burnBridge[b];if(I&&I.bannedSkills){let E=!1;if(e.gameMode==="2v2"){const N=e.players.find(O=>O.name===b);N&&d.team!==void 0&&N.team!==void 0&&(E=d.team===N.team)}E||I.bannedSkills.forEach(N=>g.add(N))}}if(e.forcedSoldierBan)for(const b in e.forcedSoldierBan){if(b===d.name)continue;const I=e.forcedSoldierBan[b];if(I&&I.bannedSkills){let E=!1;if(e.gameMode==="2v2"){const N=e.players.find(O=>O.name===b);N&&d.team!==void 0&&N.team!==void 0&&(E=d.team===N.team)}E||I.bannedSkills.forEach(N=>g.add(N))}}const C=Array.from(g);if(C.length===0)return{success:!1,message:""};if(!c)return{success:!0,message:"",data:{bannedSkills:C,needSelection:!0}};if(!C.includes(c))return{success:!1,message:""};const w=he("",d,e);if(!w.success)return w;if(e.bannedSkills&&e.bannedSkills[d.name]&&delete e.bannedSkills[d.name][c],e.burnBridge)for(const b in e.burnBridge){const I=e.burnBridge[b];if(I&&I.bannedSkills){const E=I.bannedSkills.indexOf(c);E!==-1&&I.bannedSkills.splice(E,1)}}if(e.forcedSoldierBan)for(const b in e.forcedSoldierBan){const I=e.forcedSoldierBan[b];if(I&&I.bannedSkills){const E=I.bannedSkills.indexOf(c);E!==-1&&I.bannedSkills.splice(E,1)}}return e.addLog(`${d.name}${c}`),{success:!0,message:`${c}`}}function ce(d,c,g){if(!c||!g)return{success:!1,message:""};const C=c.cities.indexOf(g);if(C===-1)return{success:!1,message:""};const w=g.currentHp||g.hp;if(w===8e4||w===1e5)return{success:!1,message:"HP80000100000"};if(c.name!==d.name){if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(C))return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`}}const b=he("",d,e);if(!b.success)return b;const E=Math.floor(w).toString().split("").reverse().join(""),N=parseInt(E,10);return g.currentHp=N,e.addLog(`${d.name}${c.name}${g.name}HP${Math.floor(w)}${N}`),{success:!0,message:`${g.name}HP${Math.floor(w)}${N}`,data:{oldHp:w,newHp:N}}}function xe(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);return g.success?(e.stareDown||(e.stareDown={}),e.stareDown[c.name]={roundsLeft:3,source:d.name},e.addLog(`${d.name}${c.name}${c.name}3`),{success:!0,message:`${c.name}3`}):g}function Te(d){if(e.burnBridge&&e.burnBridge[d.name]&&e.burnBridge[d.name].active)return{success:!1,message:""};const c=e.gameMode||"2P";let g;if(c==="2v2"){const w=d.team;g=e.players.filter(b=>b.team!==w)}else g=e.players.filter(w=>w.name!==d.name);for(const w of g)if(e.skillProtection&&e.skillProtection[w.name]&&e.skillProtection[w.name].roundsLeft>0)return{success:!1,message:`${w.name}`};const C=he("",d,e);return C.success?(e.burnBridge||(e.burnBridge={}),e.burnBridge[d.name]={active:!0,bannedSkills:[]},e.addLog(`${d.name}5`),{success:!0,message:"5"}):C}function we(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=[];if(c.cities.forEach((E,N)=>{!E||(E.currentHp||E.hp)<=0||E.isAlive===!1||e.ironCities&&e.ironCities[c.name]&&e.ironCities[c.name].includes(N)||e.protections&&e.protections[c.name]&&e.protections[c.name][N]>0||C.push(N)}),C.length<3)return{success:!1,message:`3${C.length}`};const b=C.sort(()=>Math.random()-.5).slice(0,3);e.electromagnetic||(e.electromagnetic={}),e.electromagnetic[c.name]={cities:b,roundsLeft:3,source:d.name};const I=b.map(E=>c.cities[E].name).join("");return e.addLog(`${d.name}${c.name}${I}350%`),{success:!0,message:`${I}350%`,data:{connectedCities:b}}}function le(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};const C=e.gameMode||"2P",w=C==="2P",b=C==="2v2",I=w||b?d.centerIndex??0:-1;if((w||b)&&g===I)return{success:!1,message:""};const E=c.currentHp||c.hp,N=e.initialCities&&e.initialCities[d.name]&&e.initialCities[d.name][g]?e.initialCities[d.name][g].hp:c.hp;if(Math.abs(E-N)>.1)return{success:!1,message:"HPHP"};const O=he("",d,e);return O.success?(e.hjbf||(e.hjbf={}),e.hjbf[d.name]||(e.hjbf[d.name]={}),e.hjbf[d.name][g]={roundsLeft:5,originalHp:E,active:!0},e.addLog(`${d.name}${c.name}15HP5`),{success:!0,message:`${c.name}15HP5`}):O}function Ve(d){const c=he("",d,e);if(!c.success)return c;const g=e.gameMode||"2P",C=[];d.cities.forEach((b,I)=>{if(b&&(b.currentHp||b.hp)>0&&(b.currentHp||b.hp)<1e4){const E=b.currentHp||b.hp,N=Math.floor(Math.sqrt(E)*100);b.currentHp=N,C.push({player:d.name,cityName:b.name,oldHp:Math.round(E),newHp:N,type:"HP"})}}),e.players.forEach(b=>{if(b.name!==d.name&&!(g==="2v2"&&b.team===d.team)){if(e.isBlockedByJianbukecui(b.name,d.name,"")){e.addLog(`${d.name}${b.name}`);return}b.cities.forEach((I,E)=>{if(I&&(I.currentHp||I.hp)>0&&(I.currentHp||I.hp)>1e4){const N=g==="2P"||g==="2v2",O=N?b.centerIndex??0:-1;if(N&&E===O&&e.mirage&&e.mirage[b.name]&&e.mirage[b.name].roundsLeft>0&&Math.random()<.75){e.mirage[b.name].blocked++,C.push({player:b.name,cityName:I.name,oldHp:Math.round(I.currentHp||I.hp),newHp:Math.round(I.currentHp||I.hp),type:""});return}const re=I.currentHp||I.hp,K=Math.floor(Math.sqrt(re)*100);I.currentHp=K,C.push({player:b.name,cityName:I.name,oldHp:Math.round(re),newHp:K,type:"HP"})}})}});const w=C.map(b=>`${b.player}${b.cityName}: ${b.oldHp}${b.newHp}`).join("");return e.addLog(`${d.name}${C.length}${w}`),{success:!0,message:`${C.length}`,data:{affectedCities:C}}}function We(d,c){if(!c)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;const C=[];if(e.disasterDebuff&&e.disasterDebuff[d.name]){const b=Object.keys(e.disasterDebuff[d.name]).length;b>0&&(delete e.disasterDebuff[d.name],C.push(`${b}`))}if(e.electromagnetic&&e.electromagnetic[d.name]&&e.electromagnetic[d.name].source===c.name&&(delete e.electromagnetic[d.name],C.push("")),e.stareDown&&e.stareDown[d.name]&&e.stareDown[d.name].source===c.name&&(delete e.stareDown[d.name],C.push("")),e.timeBombs&&e.timeBombs[c.name]){const b=Object.keys(e.timeBombs[c.name]).length;b>0&&(delete e.timeBombs[c.name],C.push(`${b}`))}if(e.stealthMode&&e.stealthMode[c.name]&&(delete e.stealthMode[c.name],C.push("")),e.barrier&&e.barrier[c.name]&&(delete e.barrier[c.name],C.push("")),e.potentialOverflow&&e.potentialOverflow[c.name]&&(delete e.potentialOverflow[c.name],C.push("")),C.length===0)return e.addLog(`${d.name}${c.name}`),{success:!0,message:""};const w=C.join("");return e.addLog(`${d.name}${c.name}${w}`),{success:!0,message:`${w}`,data:{clearedEffects:C}}}function Pn(d,c,g){if(!c||g===void 0)return{success:!1,message:""};const C=c.cities[g];if(!C||C.currentHp<=0||C.isAlive===!1)return{success:!1,message:""};const w=e.gameMode||"2P";if((w==="2P"||w==="2v2")&&c.centerIndex===g)return{success:!1,message:""};if(e.yillailiang&&e.yillailiang[c.name]&&e.yillailiang[c.name].cityIndex===g)return{success:!1,message:""};if(e.deploymentConfirmed&&e.deploymentConfirmed[c.name])return{success:!1,message:""};const b=he("",d,e);return b.success?(e.yantingjicong||(e.yantingjicong={}),e.yantingjicong[c.name]={cityIndex:g,demandBy:d.name,enforced:!1},e.addLog(`${d.name}${c.name}${C.name}`),{success:!0,message:`${c.name}${C.name}`}):b}function wn(d,c){if(!c)return{success:!1,message:""};const C={:1,:2,:2,:3,:3,:3,:4,:4,:5,:6,:6,:6,:7,:7,:7,:8,:8,:9,:9,:10,:10,:10,:10,:11,:13,:15,:1,:1,:1,:2,:2,:2,:3,:3,:3,:3,:3,:4,:4,:4,:4,:4,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:5,:6,:6,:6,:6,:6,:6,:6,:7,:7,:7,:7,:7,:7,:7,:8,:8,:8,:8,:8,:8,:8,:9,:9,:9,:9,:9,:10,:10,:11,"":11,:11,:11,:11,:11,"":11,:12,:12,:12,:12,"":13,"":13,:13,:13,"":14,:15}[c];if(!C||C<1||C>15)return{success:!1,message:"1-15"};const w=Math.ceil(C/2);if(d.gold<w)return{success:!1,message:`${w}${d.gold}`};const b=e.gameMode||"2P";let I;if(b==="2v2"){const N=d.team;I=e.players.filter(O=>O.team!==N)}else I=e.players.filter(N=>N.name!==d.name);e.bannedSkills||(e.bannedSkills={});let E=!1;for(const N of I)if(e.bannedSkills[N.name]||(e.bannedSkills[N.name]={}),e.bannedSkills[N.name][c]){E=!0;break}if(E)return{success:!1,message:`"${c}"`};for(const N of I)if(e.skillProtection&&e.skillProtection[N.name]&&e.skillProtection[N.name].roundsLeft>0)return{success:!1,message:`${N.name}`};d.gold-=w;for(const N of I)e.bannedSkills[N.name]||(e.bannedSkills[N.name]={}),e.bannedSkills[N.name][c]={bannedBy:d.name,cost:w};return e.addLog(`${d.name}${w}"${c}"`),{success:!0,message:`"${c}"${w}`,data:{bannedSkill:c,cost:w,affectedPlayers:I.map(N=>N.name)}}}function fn(d,c,g){if(!c||g===void 0)return{success:!1,message:""};const C=c.cities[g];if(!C||C.currentHp<=0||C.isAlive===!1)return{success:!1,message:""};const w=e.gameMode||"2P";if((w==="2P"||w==="2v2")&&c.centerIndex===g)return{success:!1,message:""};if(!(C.isCapitalCity||e.isCapitalCity(C.name)))return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const I=he("",d,e);if(!I.success)return I;const E=e.getProvinceOfCity(C.name)?.name||"";return e.reversedCapitals||(e.reversedCapitals={}),e.reversedCapitals[c.name]||(e.reversedCapitals[c.name]={}),e.reversedCapitals[c.name][g]={province:E,cityName:C.name},e.addLog(`${d.name}${c.name}${C.name}${E}`),{success:!0,message:`${C.name}${E}`,data:{capitalCity:C.name,province:E}}}function Sn(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};let C;if(e.changeFlagMark&&e.changeFlagMark[d.name]&&e.changeFlagMark[d.name][g])C=e.changeFlagMark[d.name][g].newProvince;else{const K=e.getProvinceOfCity(c.name);C=K?K.name:null}if(!C||C==="")return{success:!1,message:""};const w=he("",d,e);if(!w.success)return w;const b=new Set;e.players.forEach(K=>{K.cities.forEach(Ae=>{Ae&&Ae.name&&b.add(Ae.name)})});const E=e.getUnusedCities().filter(K=>{const Ae=e.getProvinceOfCity(K.name);return Ae&&Ae.name===C&&!b.has(K.name)});if(E.length<2)return{success:!1,message:`${C}2${E.length}`};const O=[...E].sort(()=>Math.random()-.5).slice(0,2),ie=[],re=[];for(const K of O){const Ae={name:K.name,hp:K.hp,currentHp:K.hp,baseHp:K.hp,isAlive:!0,red:K.red||0,green:K.green||0,blue:K.blue||0,yellow:K.yellow||0,modifiers:[]};d.cities.push(Ae);const Be=d.cities.length-1;ie.push(Be),re.push(Ae),e.markCityAsUsed(K.name),e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push({name:Ae.name,hp:Ae.hp})}return e.playerStates[d.name]||(e.playerStates[d.name]={}),e.playerStates[d.name].forcedDeployment={cities:[g,...ie],reason:""},e.addLog(`${d.name}${C}${re.map(K=>`${K.name}(${K.hp})`).join("")}3`),{success:!0,message:`2${C}${re.map(K=>K.name).join("")}3`,data:{province:C,addedCities:re.map(K=>({name:K.name,hp:K.hp}))}}}function it(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};let C;if(e.changeFlagMark&&e.changeFlagMark[d.name]&&e.changeFlagMark[d.name][g])C=e.changeFlagMark[d.name][g].newProvince;else{const z=e.getProvinceOfCity(c.name);C=z?z.name:null}if(!C||C==="")return{success:!1,message:""};const w=he("",d,e);if(!w.success)return w;const b=new Set;e.players.forEach(z=>{z.cities.forEach(ye=>{ye&&ye.name&&b.add(ye.name)})});const E=e.getUnusedCities().filter(z=>{const ye=e.getProvinceOfCity(z.name);return ye&&ye.name===C&&!b.has(z.name)});if(E.length<3)return{success:!1,message:`${C}3${E.length}`};const N=[...E].sort((z,ye)=>ye.hp-z.hp);let O;N.length===1?O=N[0]:(N[0].hp,c.name===N[0].name?O=N[1]:O=N[0]);const K=[...E.filter(z=>z.name!==O.name)].sort(()=>Math.random()-.5).slice(0,2),Ae=[O,...K],Be=[];for(const z of Ae){const ye={name:z.name,hp:z.hp,currentHp:z.hp,baseHp:z.hp,isAlive:!0,red:z.red||0,green:z.green||0,blue:z.blue||0,yellow:z.yellow||0,modifiers:[]};d.cities.push(ye),Be.push(ye),e.markCityAsUsed(z.name),e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push({name:ye.name,hp:ye.hp})}if(d.cities.filter(z=>z.isAlive!==!1).length<=5){e.roster[d.name]||(e.roster[d.name]=[]);const z=d.cities.length-3;for(let ye=z;ye<d.cities.length;ye++)e.roster[d.name].includes(ye)||e.roster[d.name].push(ye)}const Ue=(e.gameMode||"2P")==="2v2"?4:5;return(e.roster[d.name]||[]).filter(z=>{const ye=d.cities[z];return ye&&(ye.currentHp||ye.hp)>0}).length<Ue&&e.addLog(`${d.name}${Ue}`),e.addLog(`${d.name}${C}${Be.map(z=>`${z.name}(${z.hp})`).join("")}`),{success:!0,message:`3${C}${Be.map(z=>z.name).join("")}`,data:{province:C,addedCities:Be.map(z=>({name:z.name,hp:z.hp})),highHpCity:O.name}}}function Gn(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=e.gameMode||"2P",w=C==="2P"||C==="2v2"?c.centerIndex??0:-1,b=e.protections&&e.protections[c.name]||{},I=e.ironCities&&e.ironCities[c.name]||{},E=e.anchored&&e.anchored[c.name]||{},N=e.bbgs&&e.bbgs[c.name]||{},O=c.cities.map((Pe,Ee)=>({city:Pe,idx:Ee})).filter(Pe=>!((Pe.city.currentHp||Pe.city.hp)<=0||Pe.city.isAlive===!1||Pe.idx===w||b[Pe.idx]&&b[Pe.idx]>0||I[Pe.idx]||E[Pe.idx]&&E[Pe.idx]>0||N[Pe.idx]));if(O.length===0)return{success:!1,message:""};const ie=O[Math.floor(Math.random()*O.length)],re={...ie.city},K=re.name,Ae=re.currentHp||re.hp;c.cities.splice(ie.idx,1),e.initialCities[c.name]&&e.initialCities[c.name].splice(ie.idx,1),e.roster[c.name]&&(e.roster[c.name]=e.roster[c.name].filter(Pe=>Pe!==ie.idx).map(Pe=>Pe>ie.idx?Pe-1:Pe)),c.centerIndex!==void 0&&c.centerIndex>ie.idx&&c.centerIndex--,d.cities.push(re);const Be=d.cities.length-1;return e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push({name:re.name,hp:re.baseHp||re.hp}),d.cities.length<=5&&(e.roster[d.name]||(e.roster[d.name]=[]),e.roster[d.name].includes(Be)||e.roster[d.name].push(Be)),e.setCityKnown(d.name,Be,c.name),e.addLog(`${d.name}${c.name}${K}(HP:${Math.floor(Ae)})`),{success:!0,message:`${K}(HP:${Math.floor(Ae)})`,data:{stolenCity:K,stolenHp:Ae}}}function In(d,c,g){if(!c)return{success:!1,message:""};if(!g)return{success:!1,message:""};const C=c.cities.indexOf(g);if(C===-1)return{success:!1,message:""};if((g.currentHp||g.hp)<=0||g.isAlive===!1)return{success:!1,message:""};if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(C))return{success:!1,message:""};const w=e.gameMode||"2P";if((w==="2P"||w==="2v2")&&c.centerIndex===C)return{success:!1,message:""};if(e.protections&&e.protections[c.name]&&e.protections[c.name][C]&&e.protections[c.name][C]>0)return{success:!1,message:""};if(e.ironCities&&e.ironCities[c.name]&&e.ironCities[c.name][C])return{success:!1,message:""};if(e.bbgs&&e.bbgs[c.name]&&e.bbgs[c.name][C])return{success:!1,message:""};const b=e.anchored&&e.anchored[c.name]||{};if(b[C]&&b[C]>0)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const I=he("",d,e);if(!I.success)return I;const E={...g},N=E.name,O=E.currentHp||E.hp;c.cities.splice(C,1),e.initialCities[c.name]&&e.initialCities[c.name].splice(C,1),e.roster[c.name]&&(e.roster[c.name]=e.roster[c.name].filter(re=>re!==C).map(re=>re>C?re-1:re)),c.centerIndex!==void 0&&c.centerIndex>C&&c.centerIndex--,d.cities.push(E);const ie=d.cities.length-1;return e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push({name:E.name,hp:E.baseHp||E.hp}),d.cities.length<=5&&(e.roster[d.name]||(e.roster[d.name]=[]),e.roster[d.name].includes(ie)||e.roster[d.name].push(ie)),e.setCityKnown(d.name,ie,c.name),e.addLog(`${d.name}${c.name}${N}(HP:${Math.floor(O)})`),{success:!0,message:`${N}(HP:${Math.floor(O)})`,data:{stolenCity:N,stolenHp:O}}}function _n(d,c,g){const{myCityIdx:C,oppCityIdx:w}=g;if(!c)return{success:!1,message:""};if(C===void 0||w===void 0)return{success:!1,message:""};const b=(re,K)=>{if(e.changeFlagMark&&e.changeFlagMark[re.name]&&e.changeFlagMark[re.name][K])return e.changeFlagMark[re.name][K].newProvince;const Ae=re.cities[K];return Ae?Ae.province||e.getProvinceName(Ae.name):null},I=d.cities[C],E=c.cities[w];if(!I||!E)return{success:!1,message:""};if(I.currentHp<=0||I.isAlive===!1)return{success:!1,message:""};if(E.currentHp<=0||E.isAlive===!1)return{success:!1,message:""};const N=b(d,C),O=b(c,w);if(!N||!O)return{success:!1,message:""};if(e.isCapitalCity(I.name,N))return{success:!1,message:""};if(e.isCapitalCity(E.name,O))return{success:!1,message:""};if(N==="")return{success:!1,message:""};if(O==="")return{success:!1,message:""};const ie=he("",d,e);return ie.success?(e.changeFlagMark||(e.changeFlagMark={}),e.changeFlagMark[d.name]||(e.changeFlagMark[d.name]={}),e.changeFlagMark[c.name]||(e.changeFlagMark[c.name]={}),e.changeFlagMark[d.name][C]={newProvince:O,originalProvince:N},e.changeFlagMark[c.name][w]={newProvince:N,originalProvince:O},e.addLog(`${d.name}${c.name}${I.name}${N}${O}${E.name}${O}${N}`),{success:!0,message:`${I.name}${N}${O}${E.name}${O}${N}`,data:{myCityName:I.name,oppCityName:E.name,myProvChange:{from:N,to:O},oppProvChange:{from:O,to:N}}}):ie}function st(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};const C=c.province||e.getProvinceName(c.name);if(C===""||C===""||C===""||C===""||C===""||C===""||C==="")return{success:!1,message:""};const w=he("",d,e);return w.success?(e.mutualWatch||(e.mutualWatch={}),e.mutualWatch[d.name]||(e.mutualWatch[d.name]={}),e.mutualWatch[d.name][g]={province:C,cityName:c.name},e.addLog(`${d.name}${c.name}${C}`),{success:!0,message:`${c.name}`,data:{cityName:c.name,province:C}}):w}function kt(d,c,g){if(!c)return{success:!1,message:""};if(!g)return{success:!1,message:""};const C=c.cities.indexOf(g);if(C===-1)return{success:!1,message:""};if(g.currentHp<=0||g.isAlive===!1)return{success:!1,message:""};const w=e.gameMode||"2P";if((w==="2P"||w==="2v2")&&c.centerIndex===C)return{success:!1,message:""};if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(C))return{success:!1,message:""};const b=he("",d,e);return b.success?(e.yillailiang||(e.yillailiang={}),e.yillailiang[c.name]={cityIndex:C,markedBy:d.name,cityName:g.name},e.ironCities&&e.ironCities[c.name]&&e.ironCities[c.name][C]&&(delete e.ironCities[c.name][C],e.addLog(`${g.name}`)),e.protections&&e.protections[c.name]&&e.protections[c.name][C]&&(delete e.protections[c.name][C],e.addLog(`${g.name}`)),e.cautiousSet||(e.cautiousSet={}),e.cautiousSet[c.name]||(e.cautiousSet[c.name]=[]),e.cautiousSet[c.name].includes(C)||e.cautiousSet[c.name].push(C),e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}`,data:{targetCity:g.name,targetPlayer:c.name}}):b}function Lr(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};let C;if(e.changeFlagMark&&e.changeFlagMark[d.name]&&e.changeFlagMark[d.name][g]?C=e.changeFlagMark[d.name][g].newProvince:C=c.province||e.getProvinceName(c.name),C===""||C===""||C===""||C===""||C===""||C===""||C==="")return{success:!1,message:""};const w=he("",d,e);if(!w.success)return w;const b=e.gameMode||"2P";let I=[],E=[],N=0;return e.players.forEach(O=>{if(O.name===d.name||b==="2v2"&&O.team===d.team)return;if(e.isBlockedByJianbukecui(O.name,d.name,"")){e.addLog(`${d.name}${O.name}`);return}const ie=[];O.cities.forEach((re,K)=>{if(!re||re.currentHp<=0||re.isAlive===!1)return;let Ae;if(e.changeFlagMark&&e.changeFlagMark[O.name]&&e.changeFlagMark[O.name][K]?Ae=e.changeFlagMark[O.name][K].newProvince:Ae=re.province||e.getProvinceName(re.name),Ae===C){const Be=e.getProvinceOfCity(re.name);if((Be?Be.name:null)===""||(b==="2P"||b==="2v2")&&K===(O.centerIndex??0))return;let Ee=!1;e.protections&&e.protections[O.name]&&e.protections[O.name][K]&&e.protections[O.name][K]>0?(e.protections[O.name][K]-=1,E.push(`${O.name}${re.name}-1${e.protections[O.name][K]}`),Ee=!0):e.ironCities&&e.ironCities[O.name]&&e.ironCities[O.name][K]&&(delete e.ironCities[O.name][K],E.push(`${O.name}${re.name}`),Ee=!0),Ee||ie.push({idx:K,name:re.name})}});for(let re=ie.length-1;re>=0;re--){const{idx:K,name:Ae}=ie[re];O.cities.splice(K,1),I.push(`${O.name}${Ae}`),N++,e.mutualWatch&&e.mutualWatch[O.name]&&delete e.mutualWatch[O.name][K],e.changeFlagMark&&e.changeFlagMark[O.name]&&delete e.changeFlagMark[O.name][K],O.centerIndex!==void 0&&K<O.centerIndex&&O.centerIndex--,e.roster&&e.roster[O.name]&&(e.roster[O.name]=e.roster[O.name].filter(Be=>Be!==K).map(Be=>Be>K?Be-1:Be))}}),E.length>0&&E.forEach(O=>e.addLog(O)),I.length>0?e.addLog(`${d.name}${C}${I.join("")}`):e.addLog(`${d.name}${C}`),{success:!0,message:`${N}`,data:{province:C,destroyed:I,protected:E}}}function Or(d,c){if(!c)return{success:!1,message:""};const g=e.gameMode||"2P";if(g!=="2P"&&g!=="2v2")return{success:!1,message:"2P/2v2"};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const C=he("",d,e);if(!C.success)return C;const w=c.centerIndex??0,b=c.cities[w];return b?(b.isAlive=!1,b.currentHp=0,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(w)||e.deadCities[c.name].push(w),e.playerStates[c.name]||(e.playerStates[c.name]={}),e.playerStates[c.name].needsNewCenter=!0,e.playerStates[c.name].newCenterReason="",e.addLog(`${d.name}${c.name}${b.name}${c.name}`),{success:!0,message:`${c.name}${b.name}`,data:{destroyedCenter:b.name,targetPlayer:c.name}}):{success:!1,message:""}}function Ur(d,c,g){if(!c)return{success:!1,message:""};if(!g)return{success:!1,message:""};const C=e.gameMode||"2P";if(C!=="2P"&&C!=="2v2")return{success:!1,message:"2P/2v2"};const w=c.cities.indexOf(g);if(w===-1)return{success:!1,message:""};if(g.currentHp<=0||g.isAlive===!1)return{success:!1,message:""};if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(w))return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const b=he("",d,e);if(!b.success)return b;const I=c.centerIndex??0,E=c.cities[I];return E&&(E.isAlive=!1,E.currentHp=0,E.isCenter=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(I)||e.deadCities[c.name].push(I)),g.isCenter=!0,c.centerIndex=w,e.addLog(`${d.name}${c.name}${E?.name}${g.name}`),{success:!0,message:`${g.name}${c.name}${E?.name}`,data:{oldCenter:E?.name,newCenter:g.name,targetPlayer:c.name}}}function nn(d,c,g){if(!c)return{success:!1,message:""};if(!g)return{success:!1,message:""};const C=c.cities.indexOf(g);if(C===-1)return{success:!1,message:""};if(g.currentHp<=0||g.isAlive===!1)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const w=he("",d,e);if(!w.success)return w;const b=e.gameMode||"2P",I=(b==="2P"||b==="2v2")&&C===(c.centerIndex??0);if(e.ironCities&&e.ironCities[c.name]&&e.ironCities[c.name][C]){if(delete e.ironCities[c.name][C],I)return g.isAlive=!1,g.currentHp=0,g.isCenter=!1,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(C)||e.deadCities[c.name].push(C),e.playerStates[c.name]||(e.playerStates[c.name]={}),e.playerStates[c.name].needsNewCenter=!0,e.playerStates[c.name].newCenterReason="",e.addLog(`${d.name}${c.name}${g.name}${c.name}`),{success:!0,message:`${g.name}`,data:{destroyedCity:g.name,wasCenter:!0}};if(e.viceCenters&&e.viceCenters[c.name]&&e.viceCenters[c.name].includes(C)){e.viceCenters[c.name]=e.viceCenters[c.name].filter(ie=>ie!==C);const O=g.currentHp||g.hp;return g.currentHp=Math.floor(O*.2),e.addLog(`${d.name}${c.name}${g.name}HP${Math.floor(g.currentHp)}`),{success:!0,message:`${g.name}HP20%`,data:{cityName:g.name,wasViceCenter:!0,newHp:g.currentHp}}}else return g.isAlive=!1,g.currentHp=0,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(C)||e.deadCities[c.name].push(C),e.addLog(`${d.name}${c.name}${g.name}`),{success:!0,message:`${g.name}`,data:{destroyedCity:g.name,wasIronCity:!0}}}else return{success:!1,message:`${g.name}`}}function jr(d){const c=he("",d,e);if(!c.success)return c;const g=[];if(d.cities.forEach((w,b)=>{if(!w||w.currentHp<=0||w.isAlive===!1)return;if(e.isCapitalCity(w.name)||e.isPlanCity(w.name)||e.isMunicipality(w.name)||e.isSpecialAdministrativeRegion(w.name)){const E=w.hp;w.hp=w.hp*3,(w.currentHp||w.hp)>w.hp&&(w.currentHp=w.hp),e.initialCities[d.name]&&e.initialCities[d.name][b]&&(e.initialCities[d.name][b].hp=w.hp),g.push({name:w.name,before:Math.floor(E),after:Math.floor(w.hp)})}}),g.length===0)return e.addLog(`${d.name}`),{success:!0,message:""};const C=g.map(w=>`${w.name}(${w.before}${w.after})`).join("");return e.addLog(`${d.name}${g.length}${C}`),{success:!0,message:`${g.length}HP3`,data:{boosted:g}}}function Fr(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};const C=c.province||e.getProvinceName(c.name);if(!C)return{success:!1,message:""};if(c.isCapitalCity||e.isCapitalCity(c.name,C))return{success:!1,message:""};const b=he("",d,e);return b.success?(e.actingCapital||(e.actingCapital={}),e.actingCapital[d.name]||(e.actingCapital[d.name]={}),e.actingCapital[d.name][g]={province:C,cityName:c.name},e.addLog(`${d.name}${c.name}${C}`),{success:!0,message:`${c.name}${C}`,data:{cityName:c.name,province:C}}):b}function Vr(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};if(e.subCenters&&e.subCenters[d.name]===g)return{success:!1,message:""};if(e.subCenters&&e.subCenters[d.name]!==void 0){const w=e.subCenters[d.name];return{success:!1,message:`${d.cities[w]?.name}`}}const C=he("",d,e);return C.success?(e.subCenters||(e.subCenters={}),e.subCenters[d.name]=g,e.ironCities||(e.ironCities={}),e.ironCities[d.name]||(e.ironCities[d.name]={}),e.ironCities[d.name][g]=2,e.addLog(`${d.name}${c.name}21.5`),{success:!0,message:`${c.name}1.52`,data:{cityName:c.name,cityIdx:g}}):C}function _o(d){const c=he("",d,e);if(!c.success)return c;const g=[{name:"",hp:8589,weight:33},{name:"",hp:9517,weight:30},{name:"",hp:16719,weight:20},{name:"",hp:18148,weight:15},{name:"",hp:36802,weight:2}],C=g.reduce((re,K)=>re+K.weight,0);let w=Math.random()*C,b=g[0];for(const re of g){if(w<re.weight){b=re;break}w-=re.weight}const I=e.roster[d.name]||[];if(I.length===0)return{success:!1,message:""};let E=0,N=0;const O=[];I.forEach(re=>{const K=d.cities[re];if(!K||K.currentHp<=0||K.isAlive===!1)return;let Ae=!1;const Be=K.hp;K.hp<b.hp&&(K.hp=b.hp,(K.currentHp||K.hp)>K.hp&&(K.currentHp=K.hp),e.initialCities[d.name]&&e.initialCities[d.name][re]&&(e.initialCities[d.name][re].hp=K.hp),E++,Ae=!0);const Pe=e.initialCities&&e.initialCities[d.name]&&e.initialCities[d.name][re];Pe&&Pe.blue!==void 0&&K.blue!==Pe.blue&&(K.blue=Pe.blue,N++,Ae=!0),Ae&&O.push({name:K.name,beforeHp:Math.floor(Be),afterHp:Math.floor(K.hp)})});const ie=O.map(re=>`${re.name}(${re.beforeHp}${re.afterHp})`).join("");return e.addLog(`${d.name}${b.name}(${b.hp})${E}HP${N}${ie}`),{success:!0,message:`${b.name}(${b.hp})${E}HP${N}`,data:{selectedCity:b.name,selectedHp:b.hp,hpChanged:E,blueRestored:N,affected:O}}}function Wr(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};const C=e.gameMode||"2P";if((C==="2P"||C==="2v2")&&g===(d.centerIndex??0))return{success:!1,message:""};let b;if(e.changeFlagMark&&e.changeFlagMark[d.name]&&e.changeFlagMark[d.name][g]?b=e.changeFlagMark[d.name][g].newProvince:b=c.province||e.getProvinceName(c.name),b===""||b===""||b===""||b===""||b===""||b===""||b==="")return{success:!1,message:""};if(e.bbgs&&e.bbgs[d.name]&&e.bbgs[d.name][g])return{success:!1,message:""};const I=he("",d,e);if(!I.success)return I;const E=e.getCityByName(c.name),N=E?E.hp:c.baseHp||c.hp;return e.bbgs||(e.bbgs={}),e.bbgs[d.name]||(e.bbgs[d.name]={}),e.bbgs[d.name][g]={count:0,maxCount:3,originalHp:N},e.cautiousSet||(e.cautiousSet={}),e.cautiousSet[d.name]||(e.cautiousSet[d.name]=[]),e.cautiousSet[d.name].includes(g)||e.cautiousSet[d.name].push(g),e.addLog(`${d.name}${c.name}HP3`),{success:!0,message:`${c.name}3`,data:{cityName:c.name,province:b,originalHp:N}}}function zr(d,c){if(!c)return{success:!1,message:""};const g=d.cities.indexOf(c);if(g===-1)return{success:!1,message:""};if(c.currentHp<=0||c.isAlive===!1)return{success:!1,message:""};const C=e.gameMode||"2P",w=C==="2P"||C==="2v2",b=w?d.centerIndex??0:-1;if(w&&g===b)return{success:!1,message:""};e.purpleChamber||(e.purpleChamber={});const I=e.purpleChamber[d.name],E=I!==void 0,N=he("",d,e);if(!N.success)return N;if(E){const O=d.cities[I],ie=c,re=d.cities[b],K=O?O.currentHp||O.hp:0,Ae=ie.currentHp||ie.hp,Be=re?re.currentHp||re.hp:0;if(Be>K&&K>Ae){if(e.purpleChamber[d.name]=g,e.knownCities)for(const Pe in e.knownCities)e.knownCities[Pe][d.name]&&(e.knownCities[Pe][d.name].includes(I)||e.knownCities[Pe][d.name].push(I));return e.clearCityKnownStatus(d.name,g),e.addLog(`${d.name}${O?.name}${ie.name}${Math.floor(Be)}>${Math.floor(K)}>${Math.floor(Ae)}`),{success:!0,message:`${O?.name}${ie.name}`,data:{transferred:!0,oldCity:O?.name,newCity:ie.name}}}else return{success:!1,message:`HP(${Math.floor(Be)})>HP(${Math.floor(K)})>HP(${Math.floor(Ae)})`}}else return e.purpleChamber[d.name]=g,e.clearCityKnownStatus(d.name,g),e.addLog(`${d.name}${c.name}2HP+10%`),{success:!0,message:`${c.name}2HP+10%`,data:{transferred:!1,cityName:c.name,cityIdx:g}}}function Gr(d,c,g){if(!c)return{success:!1,message:""};if(!g)return{success:!1,message:""};const C=c.cities.indexOf(g);if(C===-1)return{success:!1,message:""};if(g.currentHp<=0||g.isAlive===!1)return{success:!1,message:""};if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(C))return{success:!1,message:""};let w;if(e.changeFlagMark&&e.changeFlagMark[c.name]&&e.changeFlagMark[c.name][C]?w=e.changeFlagMark[c.name][C].newProvince:w=g.province||e.getProvinceName(g.name),!w)return{success:!1,message:`${g.name}`};if(w===""||w===""||w===""||w===""||w===""||w===""||w==="")return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const b=he("",d,e);if(!b.success)return b;const I=new Set;e.players.forEach(Ae=>{Ae.cities.forEach(Be=>{Be&&Be.name&&I.add(Be.name)})});const N=e.getUnusedCities().filter(Ae=>{const Be=e.getProvinceOfCity(Ae.name);return Be&&Be.name===w&&!I.has(Ae.name)});if(N.length<2)return{success:!1,message:`${w}2${N.length}`};const ie=[...N].sort(()=>Math.random()-.5).slice(0,2),re=[],K=[];return ie.forEach(Ae=>{const Be={name:Ae.name,hp:Ae.hp,currentHp:Ae.hp,baseHp:Ae.hp,isAlive:!0,red:Ae.red||0,green:Ae.green||0,blue:Ae.blue||0,yellow:Ae.yellow||0,modifiers:[]};c.cities.push(Be),re.push(c.cities.length-1),K.push(Be.name),e.markCityAsUsed(Ae.name)}),e.initialCities[c.name]||(e.initialCities[c.name]=[]),ie.forEach(Ae=>{e.initialCities[c.name].push({name:Ae.name,hp:Ae.hp})}),e.playerStates[c.name]||(e.playerStates[c.name]={}),e.playerStates[c.name].forcedDeployment={cities:[C,...re],reason:""},e.forcedSoldierBan||(e.forcedSoldierBan={}),e.forcedSoldierBan[c.name]={roundsLeft:3,bannedSkills:["","",""]},e.addLog(`${d.name}${c.name}${K.join("")}${g.name}`),{success:!0,message:`${c.name}2${w}${K.join("")}`,data:{province:w,originalCity:g.name,newCities:K}}}function Jr(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;const C=e.roster[c.name]||[],w=[];c.cities.forEach((K,Ae)=>{!K||(K.currentHp||K.hp)<=0||K.isAlive===!1||C.includes(Ae)||e.ironCities&&e.ironCities[c.name]&&e.ironCities[c.name].includes(Ae)||e.protections&&e.protections[c.name]&&e.protections[c.name][Ae]>0||w.push(Ae)});const b=C.filter(K=>{const Ae=c.cities[K];return!(!Ae||(Ae.currentHp||Ae.hp)<=0||Ae.isAlive===!1||e.ironCities&&e.ironCities[c.name]&&e.ironCities[c.name].includes(K)||e.protections&&e.protections[c.name]&&e.protections[c.name][K]>0)});if(w.length===0||b.length===0)return{success:!1,message:""};const I=w[Math.floor(Math.random()*w.length)],E=b[Math.floor(Math.random()*b.length)],N=c.cities[I],O=c.cities[E],ie=N.currentHp||N.hp,re=O.currentHp||O.hp;if(ie<re)N.isAlive=!1,N.currentHp=0,O.currentHp=re-ie,e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(I)||e.deadCities[c.name].push(I),e.addLog(`${d.name}${c.name}${N.name}${Math.floor(ie)}${O.name}${Math.floor(re)}${N.name}${O.name}${Math.floor(O.currentHp)}HP`);else if(ie>re){O.isAlive=!1,O.currentHp=0,N.currentHp=ie-re;const K=C.indexOf(E);K!==-1&&C.splice(K,1),e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(E)||e.deadCities[c.name].push(E),C.includes(I)||C.push(I),e.addLog(`${d.name}${c.name}${N.name}${Math.floor(ie)}${O.name}${Math.floor(re)}${O.name}${N.name}${Math.floor(N.currentHp)}HP`)}else{N.isAlive=!1,N.currentHp=0,O.isAlive=!1,O.currentHp=0;const K=C.indexOf(E);K!==-1&&C.splice(K,1),e.deadCities[c.name]||(e.deadCities[c.name]=[]),e.deadCities[c.name].includes(I)||e.deadCities[c.name].push(I),e.deadCities[c.name].includes(E)||e.deadCities[c.name].push(E),e.addLog(`${d.name}${c.name}${N.name}${O.name}HP${Math.floor(ie)}`)}return{success:!0,message:`${N.name}${O.name}`}}function Yr(d,c,g){if(!c)return{success:!1,message:""};if(g===void 0)return{success:!1,message:""};const C=c.cities[g];if(!C)return{success:!1,message:""};if(!e.knownCities||!e.knownCities[d.name]||!e.knownCities[d.name][c.name]||!e.knownCities[d.name][c.name].includes(g))return{success:!1,message:""};const w=he("",d,e);if(!w.success)return w;if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};e.createGameStateSnapshot();const b=e.initialCities&&e.initialCities[c.name]&&e.initialCities[c.name][g],I=b?b.hp:C.baseHp||C.hp,E=C.currentHp||C.hp,N={name:C.name,originalHp:Math.floor(I),currentHp:Math.floor(E),red:C.red||0,green:C.green||0,blue:C.blue||0,yellow:C.yellow||0},O=`${N.name}
HP${N.originalHp}
HP${N.currentHp}
Lv${N.red}
Lv${N.green}
Lv${N.blue}
Lv${N.yellow}`;return e.addPrivateLog&&e.addPrivateLog(d.name,`${c.name}${N.name}
${O}`),e.addLog(`${d.name}${c.name}`),e.recordSkillUsageTracking(d.name,""),e.lastSkillUsed={userName:d.name,skillName:"",cost:1,roundNumber:e.currentRound,timestamp:Date.now()},{success:!0,message:`

${O}`,data:{cityInfo:N}}}function $o(d,c){if(!c)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};e.createGameStateSnapshot();const C=e.roster[c.name]||[];if(C.length===0)return d.gold+=6,{success:!1,message:`${c.name}`};const w=[];if(C.forEach(b=>{const I=c.cities[b];if(!I)return;const E=e.initialCities&&e.initialCities[c.name]&&e.initialCities[c.name][b],N=E?E.hp:I.baseHp||I.hp,O=[];I.red>0&&O.push(`${I.red}`),I.green>0&&O.push(`${I.green}`),I.blue>0&&O.push(`${I.blue}`),I.yellow>0&&O.push(`${I.yellow}`),w.push({name:I.name,originalHp:Math.floor(N),currentHp:Math.floor(I.currentHp||I.hp),colors:O.length>0?O.join(""):""}),e.purpleChamber&&e.purpleChamber[c.name]===b||e.setCityKnown(c.name,b,d.name)}),e.addPrivateLog){const b=w.map((I,E)=>`${E+1}. ${I.name} - HP:${I.originalHp} HP:${I.currentHp} :${I.colors}`).join(`
`);e.addPrivateLog(d.name,`${c.name}${C.length}
${b}`)}return e.addLog(`${d.name}${c.name}`),e.recordSkillUsageTracking(d.name,""),{success:!0,message:`${c.name}${w.length}`,data:{cityInfoList:w}}}function Kr(d,c){if(!c)return{success:!1,message:""};const g=c.cities.filter(b=>b&&(b.currentHp||b.hp)>0);if(g.length<2)return{success:!1,message:`${c.name}2`};const C=d.cities.filter(b=>b&&(b.currentHp||b.hp)>0);if(C.length<3||g.length<3)return{success:!1,message:`3${C.length}${g.length}`};const w=he("",d,e);return w.success?e.isBlockedByJianbukecui(c.name,d.name,"")?(e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`}):(e.createGameStateSnapshot(),e.forceDeployTwo||(e.forceDeployTwo={}),e.forceDeployTwo[c.name]={active:!0,round:e.currentRound},e.cannotStandDown||(e.cannotStandDown={}),e.cannotStandDown[c.name]={active:!0,round:e.currentRound},e.addPrivateLog&&e.addPrivateLog(d.name,`${c.name}2`),e.addLog(`${d.name}${c.name}`),e.lastSkillUsed={userName:d.name,skillName:"",cost:3,roundNumber:e.currentRound,timestamp:Date.now()},{success:!0,message:`${c.name}2`}):w}function wo(d,c){if(!c)return{success:!1,message:""};const g=he("",d,e);if(!g.success)return g;if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};e.createGameStateSnapshot();const C=e.playerStates[c.name];if(!C||!C.currentBattleCities||C.currentBattleCities.length===0)return d.gold+=3,{success:!1,message:`${c.name}`};const w=[];C.currentBattleCities.forEach(I=>{const E=c.cities[I.cityIdx];if(!E)return;const N=[];I.red>0&&N.push(`${I.red}`),I.green>0&&N.push(`${I.green}`),I.blue>0&&N.push(`${I.blue}`),I.yellow>0&&N.push(`${I.yellow}`);const O=N.length>0?`${N.join("")}`:"";w.push({name:E.name,hp:Math.floor(E.currentHp||E.hp),colors:O}),e.setCityKnown(c.name,I.cityIdx,d.name)});const b=w.map(I=>`${I.name}HP:${I.hp}${I.colors}`).join(`
`);return e.addPrivateLog&&e.addPrivateLog(d.name,`${c.name}
${b}`),e.addLog(`${d.name}${c.name}`),e.recordSkillUsageTracking(d.name,""),{success:!0,message:`

${c.name}
${b}`,data:{deploymentInfo:w}}}function Zr(d,c){if(!c)return{success:!1,message:""};if(e.isBlockedByJianbukecui(c.name,d.name,""))return e.addLog(`${d.name}${c.name}`),{success:!1,message:`${c.name}`};const g=he("",d,e);if(!g.success)return g;e.createGameStateSnapshot();const C=["","","","","","","","","","","","","","","","","","","","","","","","","","",""],w=["","","","",""],b=["","","",""],I=(Se,ke)=>{const De=e.disguisedCities&&e.disguisedCities[Se]&&e.disguisedCities[Se][ke];return De&&De.roundsLeft>0?De.disguiseAsName||e.players.find(Nn=>Nn.name===Se).cities[ke].name:e.players.find(Nn=>Nn.name===Se).cities[ke].name},E=Se=>{const ke=Se.replace(/(||)$/g,"");return C.some(De=>ke.includes(De)||De.includes(ke))},N=Se=>{const ke=Se.replace(/(||)$/g,"");return w.some(De=>ke.includes(De)||De.includes(ke))},O=Se=>{const ke=Se.replace(/(||)$/g,"");return b.some(De=>ke.includes(De)||De.includes(ke))},ie=Se=>Se.includes("")||Se.includes(""),re=(Se,ke,De)=>{if(e.changeFlagMark&&e.changeFlagMark[Se]&&e.changeFlagMark[Se][ke])return e.changeFlagMark[Se][ke].newProvince;if(O(De)||ie(De)){const Rn=De.replace(/(||)$/g,"");if(b.includes(Rn))return Rn+"";if(De.includes(""))return"";if(De.includes(""))return""}return e.getProvinceName?e.getProvinceName(De):null},K=new Set;if(d.cities.forEach((Se,ke)=>{if(Se&&(Se.currentHp||Se.hp)>0){const De=I(d.name,ke),Rn=re(d.name,ke,De);Rn&&K.add(Rn)}}),K.size===0)return d.gold+=23,e.addLog(`${d.name}`),{success:!1,message:""};const Ae=e.gameMode||"2P",Be=Ae==="2P"||Ae==="2v2",Pe=Be?c.centerIndex??0:-1,Ee=[],Ue=[],y=[];for(let Se=0;Se<c.cities.length;Se++){const ke=c.cities[Se];if(!ke||(ke.currentHp||ke.hp)<=0||Be&&Se===Pe)continue;const De=I(c.name,Se);if(E(De)||N(De)||O(De)||ie(De)){if(e.consumeProtection(c.name,Se))continue;const Nn=e.disguisedCities&&e.disguisedCities[c.name]&&e.disguisedCities[c.name][Se],jn=ke.currentHp||ke.hp;if(Nn&&Nn.roundsLeft>0){const Et=Nn.disguiseAsHp||jn;ke.currentHp=Math.floor(jn/2),Nn.disguiseAsHp!==void 0&&(Nn.disguiseAsHp=Math.floor(Nn.disguiseAsHp/2)),Ue.push({name:De,before:Math.floor(Et),after:Math.floor(Nn.disguiseAsHp||ke.currentHp)})}else{const Et=jn;ke.currentHp=Math.floor(jn/2),Ue.push({name:De,before:Math.floor(Et),after:Math.floor(ke.currentHp)})}}}const z=[];for(let Se=0;Se<c.cities.length;Se++){const ke=c.cities[Se];if(!ke||(ke.currentHp||ke.hp)<=0||Be&&Se===Pe)continue;const De=I(c.name,Se);if(E(De)||N(De)||O(De)||ie(De))continue;const Nn=re(c.name,Se,De);if(!Nn||!K.has(Nn))continue;if(e.bbgs&&e.bbgs[c.name]&&e.bbgs[c.name][Se]){e.addLog(`${c.name}${De}`);continue}const jn=e.disguisedCities&&e.disguisedCities[c.name]&&e.disguisedCities[c.name][Se];jn&&jn.roundsLeft>0?(ke.currentHp||ke.hp,ke.currentHp=0,ke.isAlive=!1,jn.roundsLeft=0,y.push({name:`${jn.disguiseAsName}${ke.name}`})):(Ee.push({cityObj:JSON.parse(JSON.stringify(ke)),originalIndex:Se}),z.push(Se))}const ye=[];for(const Se of Ee){let ke=null;e.initialCities&&e.initialCities[c.name]&&(ke=e.initialCities[c.name][Se.originalIndex]),ye.push(ke||{name:Se.cityObj.name,hp:Se.cityObj.hp})}let Me=0;for(let Se=z.length-1;Se>=0;Se--){const ke=z[Se];Be&&ke<Pe&&Me++,c.cities.splice(ke,1),e.initialCities&&e.initialCities[c.name]&&e.initialCities[c.name].splice(ke,1),e.disguisedCities&&e.disguisedCities[c.name]&&delete e.disguisedCities[c.name][ke],e.protectedCities&&e.protectedCities[c.name]&&delete e.protectedCities[c.name][ke],e.ironCities&&e.ironCities[c.name]&&delete e.ironCities[c.name][ke]}Be&&Me>0&&(c.centerIndex=Math.max(0,Pe-Me));for(let Se=0;Se<Ee.length;Se++){const De=Ee[Se].cityObj,Rn=d.cities.length;d.cities.push(De),e.initialCities&&(e.initialCities[d.name]||(e.initialCities[d.name]=[]),e.initialCities[d.name].push(ye[Se])),e.setCityKnown(d.name,Rn,c.name)}let sn=`${c.name}`;if(Ee.length>0){const Se=Ee.map(ke=>ke.cityObj.name).join("");sn+=`${Se}`}if(Ue.length>0){const Se=Ue.map(ke=>`${ke.name}(${ke.before}->${ke.after})`).join("");sn+=`${Ee.length>0?"":""}HP${Se}`}if(y.length>0){const Se=y.map(ke=>ke.name).join("");sn+=`${Ee.length>0||Ue.length>0?"":""}${Se}`}return Ee.length===0&&Ue.length===0&&y.length===0&&(sn+=""),e.addPrivateLog(d.name,sn),e.addLog(`${d.name}${c.name}`),e.lastSkillUsed={userName:d.name,skillName:"",cost:23,roundNumber:e.currentRound,timestamp:Date.now()},e.recordSkillUsageTracking(d.name,""),{success:!0,message:`${Ee.length>0?`${Ee.length}`:""}${Ue.length>0?` ${Ue.length}`:""}`,data:{transferredCities:Ee.map(Se=>Se.cityObj.name),halvedCities:Ue,exposedFoxCities:y}}}function Qr(d,c,g=0){if(c===void 0)return{success:!1,message:""};const C=d.cities[c];if(!C)return{success:!1,message:""};const w=e.initialCities&&e.initialCities[d.name]&&e.initialCities[d.name][c],b=w?w.hp:C.baseHp||C.hp;if(b<25e3)return{success:!1,message:`HP25000${C.name}HP${Math.floor(b)}`};const I=he("",d,e);if(!I.success)return I;e.createGameStateSnapshot(),(typeof g!="number"||g<0||g>3)&&(g=0);const N=[1,1.25,1.5,2][g],O=C.currentHp||C.hp,ie=O;C.currentHp=Math.floor(O*N),e.applyPlayerHpCap&&e.applyPlayerHpCap(d.name,c,C);const re=C.currentHp-ie;let K=C.name;if(e.disguisedCities&&e.disguisedCities[d.name]&&e.disguisedCities[d.name][c]){const Be=e.disguisedCities[d.name][c];Be.roundsLeft>0&&(K=Be.disguiseAsName||C.name)}const Ae=`${g}HP${N}${Math.floor(ie)}  ${C.currentHp}+${re}`;return e.addPrivateLog&&e.addPrivateLog(d.name,`${K}${Ae}`),e.addLog(`${d.name}`),e.lastSkillUsed={userName:d.name,skillName:"",cost:6,roundNumber:e.currentRound,timestamp:Date.now()},e.recordSkillUsageTracking(d.name,""),{success:!0,message:`${Ae}`,data:{cityName:K,correctCount:g,multiplier:N,oldHp:ie,newHp:C.currentHp,hpGain:re}}}return{executeTransferGold:n,executeWuZhiWuWei:t,executeKuaiSuZhiLiao:i,executeCityProtection:s,executeGangTieChengShi:o,executeShiLiZengQiang:r,executeJieShiHuanHun:a,executeShiQiDaZhen:l,executeQingChuJiaCheng:u,executeShiLaiYunZhuan:f,executeXianShengDuoRen:m,executeJinBiDaiKuan:h,executeDingHaiShenZhen:v,executeHuanRanYiXin:S,executeGouYanCanChuan:X,executeGaoJiZhiLiao:ae,executeZhongZhiChengCheng:fe,executeWuZhongShengYou:ge,executeHaoGaoWuYuan:R,executeHuJiaHuWei:Y,executePaoZhuanYinYu:V,executeJinZhiNiuQu:ee,executeTiDengDingSun:ue,executeLianXuDaJi:de,executeBoTaoXiongYong:W,executeKuangHongLanZha:Q,executeHengSaoYiKong:L,executeWanJianQiFa:P,executeJiangWeiDaJi:G,executeShenCangBuLu:_,executeDingShiBaoPo:$,executeYongJiuCuiHui:A,executeZhanLueZhuanYi:H,executeLianSuoFanYing:q,executeZhaoXianNaShi:ne,executeWuXieKeJi:me,executeJianBuKeCui:oe,executeYiHuaJieMu:ve,executeBuLuZongJi:_e,executeZhengQiHuaYi:Ye,executeRenZhiJiaoHuan:Qe,executeFuDiChouXin:on,executeJinRongWeiJi:rn,executeJieFuJiPin:Ge,executeGaiXianGengZhang:gn,executeChengShiShiLian:An,executeTianZaiRenHuo:lt,executeLiDaiTaoJiang:T,executeBiErBuJian:F,executeYiChuJiFa:k,executeYiChuJiFaConfirm:D,executeJiNengBaoHu:B,executeTuPoPingJing:J,executeTuPoPingJingConfirm:se,executeXueLiangCunChu:te,executeHaiShiShenLou:Z,executeJieChuFengSuo:pe,executeShuWeiFanZhuan:ce,executeMuBuZhuanJing:xe,executeGuoHeChaiQiao:Te,executeDianCiGanYing:we,executeHouJiBaoFa:le,executeZhongYongZhiDao:Ve,executeDangJiLiDuan:We,executeZiXiangCanSha:Jr,executeYanTingJiCong:Pn,executeShiBanGongBei:wn,executeDaoFanTianGang:fn,executeBanyunJiubingPutong:Sn,executeBanyunJiubingGaoji:it,executeChenqibubeiSuiji:Gn,executeChenqibubeiZhiding:In,executeBaQiYiZhi:_n,executeShouWangXiangZhu:st,executeYiLiLaiJiang:kt,executeDaYiMieQin:Lr,executeQiangZhiQianDuPutong:Or,executeQiangZhiQianDuGaoji:Ur,executeYiWeiPingDi:nn,executeQiangZhiBanYun:Gr,executeXingZhengZhongXin:jr,executeDaiXingShengQuan:Fr,executeFuZhongXinZhi:Vr,executeJiHuaDanLie:_o,executeBuBuGaoSheng:Wr,executeShengYuZiShi:zr,executeCityDetective:Yr,executeChengShiYuYan:$o,executeYiJuLiangDe:Kr,executeMingChaQiuHao:wo,executeSiMianChuGe:Zr,executeBoXueDuoCai:Qr}}const mH=Object.freeze(Object.defineProperty({__proto__:null,useNonBattleSkills:qh},Symbol.toStringTag,{value:"Module"})),hH={:{cooldown:3,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:2},:{cooldown:1,limit:3},:{cooldown:3,limit:2},:{cooldown:0,limit:2},:{cooldown:3,limit:3},:{cooldown:0,limit:2},:{cooldown:5,limit:2},:{cooldown:2,limit:0},:{cooldown:2,limit:0},:{cooldown:3,limit:2},:{cooldown:3,limit:2},:{cooldown:3,limit:2},:{cooldown:0,limit:2},:{cooldown:5,limit:3},:{cooldown:3,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:0},:{cooldown:5,limit:0},:{cooldown:0,limit:0},:{cooldown:3,limit:2},:{cooldown:3,limit:0},:{cooldown:5,limit:0},:{cooldown:3,limit:2},:{cooldown:5,limit:3},:{cooldown:0,limit:1},:{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:3},:{cooldown:5,limit:0},:{cooldown:5,limit:3},:{cooldown:0,limit:2},:{cooldown:3,limit:2},:{cooldown:3,limit:0},:{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:3},:{cooldown:0,limit:1},:{cooldown:0,limit:0,perCity:!0},:{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{minCities:2,limit:0},:{cooldown:5,limit:0},"":{cooldown:0,limit:2},"":{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cool:{2:6,3:6,"2v2":5}},"":{cooldown:10,limit:2},:{cooldown:0,limit:2},"":{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},"":{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:3,limit:0},:{cooldown:3,limit:0},:{cooldown:5,limit:0},:{cooldown:0,limit:1},:{cooldown:3,minCities:3},:{cooldown:0,limit:1,oncePerRound:!0},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:5,limit:0},:{cooldown:0,limit:0},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:2},:{cooldown:5,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:3,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:1},:{cooldown:0,limit:2},:{cooldown:0,limit:1},:{cooldown:0,limit:2}},pH=["","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],gH=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function Ku(e){return hH[e]||{}}const yH={class:"skill-selector"},CH={class:"skill-header"},vH={class:"skill-filters"},_H=["onClick"],$H={class:"skill-grid"},wH=["onClick"],bH={class:"skill-icon"},AH={class:"skill-info"},PH={class:"skill-name"},HH={class:"skill-cost"},xH={class:"skill-description"},BH={key:0,class:"skill-cooldown"},SH={key:1,class:"skill-limit"},IH={key:0,class:"skill-detail"},kH={class:"detail-description"},EH={class:"skill-params"},TH={key:0,class:"param-group"},RH=["value"],NH={key:1,class:"param-group"},MH=["value","disabled"],DH={key:2,class:"param-group"},qH=["value","disabled"],LH={key:3,class:"param-group"},OH={class:"city-multi-select"},UH=["onClick"],jH=["checked","disabled","onClick"],FH={class:"city-checkbox-label"},VH={key:0,class:"hint-text"},WH={key:4,class:"param-group"},zH=["min","max"],GH={class:"skill-actions"},JH=["disabled"],YH={__name:"SkillSelector",props:{title:{type:String,default:""},currentPlayer:{type:Object,required:!0},skillType:{type:String,default:"all",validator:e=>["all","battle","nonBattle"].includes(e)}},emits:["skill-used","skill-failed","close"],setup(e,{emit:n}){const t=e,i=n,s=ut(),o=Dh(),r=qh(),a=Ce("all"),l=Ce(null),u=Ce(""),f=Ce(""),m=Ce(""),h=Ce(0),v=Ce([]),S=Oe(()=>[{id:"all",name:"",count:ae.value.length},{id:"battle",name:"",count:ge.value.length},{id:"resource",name:"",count:R.value.length},{id:"protection",name:"",count:Y.value.length},{id:"damage",name:"",count:V.value.length},{id:"control",name:"",count:ee.value.length}]),X={:{emoji:"",category:"battle",description:"HP",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresSelfCity:!0},:{emoji:"",category:"battle",description:"",requiresSelfCity:!0},:{emoji:"",category:"battle",description:"",requiresSelfCity:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"2",requiresSelfCity:!0},:{emoji:"",category:"battle",description:"5000",requiresTarget:!0,requiresTargetCity:!0},:{emoji:"",category:"battle",description:"(3P)",requiresTarget:!1},:{emoji:"",category:"battle",description:"",requiresSelfCity:!0},:{emoji:"",category:"battle",description:"(3P)",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"HP",requiresTarget:!0},:{emoji:"",category:"battle",description:"5",requiresSelfCity:!0},:{emoji:"",category:"battle",description:"+",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0,requiresTargetCity:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"(3P)",requiresTarget:!0},:{emoji:"",category:"battle",description:"(2v2)",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"battle",description:"15000HP",requiresTarget:!1},:{emoji:"",category:"battle",description:"",requiresTarget:!1},:{emoji:"",category:"battle",description:"HP2",requiresTarget:!1},:{emoji:"",category:"battle",description:"",requiresTarget:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!0,requiresAmount:!0,amountLabel:""},:{emoji:"",category:"damage",description:"HP",requiresTarget:!0},:{emoji:"",category:"battle",description:"",requiresTarget:!1},:{emoji:"",category:"resource",description:"5",requiresTarget:!1},:{emoji:"",category:"protection",description:"",requiresSelfCity:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"resource",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresSelfCity:!0},:{emoji:"",category:"protection",description:"10",requiresSelfCity:!0},:{emoji:"",category:"protection",description:"",requiresSelfCity:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"protection",description:"",requiresSelfCity:!0},:{emoji:"",category:"protection",description:"HP",requiresSelfCity:!0},:{emoji:"",category:"protection",description:"2+1000HP",requiresMultipleSelfCities:!0,targetCount:2},:{emoji:"",category:"protection",description:"3HP20%",requiresMultipleSelfCities:!0,targetCount:3},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"HP",requiresTarget:!1},:{emoji:"",category:"protection",description:"1HP",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"protection",description:"HP",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"protection",description:"",requiresSelfCity:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!0},:{emoji:"",category:"buff",description:"3",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"protection",description:"",requiresTarget:!1},:{emoji:"",category:"resource",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"protection",description:"",requiresTarget:!1},:{emoji:"",category:"resource",description:"",requiresTarget:!1},:{emoji:"",category:"buff",description:"",requiresSelfCity:!0},:{emoji:"",category:"protection",description:"",requiresTarget:!1},:{emoji:"",category:"protection",description:"",requiresTarget:!0},:{emoji:"",category:"resource",description:"HP",requiresSelfCity:!0},:{emoji:"",category:"protection",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"protection",description:"",requiresSelfCity:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"buff",description:"",requiresSelfCity:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresSelfCity:!0,requiresAmount:!0,amountLabel:"HP"},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"buff",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresTarget:!0,requiresTargetCity:!0},:{emoji:"",category:"damage",description:"",requiresTarget:!0,requiresTargetCity:!0},"":{emoji:"",category:"resource",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"buff",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresSelfCity:!0,requiresTargetCity:!0},:{emoji:"",category:"protection",description:"",requiresTarget:!1},"":{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"buff",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresSelfCity:!0},"":{emoji:"",category:"resource",description:"",requiresTarget:!1},"":{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},"":{emoji:"",category:"damage",description:"",requiresTarget:!0,requiresTargetCity:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},:{emoji:"",category:"damage",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresSelfCity:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!1},"":{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!0},:{emoji:"",category:"buff",description:"",requiresSelfCity:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"control",description:"",requiresTarget:!0},:{emoji:"",category:"buff",description:"",requiresSelfCity:!0},:{emoji:"",category:"resource",description:"",requiresTarget:!1}},ae=Oe(()=>{const oe=[];return(t.skillType==="all"||t.skillType==="battle")&&pH.forEach(ve=>{const _e=X[ve]||{emoji:"",category:"battle",description:ve},Ye=Ku(ve);oe.push({name:ve,..._e,...Ye})}),(t.skillType==="all"||t.skillType==="nonBattle")&&gH.forEach(ve=>{const _e=X[ve]||{emoji:"",category:"resource",description:ve},Ye=Ku(ve);oe.push({name:ve,..._e,...Ye})}),oe}),fe=Oe(()=>a.value==="all"?ae.value:ae.value.filter(oe=>oe.category===a.value)),ge=Oe(()=>ae.value.filter(oe=>oe.category==="battle")),R=Oe(()=>ae.value.filter(oe=>oe.category==="resource")),Y=Oe(()=>ae.value.filter(oe=>oe.category==="protection")),V=Oe(()=>ae.value.filter(oe=>oe.category==="damage")),ee=Oe(()=>ae.value.filter(oe=>oe.category==="control")),ue=Oe(()=>{if(!s.players||!Array.isArray(s.players))return console.warn("[SkillSelector] gameStore.players :",s.players),[];const oe=s.players.filter(ve=>ve&&ve.name!==t.currentPlayer?.name);return console.log("[SkillSelector] opponents:",oe.map(ve=>ve.name)),console.log("[SkillSelector] currentPlayer:",t.currentPlayer?.name),console.log("[SkillSelector] gameStore.players:",s.players.map(ve=>ve?.name)),oe});function de(oe){return cc[oe]||0}function W(oe){const ve=de(oe.name);return!(t.currentPlayer.gold<ve||oe.limit&&s.getSkillUsageCount(t.currentPlayer.name,oe.name)>=oe.limit)}function Q(oe){if(!W(oe)){console.log("[SkillSelector] :",oe.name,": ");return}console.log("[SkillSelector] :",oe.name),l.value=oe,u.value="",f.value="",m.value="",h.value=0,v.value=[]}function L(oe,ve){if(!P(ve))return;const _e=v.value.indexOf(oe);_e>-1?v.value.splice(_e,1):v.value.length<l.value.targetCount&&v.value.push(oe)}function P(oe,ve){if(!oe||oe.isAlive===!1)return!1;if(l.value.hpRequirement){const _e=oe.currentHp||oe.hp||0;if(l.value.hpRequirement.max&&_e>l.value.hpRequirement.max||l.value.hpRequirement.min&&_e<l.value.hpRequirement.min)return!1}return!0}function G(){return u.value?ue.value.find(ve=>ve.name===u.value)?.cities||[]:[]}function _(){return!(!l.value||l.value.requiresTarget&&!u.value||l.value.requiresTargetCity&&f.value===""||l.value.requiresSelfCity&&m.value===""||l.value.requiresAmount&&!h.value||l.value.requiresMultipleSelfCities&&v.value.length!==l.value.targetCount)}const $={:()=>o.executeQinZeiQinWang(t.currentPlayer,A()),:()=>o.executeCaoMuJieBing(t.currentPlayer,A()),:()=>o.executeYueZhanYueYong(t.currentPlayer,H()),:()=>o.executeXiYinGongJi(t.currentPlayer,H()),:()=>o.executeTongQiangTieBi(t.currentPlayer,A()),:()=>o.executeBeiShuiYiZhan(t.currentPlayer,H()),:()=>o.executeLiaoShiRuShen(t.currentPlayer,A(),q()),:()=>o.executeTongGuiYuJin(t.currentPlayer,H()),:()=>o.executeSetBarrier(t.currentPlayer),:()=>o.executeQianNengJiFa(t.currentPlayer),:()=>o.executeYuJiaQinZheng(t.currentPlayer,A()),:()=>o.executeKuangBaoMoShi(t.currentPlayer,H()),:()=>o.executeAnBingBuDong(t.currentPlayer),:()=>o.executeJiLaiZeAn(t.currentPlayer,H()),:()=>o.executeFanGeYiJi(t.currentPlayer,A()),:()=>o.executeAnDuChenCang(t.currentPlayer),:()=>o.executeShengDongJiXi(t.currentPlayer,A()),:()=>o.executeYiYiDaiLao(t.currentPlayer,A()),:()=>o.executeCaoChuanJieJian(t.currentPlayer,A()),:()=>o.executeWeiWeiJiuZhao(t.currentPlayer,A()),:()=>o.executeYuQinGuZong(t.currentPlayer,A(),q()),:()=>o.executeYunTouZhuanXiang(t.currentPlayer,A()),:()=>o.executeGeAnGuanHuo(t.currentPlayer,A()),:()=>o.executeTiaoBoBaoLiJian(t.currentPlayer,A()),:()=>o.executeChenHuoDaJie(t.currentPlayer,A()),:()=>r.executeTransferGold(t.currentPlayer,A(),h.value),:()=>r.executeWuZhiWuWei(t.currentPlayer,A()),:()=>r.executeJinBiDaiKuan(t.currentPlayer),:()=>r.executeKuaiSuZhiLiao(t.currentPlayer,H()),:()=>r.executeCityProtection(t.currentPlayer,H()),:()=>r.executeGangTieChengShi(t.currentPlayer,H()),:()=>r.executeDingHaiShenZhen(t.currentPlayer,H()),:()=>r.executeHuanRanYiXin(t.currentPlayer),:()=>r.executePaoZhuanYinYu(t.currentPlayer),:()=>r.executeGaiXianGengZhang(t.currentPlayer),:()=>r.executeBaQiYiZhi(t.currentPlayer,H()),:()=>r.executeGaoJiZhiLiao(t.currentPlayer,H()),:()=>r.executeJieShiHuanHun(t.currentPlayer,H()),:()=>r.executeShiLiZengQiang(t.currentPlayer),:()=>r.executeShiQiDaZhen(t.currentPlayer),:()=>r.executeQingChuJiaCheng(t.currentPlayer,A()),:()=>r.executeShiLaiYunZhuan(t.currentPlayer,A()),:()=>r.executeZhongZhiChengCheng(t.currentPlayer),:()=>r.executeWuZhongShengYou(t.currentPlayer),:()=>r.executeGouYanCanChuan(t.currentPlayer),:()=>r.executeHaoGaoWuYuan(t.currentPlayer,H()),:()=>r.executeHuJiaHuWei(t.currentPlayer,H(),h.value,""),:()=>r.executeSiMianChuGe(t.currentPlayer,A()),:()=>r.executeBoXueDuoCai(t.currentPlayer,H(),3),:()=>r.executeJinZhiNiuQu(t.currentPlayer,A()),:()=>r.executeTiDengDingSun(t.currentPlayer,A()),:()=>r.executeLianXuDaJi(t.currentPlayer,A()),:()=>r.executeBoTaoXiongYong(t.currentPlayer,A()),:()=>r.executeKuangHongLanZha(t.currentPlayer,A()),:()=>r.executeHengSaoYiKong(t.currentPlayer,A()),:()=>r.executeWanJianQiFa(t.currentPlayer,A()),:()=>r.executeJiangWeiDaJi(t.currentPlayer,A()),:()=>r.executeShenCangBuLu(t.currentPlayer),:()=>r.executeDingShiBaoPo(t.currentPlayer,A(),q()),:()=>r.executeYongJiuCuiHui(t.currentPlayer,A(),q()),:()=>r.executeZhanLueZhuanYi(t.currentPlayer,H()),:()=>r.executeLianSuoFanYing(t.currentPlayer,A()),:()=>r.executeZhaoXianNaShi(t.currentPlayer),:()=>r.executeWuXieKeJi(t.currentPlayer),:()=>r.executeJianBuKeCui(t.currentPlayer),:()=>r.executeYiHuaJieMu(t.currentPlayer,A()),:()=>r.executeBuLuZongJi(t.currentPlayer),:()=>r.executeZhengQiHuaYi(t.currentPlayer),:()=>r.executeRenZhiJiaoHuan(t.currentPlayer,A()),:()=>r.executeFuDiChouXin(t.currentPlayer,A()),:()=>r.executeJinRongWeiJi(t.currentPlayer,A()),:()=>r.executeJieFuJiPin(t.currentPlayer,A()),:()=>r.executeChengShiShiLian(t.currentPlayer,H()),:()=>r.executeTianZaiRenHuo(t.currentPlayer,A()),:()=>r.executeLiDaiTaoJiang(t.currentPlayer),:()=>r.executeBiErBuJian(t.currentPlayer),:()=>r.executeYiChuJiFa(t.currentPlayer),:()=>r.executeJiNengBaoHu(t.currentPlayer),:()=>r.executeTuPoPingJing(t.currentPlayer,H()),:()=>r.executeXueLiangCunChu(t.currentPlayer,H()),:()=>r.executeHaiShiShenLou(t.currentPlayer),:()=>r.executeJieChuFengSuo(t.currentPlayer),:()=>r.executeShuWeiFanZhuan(t.currentPlayer,A()),:()=>r.executeMuBuZhuanJing(t.currentPlayer,A()),:()=>r.executeGuoHeChaiQiao(t.currentPlayer,A()),:()=>r.executeDianCiGanYing(t.currentPlayer,A()),:()=>r.executeHouJiBaoFa(t.currentPlayer),:()=>r.executeZhongYongZhiDao(t.currentPlayer),:()=>r.executeDangJiLiDuan(t.currentPlayer),:()=>r.executeZiXiangCanSha(t.currentPlayer,A()),:()=>r.executeYanTingJiCong(t.currentPlayer,A()),:()=>r.executeShiBanGongBei(t.currentPlayer),:()=>r.executeDaoFanTianGang(t.currentPlayer,A()),"":()=>r.executeBanyunJiubingPutong(t.currentPlayer),"":()=>r.executeBanyunJiubingGaoji(t.currentPlayer),"":()=>r.executeChenqibubeiSuiji(t.currentPlayer,A()),"":()=>r.executeChenqibubeiZhiding(t.currentPlayer,A(),q()),:()=>r.executeShouWangXiangZhu(t.currentPlayer,A()),:()=>r.executeYiLiLaiJiang(t.currentPlayer,A()),:()=>r.executeDaYiMieQin(t.currentPlayer,H()),"":()=>r.executeQiangZhiQianDuPutong(t.currentPlayer,A()),"":()=>r.executeQiangZhiQianDuGaoji(t.currentPlayer,A()),:()=>r.executeYiWeiPingDi(t.currentPlayer,A()),:()=>r.executeQiangZhiBanYun(t.currentPlayer,A()),:()=>r.executeXingZhengZhongXin(t.currentPlayer),:()=>r.executeDaiXingShengQuan(t.currentPlayer,A()),:()=>r.executeFuZhongXinZhi(t.currentPlayer,H()),:()=>r.executeJiHuaDanLie(t.currentPlayer),:()=>r.executeBuBuGaoSheng(t.currentPlayer),:()=>r.executeShengYuZiShi(t.currentPlayer,H()),:()=>r.executeCityDetective(t.currentPlayer,A()),:()=>r.executeChengShiYuYan(t.currentPlayer),:()=>r.executeYiJuLiangDe(t.currentPlayer),:()=>r.executeMingChaQiuHao(t.currentPlayer,A()),:()=>ne(Th,""),:()=>ne(kh,"")};function A(){return ue.value.find(oe=>oe.name===u.value)}function H(){return t.currentPlayer.cities[m.value]}function q(){return A()?.cities[f.value]}function ne(oe,ve){const _e={cityName:ve,skillName:l.value.name};return oe(t.currentPlayer,_e,s.addLog,s,v.value),{success:!0}}function me(){if(!_()){console.log("[SkillSelector]  - "),console.log("[SkillSelector] requiresTarget:",l.value?.requiresTarget,"targetPlayer:",u.value),console.log("[SkillSelector] requiresTargetCity:",l.value?.requiresTargetCity,"targetCity:",f.value),console.log("[SkillSelector] requiresSelfCity:",l.value?.requiresSelfCity,"selfCity:",m.value);return}const oe=l.value;let ve;try{console.log("[SkillSelector] :",oe.name),console.log("[SkillSelector] :",u.value),console.log("[SkillSelector] :",f.value),console.log("[SkillSelector] :",m.value),console.log("[SkillSelector] :",h.value);const _e=$[oe.name];_e?(ve=_e(),console.log("[SkillSelector] :",ve)):(ve={success:!1,message:` "${oe.name}" `},console.warn("[SkillSelector] :",oe.name)),ve.success?(i("skill-used",{skill:oe.name,result:ve}),l.value=null,u.value="",f.value="",m.value="",h.value=0):i("skill-failed",{skill:oe.name,result:ve})}catch(_e){console.error("[SkillSelector] :",_e),i("skill-failed",{skill:oe.name,error:_e.message})}}return(oe,ve)=>(M(),j("div",yH,[p("div",CH,[p("h3",null,U(e.title),1),p("div",vH,[(M(!0),j(qe,null,en(S.value,_e=>(M(),j("button",{key:_e.id,class:ze(["filter-btn",{active:a.value===_e.id}]),onClick:Ye=>a.value=_e.id},U(_e.name)+" ("+U(_e.count)+") ",11,_H))),128))])]),p("div",$H,[(M(!0),j(qe,null,en(fe.value,_e=>(M(),j("div",{key:_e.name,class:ze(["skill-card",{disabled:!W(_e),selected:l.value?.name===_e.name}]),onClick:Ye=>Q(_e)},[p("div",bH,U(_e.emoji),1),p("div",AH,[p("div",PH,U(_e.name),1),p("div",HH,[ve[5]||(ve[5]=p("span",{class:"gold-icon"},"",-1)),un(" "+U(de(_e.name)),1)]),p("div",xH,U(_e.description),1),_e.cooldown?(M(),j("div",BH," : "+U(_e.cooldown)+" ",1)):$e("",!0),_e.limit?(M(),j("div",SH," : "+U(_e.limit)+" ",1)):$e("",!0)])],10,wH))),128))]),l.value?(M(),j("div",IH,[p("h4",null,U(l.value.name),1),p("p",kH,U(l.value.detailedDescription),1),p("div",EH,[l.value.requiresTarget?(M(),j("div",TH,[ve[7]||(ve[7]=p("label",null,":",-1)),ft(p("select",{"onUpdate:modelValue":ve[0]||(ve[0]=_e=>u.value=_e)},[ve[6]||(ve[6]=p("option",{value:""},"--  --",-1)),(M(!0),j(qe,null,en(ue.value,_e=>(M(),j("option",{key:_e.name,value:_e.name},U(_e.name)+" (: "+U(_e.gold)+") ",9,RH))),128))],512),[[Es,u.value]])])):$e("",!0),l.value.requiresSelfCity?(M(),j("div",NH,[ve[9]||(ve[9]=p("label",null,":",-1)),ft(p("select",{"onUpdate:modelValue":ve[1]||(ve[1]=_e=>m.value=_e)},[ve[8]||(ve[8]=p("option",{value:""},"--  --",-1)),(M(!0),j(qe,null,en(t.currentPlayer.cities,(_e,Ye)=>(M(),j("option",{key:Ye,value:Ye,disabled:_e.isAlive===!1},U(_e.name)+" (HP: "+U(Math.floor(_e.currentHp||_e.hp))+") ",9,MH))),128))],512),[[Es,m.value]])])):$e("",!0),l.value.requiresTargetCity?(M(),j("div",DH,[ve[11]||(ve[11]=p("label",null,":",-1)),ft(p("select",{"onUpdate:modelValue":ve[2]||(ve[2]=_e=>f.value=_e)},[ve[10]||(ve[10]=p("option",{value:""},"--  --",-1)),(M(!0),j(qe,null,en(G(),(_e,Ye)=>(M(),j("option",{key:Ye,value:Ye,disabled:_e.isAlive===!1},U(_e.name)+" (HP: "+U(Math.floor(_e.currentHp||_e.hp))+") ",9,qH))),128))],512),[[Es,f.value]])])):$e("",!0),l.value.requiresMultipleSelfCities?(M(),j("div",LH,[p("label",null,""+U(v.value.length)+" / "+U(l.value.targetCount)+":",1),p("div",OH,[(M(!0),j(qe,null,en(t.currentPlayer.cities,(_e,Ye)=>(M(),j("div",{key:Ye,class:ze(["city-checkbox-item",{selected:v.value.includes(Ye),disabled:!P(_e)}]),onClick:Qe=>L(Ye,_e)},[p("input",{type:"checkbox",checked:v.value.includes(Ye),disabled:!P(_e),onClick:Xn(Qe=>L(Ye,_e),["stop"])},null,8,jH),p("span",FH,U(_e.name)+" (HP: "+U(Math.floor(_e.currentHp||_e.hp))+") ",1)],10,UH))),128))]),l.value.targetCount&&v.value.length<l.value.targetCount?(M(),j("div",VH,"  "+U(l.value.targetCount)+"  ",1)):$e("",!0)])):$e("",!0),l.value.requiresAmount?(M(),j("div",WH,[p("label",null,U(l.value.amountLabel)+":",1),ft(p("input",{type:"number","onUpdate:modelValue":ve[3]||(ve[3]=_e=>h.value=_e),min:l.value.amountMin||1,max:l.value.amountMax||999999},null,8,zH),[[uo,h.value,void 0,{number:!0}]])])):$e("",!0)]),p("div",GH,[p("button",{class:"btn-primary",disabled:!_(),onClick:me},"  ",8,JH),p("button",{class:"btn-secondary",onClick:ve[4]||(ve[4]=_e=>l.value=null)},"  ")])])):$e("",!0)]))}},Lh=kn(YH,[["__scopeId","data-v-467704a8"]]),KH={class:"city-deployment panel"},ZH={class:"deployment-info"},QH={class:"info-item"},XH={class:"value"},ex={class:"info-item"},nx={class:"value"},tx={class:"info-item"},ix={class:"value"},sx={class:"muted",style:{margin:"10px 0"}},ox={class:"roster-cities"},rx={class:"city-grid"},ax=["onClick"],lx={class:"city-header"},cx={key:0,class:"center-badge"},ux={class:"city-hp"},dx={key:0,class:"dead-badge"},fx=["onClick"],mx={key:1,class:"no-skill"},hx={class:"skill-toggle"},px=["onUpdate:modelValue","disabled"],gx={class:"skill-toggle-text"},yx={class:"skill-usage"},Cx={class:"city-status"},vx={class:"skills-section"},_x={class:"skills-buttons"},$x={class:"battle-skill-select"},wx={class:"skill-selector-container"},bx=["value","disabled"],Ax={class:"action-buttons"},Px=["disabled"],Hx={class:"skill-detail-content"},xx={class:"skill-detail-header"},Bx={class:"skill-detail-body"},Sx={class:"skill-badges"},Ix={class:"skill-description"},kx={key:0,class:"skill-meta"},Ex={class:"meta-item"},Tx={class:"meta-value"},Rx={class:"skill-detail-content"},Nx={class:"skill-detail-header"},Mx={class:"skill-detail-body"},Dx={class:"skill-badges"},qx={class:"skill-cost-badge"},Lx={class:"skill-description"},Ox={__name:"CityDeployment",props:{currentPlayer:{type:Object,required:!0},rosterCities:{type:Array,required:!0},gameMode:{type:String,default:"2P"}},emits:["confirm","cancel"],setup(e,{emit:n}){const t=e,i=n,s=ut(),{showNotification:o}=pi(),r=Ce([]),a=Ce(""),l=Ce(!1),u=Ce({}),f=Ce(!1),m=Ce(null),h=Ce(""),v=Ce(!1),S=Ce(null);console.log("[CityDeployment] =====  ====="),console.log("[CityDeployment] currentPlayer.name:",t.currentPlayer?.name),console.log("[CityDeployment] currentPlayer.cities :",t.currentPlayer?.cities?.length),console.log("[CityDeployment] currentPlayer.cities :"),t.currentPlayer?.cities?.forEach((Q,L)=>{console.log(`  [${L}] ${Q.name} (HP: ${Q.currentHp??Q.hp})`)}),console.log("[CityDeployment] rosterCities:",t.rosterCities),console.log("[CityDeployment] roster:"),t.rosterCities?.forEach((Q,L)=>{const P=t.currentPlayer?.cities?.[Q];console.log(`  roster[${L}] = cityIdx ${Q} -> ${P?.name||"undefined"}`)}),console.log("[CityDeployment] ===========================");const X=Oe(()=>t.gameMode==="2P"?3:t.gameMode==="3P"||t.gameMode==="2v2"?2:3),ae=Oe(()=>s.currentRound),fe=Oe(()=>dH.map(Q=>Q.name===""?{...Q,cost:t.gameMode==="3P"?4:2}:Q).filter(Q=>!(Q.modes&&!Q.modes.includes(t.gameMode))));function ge(Q){const L=t.currentPlayer.cities[Q],P=L?.currentHp!==void 0?L.currentHp:L?.hp;if(!L||P<=0||L.isAlive===!1){o("","warning");return}const G=r.value.indexOf(Q);if(G>-1)r.value.splice(G,1),delete u.value[Q];else{if(r.value.length>=X.value){o(` ${X.value} `,"warning");return}r.value.push(Q)}}function R(Q){const L=t.currentPlayer.name;return s.getSkillUsageCount(L,Q)||0}function Y(Q){const L=Un(Q);L&&(m.value=L,h.value=Q,f.value=!0)}function V(Q){const L=uH[Q],P=fe.value.find(G=>G.name===Q);L&&P&&(S.value={name:Q,cost:P.cost,description:L},v.value=!0)}const ee=Oe(()=>h.value?R(h.value):0);function ue(Q){console.log("[CityDeployment] ",Q),o(`: ${Q.skill}`,"success"),l.value=!1}function de(Q){console.log("[CityDeployment] ",Q),o(`: ${Q.result?.message||Q.error||""}`,"error")}function W(){if(a.value===""){if(r.value.length>0){o('""',"warning");return}i("confirm",{cities:[],skill:a.value,activatedCitySkills:{}});return}if(r.value.length===0){o("","warning");return}if(a.value){const L=fe.value.find(P=>P.name===a.value);if(L&&t.currentPlayer.gold<L.cost){o(` ${L.cost} `,"error");return}}const Q={};Object.keys(u.value).forEach(L=>{if(u.value[L]&&r.value.includes(Number(L))){const P=t.currentPlayer.cities[L],G=Un(P?.name);G&&(Q[L]={cityName:P.name,skillName:G.name,skillData:G})}}),i("confirm",{cities:r.value,skill:a.value,activatedCitySkills:Q}),console.log("[CityDeployment] "),console.log("[CityDeployment] selectedCities:",r.value),console.log("[CityDeployment] rosterCities:",t.rosterCities),r.value.forEach(L=>{const P=t.currentPlayer.cities[L];console.log(`[CityDeployment]  cityIdx=${L}, name=${P?.name}`)})}return(Q,L)=>(M(),j("div",KH,[L[20]||(L[20]=p("h3",null,"",-1)),p("div",ZH,[p("div",QH,[L[10]||(L[10]=p("span",{class:"label"},":",-1)),p("span",XH,U(ae.value),1)]),p("div",ex,[L[11]||(L[11]=p("span",{class:"label"},":",-1)),p("span",nx,U(e.currentPlayer?.gold||0),1)]),p("div",tx,[L[12]||(L[12]=p("span",{class:"label"},":",-1)),p("span",ix,U(r.value.length)+" / "+U(X.value),1)])]),p("div",sx,"   "+U(X.value)+"  ",1),p("div",ox,[L[15]||(L[15]=p("h4",null,"",-1)),p("div",rx,[(M(!0),j(qe,null,en(e.rosterCities,(P,G)=>(M(),j("div",{key:G,class:ze(["city-card",{selected:r.value.includes(P),dead:(e.currentPlayer?.cities[P]?.currentHp!==void 0?e.currentPlayer?.cities[P]?.currentHp:e.currentPlayer?.cities[P]?.hp||0)<=0||e.currentPlayer?.cities[P]?.isAlive===!1,center:P===e.currentPlayer?.centerIndex}]),onClick:_=>ge(P)},[p("div",lx,[p("strong",null,U(e.currentPlayer?.cities[P]?.name||""),1),P===e.currentPlayer?.centerIndex?(M(),j("span",cx,"")):$e("",!0)]),p("div",ux,[un(" HP: "+U(Math.floor(e.currentPlayer?.cities[P]?.currentHp!==void 0?e.currentPlayer?.cities[P]?.currentHp:e.currentPlayer?.cities[P]?.hp||0))+" ",1),(e.currentPlayer?.cities[P]?.currentHp!==void 0?e.currentPlayer?.cities[P]?.currentHp:e.currentPlayer?.cities[P]?.hp||0)<=0||e.currentPlayer?.cities[P]?.isAlive===!1?(M(),j("span",dx,"")):$e("",!0)]),p("div",{class:ze(["city-skills",{clickable:Fe(Un)(e.currentPlayer?.cities[P]?.name)}]),onClick:Xn(_=>Y(e.currentPlayer?.cities[P]?.name),["stop"])},[Fe(Un)(e.currentPlayer?.cities[P]?.name)?(M(),j(qe,{key:0},[un("  "+U(Fe(Un)(e.currentPlayer?.cities[P]?.name).name)+" ",1),L[13]||(L[13]=p("span",{class:"skill-hint"},"",-1))],64)):(M(),j("span",mx,""))],10,fx),r.value.includes(P)&&Fe(Un)(e.currentPlayer?.cities[P]?.name)?.type==="active"&&Fe(Un)(e.currentPlayer?.cities[P]?.name)?.category==="battle"?(M(),j("div",{key:0,class:"city-skill-activation",onClick:L[0]||(L[0]=Xn(()=>{},["stop"]))},[p("label",hx,[ft(p("input",{type:"checkbox","onUpdate:modelValue":_=>u.value[P]=_,disabled:R(e.currentPlayer?.cities[P]?.name)>=Fe(Un)(e.currentPlayer?.cities[P]?.name)?.limit},null,8,px),[[y0,u.value[P]]]),p("span",gx,[L[14]||(L[14]=un("  ",-1)),p("span",yx,"("+U(R(e.currentPlayer?.cities[P]?.name))+"/"+U(Fe(Un)(e.currentPlayer?.cities[P]?.name)?.limit)+")",1)])])])):$e("",!0),p("div",Cx,U(r.value.includes(P)?" ":(e.currentPlayer?.cities[P]?.currentHp!==void 0?e.currentPlayer?.cities[P]?.currentHp:e.currentPlayer?.cities[P]?.hp||0)<=0||e.currentPlayer?.cities[P]?.isAlive===!1?"":""),1)],10,ax))),128))])]),p("div",vx,[L[18]||(L[18]=p("h4",null,"",-1)),p("div",_x,[p("button",{class:"skill-btn skill-btn--nonbattle",onClick:L[1]||(L[1]=P=>l.value=!0)},"   (: "+U(e.currentPlayer?.gold||0)+") ",1),p("div",$x,[L[17]||(L[17]=p("label",null,"",-1)),p("div",wx,[ft(p("select",{"onUpdate:modelValue":L[2]||(L[2]=P=>a.value=P),class:"skill-select"},[L[16]||(L[16]=p("option",{value:""},"",-1)),(M(!0),j(qe,null,en(fe.value,P=>(M(),j("option",{key:P.name,value:P.name,disabled:e.currentPlayer?.gold<P.cost},U(P.name)+" ("+U(P.cost)+") - "+U(P.description),9,bx))),128))],512),[[Es,a.value]]),a.value?(M(),j("button",{key:0,class:"view-skill-btn",onClick:L[3]||(L[3]=P=>V(a.value)),title:""},"   ")):$e("",!0)])])])]),p("div",Ax,[p("button",{class:"confirm-btn",disabled:r.value.length===0&&a.value!=="",onClick:W},"  ",8,Px),p("button",{class:"cancel-btn",onClick:L[4]||(L[4]=P=>Q.$emit("cancel"))},"  ")]),l.value?(M(),bn(Lh,{key:0,title:"","current-player":e.currentPlayer,"skill-type":"nonBattle",onSkillUsed:ue,onSkillFailed:de,onClose:L[5]||(L[5]=P=>l.value=!1)},null,8,["current-player"])):$e("",!0),f.value?(M(),j("div",{key:1,class:"skill-detail-modal",onClick:L[7]||(L[7]=Xn(P=>f.value=!1,["self"]))},[p("div",Hx,[p("div",xx,[p("h3",null,U(m.value?.name),1),p("button",{class:"close-btn",onClick:L[6]||(L[6]=P=>f.value=!1)},"")]),p("div",Bx,[p("div",Sx,[p("div",{class:ze(["skill-type-badge",m.value?.type])},U(m.value?.type==="active"?"":""),3),p("div",{class:ze(["skill-category-badge",m.value?.category])},U(m.value?.category==="battle"?"":""),3)]),p("div",Ix,U(m.value?.description),1),m.value?.limit?(M(),j("div",kx,[p("div",Ex,[L[19]||(L[19]=p("span",{class:"meta-label"},"",-1)),p("span",Tx,U(ee.value)+" / "+U(m.value.limit),1)])])):$e("",!0)])])])):$e("",!0),v.value?(M(),j("div",{key:2,class:"skill-detail-modal",onClick:L[9]||(L[9]=Xn(P=>v.value=!1,["self"]))},[p("div",Rx,[p("div",Nx,[p("h3",null,U(S.value?.name),1),p("button",{class:"close-btn",onClick:L[8]||(L[8]=P=>v.value=!1)},"")]),p("div",Mx,[p("div",Dx,[p("div",qx," "+U(S.value?.cost),1)]),p("div",Lx,U(S.value?.description),1)])])])):$e("",!0)]))}},Ux=kn(Ox,[["__scopeId","data-v-0a7d0ff7"]]),jx={class:"city-card__header"},Fx={class:"city-card__name"},Vx={key:0,class:"city-card__center-badge"},Wx={key:0,class:"city-card__protection"},zx={key:0,class:"city-card__unknown-hint"},Gx={key:1,class:"city-card__hp"},Jx={class:"city-card__hp-bar"},Yx={class:"city-card__hp-text"},Kx={key:2,class:"city-card__skill-section"},Zx=["disabled"],Qx={class:"skill-name"},Xx={key:0,class:"skill-usage"},eB={key:3,class:"city-card__modifiers"},nB=["title"],tB={key:4,class:"city-card__actions"},iB={__name:"CityCard",props:{city:{type:Object,required:!0},hasProtection:{type:Boolean,default:!1},protectionRounds:{type:Number,default:0},modifiers:{type:Array,default:()=>[]},showActions:{type:Boolean,default:!1}},emits:["skill-click"],setup(e,{emit:n}){const t=e,i=n,s=Oe(()=>t.city.hp?Math.max(0,Math.min(100,t.city.currentHp/t.city.hp*100)):0),o=Oe(()=>{const l=s.value;return l>70?"hp-fill--high":l>30?"hp-fill--medium":"hp-fill--low"}),r=Oe(()=>Un(t.city.name));function a(){r.value&&!t.city.isUnknown&&i("skill-click",{city:t.city,skill:r.value})}return(l,u)=>(M(),j("div",{class:ze(["city-card",{"city-card--dead":!e.city.isAlive,"city-card--center":e.city.isCenter,"city-card--protected":e.hasProtection,"city-card--unknown":e.city.isUnknown}])},[p("div",jx,[p("h4",Fx,[un(U(e.city.name)+" ",1),e.city.isCenter&&!e.city.isUnknown?(M(),j("span",Vx,"")):$e("",!0)]),e.hasProtection&&!e.city.isUnknown?(M(),j("div",Wx,"  "+U(e.protectionRounds)+" ",1)):$e("",!0)]),e.city.isUnknown?(M(),j("div",zx,[...u[0]||(u[0]=[p("span",{class:"unknown-icon"},"",-1),p("span",{class:"unknown-text"},"",-1)])])):(M(),j("div",Gx,[p("div",Jx,[p("div",{class:ze(["city-card__hp-fill",o.value]),style:Ki({width:s.value+"%"})},null,6)]),p("div",Yx,U(Math.floor(e.city.currentHp))+" / "+U(e.city.hp),1)])),!e.city.isUnknown&&r.value?(M(),j("div",Kx,[p("button",{class:"skill-button",onClick:Xn(a,["stop"]),disabled:!e.city.isAlive},[u[1]||(u[1]=p("span",{class:"skill-icon"},"",-1)),p("span",Qx,U(r.value.name),1),r.value.limit?(M(),j("span",Xx,U(e.city.skillUsageCount||0)+"/"+U(r.value.limit),1)):$e("",!0)],8,Zx)])):$e("",!0),e.modifiers.length>0?(M(),j("div",eB,[(M(!0),j(qe,null,en(e.modifiers,(f,m)=>(M(),j("span",{key:m,class:"modifier-badge",title:f.description},U(f.icon),9,nB))),128))])):$e("",!0),e.showActions?(M(),j("div",tB,[Sa(l.$slots,"actions",{},void 0)])):$e("",!0)],2))}},Zu=kn(iB,[["__scopeId","data-v-0b42f17c"]]),sB={class:"modal-content"},oB={class:"modal-header"},rB={class:"modal-title"},aB={class:"modal-body"},lB={class:"city-info"},cB={class:"city-name"},uB={class:"city-hp"},dB={class:"skill-badges"},fB={class:"skill-description"},mB={key:0,class:"skill-usage-info"},hB={class:"value"},pB={key:1,class:"skill-requirement"},gB={class:"value"},yB={class:"skill-effects"},CB={class:"effects-list"},vB={key:0,class:"effect-item"},_B={key:1,class:"effect-item"},$B={key:2,class:"effect-item"},wB={key:3,class:"effect-item"},bB={key:4,class:"effect-item"},AB={key:5,class:"effect-item"},PB={key:2,class:"error-message"},HB={class:"modal-footer"},xB={key:0,class:"passive-note"},BB={key:1,class:"battle-note"},SB={key:2,class:"nonbattle-note"},IB={key:3,class:"action-buttons"},kB=["disabled"],EB={__name:"CitySkillModal",props:{isVisible:{type:Boolean,default:!1},city:{type:Object,required:!0},skill:{type:Object,required:!0}},emits:["close","use-skill"],setup(e,{emit:n}){const t=e,i=n,s=Ce(""),o=Oe(()=>({[x.PASSIVE]:"",[x.ACTIVE]:"",[x.TOGGLE]:""})[t.skill.type]||""),r=Oe(()=>t.skill.category==="battle"?"":t.skill.category==="nonBattle"?"":""),a=Oe(()=>{if(s.value="",!t.city.isAlive)return s.value="",!1;if(t.skill.type===x.PASSIVE)return s.value="",!1;if(t.skill.limit){const f=t.city.skillUsageCount||0;if(f>=t.skill.limit)return s.value=` ${f} `,!1}if(t.skill.hpRequirement){const f=t.city.currentHp||t.city.hp;if(t.skill.hpRequirement.max&&f>=t.skill.hpRequirement.max)return s.value=`HP ${t.skill.hpRequirement.max} ${Math.floor(f)}`,!1;if(t.skill.hpRequirement.min&&f<=t.skill.hpRequirement.min)return s.value=`HP ${t.skill.hpRequirement.min} ${Math.floor(f)}`,!1}return!0});function l(){i("close")}function u(){a.value&&(i("use-skill",{city:t.city,skill:t.skill}),l())}return(f,m)=>e.isVisible?(M(),j("div",{key:0,class:"modal-overlay",onClick:Xn(l,["self"])},[p("div",sB,[p("div",oB,[p("h3",rB,[m[0]||(m[0]=p("span",{class:"skill-icon"},"",-1)),un(" "+U(e.skill.name),1)]),p("button",{class:"close-button",onClick:l},"")]),p("div",aB,[p("div",lB,[p("div",cB,U(e.city.name),1),p("div",uB," HP: "+U(Math.floor(e.city.currentHp))+" / "+U(e.city.hp),1)]),p("div",dB,[p("div",{class:ze(["skill-type-badge",`skill-type--${e.skill.type}`])},U(o.value),3),p("div",{class:ze(["skill-category-badge",`skill-category--${e.skill.category}`])},U(r.value),3)]),p("div",fB,U(e.skill.description),1),e.skill.limit?(M(),j("div",mB,[m[1]||(m[1]=p("span",{class:"label"},"",-1)),p("span",hB,U(e.city.skillUsageCount||0)+" / "+U(e.skill.limit),1)])):$e("",!0),e.skill.hpRequirement?(M(),j("div",pB,[m[2]||(m[2]=p("span",{class:"label"},"HP",-1)),p("span",gB,U(e.skill.hpRequirement.max?` ${e.skill.hpRequirement.max}`:"")+" "+U(e.skill.hpRequirement.min?` ${e.skill.hpRequirement.min}`:""),1)])):$e("",!0),p("div",yB,[m[9]||(m[9]=p("div",{class:"effects-title"},"",-1)),p("div",CB,[e.skill.healAmount?(M(),j("div",vB,[m[3]||(m[3]=p("span",{class:"effect-icon"},"",-1)),un("  "+U(e.skill.healAmount)+" HP ",1)])):$e("",!0),e.skill.powerBonus?(M(),j("div",_B,[m[4]||(m[4]=p("span",{class:"effect-icon"},"",-1)),un("  "+U(typeof e.skill.powerBonus=="number"&&e.skill.powerBonus<10?"+"+e.skill.powerBonus*100+"%":"+"+e.skill.powerBonus),1)])):$e("",!0),e.skill.hpBonus?(M(),j("div",$B,[m[5]||(m[5]=p("span",{class:"effect-icon"},"",-1)),un(" HP "+U("+"+e.skill.hpBonus*100+"%"),1)])):$e("",!0),e.skill.duration?(M(),j("div",wB,[m[6]||(m[6]=p("span",{class:"effect-icon"},"",-1)),un("  "+U(e.skill.duration)+"  ",1)])):$e("",!0),e.skill.shieldHp?(M(),j("div",bB,[m[7]||(m[7]=p("span",{class:"effect-icon"},"",-1)),un("  "+U(e.skill.shieldHp)+" HP ",1)])):$e("",!0),e.skill.damageReduction?(M(),j("div",AB,[m[8]||(m[8]=p("span",{class:"effect-icon"},"",-1)),un("  "+U(e.skill.damageReduction*100)+"% ",1)])):$e("",!0)])]),s.value?(M(),j("div",PB,U(s.value),1)):$e("",!0)]),p("div",HB,[e.skill.type==="passive"?(M(),j("div",xB,"   ")):e.skill.category==="battle"?(M(),j("div",BB,"   ")):e.skill.category==="nonBattle"?(M(),j("div",SB,"   ")):$e("",!0),e.skill.type!=="passive"?(M(),j("div",IB,[p("button",{class:"btn btn--secondary",onClick:l},"  "),p("button",{class:"btn btn--primary",onClick:u,disabled:!a.value},U(a.value?"":""),9,kB)])):$e("",!0)])])])):$e("",!0)}},TB=kn(EB,[["__scopeId","data-v-99ae23da"]]),RB={class:"selector-content"},NB={class:"selector-header"},MB={class:"selector-title"},DB={class:"selector-body"},qB={class:"selector-description"},LB={class:"city-list"},OB=["onClick"],UB={class:"city-option__info"},jB={class:"city-option__name"},FB={key:0,class:"city-center-badge"},VB={class:"city-option__hp"},WB={key:0,class:"city-option__check"},zB={key:0,class:"selection-info"},GB={class:"selector-footer"},JB=["disabled"],YB={__name:"CityTargetSelector",props:{isVisible:{type:Boolean,default:!1},cities:{type:Array,required:!0},title:{type:String,default:""},description:{type:String,default:""},maxSelections:{type:Number,default:1},filter:{type:Function,default:()=>!0}},emits:["close","confirm"],setup(e,{emit:n}){const t=e,i=n,s=Ce([]),o=Oe(()=>t.cities.map((h,v)=>({...h,originalIndex:v})).filter(h=>t.filter(h))),r=Oe(()=>t.maxSelections===1?s.value.length===1:s.value.length>0&&s.value.length<=t.maxSelections);function a(h,v){return s.value.some(S=>S.name===h.name&&S.originalIndex===h.originalIndex)}function l(h){return!(h.isAlive===!1||(h.currentHp||h.hp)<=0)}function u(h,v){if(!l(h))return;const S=s.value.findIndex(X=>X.name===h.name&&X.originalIndex===h.originalIndex);S>=0?s.value.splice(S,1):t.maxSelections===1?s.value=[h]:s.value.length<t.maxSelections&&s.value.push(h)}function f(){s.value=[],i("close")}function m(){r.value&&(i("confirm",{cities:[...s.value],indices:s.value.map(h=>h.originalIndex)}),s.value=[])}return(h,v)=>e.isVisible?(M(),j("div",{key:0,class:"selector-overlay",onClick:Xn(f,["self"])},[p("div",RB,[p("div",NB,[p("h3",MB,U(e.title),1),p("button",{class:"close-button",onClick:f},"")]),p("div",DB,[p("div",qB,U(e.description),1),p("div",LB,[(M(!0),j(qe,null,en(o.value,(S,X)=>(M(),j("div",{key:X,class:ze(["city-option",{"city-option--selected":a(S),"city-option--disabled":!l(S)}]),onClick:ae=>u(S)},[p("div",UB,[p("div",jB,[un(U(S.name)+" ",1),S.isCenter?(M(),j("span",FB,"")):$e("",!0)]),p("div",VB," HP: "+U(Math.floor(S.currentHp||S.hp))+" / "+U(S.hp),1)]),a(S)?(M(),j("div",WB,"  ")):$e("",!0)],10,OB))),128))]),e.maxSelections>1?(M(),j("div",zB," : "+U(s.value.length)+" / "+U(e.maxSelections),1)):$e("",!0)]),p("div",GB,[p("button",{class:"btn btn--secondary",onClick:f},"  "),p("button",{class:"btn btn--primary",onClick:m,disabled:!r.value},"  ",8,JB)])])])):$e("",!0)}},Qu=kn(YB,[["__scopeId","data-v-81fbacbd"]]);function KB(){const e=ut();function n(r,a,l,u={}){if(!t(a,l))return{success:!1,message:""};l.limit&&(a.skillUsageCount||(a.skillUsageCount=0),a.skillUsageCount++);let f={success:!0,message:""};try{if(l.healAmount){const m=u.targetCity||a,h=Math.min(l.healAmount,m.hp-m.currentHp);m.currentHp=Math.min(m.currentHp+l.healAmount,m.hp),f.message+=` ${m.name}  ${Math.floor(h)} HP`}if(l.hpBonus){const m=u.targetCity||a,h=m.hp*l.hpBonus;m.currentHp=Math.min(m.currentHp+h,m.hp),f.message+=` ${m.name}  ${l.hpBonus*100}% HP`}if(l.hpMultiplier){const m=u.targetCity||a;m.specialState||(m.specialState={}),m.specialState.hpMultiplier=l.hpMultiplier,m.specialState.duration=l.duration||1,m.specialState.startRound=e.currentRound,f.message+=`${m.name} ${l.duration}HP${l.hpMultiplier}`}if(l.powerBonus){const m=u.targetCity||a;m.modifiers||(m.modifiers=[]),m.modifiers.push({type:"power_boost",value:l.powerBonus,duration:l.duration||1,startRound:e.currentRound}),f.message+=`${m.name} `}if(l.shieldHp){e.cityShields||(e.cityShields={}),e.cityShields[r.name]||(e.cityShields[r.name]={});const m=r.cities.indexOf(a);e.cityShields[r.name][m]={hp:l.shieldHp,maxHp:l.shieldHp,duration:l.duration||3,startRound:e.currentRound},f.message+=` ${a.name}  ${l.shieldHp}HP `}if(l.damageReduction){const m=u.targetCity||a;m.modifiers||(m.modifiers=[]),m.modifiers.push({type:"damage_reduction",value:l.damageReduction,duration:l.duration||1,startRound:e.currentRound}),f.message+=`${m.name} `}if(l.hpReduction&&u.targetOpponent&&u.targetOpponentCity){const m=u.targetOpponentCity,h=m.currentHp*l.hpReduction;m.currentHp-=h,m.currentHp<=0&&(m.currentHp=0,m.isAlive=!1),f.message+=` ${m.name}  ${Math.floor(h)} HPHP`}if(l.goldPerRound&&l.duration&&(r.skillEffects||(r.skillEffects=[]),r.skillEffects.push({type:"gold_generation",amount:l.goldPerRound,duration:l.duration,startRound:e.currentRound}),f.message+=`${l.duration}${l.goldPerRound}`),l.summon&&(f.message+=` ${l.summon}`),l.skillImmune){const m=u.targetCity||a;m.modifiers||(m.modifiers=[]),m.modifiers.push({type:"skill_immune",duration:l.duration||1,startRound:e.currentRound}),f.message+=`${m.name} `}return e.addLog(`${r.name}  ${a.name} ${l.name}${f.message}`),{success:!0,message:f.message}}catch(m){return console.error(":",m),{success:!1,message:""+m.message}}}function t(r,a){if(!r.isAlive||a.type===x.PASSIVE||a.limit&&(r.skillUsageCount||0)>=a.limit)return!1;if(a.hpRequirement){const l=r.currentHp||r.hp;if(a.hpRequirement.max&&l>=a.hpRequirement.max||a.hpRequirement.min&&l<=a.hpRequirement.min)return!1}return!0}function i(r,a){const l=Un(a.name);if(!(!l||l.type!==x.PASSIVE)){if(l.limit&&(a.skillUsageCount||0)>=l.limit){e.addLog(`${a.name} ${l.name}`);return}e.addLog(`${a.name} ${l.name}`),n(r,a,l)}}function s(){const r=e.currentRound;e.players.forEach(a=>{a.cities.forEach(l=>{l.modifiers&&l.modifiers.length>0&&(l.modifiers=l.modifiers.filter(u=>r-u.startRound<u.duration)),l.specialState&&r-l.specialState.startRound>=l.specialState.duration&&(l.specialState.hpMultiplier&&(l.currentHp=Math.min(l.currentHp*l.specialState.hpMultiplier,12e4),l.hp=l.currentHp,e.addLog(`${l.name} HP ${Math.floor(l.currentHp)}`)),delete l.specialState)}),a.skillEffects&&a.skillEffects.length>0&&(a.skillEffects=a.skillEffects.filter(l=>{const u=r-l.startRound;return l.type==="gold_generation"&&u<l.duration?(a.gold+=l.amount,e.addLog(`${a.name}  ${l.amount} `),!0):u<l.duration}))}),e.cityShields&&Object.keys(e.cityShields).forEach(a=>{const l=e.cityShields[a];Object.keys(l).forEach(u=>{const f=l[u];(r-f.startRound>=f.duration||f.hp<=0)&&(delete l[u],e.addLog(`${a} `))})})}function o(r){Un(r.name)&&(r.skillUsageCount=0,r.modifiers=[])}return{executeCitySkill:n,canUseSkill:t,triggerPassiveSkill:i,updateSkillEffects:s,initializeCitySkill:o}}const ZB={class:"player-panel__header"},QB={class:"player-panel__avatar"},XB={class:"player-panel__info"},eS={class:"player-panel__name"},nS={key:0,class:"player-panel__current-badge"},tS={class:"player-panel__stats"},iS={class:"stat stat--gold"},sS={class:"stat stat--cities"},oS={key:0,class:"player-panel__cities"},rS={key:1,class:"player-panel__cities"},aS={key:2,class:"player-panel__battle-modifiers"},lS={class:"modifier-list"},cS={class:"modifier-icon"},uS={class:"modifier-name"},dS={key:0,class:"modifier-rounds"},fS={key:3,class:"player-panel__actions"},mS={__name:"PlayerPanel",props:{player:{type:Object,required:!0},isCurrentPlayer:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},showCityActions:{type:Boolean,default:!1},hideOpponentCities:{type:Boolean,default:!1}},emits:["city-click"],setup(e){const n=e,t=ut(),i=KB(),s=Ce(!1),o=Ce(null),r=Ce(null),a=Ce(!1),l=Ce(!1),u=Ce(null),f=Ce(""),m=Ce(""),h=Ce(""),v=Ce(""),S=Ce(1),X=Oe(()=>n.player.cities.filter(H=>H.isAlive===!1?!1:(H.currentHp!==void 0?H.currentHp:H.hp)>0).length);Oe(()=>{if(n.hideOpponentCities)return"";const H=n.player.cities[n.player.centerIndex||0];if(!H)return"";const q=H.currentHp!==void 0?H.currentHp:H.hp;return H.isAlive!==!1&&q>0?`${H.name} (HP: ${Math.floor(q)})`:`${H.name} ()`});const ae=Oe(()=>{const H=t.players.filter(ne=>ne.name!==n.player.name),q=[];return H.forEach(ne=>{ne.cities.forEach((me,oe)=>{t.knownCities?.[ne.name]?.[n.player.name]?.includes(oe)&&q.push({...me,ownerName:ne.name,originalIndex:oe})})}),q}),fe=Oe(()=>H=>{if(!H.isAlive||(H.currentHp||H.hp)<=0)return!1;if(u.value&&u.value.skill){const q=u.value.skill;if(q.targetHpRequirement){const ne=H.currentHp||H.hp;if(q.targetHpRequirement.max&&ne>=q.targetHpRequirement.max||q.targetHpRequirement.min&&ne<=q.targetHpRequirement.min)return!1}}return!0}),ge=Oe(()=>H=>{if(!H.isAlive||(H.currentHp||H.hp)<=0)return!1;if(u.value&&u.value.skill){const q=u.value.skill;if(q.targetHpRequirement){const ne=H.currentHp||H.hp;if(q.targetHpRequirement.max&&ne>=q.targetHpRequirement.max||q.targetHpRequirement.min&&ne<=q.targetHpRequirement.min)return!1}}return!0});function R(H){if(n.isCurrentPlayer||!n.hideOpponentCities)return!0;const q=t.currentPlayer;if(!q)return!1;const ne=t.knownCities?.[n.player.name]?.[q];return ne?ne.includes(H):!1}function Y(H){return t.protections?.[n.player.name]?.[H]>0||t.ironCities?.[n.player.name]?.[H]}function V(H){return t.protections?.[n.player.name]?.[H]||0}function ee(H){const q=[];return H.modifiers&&H.modifiers.forEach(ne=>{q.push({icon:ue(ne.type),description:de(ne.type)})}),q}function ue(H){return{damage_immunity:"",power_boost:"",reflect:"",berserk:"",defense:"",heal:"",poison:""}[H]||""}function de(H){return{damage_immunity:"",power_boost:"",reflect:"",berserk:"",defense:"",heal:"",poison:""}[H]||H}function W(H){o.value=H.city,r.value=H.skill,s.value=!0}function Q(){s.value=!1,o.value=null,r.value=null}function L(H){const q=H.skill;u.value=H,q.requiresTarget||q.requiresMultipleSelfCities?(S.value=q.targetCount||1,q.requiresTarget?q.description.includes("")||q.description.includes("")||q.description.includes("")||q.captureHpRequirement||q.targetOpponent?(h.value=` - ${q.name}`,v.value=q.description,l.value=!0):(f.value=` - ${q.name}`,m.value=q.description,a.value=!0):q.requiresMultipleSelfCities&&(f.value=`${S.value} - ${q.name}`,m.value=q.description,a.value=!0),Q()):P(H)}function P(H,q=null){const ne={...H};q&&q.length>0&&(q[0].ownerName?(ne.targetOpponent=t.players.find(oe=>oe.name===q[0].ownerName),ne.targetOpponentCity=q[0],ne.targetOpponentCities=q):(ne.targetCity=q[0],ne.targetCities=q));const me=i.executeCitySkill(n.player,H.city,H.skill,ne);me.success?(t.addLog(`${n.player.name}  ${H.city.name} ${H.skill.name}`),me.message&&t.addLog(me.message)):t.addLog(`${n.player.name} ${me.message}`),u.value=null}function G(H){u.value&&P(u.value,H.cities),$()}function _(H){u.value&&P(u.value,H.cities),A()}function $(){a.value=!1,u.value=null}function A(){l.value=!1,u.value=null}return(H,q)=>(M(),j("div",{class:ze(["player-panel",{"player-panel--active":e.isCurrentPlayer}])},[p("div",ZB,[p("div",QB,U(e.player.name.charAt(0)),1),p("div",XB,[p("h3",eS,[un(U(e.player.name)+" ",1),e.isCurrentPlayer?(M(),j("span",nS,"  ")):$e("",!0)]),p("div",tS,[p("span",iS," "+U(e.player.gold),1),p("span",sS,"  "+U(X.value)+"/"+U(e.player.cities.length),1)])])]),!e.hideOpponentCities||e.isCurrentPlayer?(M(),j("div",oS,[(M(!0),j(qe,null,en(e.player.cities,(ne,me)=>(M(),bn(Zu,{key:me,city:ne,"has-protection":Y(me),"protection-rounds":V(me),modifiers:ee(ne),"show-actions":e.isCurrentPlayer&&e.showCityActions,onClick:oe=>H.$emit("city-click",me),onSkillClick:W},{actions:Fs(()=>[Sa(H.$slots,"city-actions",{city:ne,index:me},void 0,!0)]),_:2},1032,["city","has-protection","protection-rounds","modifiers","show-actions","onClick"]))),128))])):e.hideOpponentCities&&!e.isCurrentPlayer?(M(),j("div",rS,[(M(!0),j(qe,null,en(e.player.cities,(ne,me)=>(M(),bn(Zu,{key:me,city:R(me)?ne:{name:"",hp:0,currentHp:0,isUnknown:!0},"has-protection":R(me)&&Y(me),"protection-rounds":R(me)?V(me):0,modifiers:R(me)?ee(ne):[],"show-actions":!1,class:ze({"city-unknown":!R(me)}),onSkillClick:W},null,8,["city","has-protection","protection-rounds","modifiers","class"]))),128))])):$e("",!0),e.player.battleModifiers&&e.player.battleModifiers.length>0?(M(),j("div",aS,[q[0]||(q[0]=p("h4",{class:"section-title"},"",-1)),p("div",lS,[(M(!0),j(qe,null,en(e.player.battleModifiers,(ne,me)=>(M(),j("div",{key:me,class:"modifier-item"},[p("span",cS,U(ue(ne.type)),1),p("span",uS,U(de(ne.type)),1),ne.roundsLeft?(M(),j("span",dS," ("+U(ne.roundsLeft)+") ",1)):$e("",!0)]))),128))])])):$e("",!0),e.isCurrentPlayer&&e.showActions?(M(),j("div",fS,[Sa(H.$slots,"actions",{},void 0)])):$e("",!0),o.value&&r.value?(M(),bn(TB,{key:4,"is-visible":s.value,city:o.value,skill:r.value,onClose:Q,onUseSkill:L},null,8,["is-visible","city","skill"])):$e("",!0),Ln(Qu,{"is-visible":a.value,cities:e.player.cities,title:f.value,description:m.value,maxSelections:S.value,filter:fe.value,onClose:$,onConfirm:G},null,8,["is-visible","cities","title","description","maxSelections","filter"]),ae.value.length>0?(M(),bn(Qu,{key:5,"is-visible":l.value,cities:ae.value,title:h.value,description:v.value,maxSelections:S.value,filter:ge.value,onClose:A,onConfirm:_},null,8,["is-visible","cities","title","description","maxSelections","filter"])):$e("",!0)],2))}},hS=kn(mS,[["__scopeId","data-v-09d8872a"]]),pS={class:"game-board"},gS={class:"game-board__header"},yS={class:"game-info"},CS={class:"game-info__item"},vS={class:"value"},_S={class:"game-info__item"},$S={class:"value"},wS={class:"game-actions"},bS=["onClick"],AS=["onClick"],PS=["onClick"],HS={key:0,class:"game-board__battle-area"},xS={class:"battle-area"},BS={class:"battle-area__content"},SS={key:0,class:"battle-display"},IS={class:"battle-side"},kS={class:"battle-player"},ES={class:"battle-city"},TS={class:"battle-side"},RS={class:"battle-player"},NS={class:"battle-city"},MS={key:1,class:"battle-waiting"},DS={key:1,class:"game-board__quick-skills"},qS={class:"quick-skills"},LS={class:"quick-skills__list"},OS=["disabled","onClick"],US={class:"skill-icon"},jS={class:"skill-name"},FS={class:"skill-cost"},VS={__name:"GameBoard",props:{showBattleArea:{type:Boolean,default:!1},currentBattle:{type:Object,default:null},quickSkills:{type:Array,default:()=>[{name:"",cost:1,icon:""},{name:"",cost:1,icon:""},{name:"",cost:1,icon:""}]}},emits:["show-log","show-skills","exit","use-skill","end-turn","heal-city","quick-skill"],setup(e){const n=ut(),t=Oe(()=>({"2P":"","3P":"","2v2":"2v2"})[n.gameMode]||n.gameMode),i=Oe(()=>n.players.find(a=>a.name===n.currentPlayer));function s(a){return a.name===n.currentPlayer}function o(a,l){console.log("City clicked:",a.name,l)}function r(a){return i.value?i.value.gold>=a.cost:!1}return(a,l)=>(M(),j("div",pS,[p("div",gS,[p("div",yS,[p("div",CS,[l[3]||(l[3]=p("span",{class:"label"},"",-1)),p("span",vS,U(Fe(n).currentRound),1)]),p("div",_S,[l[4]||(l[4]=p("span",{class:"label"},"",-1)),p("span",$S,U(t.value),1)])]),p("div",wS,[p("button",{class:"btn btn--secondary",onClick:l[0]||(l[0]=u=>a.$emit("show-log"))},"   "),p("button",{class:"btn btn--secondary",onClick:l[1]||(l[1]=u=>a.$emit("show-skills"))},"   "),p("button",{class:"btn btn--danger",onClick:l[2]||(l[2]=u=>a.$emit("exit"))},"   ")])]),p("div",{class:ze(["game-board__players",`players--${Fe(n).gameMode}`])},[(M(!0),j(qe,null,en(Fe(n).players,(u,f)=>(M(),bn(hS,{key:f,player:u,"is-current-player":s(u),"show-actions":s(u),"show-city-actions":s(u),"hide-opponent-cities":!s(u),onCityClick:m=>o(u,m)},{actions:Fs(()=>[s(u)?(M(),j("button",{key:0,class:"btn btn--primary",onClick:m=>a.$emit("use-skill",u)},"  ",8,bS)):$e("",!0),s(u)?(M(),j("button",{key:1,class:"btn btn--success",onClick:m=>a.$emit("end-turn",u)},"  ",8,AS)):$e("",!0)]),"city-actions":Fs(({city:m,index:h})=>[m.currentHp<m.hp?(M(),j("button",{key:0,class:"btn-small btn-small--heal",onClick:v=>a.$emit("heal-city",u,h)},"  ",8,PS)):$e("",!0)]),_:2},1032,["player","is-current-player","show-actions","show-city-actions","hide-opponent-cities","onCityClick"]))),128))],2),Fe(n).gameMode==="2P"&&e.showBattleArea?(M(),j("div",HS,[p("div",xS,[l[6]||(l[6]=p("div",{class:"battle-area__title"},"  ",-1)),p("div",BS,[e.currentBattle?(M(),j("div",SS,[p("div",IS,[p("span",kS,U(e.currentBattle.attacker),1),p("span",ES,U(e.currentBattle.attackerCity),1)]),l[5]||(l[5]=p("div",{class:"battle-vs"},"VS",-1)),p("div",TS,[p("span",RS,U(e.currentBattle.defender),1),p("span",NS,U(e.currentBattle.defenderCity),1)])])):(M(),j("div",MS," ... "))])])])):$e("",!0),i.value?(M(),j("div",DS,[p("div",qS,[l[7]||(l[7]=p("div",{class:"quick-skills__title"},"",-1)),p("div",LS,[(M(!0),j(qe,null,en(e.quickSkills,u=>(M(),j("button",{key:u.name,class:"quick-skill-btn",disabled:!r(u),onClick:f=>a.$emit("quick-skill",u)},[p("span",US,U(u.icon),1),p("span",jS,U(u.name),1),p("span",FS,""+U(u.cost),1)],8,OS))),128))])])])):$e("",!0)]))}},WS=kn(VS,[["__scopeId","data-v-67825b22"]]),zS={class:"game-log"},GS={class:"game-log__header"},JS={class:"game-log__filters"},YS={class:"log-entry__time"},KS={class:"log-entry__icon"},ZS={class:"log-entry__message"},QS={key:0,class:"log-empty"},XS={__name:"GameLog",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(e,{emit:n}){const t=e,i=ut(),s=Ce(null),o=Ce("all"),r=Oe(()=>{if(!i.logs)return[];const h=i.logs.map((v,S)=>{const X=a(v.message);return{...v,type:X,id:v.id||S}});return o.value==="all"?h:h.filter(v=>v.type===o.value)});function a(h){return h.includes("")&&h.includes("")?"skill":h.includes("")||h.includes("")||h.includes("")?"battle":(h.includes("")||h.includes(""),"system")}function l(h){return{battle:"",skill:"",system:"",info:"",warning:"",error:""}[h]||""}function u(h){if(!h)return"";const v=new Date(h);return`${v.getHours().toString().padStart(2,"0")}:${v.getMinutes().toString().padStart(2,"0")}:${v.getSeconds().toString().padStart(2,"0")}`}function f(){confirm("")&&(i.logs=[])}function m(){Qi(()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)})}return xt(()=>i.logs?.length,()=>{t.show&&m()}),xt(()=>t.show,h=>{h&&Qi(()=>{m()})}),(h,v)=>(M(),j("div",{class:ze(["game-log-modal",{"game-log-modal--show":e.show}]),onClick:v[5]||(v[5]=Xn(S=>h.$emit("close"),["self"]))},[p("div",zS,[p("div",GS,[v[6]||(v[6]=p("h3",{class:"game-log__title"}," ",-1)),p("button",{class:"close-btn",onClick:v[0]||(v[0]=S=>h.$emit("close"))},"")]),p("div",JS,[p("button",{class:ze(["filter-btn",{"filter-btn--active":o.value==="all"}]),onClick:v[1]||(v[1]=S=>o.value="all")},"  ",2),p("button",{class:ze(["filter-btn",{"filter-btn--active":o.value==="battle"}]),onClick:v[2]||(v[2]=S=>o.value="battle")},"  ",2),p("button",{class:ze(["filter-btn",{"filter-btn--active":o.value==="skill"}]),onClick:v[3]||(v[3]=S=>o.value="skill")},"  ",2),p("button",{class:ze(["filter-btn",{"filter-btn--active":o.value==="system"}]),onClick:v[4]||(v[4]=S=>o.value="system")},"  ",2)]),p("div",{class:"game-log__content",ref_key:"logContainer",ref:s},[(M(!0),j(qe,null,en(r.value,(S,X)=>(M(),j("div",{key:X,class:ze(["log-entry",`log-entry--${S.type}`])},[p("div",YS,U(u(S.timestamp)),1),p("div",KS,U(l(S.type)),1),p("div",ZS,U(S.message),1)],2))),128)),r.value.length===0?(M(),j("div",QS,[...v[7]||(v[7]=[p("span",{class:"log-empty__icon"},"",-1),p("span",{class:"log-empty__text"},"",-1)])])):$e("",!0)],512),p("div",{class:"game-log__footer"},[p("button",{class:"btn btn--secondary",onClick:f},"   "),p("button",{class:"btn btn--primary",onClick:m},"   ")])])],2))}},eI=kn(XS,[["__scopeId","data-v-ec1cc680"]]),nI={class:"game-log__header"},tI={class:"title-section"},iI={class:"log-count"},sI={class:"header-actions"},oI=["title"],rI={key:0,class:"game-log__filters"},aI={class:"log-entry__time"},lI={class:"log-entry__icon"},cI={class:"log-entry__message"},uI={key:0,class:"log-empty"},dI={__name:"GameLogPanel",setup(e){const n=ut(),t=Ce(null),i=Ce("all"),s=Ce(!1),o=Oe(()=>{if(!n.logs)return[];const m=n.logs.map((h,v)=>{const S=r(h.message);return{...h,type:S,id:h.id||v,timestamp:h.timestamp||Date.now()}});return i.value==="all"?m:m.filter(h=>h.type===i.value)});function r(m){return m.includes("")&&m.includes("")?"skill":m.includes("")||m.includes("")||m.includes("")?"battle":(m.includes("")||m.includes(""),"system")}function a(m){return{battle:"",skill:"",system:"",info:"",warning:"",error:""}[m]||""}function l(m){if(!m)return"";const h=new Date(m);return`${h.getHours().toString().padStart(2,"0")}:${h.getMinutes().toString().padStart(2,"0")}:${h.getSeconds().toString().padStart(2,"0")}`}function u(){confirm("")&&(n.logs=[])}function f(){Qi(()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)})}return xt(()=>n.logs?.length,()=>{s.value||f()},{flush:"post"}),(m,h)=>(M(),j("div",{class:ze(["game-log-panel",{collapsed:s.value}])},[p("div",nI,[p("div",tI,[h[5]||(h[5]=p("h3",{class:"game-log__title"}," ",-1)),p("span",iI,"("+U(o.value.length)+")",1)]),p("div",sI,[p("button",{class:"icon-btn",onClick:f,title:""},"  "),p("button",{class:"icon-btn",onClick:u,title:""},"  "),p("button",{class:"icon-btn",onClick:h[0]||(h[0]=v=>s.value=!s.value),title:s.value?"":""},U(s.value?"":""),9,oI)])]),s.value?$e("",!0):(M(),j("div",rI,[p("button",{class:ze(["filter-btn",{"filter-btn--active":i.value==="all"}]),onClick:h[1]||(h[1]=v=>i.value="all")},"  ",2),p("button",{class:ze(["filter-btn",{"filter-btn--active":i.value==="battle"}]),onClick:h[2]||(h[2]=v=>i.value="battle")},"  ",2),p("button",{class:ze(["filter-btn",{"filter-btn--active":i.value==="skill"}]),onClick:h[3]||(h[3]=v=>i.value="skill")},"  ",2),p("button",{class:ze(["filter-btn",{"filter-btn--active":i.value==="system"}]),onClick:h[4]||(h[4]=v=>i.value="system")},"  ",2)])),s.value?$e("",!0):(M(),j("div",{key:1,class:"game-log__content",ref_key:"logContainer",ref:t},[(M(!0),j(qe,null,en(o.value,(v,S)=>(M(),j("div",{key:S,class:ze(["log-entry",`log-entry--${v.type}`])},[p("div",aI,U(l(v.timestamp)),1),p("div",lI,U(a(v.type)),1),p("div",cI,U(v.message),1)],2))),128)),o.value.length===0?(M(),j("div",uI,[...h[6]||(h[6]=[p("span",{class:"log-empty__icon"},"",-1),p("span",{class:"log-empty__text"},"",-1)])])):$e("",!0)],512))],2))}},fI=kn(dI,[["__scopeId","data-v-106cb67b"]]),mI={key:0,class:"roster-refill-panel panel"},hI={key:0,class:"refill-content"},pI={class:"muted warning-text"},gI={class:"city-list"},yI={class:"city-grid"},CI=["onClick"],vI={class:"city-name"},_I={key:0,class:"center-badge"},$I={class:"city-hp"},wI={key:1,class:"refill-content"},bI={class:"muted info-text"},AI={class:"city-list"},PI={class:"city-grid"},HI=["onClick"],xI={class:"city-name"},BI={class:"city-hp"},SI={__name:"RosterRefill",props:{player:{type:Object,required:!0},playerState:{type:Object,required:!0},gameMode:{type:String,default:"2P"}},emits:["refill-confirmed"],setup(e,{emit:n}){const t=e,i=n,{showNotification:s}=pi(),o=Ce([]),r=Oe(()=>t.playerState?.needsRosterRefill===!0),a=Oe(()=>t.playerState?.rosterRefillReason===""),l=Oe(()=>t.gameMode==="2v2"?4:5),u=Oe(()=>t.player.roster?t.player.roster.filter(fe=>{const ge=t.player.cities[fe],R=t.playerState.deadCities?.includes(fe),Y=ge?.currentHp!==void 0?ge.currentHp:ge?.hp;return!R&&Y>0}).length:0),f=Oe(()=>l.value-u.value),m=Oe(()=>t.player.centerIndex!==void 0?t.player.centerIndex:0),h=Oe(()=>t.player.cities?t.player.cities.map((ae,fe)=>({city:ae,idx:fe})).filter(({city:ae,idx:fe})=>!t.playerState.deadCities?.includes(fe)&&(ae.currentHp||ae.hp)>0):[]),v=Oe(()=>t.player.cities?t.player.cities.map((ae,fe)=>({city:ae,idx:fe})).filter(({city:ae,idx:fe})=>{const ge=t.playerState.deadCities?.includes(fe),R=t.player.roster?.includes(fe);return!ge&&!R&&(ae.currentHp||ae.hp)>0}):[]);function S(ae){const fe=o.value.indexOf(ae);fe>-1?o.value.splice(fe,1):o.value.push(ae)}function X(){if(o.value.length===0){s("","warning");return}if(a.value){if(o.value.length!==l.value){s(`${l.value}${o.value.length}`,"warning");return}if(!o.value.includes(m.value)){s("","error");return}i("refill-confirmed",{mode:"reselection",cities:o.value})}else{if(u.value+o.value.length>l.value){s(`${l.value}${u.value}${l.value-u.value}`,"warning");return}i("refill-confirmed",{mode:"append",cities:o.value})}o.value=[]}return xt(r,ae=>{ae&&(o.value=[])}),(ae,fe)=>r.value?(M(),j("div",mI,[fe[4]||(fe[4]=p("h2",{style:{color:"var(--warn)","text-align":"center"}}," ",-1)),a.value?(M(),j("div",hI,[p("div",pI,[un("  "+U(l.value)+"  ",1),fe[0]||(fe[0]=p("span",{style:{color:"var(--error)"}},"",-1)),fe[1]||(fe[1]=un(" ",-1))]),p("div",gI,[fe[2]||(fe[2]=p("label",null,"",-1)),p("div",yI,[(M(!0),j(qe,null,en(h.value,({city:ge,idx:R},Y)=>(M(),j("div",{key:R,class:ze(["city-option",{selected:o.value.includes(R),center:R===m.value}]),onClick:V=>S(R)},[p("div",vI,[un(U(ge.name)+" ",1),R===m.value?(M(),j("span",_I,"")):$e("",!0)]),p("div",$I,"HP: "+U(Math.floor(ge.currentHp||ge.hp)),1)],10,CI))),128))])]),p("button",{class:"confirm-btn",onClick:X},"  ")])):(M(),j("div",wI,[p("div",bI,"  "+U(u.value)+" / "+U(l.value)+"  "+U(f.value)+"  ",1),p("div",AI,[fe[3]||(fe[3]=p("label",null,"",-1)),p("div",PI,[(M(!0),j(qe,null,en(v.value,({city:ge,idx:R},Y)=>(M(),j("div",{key:R,class:ze(["city-option",{selected:o.value.includes(R)}]),onClick:V=>S(R)},[p("div",xI,U(ge.name),1),p("div",BI,"HP: "+U(Math.floor(ge.currentHp||ge.hp)),1)],10,HI))),128))])]),p("button",{class:"confirm-btn",onClick:X},"  ")]))])):$e("",!0)}},II=kn(SI,[["__scopeId","data-v-da09ff90"]]),kI={id:"playerMode"},EI={class:"player-container"},TI={class:"victory-content"},RI={class:"victory-title"},NI={class:"victory-stats"},MI={class:"stat-item"},DI={class:"stat-value"},qI={class:"stat-item"},LI={class:"stat-value"},OI={class:"stat-item"},UI={class:"stat-value"},jI={__name:"PlayerModeOnline",emits:["exit"],setup(e,{emit:n}){const t=n,i=ut(),{leaveRoom:s,getRoomData:o,saveRoomData:r,startRoomListener:a,stopRoomListener:l}=oc(),u=C2(),{drawCities:f,getUsedNames:m}=Mh(),h=Ce("firebase-config"),v=Ce(""),S=Ce(!1),X=Ce(null),ae=Ce(!1),fe=Ce(!1),ge=Ce(!1),R=Ce(null),Y=Ce("2P"),V=Ce(null),ee=Ce([]),ue=Ce(1);let de=null;as(()=>{O_()&&(h.value="room-selection")});function W(){h.value="room-selection"}function Q(){h.value="room-selection"}function L(k){v.value=k,h.value="waiting-room"}function P({roomId:k,roomData:D,isRoomFull:B}){v.value=k,S.value=B,X.value=D,Y.value=D.mode||"2P",h.value="waiting-room"}async function G(k){console.log("[PlayerMode] ",k);const D=await o(v.value);if(D){const B=D.players.find(J=>J.name===R.value?.name);B&&(console.log("[PlayerMode] handleAllReady - currentPlayer"),console.log("[PlayerMode] :",B.name),console.log("[PlayerMode] :",B.cities.length),console.log("[PlayerMode] :",B.cities.map(J=>J.name)),console.log("[PlayerMode] "),R.value=B,Y.value=D.mode||"2P",Y.value==="2P"||Y.value==="2v2"?(h.value="center-city-selection",console.log("[PlayerMode] ")):(h.value="roster-selection",console.log("[PlayerMode] ")))}}function _({name:k,asSpectator:D}){console.log("[PlayerMode] ",{name:k,asSpectator:D}),R.value||(R.value={name:k})}async function $(k){if(V.value=k,v.value&&R.value){const D=await o(v.value);if(D){const B=D.players.findIndex(J=>J.name===R.value.name);B!==-1&&(D.players[B].centerIndex=k,await r(v.value,D),console.log("[PlayerMode] cities"))}}}async function A(k){if(V.value=k,console.log("[PlayerMode] "),console.log("[PlayerMode] handleCenterConfirmed - currentPlayer:",R.value?.name),console.log("[PlayerMode] handleCenterConfirmed - cities:",R.value?.cities?.map(D=>D.name)),v.value&&R.value){const D=await o(v.value);if(D){const B=D.players.find(J=>J.name===R.value.name);B&&(R.value={...B,cities:R.value.cities},console.log("[PlayerMode] centerIndexcities"))}}h.value="roster-selection"}async function H(){if(console.log("[PlayerMode] "),ue.value>=5){console.warn("[PlayerMode] ");return}if(!v.value||!R.value){console.error("[PlayerMode] ");return}try{const k=await o(v.value);if(!k){console.error("[PlayerMode] ");return}const D=k.players.findIndex(Z=>Z.name===R.value.name);if(D===-1){console.error("[PlayerMode] ");return}const B=m(k.players,D),J=Y.value==="2v2"?7:10,se=f(J,B);k.players[D].cities=se,k.players[D].centerIndex=null,k.players[D].roster=[],await r(v.value,k);const te=k.players[D];console.log("[PlayerMode] currentPlayer"),console.log("[PlayerMode] :",te.cities.map(Z=>Z.name)),R.value=te,V.value=null,ee.value=[],ue.value++,console.log("[PlayerMode] ",te.cities.length,"")}catch(k){console.error("[PlayerMode] :",k)}}async function q(k){if(ee.value=k,v.value&&R.value){const D=await o(v.value);if(D){const B=D.players.findIndex(J=>J.name===R.value.name);B!==-1&&(D.players[B].roster=k,await r(v.value,D))}}}async function ne(k){if(ee.value=k,console.log("[PlayerMode] "),v.value&&R.value){const D=await o(v.value);if(D){const B=D.players.findIndex(se=>se.name===R.value.name);B!==-1&&(D.players[B].roster=k,D.players[B].ready=!0,await r(v.value,D)),rn(D);const J=D.players.find(se=>se.name===R.value.name);J&&(console.log("[PlayerMode] currentPlayerroomData"),console.log("[PlayerMode] currentPlayer.cities:",R.value.cities.map(se=>se.name)),R.value=J,console.log("[PlayerMode] currentPlayer.cities:",R.value.cities.map(se=>se.name)),console.log("[PlayerMode] roster:",R.value.roster))}}h.value="city-deployment"}async function me(){confirm("")&&(de&&(l(),de=null),v.value&&R.value&&await s(v.value,R.value.name),t("exit"))}lo(()=>{de&&(l(),de=null)});function oe(k){console.log("[PlayerMode] ",k)}async function ve(){if(console.log("[PlayerMode] "),!v.value||!R.value){console.error("[PlayerMode] ");return}const k=await o(v.value);if(!k){console.error("[PlayerMode] ");return}i.updateRoundStates(),console.log("[PlayerMode] "),i.qinwang=null,i.cmjb=null,i.ironwall=null,i.foresee=null,i.yujia=null,Object.keys(i.reflect).forEach(D=>delete i.reflect[D]),Object.keys(i.forceDeployTwo).forEach(D=>delete i.forceDeployTwo[D]),Object.keys(i.cannotStandDown).forEach(D=>delete i.cannotStandDown[D]),Object.keys(i.sdxj).forEach(D=>delete i.sdxj[D]),Object.keys(i.yiyidl).forEach(D=>delete i.yiyidl[D]),Object.keys(i.wwjz).forEach(D=>delete i.wwjz[D]),Object.keys(i.dizzy).forEach(D=>delete i.dizzy[D]),Object.keys(i.ccjj).forEach(D=>delete i.ccjj[D]),i.gawhUser=null,Object.keys(i.tblj).forEach(D=>delete i.tblj[D]),console.log("[PlayerMode] "),i.currentRound++,console.log(`[PlayerMode]  ${i.currentRound} `),k.players.forEach((D,B)=>{const J=i.players.find(se=>se.name===D.name);J&&(D.cities=J.cities.map(se=>({...se,currentHp:se.currentHp,isAlive:se.isAlive!==!1})),D.gold=J.gold)}),k.gameState||(k.gameState={}),k.gameState.currentRound=i.currentRound,await r(v.value,k),console.log("[PlayerMode] Firebase"),i.addLog(` ${i.currentRound} `)}function _e(k){console.log("[PlayerMode] ",k)}function Ye(k){console.log("[PlayerMode] ",k)}async function Qe(k){if(console.log("[PlayerMode] ",k),fe.value=!1,!k||!k.skillName){console.error("[PlayerMode] ");return}if(!v.value||!R.value){console.error("[PlayerMode] ");return}const D=await o(v.value);if(!D){console.error("[PlayerMode] ");return}const B=i.players.find(We=>We.name===R.value.name);if(!B){console.error("[PlayerMode] ");return}const{skillName:J,targetPlayerName:se,targetCityIdx:te,selfCityIdx:Z,amount:pe}=k;let ce=null;if(se&&(ce=i.players.find(We=>We.name===se),!ce)){console.error("[PlayerMode] ");return}let xe=null;ce&&te!==void 0&&te!==null&&(xe=ce.cities[te]);let Te=null;Z!=null&&(Te=B.cities[Z]);const we=await ua(()=>Promise.resolve().then(()=>fH),void 0),le=await ua(()=>Promise.resolve().then(()=>mH),void 0);let Ve=null;try{const We={:()=>we.useBattleSkills().executeQinZeiQinWang(B,ce),:()=>we.useBattleSkills().executeCaoMuJieBing(B,ce),:()=>we.useBattleSkills().executeYueZhanYueYong(B,Te),:()=>we.useBattleSkills().executeXiYinGongJi(B,Te),:()=>we.useBattleSkills().executeTongQiangTieBi(B,ce),:()=>we.useBattleSkills().executeBeiShuiYiZhan(B,Te),:()=>we.useBattleSkills().executeLiaoShiRuShen(B,ce,xe),:()=>we.useBattleSkills().executeTongGuiYuJin(B,Te),:()=>we.useBattleSkills().executeSetBarrier(B),:()=>we.useBattleSkills().executeQianNengJiFa(B),:()=>we.useBattleSkills().executeYuJiaQinZheng(B,ce),:()=>we.useBattleSkills().executeKuangBaoMoShi(B,Te),:()=>we.useBattleSkills().executeAnBingBuDong(B),:()=>we.useBattleSkills().executeJiLaiZeAn(B,Te),:()=>we.useBattleSkills().executeFanGeYiJi(B,ce),:()=>we.useBattleSkills().executeAnDuChenCang(B),:()=>we.useBattleSkills().executeShengDongJiXi(B,ce),:()=>we.useBattleSkills().executeYiYiDaiLao(B,ce),:()=>we.useBattleSkills().executeCaoChuanJieJian(B,ce),:()=>we.useBattleSkills().executeWeiWeiJiuZhao(B,ce),:()=>we.useBattleSkills().executeYuQinGuZong(B,ce,xe),:()=>we.useBattleSkills().executeYunTouZhuanXiang(B,ce),:()=>we.useBattleSkills().executeGeAnGuanHuo(B,ce),:()=>we.useBattleSkills().executeTiaoBoBaoLiJian(B,ce),:()=>we.useBattleSkills().executeChenHuoDaJie(B,ce),:()=>we.useBattleSkills().executeYuSuiWaQuan(B,ce,te),:()=>we.useBattleSkills().executeHeZongLianHeng(B,ce),:()=>we.useBattleSkills().executeMuBuZhuanJing(B,ce),:()=>we.useBattleSkills().executePaoZhuanYinYu(B)},Pn={:()=>le.useNonBattleSkills().executeTransferGold(B,ce,pe),:()=>le.useNonBattleSkills().executeGoldLoan(B),:()=>le.useNonBattleSkills().executeFinancialCrisis(B),:()=>le.useNonBattleSkills().executeFuDiChouXin(B,ce),:()=>le.useNonBattleSkills().executeChenHuoDaJie(B,ce),:()=>le.useNonBattleSkills().executeJiHuaDanLie(B,Z),:()=>le.useNonBattleSkills().executeWuZhongShengYou(B),:()=>le.useNonBattleSkills().executeQuickHeal(B,Z),:()=>le.useNonBattleSkills().executeAdvancedHeal(B,[Z]),:()=>le.useNonBattleSkills().executeJieShiHuanHun(B,Z),:()=>le.useNonBattleSkills().executeShiLiZengQiang(B),:()=>le.useNonBattleSkills().executeShiQiDaZhen(B),:()=>le.useNonBattleSkills().executeGouYanCanChuan(B),:()=>le.useNonBattleSkills().executeZhongZhiChengCheng(B),:()=>le.useNonBattleSkills().executeHuanRanYiXin(B,Z),:()=>le.useNonBattleSkills().executeHouJiBaoFa(B,Z),:()=>le.useNonBattleSkills().executeHpBank(B,Z,pe),:()=>le.useNonBattleSkills().executeCityProtection(B,Z),:()=>le.useNonBattleSkills().executeIronCity(B,Z),:()=>le.useNonBattleSkills().executeDingHaiShenZhen(B,Z),:()=>le.useNonBattleSkills().executeJianBuKeCui(B),:()=>le.useNonBattleSkills().executeBuBuGaoSheng(B,Z),:()=>le.useNonBattleSkills().executeHaiShiShenLou(B),:()=>le.useNonBattleSkills().executeFuZhongXinZhi(B,Z),:()=>le.useNonBattleSkills().executeShengYuZiShi(B,Z),:()=>le.useNonBattleSkills().executeShenCangBuLu(B,Te),:()=>le.useNonBattleSkills().executeJiNengBaoHu(B,J),:()=>le.useNonBattleSkills().executeWuZhiWuWei(B,ce,Z),:()=>le.useNonBattleSkills().executeTiDengDingSun(B,ce,te),:()=>le.useNonBattleSkills().executeLianXuDaJi(B,ce),:()=>le.useNonBattleSkills().executeBotaoXiongYong(B,ce),:()=>le.useNonBattleSkills().executeKuangHongLanZha(B,ce),:()=>le.useNonBattleSkills().executeHengSaoYiKong(B,ce),:()=>le.useNonBattleSkills().executeWanJianQiFa(B,ce),:()=>le.useNonBattleSkills().executeJiangWeiDaJi(B,ce,te),:()=>le.useNonBattleSkills().executeDingShiBaoPo(B,ce,te),:()=>le.useNonBattleSkills().executeYongJiuCuiHui(B,ce,te),:()=>le.useNonBattleSkills().executeLianSuoFanYing(B,ce,te),:()=>le.useNonBattleSkills().executeJinZhiNiuQu(B,ce,te),:()=>le.useNonBattleSkills().executeZhengQiHuaYi(B,ce),:()=>le.useNonBattleSkills().executeTianZaiRenHuo(B,ce),:()=>le.useNonBattleSkills().executeZiXiangCanSha(B,ce),:()=>le.useNonBattleSkills().executeZhongYongZhiDao(B,ce),:()=>le.useNonBattleSkills().executeYiWeiPingDi(B,ce,te),:()=>le.useNonBattleSkills().executeZhaoXianNaShi(B,ce,te),:()=>le.useNonBattleSkills().executeXianShengDuoRen(B),:()=>le.useNonBattleSkills().executeShiLaiYunZhuan(B,Z),:()=>le.useNonBattleSkills().executeRenZhiJiaoHuan(B,ce,Z,te),:()=>le.useNonBattleSkills().executeGaiXianGengZhang(B),:()=>le.useNonBattleSkills().executeBaQiYiZhi(B,Z),:()=>le.useNonBattleSkills().executeBiErBuJian(B,Z),:()=>le.useNonBattleSkills().executeHuJiaHuWei(B,Z),:()=>le.useNonBattleSkills().executeLiDaiTaoJiang(B,Z,te),:()=>le.useNonBattleSkills().executeHaoGaoWuYuan(B,ce,Z,te),:()=>le.useNonBattleSkills().executeShuWeiFanZhuan(B,Z),:()=>le.useNonBattleSkills().executeZhanLueZhuanYi(B,Z,te),:()=>le.useNonBattleSkills().executeDaoFanTianGang(B,ce,te),:()=>le.useNonBattleSkills().executeCityDetective(B,ce,te),:()=>le.useNonBattleSkills().executeCityProphecy(B,ce),:()=>le.useNonBattleSkills().executeMingChaQiuHao(B,ce),:()=>le.useNonBattleSkills().executeYiJuLiangDe(B,ce),:()=>le.useNonBattleSkills().executeBuLuZongJi(B,Z),:()=>le.useNonBattleSkills().executeBoXueDuoCai(B,Z),:()=>le.useNonBattleSkills().executeSiMianChuGe(B,ce),"":()=>le.useNonBattleSkills().executeBanYunJiuBing(B,Z,!1),"":()=>le.useNonBattleSkills().executeBanYunJiuBing(B,Z,!0),:()=>le.useNonBattleSkills().executeDaYiMieQin(B,Z),:()=>le.useNonBattleSkills().executeQiangZhiBanYun(B,ce,te),:()=>le.useNonBattleSkills().executeDaiXingShengQuan(B,Z),:()=>le.useNonBattleSkills().executeShouWangXiangZhu(B,Z),:()=>le.useNonBattleSkills().executeXingZhengZhongXin(B,Z),:()=>le.useNonBattleSkills().executeYiLiLaiJiang(B,ce,te),"":()=>le.useNonBattleSkills().executeChenQiBuBei(B,ce,null),"":()=>le.useNonBattleSkills().executeChenQiBuBei(B,ce,te),:()=>le.useNonBattleSkills().executeWuXieKeJi(B,ce),:()=>le.useNonBattleSkills().executeShiBanGongBei(B,ce,J),:()=>le.useNonBattleSkills().executeGuoHeChaiQiao(B),:()=>le.useNonBattleSkills().executeJieChuFengSuo(B),:()=>le.useNonBattleSkills().executeYiChuJiFa(B,ce,te),:()=>le.useNonBattleSkills().executeTuPoiPingJing(B,Z),:()=>le.useNonBattleSkills().executeDangJiLiDuan(B,ce),"":()=>le.useNonBattleSkills().executeQiangZhiQianDu(B,ce,!1),"":()=>le.useNonBattleSkills().executeQiangZhiQianDu(B,ce,!0),:()=>le.useNonBattleSkills().executeYanTingJiCong(B,ce,Z,te),:()=>le.useNonBattleSkills().executeDianCiGanYing(B,ce,te)};if(We[J])Ve=We[J]();else if(Pn[J])Ve=Pn[J]();else{console.warn("[PlayerMode] :",J),i.addLog(` ${J} `);return}Ve&&Ve.success?(i.addLog(Ve.message||`${J} `),console.log("[PlayerMode] :",Ve),D.players.forEach(wn=>{const fn=i.players.find(Sn=>Sn.name===wn.name);fn&&(wn.cities=fn.cities.map(Sn=>({...Sn,currentHp:Sn.currentHp,isAlive:Sn.isAlive!==!1})),wn.gold=fn.gold)}),await r(v.value,D),console.log("[PlayerMode] Firebase")):(i.addLog(Ve?.message||`${J} `),console.error("[PlayerMode] :",Ve))}catch(We){console.error("[PlayerMode] :",We),i.addLog(`: ${We.message}`)}}async function on({cities:k,skill:D,activatedCitySkills:B}){if(console.log("[PlayerMode] ",{cities:k,skill:D,activatedCitySkills:B}),console.log("[PlayerMode] currentPlayer.name:",R.value?.name),console.log("[PlayerMode] currentPlayer.cities:"),R.value?.cities.forEach((J,se)=>{console.log(`  [${se}] ${J.name} (HP: ${J.currentHp??J.hp})`)}),v.value&&R.value){const J=await o(v.value);if(!J){console.error("[PlayerMode] ");return}J.gameState||(J.gameState={currentRound:1,playerStates:{},barrier:null,protections:{},ironCities:{},strengthBoost:{},morale:{},yqgzMarks:[],battleLogs:[]}),J.gameState.playerStates[R.value.name]||(J.gameState.playerStates[R.value.name]={currentBattleCities:[],battleGoldSkill:null,deadCities:[],usedSkills:[],activatedCitySkills:{}});const se=J.gameState.playerStates[R.value.name];se.currentBattleCities=k.map(Z=>({cityIdx:Z,isStandGroundCity:D===""})),se.battleGoldSkill=D||null,se.activatedCitySkills=B||{},await r(v.value,J),console.log("[PlayerMode] "),rn(J);const te=J.players.find(Z=>Z.name===R.value.name);te&&(console.log("[PlayerMode] handleDeploymentConfirmed - currentPlayer"),R.value=te),h.value="game",Ge()}}function rn(k){if(!k){console.warn("[PlayerMode] syncRoomDataToGameStore - roomData ");return}if(console.log("[PlayerMode]  gameStore"),i.gameMode=k.mode||"2P",!k.players||!Array.isArray(k.players)){console.warn("[PlayerMode] syncRoomDataToGameStore - roomData.players ");return}k.players.forEach(D=>{if(!D||!D.cities||!Array.isArray(D.cities)){console.warn("[PlayerMode] syncRoomDataToGameStore - ",D);return}const B=i.players.find(Z=>Z.name===D.name),J=D.cities.map((Z,pe)=>{const ce=B?.cities[pe],xe=ce?.currentHp!==void 0?ce.currentHp:Z.hp,Te=xe>0;return{...Z,currentHp:xe,isAlive:Te}}),se=i.players.findIndex(Z=>Z.name===D.name),te={name:D.name,gold:D.gold||2,cities:J,centerIndex:D.centerIndex,roster:D.roster||[],battleModifiers:[]};se>=0?i.players[se]=te:i.players.push(te)}),k.gameState&&(i.currentRound=k.gameState.currentRound||1,k.gameState.playerStates&&(i.playerStates=k.gameState.playerStates,console.log("[PlayerMode] playerStatesgameStore"))),console.log("[PlayerMode] gameStore:",i.players.length)}function Ge(){v.value&&(console.log("[PlayerMode] "),de=a(v.value,async k=>{console.log("[PlayerMode] ",k),rn(k);const D=k.players.find(B=>B.name===R.value?.name);D&&(console.log("[PlayerMode]  - currentPlayer"),R.value=D),k.gameState&&(i.currentRound=k.gameState.currentRound||1,k.gameState.battleLogs&&Array.isArray(k.gameState.battleLogs)&&(i.clearLogs(),k.gameState.battleLogs.forEach(J=>{i.logs.push(J)}),console.log(`[PlayerMode] ${k.gameState.battleLogs.length}`)),k.players.every(J=>{const se=k.gameState.playerStates[J.name];return se&&(se.currentBattleCities&&se.currentBattleCities.length>0||se.battleGoldSkill==="")})&&!k.gameState.battleProcessed&&(console.log("[PlayerMode] "),k.players[0].name===R.value.name&&await gn(k)),k.gameState.battleProcessed&&h.value==="game"&&(console.log("[PlayerMode] "),console.log("[PlayerMode] currentStep:",h.value),setTimeout(async()=>{if(console.log("[PlayerMode] 3"),k.gameState.gameOver){console.log("[PlayerMode] :",k.gameState.winner),ge.value=!0;return}const J=k.gameState.playerStates[R.value.name];console.log("[PlayerMode] :",J),console.log("[PlayerMode] needsRosterRefill:",J?.needsRosterRefill),console.log("[PlayerMode] rosterRefillReason:",J?.rosterRefillReason),J&&J.needsRosterRefill?console.log("[PlayerMode] gameRosterRefill"):(console.log("[PlayerMode] "),k.players[0].name===R.value.name&&(console.log("[PlayerMode] "),k.gameState.currentRound++,k.gameState.battleProcessed=!1,Object.keys(k.gameState.playerStates).forEach(se=>{k.gameState.playerStates[se].currentBattleCities=[],k.gameState.playerStates[se].battleGoldSkill=null}),await r(v.value,k),console.log("[PlayerMode] ")),console.log("[PlayerMode] city-deployment"),h.value="city-deployment")},3e3)))}))}async function gn(k){console.log("[PlayerMode] "),k.gameState.battleLogs||(k.gameState.battleLogs=[]),i.clearLogs();const D=k.mode||"2P";console.log(`[PlayerMode] : ${D}`);const{executePreBattleChecks:B}=await ua(async()=>{const{executePreBattleChecks:se}=await import("./preBattleChecks-B6PPrWff.js");return{executePreBattleChecks:se}},[]);if(B(i,k.gameState,k.players,D)){console.log("[PlayerMode] "),k.gameState.battleLogs=[...i.logs],k.gameState.battleProcessed=!0,await r(v.value,k);return}D==="3P"||D==="3p"?u.battle3P(k.players,k.gameState):D==="2v2"||D==="2V2"?u.battle2v2(k.players,k.gameState):u.battle2P(k.players,k.gameState);for(const se of k.players){for(let te=0;te<se.cities.length;te++){const Z=se.cities[te];Z.currentHp<=0&&Z.isAlive!==!1&&(Z.isAlive=!1,i.handleBuBuGaoShengSummon(se,te,Z))}i.checkCenterDeathAndPurpleChamberInheritance(se)}if(k.gameState.battleLogs=[...i.logs],k.gameState.battleProcessed=!0,console.log("[PlayerMode] battleProcessed=true"),u.isGameOver.value){console.log("[PlayerMode] "),k.gameState.gameOver=!0,k.gameState.winner=u.winner.value?.name||"",await r(v.value,k),ge.value=!0;return}await r(v.value,k),console.log("[PlayerMode] needsRosterRefill")}function An(){console.log("[PlayerMode] "),h.value="room-selection",v.value="",R.value=null,V.value=null,ee.value=[]}const lt=Oe(()=>!v.value||!R.value?!1:T()?.needsRosterRefill===!0);function T(){return i.playerStates?.[R.value?.name]||{}}async function F({mode:k,cities:D}){if(console.log("[PlayerMode] ",{mode:k,cities:D}),!v.value||!R.value){console.error("[PlayerMode] ");return}const B=await o(v.value);if(!B){console.error("[PlayerMode] ");return}const J=B.players.find(te=>te.name===R.value.name);if(!J){console.error("[PlayerMode] ");return}const se=B.gameState.playerStates[J.name];if(!se){console.error("[PlayerMode] ");return}if(k==="reselection")J.roster=D,se.needsRosterRefill=!1,se.rosterRefillReason=null,await r(v.value,B),console.log("[PlayerMode] ");else{D.forEach(Z=>{J.roster.includes(Z)||J.roster.push(Z)});const te=B.mode==="2v2"?4:5;J.roster.length>=te&&(se.needsRosterRefill=!1,se.rosterRefillReason=null),await r(v.value,B),console.log("[PlayerMode] ")}rn(B),R.value=J,ee.value=J.roster,console.log("[PlayerMode] roster:",J.roster),console.log("[PlayerMode] roster:",J.roster.map(te=>J.cities[te]?.name)),console.log("[PlayerMode] "),h.value="city-deployment"}return(k,D)=>(M(),j("div",kI,[h.value!=="menu"?(M(),j("button",{key:0,class:"exit-btn",onClick:me}," ")):$e("",!0),p("div",EI,[h.value==="firebase-config"?(M(),bn(k2,{key:0,onInitialized:W,onSkip:Q})):$e("",!0),h.value==="room-selection"?(M(),bn(q2,{key:1,onRoomCreated:L,onRoomJoined:P})):$e("",!0),h.value==="waiting-room"?(M(),bn(SP,{key:2,"room-id":v.value,"force-spectator":S.value,"initial-room-data":X.value,onAllReady:G,onPlayerJoined:_},null,8,["room-id","force-spectator","initial-room-data"])):$e("",!0),h.value==="center-city-selection"?(M(),bn(JP,{key:3,"player-name":R.value?.name||"",cities:R.value?.cities||[],"initial-center-index":V.value,"current-draw-count":ue.value,onCenterSelected:$,onConfirm:A,onRedraw:H},null,8,["player-name","cities","initial-center-index","current-draw-count"])):$e("",!0),h.value==="roster-selection"?(M(),bn(lH,{key:4,"player-name":R.value?.name||"",cities:R.value?.cities||[],mode:Y.value,"center-index":V.value,"initial-roster":ee.value,onRosterUpdated:q,onConfirm:ne},null,8,["player-name","cities","mode","center-index","initial-roster"])):$e("",!0),h.value==="city-deployment"?(M(),bn(Ux,{key:5,"current-player":R.value,"roster-cities":ee.value,"game-mode":Y.value,onConfirm:on,onCancel:me},null,8,["current-player","roster-cities","game-mode"])):$e("",!0),h.value==="game"?(M(),bn(WS,{key:6,"show-battle-area":!1,"current-battle":null,onShowLog:D[0]||(D[0]=B=>ae.value=!0),onShowSkills:D[1]||(D[1]=B=>fe.value=!0),onExit:me,onUseSkill:oe,onEndTurn:ve,onHealCity:_e,onQuickSkill:Ye})):$e("",!0)]),h.value==="game"&&R.value&&lt.value?(M(),bn(II,{key:1,player:R.value,"player-state":T(),"game-mode":Y.value,onRefillConfirmed:F},null,8,["player","player-state","game-mode"])):$e("",!0),h.value!=="game"&&h.value!=="city-deployment"?(M(),bn(eI,{key:2,show:ae.value,onClose:D[2]||(D[2]=B=>ae.value=!1)},null,8,["show"])):$e("",!0),h.value==="game"||h.value==="city-deployment"?(M(),bn(fI,{key:3})):$e("",!0),fe.value?(M(),bn(Lh,{key:4,"current-player":R.value,onClose:D[3]||(D[3]=B=>fe.value=!1),onSkillSelected:Qe},null,8,["current-player"])):$e("",!0),ge.value&&Fe(u)?.isGameOver?.value?(M(),j("div",{key:5,class:"victory-modal",onClick:Xn(me,["self"])},[p("div",TI,[D[7]||(D[7]=p("div",{class:"victory-animation"},[p("div",{class:"trophy"},""),p("div",{class:"fireworks"},"")],-1)),p("h2",RI,U(Fe(u).winner.value?.name)+"  ",1),p("div",NI,[p("div",MI,[D[4]||(D[4]=p("span",{class:"stat-label"},"",-1)),p("span",DI,U(Fe(i).currentRound),1)]),p("div",qI,[D[5]||(D[5]=p("span",{class:"stat-label"},"",-1)),p("span",LI,U(Fe(u).winner.value?.gold||0),1)]),p("div",OI,[D[6]||(D[6]=p("span",{class:"stat-label"},"",-1)),p("span",UI,U(Fe(u).winner.value?.cities?.filter(B=>B.isAlive).length||0),1)])]),p("div",{class:"victory-actions"},[p("button",{class:"victory-btn victory-btn--restart",onClick:An},"   "),p("button",{class:"victory-btn victory-btn--exit",onClick:me},"   ")])])])):$e("",!0)]))}},FI=kn(jI,[["__scopeId","data-v-ff4c3032"]]),VI={:3,:3,:3,:4,:4,:5,:6,:6,:6,:7,:7,:8,:9,:9,:7,:10,:10,:10,:10,:11,:13,:15,:2,:8,:5,:0,:2,:1,:1,:1,:1,:2,:2,:3,:3,:2,:4,:4,:4,:5,:4,:4,:5,:5,:5,:5,:4,:5,:5,:5,:5,:5,:5,:5,:5,:5,:6,:6,:6,:6,:6,:5,:7,:7,:7,:7,:7,:8,:8,:8,:8,:8,:8,:8,:9,:9,:9,:9,:9,:5,:10,:10,:11,"":11,:11,:11,:11,:11,"":11,:12,:12,:12,:12,"":13,"":13,:13,:13,"":14,:15,:15,:16,:16,:16,:17,"":19,:20,:23,:0,:1,:6,:3,:3,:3,:5,:6,:7,:13},WI={:"22P/2v243P33",:"3",:"312",:"312",:"4132",:"42",:"553",:"615000HP",:"6150002500/2500",:"63A1BCBC3",:"75",:"73",:"8HPHP",:"91551",:"922000/2",:"7212",:"101500110",:"102",:"1031",:"102v21",:"11/",:"132/2v210000/2",:"15150005+30001500050%50%",:"20HP2350%2/2v23HP2",:"83P2v2+15000HP3P1",:"5HP2",:"024",:"2HP525HP20%1",:"215000750032",:"112/2v232",:"1521",:"12+3+1+3+331",:"111013",:"21///2",:"311",:"311011052",:"4HPHP8932",:"3132",:"252v242",:"4150%HP500053",:"42HP10001",:"4HP1000030001",:"42232",:"53-5HP31",:"511",:"51HP232",:"51213",:"535",:"51HP500002/2v25",:"41HP150003HP315",:"5HP3HP44",:"5850%32",:"5	HP	2",:"5322232",:"5HPHPHP51",:"5",:"52",:"5101",:"532V2//52",:"65",:"6111",:"61121",:"61HP2500030/1/2/3HP1/1.25/1.5/212152",:"6HPHP1000010000HPHP<1000010%10000-199998%20000-299996%30000-399994%40000-499992%500001%2000HPHP20001",:'62P/2v2""575%/1',:"53",:"71HP32/2v25",:"713",:"711",:"7353",:"7,HP0HP800001000001",:"72HP2",:"8",:"81500",:"8///1",:"81HP50%13",:"821-1511-1532",:"81200010005001",:"81HP2000HP1",:"931",:"952V251",:"9HPHP15HP5HP<3000080000300001000001",:"9-111/119",:"91HP100003",:"513",:"101510000HP1",:"10135002/2v210001",:"11/14115","":"11122",:"11331250%1",:"11",:"11HP50%",:"1116+1915","":"1112",:"1211HPHPHPHP",:"121",:"12HP<10000HP>10000HP1001","":"131HPHP",:"131/11",:"131231",:"1311","":"13102","":"1412",:"15HP31",:"15HP20%1",:'16""2HPHP10%1)HP>HP>HPHP50%2)HPmax{HP,HP}HP50%3)HP<HP2',:"1611.5HP1",:"161////////////+1//////1",:"17HPXXXHP33%30%20%15%2%","":"1911",:"23HP1",:"1-813",:"11HPHP2",:"6HPHP1",:"322",:"332",:"12HP0HP33HP1"},zI=["","","","","","","","","","","","","","","","","","","","","","","",""],GI=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];function Xu(e){return e.map(n=>({name:n,cost:VI[n]||0,desc:WI[n]||""})).sort((n,t)=>n.cost-t.cost)}const JI={class:"modal-content"},YI={class:"modal-body"},KI={class:"skills-section"},ZI={class:"skill-header"},QI={class:"skill-description"},XI={class:"skills-section"},ek={class:"skill-header"},nk={class:"skill-description"},tk={__name:"SkillGuideModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:n}){const t=n,i=Oe(()=>Xu(zI)),s=Oe(()=>Xu(GI));function o(){t("update:modelValue",!1)}return(r,a)=>e.modelValue?(M(),j("div",{key:0,class:"modal-backdrop",onClick:Xn(o,["self"])},[p("div",JI,[p("div",{class:"modal-header"},[a[0]||(a[0]=p("h2",null,"",-1)),p("button",{class:"close-btn",onClick:o},"")]),p("div",YI,[a[1]||(a[1]=p("h3",{class:"section-title battle-title"},"",-1)),p("div",KI,[(M(!0),j(qe,null,en(i.value,l=>(M(),j("div",{key:l.name,class:"skill-card battle-skill"},[p("div",ZI," "+U(l.cost)+""+U(l.name),1),p("div",QI,U(l.desc),1)]))),128))]),a[2]||(a[2]=p("h3",{class:"section-title non-battle-title"},"",-1)),p("div",XI,[(M(!0),j(qe,null,en(s.value,l=>(M(),j("div",{key:l.name,class:"skill-card non-battle-skill"},[p("div",ek," "+U(l.cost)+""+U(l.name),1),p("div",nk,U(l.desc),1)]))),128))])])])])):$e("",!0)}},ik=kn(tk,[["__scopeId","data-v-852990c1"]]),Io={:{:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:'""',options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:'""',options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 7","B. 9","C. 11","D. 13"],answer:"A"},{question:'""',options:["A. ","B. 1949","C.  ","D. "],answer:"A"},{question:'""',options:["A.    ","B.     ","C.    ","D.  "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 2000","B. 2500","C. 3000","D. 3500"],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:'""',options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 2022","B. 2023","C. 2024","D. 2025"],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"2050",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1990",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 1979","B. 1981","C. 1983","D. 1985"],answer:"B"},{question:"1971115",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 1895","B. 1906","C. 1895","D. 1906"],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"1950",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"3000",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. 14","B. ","C. ","D. DNA"],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"798",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"19841",options:["A. ","B. ''","C. ","D. "],answer:"A"},{question:"1976",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"}]},:{:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 1991","B. 1992","C. 1993","D. 1994"],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:'""',options:["A. 1978","B. 1988","C. 1990","D. 1992"],answer:"C"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:'""',options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 1905","B. 1908","C. 1910","D. 1912"],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:'""',options:["A. 1842","B. 1849","C. 1860","D. 1895"],answer:"B"},{question:"2025",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 1963","B. 1970","C. 1975","D. 1980"],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"19431945",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. 1872","B. 1879","C. 1882","D. 1889"],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''2030",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"70",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"22,000",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1.5",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"14",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"}]},:{:[{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"GaWC 2024",options:["A. Alpha","B. Beta","C. Gamma","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"102025",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1921",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"2010",options:["A. 10.5","B. ","C. ","D. "],answer:"A"},{question:"1990",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"1990",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"2025''''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 20300","B. 30382","C. 25350","D. 40400"],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 35","B. 38","C. 41","D. 45"],answer:"C"},{question:"",options:["A. ++X","B. ","C. +","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 2500","B. 3000","C. 3500","D. 4000"],answer:"C"},{question:"",options:["A. PVC","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"}]},:{:[{question:"",options:["A. 1978","B. 1980","C. 1984","D. 1992"],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. 100","C. ''","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. 1980","B. 1990","C. 1991","D. 1992"],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 1990","B. 1992","C. 1994","D. 1996"],answer:"B"},{question:"4",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"1",options:["A. ","B. ","C. ","D. "],answer:"C"}],:[{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 2018","B. 2020","C. 2022","D. 2024"],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"2000",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1990",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 36","B. 46","C. 5","D. 56"],answer:"B"},{question:"200051",options:["A. 2","B. 3","C. 4","D. 5"],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"}]},:{:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. 1997","B. 1999","C. 2001","D. 2003"],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 18","B. 19","C. 20","D. 21"],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:'""',options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 1996","B. 1997","C. 1998","D. 1999"],answer:"C"},{question:"",options:["A. 1982","B. 1984","C. 1986","D. 1988"],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"'''Lamma Island'",options:["A. ","B. ","C. ''","D. "],answer:"D"},{question:"''19",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''19",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"1950",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"1970",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1980",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1990",options:["A. ","B. ","C. ","D. 360"],answer:"A"},{question:"2000",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"2020",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 12","B. 35","C. 58","D. 810"],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. 20","B. 22","C. 24","D. 26"],answer:"C"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. 1950","B. 1960","C. 1970","D. 1980"],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. 1973","B. 1975","C. 1977","D. 1979"],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. 1978","B. 1980","C. 1982","D. 1984"],answer:"B"},{question:"",options:["A. 2005","B. 2007","C. 2009","D. 2011"],answer:"B"},{question:"''",options:["A. 1982","B. 1984","C. 1986","D. 1988"],answer:"B"},{question:"",options:["A. 1995","B. 1997","C. 1999","D. 2001"],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"}]},:{:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"2025",options:["A. 1031","B. 111","C. 116","D. 118"],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1200",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"2010",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"2000",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"2010",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"2010",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"27",options:["A. 120","B. 140","C. 160","D. 180"],answer:"B"},{question:"24",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"}]},:{:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"1",options:["A. 2011","B. 2012","C. 2013","D. 2014"],answer:"B"},{question:"11",options:["A. 11","B. 9","C. 17","D. 2"],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:'""',options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''''800",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''5800",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"900",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"1980''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"1990",options:["A. ","B. 863","C. ","D. "],answer:"A"},{question:"200-350",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. 4","B. 5","C. 6","D. 7"],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"B"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"C"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"D"},{question:"''",options:["A. ","B. ","C. ","D. "],answer:"A"}]},DEFAULT:{:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"A"}],:[{question:"",options:["A. ","B. ","C. ","D. "],answer:"C"}],:[{question:"",options:["A. 31","B. 32","C. 33","D. 34"],answer:"D"}]}},sk={class:"modal-content"},ok={class:"modal-body"},rk={class:"city-title"},ak={class:"questions-section"},lk={class:"question-header"},ck={class:"question-options"},uk={class:"question-answer"},dk={class:"quiz-content"},fk={key:0},mk={class:"quiz-header"},hk={class:"quiz-progress"},pk={class:"quiz-question"},gk={class:"question-text"},yk={class:"quiz-options"},Ck=["onClick"],vk={key:1,class:"quiz-result"},_k={class:"result-score"},$k={class:"result-details"},wk={class:"result-review"},bk={class:"review-question"},Ak={class:"review-options"},Pk={class:"review-info"},Hk={class:"correct-answer-label"},xk={key:0,class:"user-answer-label"},Bk={key:1,class:"timeout-text"},Sk={__name:"QuestionBankModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:n}){const t=n,i=Oe(()=>Object.keys(Io).filter(ge=>ge!=="DEFAULT")),s=Ce(!1),o=Ce(!1),r=Ce({questions:[],currentIndex:0,answers:[],timer:null,timeLeft:15,score:0,correctCount:0,wrongCount:0,timeoutCount:0,reviewData:[]}),a=Oe(()=>r.value.currentIndex<r.value.questions.length?r.value.questions[r.value.currentIndex]:null);function l(ge){const R=Io[ge],Y=[];return R.&&Y.push(...R.),R.&&Y.push(...R.),Y}function u(ge){const R=[...ge.options],Y=ge.answer,V=R.map(P=>P.replace(/^[A-D]\.\s*/,"")),ee=[0,1,2,3];for(let P=ee.length-1;P>0;P--){const G=Math.floor(Math.random()*(P+1));[ee[P],ee[G]]=[ee[G],ee[P]]}const ue=["A","B","C","D"],de=ee.map((P,G)=>`${ue[G]}. ${V[P]}`),W=ue.indexOf(Y),Q=ee.indexOf(W),L=ue[Q];return{question:ge.question,options:de,answer:L}}function f(){const ge=[];Object.keys(Io).filter(ue=>ue!=="DEFAULT").forEach(ue=>{const de=Io[ue];de.&&de..forEach(W=>{const Q=u(W);ge.push({...Q,difficulty:"",city:ue})}),de.&&de..forEach(W=>{const Q=u(W);ge.push({...Q,difficulty:"",city:ue})}),de.&&de..forEach(W=>{const Q=u(W);ge.push({...Q,difficulty:"",city:ue})})});const Y=ge.sort(()=>Math.random()-.5),V=Y.filter(ue=>ue.difficulty!=="").slice(0,8),ee=Y.filter(ue=>ue.difficulty==="").slice(0,2);r.value={questions:[...V,...ee].sort(()=>Math.random()-.5),currentIndex:0,answers:[],timer:null,timeLeft:15,score:0,correctCount:0,wrongCount:0,timeoutCount:0,reviewData:[]},s.value=!0,o.value=!1,m()}function m(){clearInterval(r.value.timer),r.value.timeLeft=15,r.value.timer=setInterval(()=>{r.value.timeLeft--,r.value.timeLeft<=0&&v()},1e3)}function h(ge){clearInterval(r.value.timer);const R=r.value.questions[r.value.currentIndex],Y=ge===R.answer;r.value.answers.push({question:R.question,options:R.options,userAnswer:ge,correctAnswer:R.answer,isCorrect:Y}),Y?r.value.correctCount++:r.value.wrongCount++,S()}function v(){clearInterval(r.value.timer);const ge=r.value.questions[r.value.currentIndex];r.value.answers.push({question:ge.question,options:ge.options,userAnswer:null,correctAnswer:ge.answer,isCorrect:!1}),r.value.timeoutCount++,S()}function S(){r.value.currentIndex++,r.value.currentIndex>=r.value.questions.length?X():m()}function X(){clearInterval(r.value.timer),r.value.score=r.value.correctCount*10,r.value.reviewData=r.value.answers,o.value=!0}function ae(){clearInterval(r.value.timer),s.value=!1,o.value=!1}function fe(){ae(),t("update:modelValue",!1)}return Cl(()=>{clearInterval(r.value.timer)}),(ge,R)=>e.modelValue?(M(),j("div",{key:0,class:"modal-backdrop",onClick:Xn(fe,["self"])},[p("div",sk,[p("div",{class:"modal-header"},[R[0]||(R[0]=p("h2",null,"",-1)),p("button",{class:"close-btn",onClick:fe},"")]),p("div",ok,[p("div",{class:"quiz-start-section"},[p("button",{class:"quiz-start-btn",onClick:f},"   "),R[1]||(R[1]=p("div",{class:"quiz-hint"}," 10+8215100 ",-1))]),(M(!0),j(qe,null,en(i.value,Y=>(M(),j("div",{key:Y},[p("h3",rk,U(Y)+"",1),p("div",ak,[(M(!0),j(qe,null,en(l(Y),(V,ee)=>(M(),j("div",{key:`${Y}-${ee}`,class:"question-card"},[p("div",lk,U(ee+1)+". "+U(V.question),1),p("div",ck,[(M(!0),j(qe,null,en(V.options,ue=>(M(),j("div",{key:ue},U(ue),1))),128))]),p("div",uk," "+U(V.answer),1)]))),128))])]))),128))])]),s.value?(M(),j("div",{key:0,class:"quiz-modal",onClick:Xn(ae,["self"])},[p("div",dk,[o.value?(M(),j("div",vk,[R[3]||(R[3]=p("h2",{class:"result-title"},"",-1)),p("div",_k," "+U(r.value.score)+"/100 ",1),p("div",$k,[p("div",null,""+U(r.value.correctCount),1),p("div",null,""+U(r.value.wrongCount),1),p("div",null,""+U(r.value.timeoutCount),1)]),p("div",wk,[R[2]||(R[2]=p("h3",null,"",-1)),(M(!0),j(qe,null,en(r.value.reviewData,(Y,V)=>(M(),j("div",{key:V,class:ze(["review-item",{"review-correct":Y.isCorrect,"review-wrong":!Y.isCorrect&&Y.userAnswer,"review-timeout":!Y.userAnswer}])},[p("div",bk,U(V+1)+". "+U(Y.question),1),p("div",Ak,[(M(!0),j(qe,null,en(Y.options,(ee,ue)=>(M(),j("div",{key:ue,class:ze(["review-option",{"correct-option":ee.startsWith(Y.correctAnswer+"."),"user-option":Y.userAnswer&&ee.startsWith(Y.userAnswer+".")&&!Y.isCorrect}])},U(ee),3))),128))]),p("div",Pk,[p("span",Hk," "+U(Y.options.find(ee=>ee.startsWith(Y.correctAnswer+"."))),1),Y.userAnswer?(M(),j("span",xk," "+U(Y.options.find(ee=>ee.startsWith(Y.userAnswer+"."))),1)):(M(),j("span",Bk,"  "))])],2))),128))]),p("button",{class:"quiz-close-btn",onClick:ae},"  ")])):(M(),j("div",fk,[p("div",mk,[p("div",hk,"  "+U(r.value.currentIndex+1)+" / "+U(r.value.questions.length),1),p("div",{class:ze(["quiz-timer",{"timer-warning":r.value.timeLeft<=5}])},"  "+U(r.value.timeLeft)+" ",3)]),p("div",pk,[p("div",gk,U(a.value.question),1),p("div",yk,[(M(!0),j(qe,null,en(a.value.options,(Y,V)=>(M(),j("button",{key:V,class:"quiz-option-btn",onClick:ee=>h(Y[0])},U(Y),9,Ck))),128))])])]))])])):$e("",!0)])):$e("",!0)}},Ik=kn(Sk,[["__scopeId","data-v-a4aa511b"]]),kk={class:"modal-content"},Ek={class:"modal-body"},Tk={class:"search-section"},Rk={class:"province-title"},Nk={class:"cities-grid"},Mk={class:"city-header"},Dk={class:"city-name"},qk={key:0,class:"city-badge capital-badge"},Lk={class:"city-details"},Ok={class:"detail-row"},Uk={class:"detail-value"},jk={class:"detail-row"},Fk={class:"detail-value hp-value"},Vk={class:"detail-row skill-row"},Wk={key:0,class:"skill-name"},zk={key:1,class:"no-skill"},Gk={key:0,class:"skill-badges"},Jk={key:1,class:"skill-description"},Yk={__name:"CityInfoModal",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:n}){const t=n,i=Ce(""),s={:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""},o=Oe(()=>{const f=L0(),m={};for(const[h,v]of Object.entries(f))m[h]=v.map(S=>({name:S.name,province:h,hp:S.hp,isCapital:s.hasOwnProperty(S.name),capitalType:s[S.name]||"",skill:Un(S.name)}));return m}),r=Oe(()=>{if(!i.value.trim())return o.value;const f=i.value.toLowerCase(),m={};for(const[h,v]of Object.entries(o.value)){const S=v.filter(X=>X.name.toLowerCase().includes(f)||h.toLowerCase().includes(f));S.length>0&&(m[h]=S)}return m});function a(f){return{[x.PASSIVE]:"",[x.ACTIVE]:"",[x.TOGGLE]:""}[f]||""}function l(f){return f==="battle"?"":f==="nonBattle"?"":""}function u(){t("update:modelValue",!1)}return(f,m)=>e.modelValue?(M(),j("div",{key:0,class:"modal-backdrop",onClick:Xn(u,["self"])},[p("div",kk,[p("div",{class:"modal-header"},[m[1]||(m[1]=p("h2",null,"",-1)),p("button",{class:"close-btn",onClick:u},"")]),p("div",Ek,[p("div",Tk,[ft(p("input",{"onUpdate:modelValue":m[0]||(m[0]=h=>i.value=h),type:"text",placeholder:"...",class:"search-input"},null,512),[[uo,i.value]])]),(M(!0),j(qe,null,en(r.value,(h,v)=>(M(),j("div",{key:v},[p("h3",Rk,U(v),1),p("div",Nk,[(M(!0),j(qe,null,en(h,S=>(M(),j("div",{key:S.name,class:"city-info-card"},[p("div",Mk,[p("span",Dk,U(S.name),1),S.isCapital?(M(),j("span",qk,U(S.capitalType),1)):$e("",!0)]),p("div",Lk,[p("div",Ok,[m[2]||(m[2]=p("span",{class:"detail-label"},"",-1)),p("span",Uk,U(S.province),1)]),p("div",jk,[m[3]||(m[3]=p("span",{class:"detail-label"},"HP",-1)),p("span",Fk,U(S.hp.toLocaleString()),1)]),p("div",Vk,[m[4]||(m[4]=p("span",{class:"detail-label"},"",-1)),S.skill?(M(),j("span",Wk,U(S.skill.name),1)):(M(),j("span",zk,"  "))]),S.skill?(M(),j("div",Gk,[p("span",{class:ze(["skill-type-badge",`skill-type--${S.skill.type}`])},U(a(S.skill.type)),3),p("span",{class:ze(["skill-category-badge",`skill-category--${S.skill.category}`])},U(l(S.skill.category)),3)])):$e("",!0),S.skill?(M(),j("div",Jk,U(S.skill.description),1)):$e("",!0)])]))),128))])]))),128))])])])):$e("",!0)}},Kk=kn(Yk,[["__scopeId","data-v-3db068fc"]]),Zk={class:"notification-container"},Qk=["onClick"],Xk={__name:"NotificationContainer",setup(e){const{notifications:n}=pi();return(t,i)=>(M(),bn(Up,{to:"body"},[p("div",Zk,[Ln(d0,{name:"notification"},{default:Fs(()=>[(M(!0),j(qe,null,en(Fe(n),s=>(M(),j("div",{key:s.id,class:ze(["notification",`notification--${s.type}`,{"notification--visible":s.visible}]),onClick:o=>t.$emit("close",s.id)},U(s.message),11,Qk))),128))]),_:1})])]))}},eE=kn(Xk,[["__scopeId","data-v-431f4e65"]]),nE={id:"app"},tE={__name:"App",setup(e){const n=Ce("menu"),t=Ce(!1),i=Ce(!1),s=Ce(!1);return(o,r)=>(M(),j("div",nE,[n.value==="menu"?(M(),bn(M0,{key:0,onEnterPlayerMode:r[0]||(r[0]=a=>n.value="player"),onShowSkillGuide:r[1]||(r[1]=a=>t.value=!0),onShowQuestionBank:r[2]||(r[2]=a=>i.value=!0),onShowCityInfo:r[3]||(r[3]=a=>s.value=!0)})):$e("",!0),n.value==="player"?(M(),bn(FI,{key:1,onExit:r[4]||(r[4]=a=>n.value="menu")})):$e("",!0),Ln(ik,{modelValue:t.value,"onUpdate:modelValue":r[5]||(r[5]=a=>t.value=a)},null,8,["modelValue"]),Ln(Ik,{modelValue:i.value,"onUpdate:modelValue":r[6]||(r[6]=a=>i.value=a)},null,8,["modelValue"]),Ln(Kk,{modelValue:s.value,"onUpdate:modelValue":r[7]||(r[7]=a=>s.value=a)},null,8,["modelValue"]),Ln(eE)]))}},Oh=b0(tE),iE=H0();Oh.use(iE);Oh.mount("#app");
